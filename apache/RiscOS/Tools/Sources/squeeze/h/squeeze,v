head	1.3;
access;
symbols
	squeeze-5_17:1.3
	squeeze-5_16:1.3
	squeeze-5_15:1.3
	squeeze-5_14:1.3
	squeeze-5_13:1.3
	squeeze-5_12:1.3
	squeeze-5_11:1.3
	squeeze-5_10:1.3
	squeeze-5_09-2:1.3
	squeeze-5_09:1.3
	squeeze-5_08:1.3
	squeeze-5_07:1.2
	squeeze-5_06:1.2
	squeeze-5_05:1.2
	squeeze-5_04:1.2
	squeeze-5_03:1.2
	squeeze-5_02:1.1.1.1
	squeeze-5_01:1.1.1.1
	squeeze-5_00:1.1.1.1
	initial:1.1.1.1
	TRUNK:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2002.10.15.10.34.52;	author kbracey;	state Exp;
branches;
next	1.2;

1.2
date	99.12.10.14.42.30;	author sbrodie;	state Exp;
branches;
next	1.1;

1.1
date	99.02.10.12.55.24;	author sbrodie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.02.10.12.55.24;	author sbrodie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Compression of non-AIF images was broken.
xpand would correctly decompress old non-AIF images, and the broken non-AIF
images generated by recent versions of squeeze, but needed to be changed to
also decompress the new non-AIF images.
Memory limit check now always occurs if running in the application slot,
regardless of whether we were loaded at &8000 - the check was not performed
reliably for non-AIF images either.

Version 5.08. Tagged as 'squeeze-5_08'
@
text
@/* Copyright 1999 Element 14 Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
typedef unsigned int word;
typedef enum { NO, YES } bool;

typedef struct aifhdr {
    word  bl_decompress;
    word  bl_selfreloc;
    word  bl_zeroinit;
    word  bl_imageentry;
    word  swi_exit;
    int   codesize;
    int   datasize;
    int   debugsize;
    int   zerosize;
    int   debugtype;
    int   imagebase;
    int   reserved[5];
    word  zeroinit[16];
} aifhdr;

#define AIFBYTES   sizeof(aifhdr)  /* size in bytes of an AIF header */
#define AIFWORDS   (AIFBYTES / sizeof(int))
#define AIFPRELUDE 5 /* no of extra instructions in AIF decompression */
#define PREFETCH   2 /* words of ARM prefetch */

typedef struct datahdr {
    word  bl_decompress;
    word  datamagic;
    word  load;
    word  exec;
    word  size;
} datahdr;

#define DATABYTES sizeof(datahdr)
#define DATAWORDS (DATABYTES / sizeof(int))
#define DATAMAGIC 0x213542
#define SQUEEZED 0xffffea00

typedef struct SqueezeHeader {
  int decodedsize;
  int encodedsize;
  int encodedtabs;
  int nshorts;
  int nlongs;
  int bytestomove;
} SqueezeHeader;

#define SQUEEZEBYTES sizeof(SqueezeHeader)
#define SQUEEZEWORDS (SQUEEZEBYTES / sizeof(int))

#define B 0xea000000
#define BL 0xeb000000
#define B_OFFSET 0x00ffffff
#define MOV_PC_R8 0xe1a0f008
#define ADD_R8_R8_0 0xe2888000
#define SUB_R8_R8_0 0xe2488000
#define MOV_R0_R0 0xe1a00000
#define LDR_PC_R8_MINUS4 0xe518f004
#define NV (0xf0000000 - 0xe0000000)
#define SUB_R1_R8_IMM4 (0xE2481004)
#define SWI_XOS_SynchroniseCodeAreas (0xEF02006E)
@


1.2
log
@  Squeeze code adjusted to be StrongARM compatible.
Detail:
  The code inserted by squeeze into an application to perform
    unsqueezing is now StrongARM compatible and no longer relies
    on the presence of the UnsqueezeAIF module.  Since it has
    better information on what it's been updating, it can actually
    make a superior call to OS_SynchroniseCodeAreas marking the
    exact area of memory that it has updated.
Admin:
  Tested on Risc PC with UnsqueezeAIF unplugged.

Version 5.03. Tagged as 'squeeze-5_03'
@
text
@d36 1
a36 1
#define AIFPRELUDE 3 /* no of extra instructions in AIF decompression */
@


1.1
log
@Initial revision
@
text
@d73 2
@


1.1.1.1
log
@  Import of sources to squeeze tool from Aquarius.
  Also contains sources to xpand tool.
Detail:
  Updated to take version numbers and dates from VersionNum
    but otherwise unchanged.
Admin:
  Changed to use srccommit.
  Initial VersionNum file faked to represent current version.

Tagged as squeeze-5_00

@
text
@@
