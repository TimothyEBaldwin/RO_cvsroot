head	1.11;
access;
symbols
	BuildSys-7_30:1.11
	BuildSys-7_29:1.11
	BuildSys-7_28:1.11
	BuildSys-7_27:1.11
	BuildSys-7_26:1.11
	BuildSys-7_25:1.11
	BuildSys-7_24:1.11
	BuildSys-7_23:1.11
	BuildSys-7_22:1.11
	BuildSys-7_21:1.11
	BuildSys-7_20:1.11
	BuildSys-7_19:1.11
	BuildSys-7_18:1.11
	BuildSys-7_17:1.11
	BuildSys-7_16:1.11
	BuildSys-7_15:1.11
	BuildSys-7_14:1.11
	BuildSys-7_13:1.11
	BuildSys-7_12:1.11
	BuildSys-7_11:1.11
	BuildSys-7_10:1.11
	BuildSys-7_09:1.11
	BuildSys-6_00-1_142_2_10:1.6.2.4
	BuildSys-7_08:1.11
	BuildSys-7_07:1.11
	BuildSys-7_06:1.11
	BuildSys-7_05:1.11
	BuildSys-6_00-1_142_2_9:1.6.2.4
	BuildSys-7_04:1.11
	BuildSys-7_03:1.11
	BuildSys-7_02:1.11
	BuildSys-7_01:1.11
	BuildSys-7_00:1.11
	BuildSys-6_99:1.11
	BuildSys-6_98:1.11
	BuildSys-6_97:1.11
	BuildSys-6_96:1.11
	BuildSys-6_95:1.11
	BuildSys-6_94:1.11
	BuildSys-6_93:1.11
	BuildSys-6_92:1.11
	BuildSys-6_91:1.11
	BuildSys-6_90:1.11
	BuildSys-6_89:1.11
	BuildSys-6_81-1:1.11
	BuildSys-6_88:1.11
	BuildSys-6_87:1.11
	BuildSys-6_86:1.11
	BuildSys-6_85:1.11
	BuildSys-6_84:1.11
	BuildSys-6_83:1.11
	BuildSys-6_82:1.11
	BuildSys-6_81:1.11
	BuildSys-6_80:1.11
	BuildSys-6_79:1.11
	BuildSys-6_78:1.11
	BuildSys-6_77:1.11
	BuildSys-6_76:1.11
	BuildSys-6_75:1.11
	BuildSys-6_74:1.11
	BuildSys-6_73:1.11
	BuildSys-6_72:1.11
	BuildSys-6_71:1.11
	BuildSys-6_70:1.11
	BuildSys-6_69:1.11
	BuildSys-6_68:1.11
	BuildSys-6_67:1.11
	BuildSys-6_66-1:1.11
	BuildSys-6_66:1.11
	BuildSys-6_65:1.11
	BuildSys-6_00-1_142_2_8:1.6.2.3
	BuildSys-6_00-1_142_2_7:1.6.2.3
	BuildSys-6_00-1_142_2_6:1.6.2.3
	BuildSys-6_64:1.11
	BuildSys-6_63:1.11
	BuildSys-6_62:1.11
	BuildSys-6_61:1.11
	BuildSys-6_60:1.11
	BuildSys-6_59:1.10
	BuildSys-6_58:1.10
	BuildSys-6_57:1.10
	BuildSys-6_56:1.10
	BuildSys-6_55:1.10
	BuildSys-6_54:1.10
	BuildSys-6_53:1.10
	BuildSys-6_00-1_142_2_5:1.6.2.2
	BuildSys-6_52:1.9
	BuildSys-6_51:1.9
	BuildSys-6_50:1.8
	BuildSys-6_49:1.8
	BuildSys-6_48:1.8
	BuildSys-6_47:1.8
	BuildSys-6_46:1.8
	BuildSys-6_45:1.8
	BuildSys-6_44:1.8
	BuildSys-6_43:1.8
	BuildSys-6_42:1.8
	BuildSys-6_41:1.8
	BuildSys-6_40:1.8
	BuildSys-6_39:1.8
	BuildSys-6_38:1.8
	BuildSys-6_00-1_142_2_4:1.6.2.1
	BuildSys-6_37:1.8
	BuildSys-6_36:1.8
	BuildSys-6_35:1.8
	BuildSys-6_34:1.8
	BuildSys-6_33:1.8
	BuildSys-6_32:1.8
	BuildSys-6_31:1.7
	BuildSys-6_30:1.7
	BuildSys-6_29:1.7
	BuildSys-6_28:1.7
	BuildSys-6_27:1.7
	BuildSys-6_26:1.7
	BuildSys-6_25:1.7
	BuildSys-6_24:1.7
	BuildSys-6_23:1.7
	BuildSys-6_22:1.7
	BuildSys-6_21:1.7
	BuildSys-6_20:1.7
	BuildSys-6_00-1_142_2_3:1.6
	BuildSys-6_19:1.6
	BuildSys-6_18:1.6
	BuildSys-6_17:1.6
	BuildSys-6_16:1.6
	BuildSys-6_15:1.6
	BuildSys-6_14:1.6
	BuildSys-6_13:1.6
	BuildSys-6_12:1.6
	BuildSys-6_00-1_142_2_2:1.6
	BuildSys-6_11:1.6
	BuildSys-6_10:1.6
	BuildSys-6_09:1.6
	BuildSys-6_08:1.6
	BuildSys-6_07:1.6
	BuildSys-6_06:1.6
	BuildSys-6_05:1.6
	BuildSys-6_04:1.6
	BuildSys-6_03:1.6
	BuildSys-6_02:1.6
	BuildSys-6_01:1.6
	BuildSys-6_00-1_142_2_1:1.6
	RPiFreeze:1.6.0.2
	BuildSys-6_00:1.6
	BuildSys-5_99:1.6
	BuildSys-5_98:1.6
	BuildSys-5_97:1.6
	BuildSys-5_96:1.6
	BuildSys-5_95:1.6
	BuildSys-5_94:1.6
	BuildSys-5_93:1.6
	BuildSys-5_92:1.6
	BuildSys-5_91:1.6
	BuildSys-5_90:1.6
	BuildSys-5_89:1.6
	BuildSys-5_88:1.6
	BuildSys-5_87:1.6
	BuildSys-5_86:1.6
	BuildSys-5_85:1.6
	BuildSys-5_84:1.6
	BuildSys-5_83:1.6
	BuildSys-5_82:1.6
	BuildSys-5_81:1.6
	BuildSys-5_80:1.6
	BuildSys-5_79:1.6
	BuildSys-5_78:1.6
	BuildSys-5_77:1.6
	BuildSys-5_76:1.6
	BuildSys-5_75:1.6
	BuildSys-5_74:1.6
	BuildSys-5_73:1.6
	BuildSys-5_72:1.6
	BuildSys-5_71:1.6
	BuildSys-5_70:1.6
	BuildSys-5_69:1.6
	BuildSys-5_68:1.6
	BuildSys-5_67:1.6
	BuildSys-5_66:1.6
	BuildSys-5_65:1.6
	BuildSys-5_64:1.6
	BuildSys-5_63:1.6
	BuildSys-5_62:1.6
	BuildSys-5_61:1.6
	BuildSys-5_60:1.6
	BuildSys-5_59:1.6
	BuildSys-5_58:1.6
	BuildSys-5_57:1.6
	BuildSys-5_56:1.6
	BuildSys-5_55:1.6
	BuildSys-5_54:1.6
	BuildSys-5_53:1.6
	BuildSys-5_52:1.6
	BuildSys-5_51:1.6
	BuildSys-5_50:1.6
	BuildSys-5_49:1.6
	BuildSys-5_48:1.6
	BuildSys-5_47:1.6
	BuildSys-5_46:1.6
	BuildSys-5_45:1.6
	BuildSys-5_44:1.6
	BuildSys-5_43:1.6
	BuildSys-5_42:1.6
	BuildSys-5_41:1.5
	BuildSys-5_40:1.5
	BuildSys-5_39:1.5
	BuildSys-5_38:1.5
	BuildSys-5_37:1.5
	BuildSys-5_36:1.5
	BuildSys-5_35:1.5
	BuildSys-5_34:1.5
	BuildSys-5_33:1.5
	BuildSys-5_32:1.5
	BuildSys-5_31:1.5
	BuildSys-5_30:1.5
	BuildSys-5_29:1.5
	BuildSys-5_28:1.5
	BuildSys-5_27:1.5
	BuildSys-5_26:1.5
	BuildSys-5_25:1.5
	BuildSys-5_24:1.5
	BuildSys-5_23:1.5
	BuildSys-5_22:1.5
	BuildSys-5_21:1.5
	BuildSys-5_20:1.4
	BuildSys-5_19:1.4
	BuildSys-5_18:1.4
	BuildSys-5_17:1.4
	BuildSys-5_16:1.4
	BuildSys-5_15:1.4
	BuildSys-5_14:1.4
	BuildSys-5_13:1.4
	BuildSys-5_12:1.4
	BuildSys-5_11:1.3
	BuildSys-5_10:1.3
	BuildSys-5_09:1.3
	BuildSys-5_08:1.3
	BuildSys-5_07:1.3
	BuildSys-5_06:1.3
	BuildSys-5_05:1.3
	BuildSys-5_04:1.3
	BuildSys-5_03:1.3
	BuildSys-5_02:1.2
	BuildSys-5_01:1.2
	BuildSys-5_00:1.1
	BuildSys-4_99:1.1
	BuildSys-4_98:1.1
	BuildSys-4_97:1.1
	BuildSys-4_96:1.1
	BuildSys-4_95:1.1
	BuildSys-4_94:1.1
	BuildSys-4_93:1.1
	BuildSys-4_92:1.1
	BuildSys-4_91:1.1
	BuildSys-4_90:1.1
	BuildSys-4_89:1.1
	BuildSys-4_88:1.1
	BuildSys-4_87:1.1
	BuildSys-4_86:1.1
	BuildSys-4_85:1.1
	BuildSys-4_84:1.1
	BuildSys-4_83:1.1
	BuildSys-4_82:1.1
	BuildSys-4_81:1.1
	BuildSys-4_80:1.1
	BuildSys-4_79:1.1
	BuildSys-4_78:1.1
	BuildSys-4_77:1.1
	BuildSys-4_76:1.1
	BuildSys-4_75:1.1
	BuildSys-4_74:1.1
	BuildSys-4_73:1.1
	BuildSys-4_72:1.1
	BuildSys-4_71:1.1
	BuildSys-4_70:1.1
	BuildSys-4_69:1.1
	BuildSys-4_68:1.1
	BuildSys-4_67:1.1
	BuildSys-4_66:1.1
	BuildSys-4_65:1.1
	BuildSys-4_64:1.1
	BuildSys-4_63:1.1
	BuildSys-4_62:1.1
	Batch4:1.1;
locks; strict;
comment	@# @;


1.11
date	2014.10.24.12.36.49;	author rsprowson;	state Exp;
branches;
next	1.10;
commitid	FCeT0nrCnPiO5sVx;

1.10
date	2014.10.12.13.46.47;	author srevill;	state Exp;
branches;
next	1.9;
commitid	2xVUVkYMczzJRUTx;

1.9
date	2014.10.01.00.15.43;	author jlee;	state Exp;
branches;
next	1.8;
commitid	4A6uXS2L62XpJqSx;

1.8
date	2013.11.11.00.50.38;	author bavison;	state Exp;
branches;
next	1.7;
commitid	Tr3fHk0Gie15lNcx;

1.7
date	2013.07.15.19.29.13;	author rsprowson;	state Exp;
branches;
next	1.6;
commitid	GNr5gJlFE3iZlBXw;

1.6
date	2012.02.05.09.13.26;	author rsprowson;	state Exp;
branches
	1.6.2.1;
next	1.5;
commitid	XCR9w41JK8TYQWRv;

1.5
date	2011.09.12.23.00.49;	author bavison;	state Exp;
branches;
next	1.4;
commitid	mwF3dZUt3oUN7gzv;

1.4
date	2011.03.31.00.04.06;	author bavison;	state Exp;
branches;
next	1.3;
commitid	BfewXnm4kl3lOVdv;

1.3
date	2010.10.20.23.14.27;	author bavison;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.19.14.47.58;	author bavison;	state Exp;
branches;
next	1.1;

1.1
date	2008.10.14.21.29.37;	author bavison;	state Exp;
branches;
next	;

1.6.2.1
date	2014.02.20.21.02.48;	author rsprowson;	state Exp;
branches;
next	1.6.2.2;
commitid	HvOFwLQ3c6PzNSpx;

1.6.2.2
date	2014.10.12.10.36.30;	author rsprowson;	state Exp;
branches;
next	1.6.2.3;
commitid	tHT6hsrmkNpoOTTx;

1.6.2.3
date	2015.02.12.20.30.56;	author rsprowson;	state Exp;
branches;
next	1.6.2.4;
commitid	joerV7rvwrTd9L9y;

1.6.2.4
date	2017.02.21.08.36.59;	author rsprowson;	state Exp;
branches;
next	;
commitid	yeUPZ9XHdm2zpNGz;


desc
@@


1.11
log
@Do 'rom_link' against the same thing you do 'rom' with
During the rom phase, ROM C modules would be linked against ${ROMCSTUBS}, ie. clib.
During the rom_link phase, they'd be linked against ${ABSSYM}, ie. clib and rlib.
As RISC_OSLib contains various wimp_ symbol names which clash with ${WIMPLIB} from the Toolbox, so you can't write a ROMmable C module which links against the Toolbox and uses the shared makefiles.

We define a new variable ROM_SYMS which is initialised to ${C_ABSSYM}, ie. just the clib to match the stubs used during the rom phase, and the ${ROMCSTUBS} is now appended to ${ROM_LIBS} so it can be overridden rather than being hardwired into the rule.
For completeness SA_LIBS can now also be overridden to remove ${CLIB} if desired.

CApp/CLibrary now use ${NOP} silently.

Version 6.60. Tagged as 'BuildSys-6_60'
@
text
@# Copyright 2008 Castle Technology Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile fragment for C and C++ applications

INCLUDED_CAPP = YES

#
# $Id: CApp,v 1.10 2014/10/12 13:46:47 srevill Exp $
#
# This makefile provides the following phony targets:
#
#    all  install  debug
#
#
# This fragment uses the following macros set by the master makefile.
#
#
# COMPONENT                 (the name of the component)
# TARGET              (opt) (the leafname of the application - otherwise ${COMPONENT})
# DBG_TARGET          (opt) (debug application leafname - otherwise ${TARGET}-D)
# INSTAPP             (opt) (the application target directory - otherwise ${INSTDIR}.!${COMPONENT})
# INSTDIR             (opt) (the target directory - otherwise <Install$Dir>.${TARGET})
# DIRS                (opt) (stamp object for directory creation - otherwise o._dirs)
# OBJS                (opt) (object files, no o. prefixes - otherwise ${TARGET})
# APP_OBJS            (opt) (release build object files, no prefixes - otherwise ${OBJS})
# DBG_OBJS            (opt) (debug build object files, no prefixes - otherwise ${OBJS})
# LIBS                (opt) (extra libraries; ${CLIB} is always used)
# APP_LIBS            (opt) (extra release libraries - otherwise ${LIBS}; ${CLIB} is always used)
# DBG_LIBS            (opt) (extra debug libraries - otherwise ${LIBS}; ${CLIB} and ${DEBUGLIBS} always used)
# LINK_TYPE           (opt) (variant of linking command, eg C++ - defaults to C)
# INSTTYPE            (opt) (use "tool" or "app" to install executable vs application - defaults to "tool")
# INSTAPP_FILES       (opt) (list of files to be installed in application directory - use InstRes specification rules)
# INSTAPP_DEPENDS     (opt) (list of dependencies to be satisfied before doing application install - ${TARGET} assumed if in INSTAPP_FILES)
# INSTAPP_VERSION     (opt) (list of Messages/!Run/Desc files to insert app version from VersionNum - include in INSTAPP_FILES as well)
# CUSTOMLINK          (opt) (set to "custom" to override the link rule)
# CUSTOMINSTALLAPP    (opt) (set to "custom" to override the install rule for resource files)
# CUSTOMINSTALLTOOL   (opt) (set to "custom" to override the install rule for target binary)
# CUSTOMINSTALLDBGAPP (opt) (set to "custom" to override the install rule for debug resources)
#
#
# It relies on the following generic tool macros from the StdTools makefile
#
#
# C + CFLAGS       (C compiler; CDFLAGS also used in debug builds; -g implicit)
# CP + CPFLAGS     (copy, cp etc.)
# WIPE + WFLAGS    (recursive delete)
# RM               (non-recursive delete)
# AS + ASFLAGS     (assembler)
# LD + LDFLAGS     (linker; LDDFLAGS also used in debug builds; -d implicit)
# SQZ + SQZFLAGS   (binary compressor)
# MKDIR            (cdir/mkdir -p)
# ECHO
# TOUCH            (create/touch)
# INSERTVERSION    (awk script to substitute from VersionNum)
# CHMOD            (file permission manipulation)
#
#
# It relies on the following from the StdRules makefile
#
#
# .c.o  .c++.o  .cpp.o  .s.o
#
#
# It relies on the following from the DbgRules makefile
#
#
# CDFLAGS  C++DFLAGS  ASDFLAGS  LDDFLAGS
# .c.od  .c++.od  .cpp.od  .s.od
#
#

INSTALLDIR    = <Install$Dir>

TARGET       ?= ${COMPONENT}
DBG_TARGET   ?= ${TARGET}-D
INSTDIR      ?= ${INSTALLDIR}.${TARGET}
INSTAPP      ?= ${INSTDIR}.!${COMPONENT}
DIRS         ?= o._dirs
OBJS         ?= ${TARGET}
APP_OBJS     ?= ${OBJS}
DBG_OBJS     ?= ${OBJS}
APP_LIBS     ?= ${LIBS}
DBG_LIBS     ?= ${LIBS}
ifeq (C++,${LINK_TYPE})
APP_LIBS     += ${C++LIB}
DBG_LIBS     += ${C++LIB}
endif
APP_LIBS     += ${CLIB}
DBG_LIBS     += ${DEBUGLIBS} ${CLIB}

APP_OBJS_     = $(addprefix o.,${APP_OBJS})
DBG_OBJS_     = $(addprefix od.,${DBG_OBJS})

ifeq ("${INCLUDED_STDTOOLS}","")
ifeq ("${INCLUDED_HOSTTOOLS}","")
include StdTools
endif
endif
ifeq ("${INCLUDED_APPLIBS}","")
include AppLibs
endif

ifeq ("${INCLUDED_APPSTDRULE}","")
include AppStdRule
endif
ifeq ("${INCLUDED_DBGRULES}","")
include DbgRules
endif

all: ${TARGET}
        @@${ECHO} ${COMPONENT}: application built

${DIRS} ::
        ${MKDIR} o
        ${MKDIR} od
        ${TOUCH} $@@

clean ::
        @@IfThere o  Then ${ECHO} ${WIPE} o ${WFLAGS}
        @@IfThere o  Then ${WIPE} o ${WFLAGS}
        @@IfThere od Then ${ECHO} ${WIPE} od ${WFLAGS}
        @@IfThere od Then ${WIPE} od ${WFLAGS}
        ${RM} ${TARGET}
        ${RM} ${DBG_TARGET}
        @@${ECHO} ${COMPONENT}: cleaned

install: install_${INSTTYPE}

install_: install_tool
        @@${NOP}

INSTAPP_DEPENDS += $(filter ${TARGET},${INSTAPP_FILES})

install_app${CUSTOMINSTALLAPP}: ${INSTAPP_DEPENDS}
        ${MKDIR} ${INSTAPP}
        ${INSTRES} -I Resources.${USERIF}.${LOCALE},Resources.${USERIF}.UK,Resources.${LOCALE},Resources.UK,Resources ${INSTAPP} ${INSTAPP_FILES}
ifneq (,$(filter Messages,${INSTAPP_VERSION}))
        ${CHMOD} +w ${INSTAPP}.Messages
        ${INSERTVERSION} LocalRes:Messages > ${INSTAPP}.Messages
endif
ifneq (,$(filter Desc,${INSTAPP_VERSION}))
        ${CHMOD} +w ${INSTAPP}.Desc
        ${INSERTVERSION} descmode=1 LocalRes:Desc > ${INSTAPP}.Desc
endif
ifneq (,$(filter !Run,${INSTAPP_VERSION}))
        ${CHMOD} +w ${INSTAPP}.!Run
        ${INSERTVERSION} obeymode=1 LocalRes:!Run > ${INSTAPP}.!Run
        ${SETTYPE} ${INSTAPP}.!Run Obey
endif
        @@${ECHO} ${COMPONENT}: application installation complete

install_debug_app${CUSTOMINSTALLDBGAPP}: ${DBG_TARGET} install_app
        ${CP} ${DBG_TARGET} ${INSTAPP}.${TARGET} ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: ${TARGET} replaced with ${DBG_TARGET}

install_tool${CUSTOMINSTALLTOOL}: ${TARGET}
        ${MKDIR} ${INSTDIR}
        ${CP} ${TARGET} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: tool installation complete

debug: ${DBG_TARGET}
        @@${ECHO} ${COMPONENT}: debug application built

${TARGET}${CUSTOMLINK}: ${APP_OBJS_} ${APP_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} -o ${TARGET} ${APP_OBJS_} ${APP_LIBS}
        ${SQZ} ${SQZFLAGS} $@@

${DBG_TARGET}${CUSTOMLINK}: ${DBG_OBJS_} ${DBG_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} ${LDDFLAGS} -o ${DBG_TARGET} ${DBG_OBJS_} ${DBG_LIBS}

# EOF
@


1.10
log
@Various updates generally associated with CTools builds.

Components (ROOL CTools):
  * Added new components (ITable, BlendTable, RTC) for exports
  * Switch to using Install: rather than <Install$Dir> to help CLX
  * Replace CToolsCD component with DDE component
ModuleDB tweaks:
  * Added the (closed source) DDE resources component
  * Added a component for BuildSys itself (so DDE can get the Makefiles)
Shared makefile tweadded ERASECVS to the standard tools
  * Added a verbose copy flags CPVFLAGS for big copy operations
  * Added "install" rule for debug app builds (amu install INSTTYPE=debug)

Version 6.53. Tagged as 'BuildSys-6_53'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.9 2014/10/01 00:15:43 jlee Exp $
d142 1
a142 1
        ${NOP}
@


1.9
log
@Fix some Disc build errors
Detail:
  Makefiles/AAsmModule - Reintroduce IfThere check of LocalRes:Messages, so that components which don't have any messages file will build correctly once again
  Makefiles/CApp - Ensure ${INSERTVERSION}'d files are writable; fixes errors when performing repeated Disc builds of components which mark their install directory tree as readonly.
Admin:
  Fixes issue reported on forums with DDEUtils not being present in recent disc images:
  https://www.riscosopen.org/forum/forums/11/topics/2848


Version 6.51. Tagged as 'BuildSys-6_51'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.8 2013/11/11 00:50:38 bavison Exp $
d30 21
a50 20
# COMPONENT               (the name of the component)
# TARGET            (opt) (the leafname of the application - otherwise ${COMPONENT})
# DBG_TARGET        (opt) (debug application leafname - otherwise ${TARGET}-D)
# INSTAPP           (opt) (the application target directory - otherwise ${INSTDIR}.!${COMPONENT})
# INSTDIR           (opt) (the target directory - otherwise <Install$Dir>.${TARGET})
# DIRS              (opt) (stamp object for directory creation - otherwise o._dirs)
# OBJS              (opt) (object files, no o. prefixes - otherwise ${TARGET})
# APP_OBJS          (opt) (release build object files, no prefixes - otherwise ${OBJS})
# DBG_OBJS          (opt) (debug build object files, no prefixes - otherwise ${OBJS})
# LIBS              (opt) (extra libraries; ${CLIB} is always used)
# APP_LIBS          (opt) (extra release libraries - otherwise ${LIBS}; ${CLIB} is always used)
# DBG_LIBS          (opt) (extra debug libraries - otherwise ${LIBS}; ${CLIB} and ${DEBUGLIBS} always used)
# LINK_TYPE         (opt) (variant of linking command, eg C++ - defaults to C)
# INSTTYPE          (opt) (use "tool" or "app" to install executable vs application - defaults to "tool")
# INSTAPP_FILES     (opt) (list of files to be installed in application directory - use InstRes specification rules)
# INSTAPP_DEPENDS   (opt) (list of dependencies to be satisfied before doing application install - ${TARGET} assumed if in INSTAPP_FILES)
# INSTAPP_VERSION   (opt) (list of Messages/!Run/Desc files to insert app version from VersionNum - include in INSTAPP_FILES as well)
# CUSTOMLINK        (opt) (set to "custom" to override the link rule)
# CUSTOMINSTALLAPP  (opt) (set to "custom" to override the install rule for resource files)
# CUSTOMINSTALLTOOL (opt) (set to "custom" to override the install rule for target binary)
d152 1
a152 1
endif        
d156 1
a156 1
endif        
d161 1
a161 1
endif        
d164 4
@


1.8
log
@  Changes to keep GNUmakefiles and Makefiles compatible
Detail:
  Makefiles/CApp:
  * Naming of object file variables rationalised in line with CModule
  * Noted that INSTAPP_VERSION files must also be present in INSTAPP_FILES for
    compatibility with GNUmakefiles - requires changes to individual top-level
    makefiles, but not BuildSys
  Makefiles/CLibrary:
  * Naming of object file variables rationalised in line with CModule
  Makefiles/CModule:
  * Removed unused variable OBJS_
  Makefiles/StdTools:
  * Retired TIDYDESC
  GNUmakefiles/AppLibs:
  * Add CONLIB, RMVSN, SYNCLIB
  GNUmakefiles/CApp:
  * Default definition of INSTAPP
  * Naming of object file variables rationalised in line with CModule
  * CLEAN_DEPEND removed, clean made a double-colon rule (it's worth noting
    that such additional clean rules are now only executed from the component's
    top-level directory: this was not true for the old extra_clean rules that
    this replaces, in the GNUmakefiles case)
  * Rename of INSTALLAPPFILES to INSTAPP_FILES
  * Rename of INSTALLAPP_DEPEND to INSTAPP_DEPENDS
  * Insertion of component version into Desc files now done using AwkVers
    script rather than the C preprocessor (note, will require editing of Desc
    files to comply). Also supports versions in Messages and !Run files,
    controlled by new variable INSTAPP_VERSION
  GNUmakefiles/CLibrary:
  * Naming of object file variables rationalised in line with CModule
  * clean rules now only executed from the component's top-level directory, as
    with CApp
  GNUmakefiles/StdTools:
  * Added INSERTVERSION (AwkVers), retired TIDYDESC
  * Perl scripts now explicitly passed to perl - no need to chmod +x the
    scripts in RiscOS/Library
  * asasm/objasm include paths and APCS/Machine/UserIF predefines set to match
    Makefiles
Admin:
  Tested in a CTools build

Version 6.32. Tagged as 'BuildSys-6_32'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.7 2013/07/15 19:29:13 rsprowson Exp $
d66 1
d149 1
d153 1
d157 1
@


1.7
log
@Shared makefile enhancements
AAsmModule:
 Comments sync'd with implementation
ModuleLibs/AppLibs:
 Add the RMVersion library
CApp:
 Now APP_OBJS and APP_DBG_OBJS don't need the '.o' suffix in common with OBJS and DBG_OBJS
 Changed insertion of version numbers to be common for Messages/Obey/Desc files through new 'INSTAPP_VERSION' dummy rule
 INSTALLAPP_DEPEND renamed to INSTAPP_DEPENDS to match other INSTAPP_stuff
CUtil:
 Use addprefix'd APP_OBJS
StdTools:
 Default SQUISHFLAGS now set
 Added INSERTVERSION


Version 6.20. Tagged as 'BuildSys-6_20'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.6 2012/02/05 09:13:26 rsprowson Exp $
d37 1
d40 1
a41 2
# APP_OBJS          (opt) (object files for application version - otherwise derived from ${OBJS})
# APP_DBG_OBJS      (opt) (object files for debug app version - otherwise derived from ${DBG_OBJS})
d46 1
a46 1
# INSTAPP_VERSION   (opt) (list of Messages/!Run/Desc files to insert app version from VersionNum - omit from INSTAPP_FILES)
a91 1
APP_DBG_OBJS ?= ${DBG_OBJS}
d102 1
a102 1
APP_DBG_OBJS_ = $(addprefix od.,${APP_DBG_OBJS})
d171 2
a172 2
${DBG_TARGET}${CUSTOMLINK}: ${APP_DBG_OBJS_} ${DBG_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} ${LDDFLAGS} -o ${DBG_TARGET} ${APP_DBG_OBJS_} ${DBG_LIBS}
@


1.6
log
@Change back to overridable clean and dirs steps.
The CLEAN_DEPEND intermediate was added because GNU make didn't support '::' notation, but GNU nake 3.81 (possibly earlier) does as described at
  http://www.gnu.org/software/make/manual/make.html#Double_002dColon
verified with two test makefiles
# This is 'makefile'
include ./other.mk
clean::
	@@echo 1
	@@echo 2
# This is 'other.mk'
CLEANALIAS = clean
${CLEANALIAS}::
	@@echo 3
	@@echo 4
which did what was required.

Version 5.42. Tagged as 'BuildSys-5_42'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.5 2011/09/12 23:00:49 bavison Exp $
d30 17
a46 18
# COMPONENT          (the name of the component)
# TARGET       (opt) (the leafname of the application - otherwise ${COMPONENT})
# DBG_TARGET   (opt) (debug application leafname - otherwise ${TARGET}-D)
# INSTDIR      (opt) (the target directory - otherwise <Install$Dir>.${TARGET})
# DIRS         (opt) (stamp object for directory creation - otherwise o._dirs)
# OBJS         (opt) (object files, no o. prefixes - otherwise ${TARGET})
# DBG_OBJS     (opt) (debug build object files, no prefixes - otherwise ${OBJS})
# LIBS         (opt) (extra libraries; CLib is always used)
# DBG_LIBS     (opt) (extra debug libraries - otherwsie ${LIBS};
#                     CLib and DEBUGLIBS always used)
# APP_OBJS     (opt) (object files for application version - otherwise derived
#                     from ${OBJS})
# APP_DBG_OBJS (opt) (object files for debug app version - otherwise derived
#                     from ${DBG_OBJS})
# LINK_TYPE    (opt) (variant of linking command, eg C++ - defaults to C)
# INSTTYPE     (opt) (use "tool" or "app" to install executable vs application - defaults to "tool")
# INSTALLAPPFILES   (opt) (list of files to be installed in application directory - use InstRes specification rules)
# INSTALLAPP_DEPEND (opt) (list of dependencies to be satisfied before doing application install - ${TARGET} assumed if in INSTALLAPPFILES)
d65 1
d87 1
d90 1
d92 1
d101 3
a103 2
APP_OBJS     ?= $(addprefix o.,${OBJS})
APP_DBG_OBJS ?= $(addprefix od.,${DBG_OBJS})
d141 1
a141 1
	${NOP}
d143 1
a143 1
INSTALLAPP_DEPEND += $(filter ${TARGET},${INSTALLAPPFILES})
d145 1
a145 1
install_app${CUSTOMINSTALLAPP}: ${INSTALLAPP_DEPEND}
d147 11
a157 6
        ${INSTRES} -I Resources.${USERIF}.${LOCALE},Resources.${USERIF}.UK,Resources.${LOCALE},Resources.UK,Resources ${INSTAPP} ${INSTALLAPPFILES}
ifneq (,$(filter Desc,${INSTALLAPPFILES}))
        ${CPREPRO} -I. ${INSTAPP}.Desc > ${INSTAPP}.DescTmp
        ${TIDYDESC} ${INSTAPP}.Desc ${INSTAPP}.DescTmp
        ${RM} ${INSTAPP}.DescTmp
endif
d168 2
a169 2
${TARGET}${CUSTOMLINK}: ${APP_OBJS} ${APP_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} -o ${TARGET} ${APP_OBJS} ${APP_LIBS}
d172 2
a173 2
${DBG_TARGET}${CUSTOMLINK}: ${APP_DBG_OBJS} ${DBG_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} ${LDDFLAGS} -o ${DBG_TARGET} ${APP_DBG_OBJS} ${DBG_LIBS}
@


1.6.2.1
log
@Merge of trunk BuildSys-6_34 to branch RPiFreeze

Version 6.00, 1.142.2.4. Tagged as 'BuildSys-6_00-1_142_2_4'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.8 2013/11/11 00:50:38 bavison Exp $
d30 18
a47 17
# COMPONENT               (the name of the component)
# TARGET            (opt) (the leafname of the application - otherwise ${COMPONENT})
# DBG_TARGET        (opt) (debug application leafname - otherwise ${TARGET}-D)
# INSTAPP           (opt) (the application target directory - otherwise ${INSTDIR}.!${COMPONENT})
# INSTDIR           (opt) (the target directory - otherwise <Install$Dir>.${TARGET})
# DIRS              (opt) (stamp object for directory creation - otherwise o._dirs)
# OBJS              (opt) (object files, no o. prefixes - otherwise ${TARGET})
# APP_OBJS          (opt) (release build object files, no prefixes - otherwise ${OBJS})
# DBG_OBJS          (opt) (debug build object files, no prefixes - otherwise ${OBJS})
# LIBS              (opt) (extra libraries; ${CLIB} is always used)
# APP_LIBS          (opt) (extra release libraries - otherwise ${LIBS}; ${CLIB} is always used)
# DBG_LIBS          (opt) (extra debug libraries - otherwise ${LIBS}; ${CLIB} and ${DEBUGLIBS} always used)
# LINK_TYPE         (opt) (variant of linking command, eg C++ - defaults to C)
# INSTTYPE          (opt) (use "tool" or "app" to install executable vs application - defaults to "tool")
# INSTAPP_FILES     (opt) (list of files to be installed in application directory - use InstRes specification rules)
# INSTAPP_DEPENDS   (opt) (list of dependencies to be satisfied before doing application install - ${TARGET} assumed if in INSTAPP_FILES)
# INSTAPP_VERSION   (opt) (list of Messages/!Run/Desc files to insert app version from VersionNum - include in INSTAPP_FILES as well)
a65 1
# INSERTVERSION    (awk script to substitute from VersionNum)
a86 1
INSTAPP      ?= ${INSTDIR}.!${COMPONENT}
a88 1
APP_OBJS     ?= ${OBJS}
d98 2
a99 3

APP_OBJS_     = $(addprefix o.,${APP_OBJS})
DBG_OBJS_     = $(addprefix od.,${DBG_OBJS})
d137 1
a137 1
        ${NOP}
d139 1
a139 1
INSTAPP_DEPENDS += $(filter ${TARGET},${INSTAPP_FILES})
d141 1
a141 1
install_app${CUSTOMINSTALLAPP}: ${INSTAPP_DEPENDS}
d143 6
a148 11
        ${INSTRES} -I Resources.${USERIF}.${LOCALE},Resources.${USERIF}.UK,Resources.${LOCALE},Resources.UK,Resources ${INSTAPP} ${INSTAPP_FILES}
ifneq (,$(filter Messages,${INSTAPP_VERSION}))
        ${INSERTVERSION} LocalRes:Messages > ${INSTAPP}.Messages
endif        
ifneq (,$(filter Desc,${INSTAPP_VERSION}))
        ${INSERTVERSION} descmode=1 LocalRes:Desc > ${INSTAPP}.Desc
endif        
ifneq (,$(filter !Run,${INSTAPP_VERSION}))
        ${INSERTVERSION} obeymode=1 LocalRes:!Run > ${INSTAPP}.!Run
        ${SETTYPE} ${INSTAPP}.!Run Obey
endif        
d159 2
a160 2
${TARGET}${CUSTOMLINK}: ${APP_OBJS_} ${APP_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} -o ${TARGET} ${APP_OBJS_} ${APP_LIBS}
d163 2
a164 2
${DBG_TARGET}${CUSTOMLINK}: ${DBG_OBJS_} ${DBG_LIBS} ${DIRS}
        ${LD} ${LDFLAGS} ${LDDFLAGS} -o ${DBG_TARGET} ${DBG_OBJS_} ${DBG_LIBS}
@


1.6.2.2
log
@Merge of BuildSys-6_52 to branch

Version 6.00, 1.142.2.5. Tagged as 'BuildSys-6_00-1_142_2_5'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.9 2014/10/01 00:15:43 jlee Exp $
a65 1
# CHMOD            (file permission manipulation)
a147 1
        ${CHMOD} +w ${INSTAPP}.Messages
a150 1
        ${CHMOD} +w ${INSTAPP}.Desc
a153 1
        ${CHMOD} +w ${INSTAPP}.!Run
@


1.6.2.3
log
@Merge of BuildSys-6_64 to branch

Version 6.00, 1.142.2.6. Tagged as 'BuildSys-6_00-1_142_2_6'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.11 2014/10/24 12:36:49 rsprowson Exp $
d30 20
a49 21
# COMPONENT                 (the name of the component)
# TARGET              (opt) (the leafname of the application - otherwise ${COMPONENT})
# DBG_TARGET          (opt) (debug application leafname - otherwise ${TARGET}-D)
# INSTAPP             (opt) (the application target directory - otherwise ${INSTDIR}.!${COMPONENT})
# INSTDIR             (opt) (the target directory - otherwise <Install$Dir>.${TARGET})
# DIRS                (opt) (stamp object for directory creation - otherwise o._dirs)
# OBJS                (opt) (object files, no o. prefixes - otherwise ${TARGET})
# APP_OBJS            (opt) (release build object files, no prefixes - otherwise ${OBJS})
# DBG_OBJS            (opt) (debug build object files, no prefixes - otherwise ${OBJS})
# LIBS                (opt) (extra libraries; ${CLIB} is always used)
# APP_LIBS            (opt) (extra release libraries - otherwise ${LIBS}; ${CLIB} is always used)
# DBG_LIBS            (opt) (extra debug libraries - otherwise ${LIBS}; ${CLIB} and ${DEBUGLIBS} always used)
# LINK_TYPE           (opt) (variant of linking command, eg C++ - defaults to C)
# INSTTYPE            (opt) (use "tool" or "app" to install executable vs application - defaults to "tool")
# INSTAPP_FILES       (opt) (list of files to be installed in application directory - use InstRes specification rules)
# INSTAPP_DEPENDS     (opt) (list of dependencies to be satisfied before doing application install - ${TARGET} assumed if in INSTAPP_FILES)
# INSTAPP_VERSION     (opt) (list of Messages/!Run/Desc files to insert app version from VersionNum - include in INSTAPP_FILES as well)
# CUSTOMLINK          (opt) (set to "custom" to override the link rule)
# CUSTOMINSTALLAPP    (opt) (set to "custom" to override the install rule for resource files)
# CUSTOMINSTALLTOOL   (opt) (set to "custom" to override the install rule for target binary)
# CUSTOMINSTALLDBGAPP (opt) (set to "custom" to override the install rule for debug resources)
d141 1
a141 1
        @@${NOP}
d151 1
a151 1
endif
d155 1
a155 1
endif
d160 1
a160 1
endif
a162 4
install_debug_app${CUSTOMINSTALLDBGAPP}: ${DBG_TARGET} install_app
        ${CP} ${DBG_TARGET} ${INSTAPP}.${TARGET} ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: ${TARGET} replaced with ${DBG_TARGET}

@


1.6.2.4
log
@Merge of BuildSys-7_04 to branch

Version 6.00, 1.142.2.9. Tagged as 'BuildSys-6_00-1_142_2_9'
@
text
@@


1.5
log
@  Fixes to shared makefiles
Detail:
  The change which permitted top-level makefiles to include only CApp,
  CModule etc accidentally broke makefiles which included HostTools (StdTools
  got included instead and overwrote the HostTools settings). Amazingly, we
  seem to have got away with this so far - but fixed now. Also, brought the
  GNUmakefiles versions in line with updates to the amu Makefiles in this
  and other respects.
Admin:
  Tested in a RISC OS ROM build, and for building cross-compiling versions
  of the tools.

Version 5.21. Tagged as 'BuildSys-5_21'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.4 2011/03/31 00:04:06 bavison Exp $
a43 1
# CLEAN_DEPEND (opt) (phony target for additional clean actions)
d125 1
a125 1
clean ::  ${CLEAN_DEPEND}
@


1.4
log
@  Improvements to shared makefiles
Detail:
  * Some subtle bugs can be caused by including shared makefiles in the
    wrong order. To try to prevent further problems, and simplify main
    makefiles at the same time, CApp, CLibrary and CModule now include the
    makefiles they depend upon themselves, in the correct order: generally
    speaking, all macro (re)definitions should be before rule definitions.
  * Added sentry macro definitions to each makefile. These can be used to
    avoid repeated inclusion of makefiles - particularly important now that
    CApp, CLibrary and CModule do additional includes. This removes the
    majority of cases where amu produced warnings about multiple inclusion;
    a few components remain where this is still the case, but these
    warnings are harmless. If they bother you, simply remove the
    now-superfluous include statements from the relevant main makefile.
  * Created a CUtil shared makefile, for building transient utilities. The
    'C' in the name is more for consistency with CApp/CLibrary/CModule than
    anything to do with the 'C' language, since all of these makefiles work
    equally well for assembler and 'C' - the 'C' is for historic reasons.
  * Tweaked the debug rules in CApp to avoid harmless but annoying linker
    warnings about stubs being included twice.
  * Added several new default switches to ASFLAGS. These enable us to start
    making assembler source files work under a cross-assembler, because
    statements like
        GET  Hdr:Macros
        GET  Hdr:Machine.<Machine>
    are not portable, and tweaking the cross-assembler to understand these
    types of constructs would not be pretty. Instead, with the extra
    command line switches now introduced, you can use
        GET  Macros
        GET  Machine/$Machine
Admin:
  Tested in a ROM build

Version 5.12. Tagged as 'BuildSys-5_12'
@
text
@d20 1
a20 1
# $Id: CApp,v 1.3 2010/10/20 23:14:27 bavison Exp $
d103 1
d106 1
@


1.3
log
@  Makefile bugfixes, and support for latest CTools build
Detail:
  * Fixed dependencies for debug builds in GNUmakefiles/CApp
  * Added -f switch to rm in GNUmakefiles/StdTools to make it fail silently
    if the file doesn't exist, like the RISC OS version
  * Fix for amu complaining if INSTTYPE is undefined in Makefiles/CApp
  * Reflected makefile changes in resgen, squeeze and xpand in CTools
    component file
  * Added a8time to ModuleDB and CTools component file
Admin:
  Tested in  a C Tools build

Version 5.03. Tagged as 'BuildSys-5_03'
@
text
@d16 3
d20 1
a20 1
# $Id: CApp,v 1.2 2010/05/19 14:47:58 bavison Exp $
d49 1
d91 1
d94 1
a94 1
LIBS         += ${C++LIB}
d97 1
a97 1
LIBS         += ${CLIB}
d102 14
d158 2
a159 2
${TARGET}: ${APP_OBJS} ${LIBS} ${DIRS}
        ${LD} ${LDFLAGS} -o ${TARGET} ${APP_OBJS} ${LIBS}
d162 1
a162 1
${DBG_TARGET}: ${APP_DBG_OBJS} ${DBG_LIBS} ${DIRS}
@


1.2
log
@  Changes to facilitate platform independence.

Detail:
 CApp:
  * New variable CLEAN_DEPEND is now the preferred way to specify additional
    clean actions because GNU make doesn't have an equivalent to amu's :: rules
  * Can now indicate preference to use C++ linker options using LINK_TYPE
  * Gains install phase support:
    + INSTALLAPPFILES lists the files to be copied, effectively specified
      relative to LocalRes$Path
    + Adopted INSTTYPE concept from DDE makefiles for cases where executable
      and support files need to be installed to different locations
    + Unusual cases can override this implementation using CUSTOMINSTALLAPP
      and/or CUSTOMINSTALLTOOL

  CLibrary:
  * New variable CLEAN_DEPEND is now the preferred way to specify additional
    clean actions because GNU make doesn't have an equivalent to amu's :: rules
  * -o is no longer a mandatory argument to libfile - now in ARFLAGS rather
    than used explicitly

  DbgRules / StdRules:
  * Macroised some Norcroft-specific features

  HostTools:
  * Clean phase support was incomplete

  StdTools:
  * A few additional tool definitions
  * Added macro definitions for common C options
  * C's enable-warnings and suppress-function-name-embedding options now on by
    default because they're usually (maybe even universally?) used - it won't
    hurt if they're specified again by existing makefiles
  * C++ now has equivalent INCLUDES and DEFINES variables, and the standard C++
    headers are on the default include path
  * SEP is defined as the directory separator character and can be used from
    top-level makefiles in a platform-independent way

  Functionally equivalent versions of the following makefile fragments
  have been developed so far for executing on a Posix build host:
    AppLibs, CApp, CLibrary, DbgRules, HostTools, StdRules, StdTools
  These suport native compilers (when APCS=Host) and cross-compilers,
  and GCC (when TOOLCHAIN=GNU) and Norcroft toolchains - typically these
  environment variables would be selected by running an Env file.

Admin:
  Tested by building as many as possible of the DDE components on RISC OS
  and on Linux, using native and cross compilers, and using Norcroft and
  GNU toolchains.

Version 5.01. Tagged as 'BuildSys-5_01'
@
text
@d17 1
a17 1
# $Id: CApp,v 1.1 2008/10/14 21:29:37 bavison Exp $
d117 1
@


1.1
log
@Clean reimport of the build environment directories.
This represents the version released in the Batch 4 "bbe" tarfiles.
Tagged as 'Batch4'
@
text
@d17 1
a17 1
# $Id: CApp,v 1.4 2005/05/19 18:12:53 bavison Exp $
d41 7
d88 4
d105 1
a105 1
clean ::
d114 17
a130 1
install: ${TARGET}
d133 1
a133 1
        @@${ECHO} ${COMPONENT}: application installation complete
@

