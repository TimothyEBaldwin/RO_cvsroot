head	4.4;
access;
symbols
	RISC_OSLib-5_97:4.4
	RISC_OSLib-5_96:4.4
	RISC_OSLib-5_95:4.4
	RISC_OSLib-5_94:4.4
	RISC_OSLib-5_93:4.4
	RISC_OSLib-5_92:4.4
	RISC_OSLib-5_91:4.4
	RISC_OSLib-5_90:4.4
	RISC_OSLib-5_89:4.4
	RISC_OSLib-5_88:4.4
	RISC_OSLib-5_87:4.4
	RISC_OSLib-5_86-1:4.4
	RISC_OSLib-5_86:4.4
	RISC_OSLib-5_85:4.4
	RISC_OSLib-5_84:4.4
	RISC_OSLib-5_83-2:4.4
	RISC_OSLib-5_83-1:4.4
	RISC_OSLib-5_83:4.4
	RISC_OSLib-5_82:4.4
	RISC_OSLib-5_81:4.4
	RISC_OSLib-5_75-2:4.4
	RISC_OSLib-5_80:4.4
	RISC_OSLib-5_79:4.4
	RISC_OSLib-5_78:4.4
	RISC_OSLib-5_75-1:4.4
	RISC_OSLib-5_77:4.4
	RISC_OSLib-5_76:4.4
	RISC_OSLib-5_75:4.4
	RISC_OSLib-5_74:4.4
	RISC_OSLib-5_73:4.4
	RISC_OSLib-5_72:4.4
	RISC_OSLib-5_71:4.4
	RISC_OSLib-5_70:4.4
	RISC_OSLib-5_69:4.4
	RISC_OSLib-5_68:4.4
	RISC_OSLib-5_67:4.4
	RISC_OSLib-5_66:4.4
	RISC_OSLib-5_65:4.4
	RISC_OSLib-5_64:4.4
	RISC_OSLib-5_63:4.4
	RISC_OSLib-5_62:4.4
	RISC_OSLib-5_61:4.4
	RISC_OSLib-5_60:4.4
	RISC_OSLib-5_59:4.4
	RISC_OSLib-5_58:4.4
	RISC_OSLib-5_57:4.4
	RISC_OSLib-5_56:4.4
	RISC_OSLib-5_55:4.4
	RISC_OSLib-5_54:4.4
	RISC_OSLib-5_53:4.4
	RISC_OSLib-5_52:4.4
	RISC_OSLib-5_51:4.4
	RO_5_07:4.4
	RISC_OSLib-5_50:4.4
	RISC_OSLib-5_49:4.4
	RISC_OSLib-5_46-4_64_2_1:4.3
	NoInlineAsm:4.3.0.2
	RISC_OSLib-5_48:4.4
	RISC_OSLib-5_47:4.3
	RISC_OSLib-5_46:4.3
	RISC_OSLib-5_45:4.3
	RISC_OSLib-5_44:4.3
	RISC_OSLib-5_43:4.2
	RISC_OSLib-5_42:4.2
	RISC_OSLib-5_41:4.2
	RISC_OSLib-5_40:4.2
	RISC_OSLib-5_39:4.2
	RISC_OSLib-5_38:4.2
	RISC_OSLib-5_37:4.2
	RISC_OSLib-5_36:4.2
	RISC_OSLib-5_35:4.2
	RISC_OSLib-5_34:4.2
	RISC_OSLib-5_33-4_50_2_1:4.2
	sbrodie_dev:4.2.0.2
	sbrodie_dev_bp:4.2
	RISC_OSLib-5_33:4.2
	RISC_OSLib-5_32:4.2
	RISC_OSLib-5_31:4.2
	RISC_OSLib-5_30:4.2
	RISC_OSLib-5_29:4.2
	RISC_OSLib-5_28:4.2
	RISC_OSLib-5_27:4.2
	RISC_OSLib-5_26:4.2
	RISC_OSLib-5_25:4.2
	RISC_OSLib-5_24:4.2
	RISC_OSLib-5_01-4_16_2_5:4.1
	RISC_OSLib-5_23:4.2
	RISC_OSLib-5_22:4.2
	RISC_OSLib-5_21:4.2
	RISC_OSLib-5_20:4.2
	RISC_OSLib-5_19:4.2
	RISC_OSLib-5_18:4.2
	RISC_OSLib-5_17:4.2
	RISC_OSLib-5_16:4.2
	RISC_OSLib-5_15:4.2
	dellis_autobuild_BaseSW:4.2
	RISC_OSLib-5_14:4.2
	RISC_OSLib-5_13:4.2
	RISC_OSLib-5_12:4.2
	RISC_OSLib-5_01-4_16_2_4:4.1
	RISC_OSLib-5_11:4.2
	RISC_OSLib-5_01-4_16_2_3:4.1
	RISC_OSLib-5_01-4_16_2_2:4.1
	RISC_OSLib-5_10:4.2
	RISC_OSLib-5_01-4_16_2_1:4.1
	Bethany:4.1.0.12
	RISC_OSLib-5_09:4.2
	RISC_OSLib-5_08:4.2
	RISC_OSLib-5_07:4.2
	RISC_OSLib-5_06:4.2
	RISC_OSLib-4_97-4_12_2_8:4.1.10.4
	RISC_OSLib-5_05:4.1
	RISC_OSLib-5_04:4.1
	sbrodie_sedwards_16Mar2000:4.1
	RISC_OSLib-5_03:4.1
	RISC_OSLib-5_02:4.1
	RISC_OSLib-4_97-4_12_2_7:4.1.10.3
	RISC_OSLib-5_01:4.1
	RISC_OSLib-5_00:4.1
	RISC_OSLib-4_99:4.1
	RISC_OSLib-4_98:4.1
	RISC_OSLib-4_97-4_12_2_6:4.1.10.2
	RISC_OSLib-4_97-4_12_2_5:4.1.10.1
	RISC_OSLib-4_97-4_12_2_4:4.1.10.1
	RISC_OSLib-4_97-4_12_2_3:4.1.10.1
	RISC_OSLib-4_97-4_12_2_2:4.1
	sbrodie_RISC_OSLib-4_97-4_12_2_1:4.1
	kbracey_32bit:4.1.0.10
	kbracey_32bit_bp:4.1
	dcotton_autobuild_BaseSW:4.2
	RISC_OSLib-4_97:4.1
	RISC_OSLib-4_96:4.1
	RISC_OSLib-4_95:4.1
	RISC_OSLib-4_94:4.1
	RISC_OSLib-4_93:4.1
	RISC_OSLib-4_92:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	sforrest_daytona_appflash-0_31:4.1
	RISC_OSLib-4_91:4.1
	RISC_OSLib-4_90:4.1
	RISC_OSLib-4_89:4.1
	Ursula_merge:4.1
	RISC_OSLib-4_88:4.1
	RISC_OSLib-4_87:4.1
	blaughto_daytona_appflash-0_30:4.1
	rmanby_clib-4_86:4.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.4
date	2003.12.02.16.51.32;	author bavison;	state Exp;
branches;
next	4.3;

4.3
date	2002.11.15.15.00.31;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	2000.05.09.14.09.38;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.25.03;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1
	4.1.10.1;
next	;

4.1.1.1
date	96.11.05.09.25.03;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.19.53.07;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.11.29.20;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.19.48.48;	author nturton;	state Exp;
branches;
next	;

4.1.10.1
date	99.11.09.16.21.23;	author sbrodie;	state Exp;
branches;
next	4.1.10.2;

4.1.10.2
date	99.11.22.17.14.19;	author sbrodie;	state Exp;
branches;
next	4.1.10.3;

4.1.10.3
date	2000.01.14.11.02.20;	author kbracey;	state Exp;
branches;
next	4.1.10.4;

4.1.10.4
date	2000.05.09.13.58.54;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.4
log
@  Changes for Customer W; also suitable for building on an Iyonix.
Detail:
  * No longer uses aasm to build h.swis.
  * (Only) compatible with new C compilers: assumes const static data is
    placed in separate read-only areas, and suitable command-line switch
    is used to ensure that library static data is never placed in a zero-
    init area.
  * Stack extension code now thread-safe.
  * Heap thread-safety code (in clib) now uses SWP instruction test results
    from stack extension code (in kernel) - as a side effect, the exported
    symbol _swp_available now exists, if you need to use it elsewhere.
  * Slightly closer to having top-bit-set heap addresses working.
Admin:
  Tested in a Tungsten build, and with Customer W's test suite.

Version 5.48. Tagged as 'RISC_OSLib-5_48'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; -*- Mode: Assembler -*-
;* Shared library kernel for Arthur/Brazil: static data layout
;* Lastedit: 09 Apr 90 10:25:45 by Harry Meekings *
;
; Copyright (C) Acorn Computers Ltd., 1988.
;

StaticData
imageBase               Variable
rtsDataBase             Variable
rtsDataLimit            Variable

IIHandlerInData         Variable        4
PAHandlerInData         Variable        4
DAHandlerInData         Variable        4
AEHandlerInData         Variable        4

undStack                Variable
svcStack                Variable
unused4                 Variable        9

registerDump            Variable        17      ; PSR in 17th entry

; Handler values on entry, to be restored on exit
oldAbortHandlers        Variable        4

oldExitHandler          Variable        2       ; handler, r12
oldMemoryLimit          Variable

oldErrorHandler         Variable                ; handler, r0, buffer
oldErrorR0              Variable
oldErrorBuffer          Variable

oldCallBackHandler      Variable        3       ; handler, r12, buffer
oldEscapeHandler        Variable        2       ; handler, r12
oldEventHandler         Variable        2       ; handler, r12

oldUpCallHandler        Variable        2       ; handler, r12

; Stuff used for _kernel_system
languageEnvSave         Variable        3       ; (fp, sp, sl over _system)

hadEscape               VariableByte
;******************* beware : position of this byte is fixed ***************
;                             (used in stubs)
kallocExtendsWS         VariableByte
inTrapHandler           VariableByte
beingDebugged           VariableByte
fpPresent               VariableByte    ; zero if not
initialised             InitByte 1
callbackInactive        VariableByte
unused_byte_2           VariableByte

errorBuffer             Variable
errorNumber             Variable
errorString             Variable        63

; Fatal error needs an error buffer - just splat from here on
FatalErrorBuffer        Variable        0

eventCode               Variable
eventUserR13            Variable
eventRegisters          Variable        12      ; r0-r10 and r13

unused2                 Variable        11

heapTop                 Variable
heapLimit               Variable

allocProc               Variable
freeProc                Variable

returnCode              Variable

moduleDataWord          Variable

;********** beware : position of this byte relative to end is fixed ********
;                         (used in s.initmodule)
ClientFlags             VariableByte    ; formerly APCS_A_Client
escapeSeen              VariableByte
unwinding               VariableByte
underDesktop            VariableByte

heapBase                Variable

ArgString               Variable
heapExtender            Variable
knownSlotSize           Variable
initSlotSize            Variable

lk_RestoreOSHandlers    Variable
extendChunk             Variable
extendChunkNotInUse     Variable
_swp_available          ExportedVariable
rootStackChunk          Variable

; Tmp space for expanding PC value in fatal error handler
; 3 words overlaid with returnCodeLimit
pc_hex_buff             Variable        0
; Tmp space for reading RC Limit in _kernel_exit - Reuse.
returnCodeLimit         Variable        3

; Tmp space for expanding reg. dump address in fatal error handler - Reuse
reg_hex_buff            Variable        3

disable_stack_extension ExportedVariable 1

unused                  Variable        14

        END
@


4.3
log
@ROM build fixed for 64-bit stuff.
PCI added to swis.h
alloc.c updated to handle bigger slots (new code merged from ARM libraries)
Various 32-bit fixes for backtracing, and general trap handling.
Polite "Application is not 32-bit compatible" message.
Headers <stdint.h> and <inttypes.h> fixed to work in non-C99 mode.
txt changed to do new-style Delete behaviour

Version 5.44. Tagged as 'RISC_OSLib-5_44'
@
text
@d107 2
d122 1
a122 1
unused                  Variable        16
@


4.2
log
@32-bit work merged from kbracey_32bit branch.

Version 5.06. Tagged as 'RISC_OSLib-5_06'
@
text
@a26 3
; Fatal error needs an error buffer - just splat from here on
FatalErrorBuffer        Variable        0

d68 6
a73 1
unused2                 Variable        11      ; was xxHandlerInData
d79 1
a79 3
errorBuffer             Variable
errorNumber             Variable
errorString             Variable        63
@


4.1
log
@Initial revision
@
text
@d27 11
a37 4
errorR12                Variable
errorBuffer             Variable
errorNumber             Variable
errorString             Variable        25
d39 1
a39 1
registerDump            Variable        16
d71 1
a71 4
IIHandlerInData         Variable        3
PAHandlerInData         Variable        3
DAHandlerInData         Variable        3
AEHandlerInData         Variable        3
d76 4
a79 2
fastEventStack          Variable        64
fastEventStackEnd       Variable        0
d91 3
a93 1
APCS_A_Client           VariableByte
@


4.1.10.1
log
@  Renamed APCS_A_Client to ClientFlags
  ClientFlags is now a (byte-wide) bitfield.
Detail:
  Bit 0 set means client is using APCS-A
  Bit 1 set means client is using APCS-32 (in either 26 or 32 bit modes)
  Bit 2 set means client is using a 32-bit mode.
  Bits 3-7 are reserved for future expansion
@
text
@d85 1
a85 3
;******************* beware : position of this byte is fixed ***************
;                         (used in s.initmodule)
ClientFlags             VariableByte    ; formerly APCS_A_Client
@


4.1.10.2
log
@Work in progress
@
text
@d30 1
a30 1
errorString             Variable        24      ; needs to be 62 !! Sort it later
d32 1
a32 1
registerDump            Variable        17      ; PSR in 17th entry
@


4.1.10.3
log
@More 32-bit work. Now functional, but still need to sort out various
build issues.

Version 4.97, 4.12.2.7. Tagged as 'RISC_OSLib-4_97-4_12_2_7'
@
text
@d27 4
a30 9
; Fatal error needs an error buffer - just splat from here on
FatalErrorBuffer        Variable        0

IIHandlerInData         Variable        4
PAHandlerInData         Variable        4
DAHandlerInData         Variable        4
AEHandlerInData         Variable        4

unused4                 Variable        11
d64 4
a67 1
unused2                 Variable        12      ; was xxHandlerInData
d72 2
a73 4

errorBuffer             Variable
errorNumber             Variable
errorString             Variable        62
d85 1
a85 1
;********** beware : position of this byte relative to end is fixed ********
@


4.1.10.4
log
@Features:

* APCS-32 support complete.
* APCS-A compatibility removed.
* Old ArthurLib code removed.
* _clib_version() now reports version from VersionNum.
* time() no longer does a run-time host check - I think we know we're not a BBC
  Master ARM second processor now.
* rename() now uses OS_FSControl 25 instead of *rename.
* getenv() can handle arbitrary length variables.
* Can now handle exceptions in 32-bit form of FPEmulator (on either 26 or 32
  bit systems).
* tmpnam() switches to SVC mode to access its zero page counter.
* Faster divide routines.

Admin:

  This will build all sorts of different things depending on the flags. See
  the Docs directory for details.

  As far as ROM builds are concerned, if using APCS-R, no changes are needed.
  If using APCS-32, the Shared C Library must be built as APCS-R to ensure
  compatibility with old binaries. To achieve this, pass in the option
  SCL_APCS="-APCS 3/26bit" in the Components file.

Version 4.97, 4.12.2.8. Tagged as 'RISC_OSLib-4_97-4_12_2_8'
@
text
@d35 1
a35 3
undStack                Variable
svcStack                Variable
unused4                 Variable        9
d69 1
a69 1
unused2                 Variable        11      ; was xxHandlerInData
d77 1
a77 1
errorString             Variable        63
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
