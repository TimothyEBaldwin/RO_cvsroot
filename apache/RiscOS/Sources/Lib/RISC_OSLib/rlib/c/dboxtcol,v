head	4.3;
access;
symbols
	RISC_OSLib-5_97:4.3
	RISC_OSLib-5_96:4.3
	RISC_OSLib-5_95:4.3
	RISC_OSLib-5_94:4.3
	RISC_OSLib-5_93:4.3
	RISC_OSLib-5_92:4.3
	RISC_OSLib-5_91:4.3
	RISC_OSLib-5_90:4.3
	RISC_OSLib-5_89:4.3
	RISC_OSLib-5_88:4.3
	RISC_OSLib-5_87:4.3
	RISC_OSLib-5_86-1:4.2
	RISC_OSLib-5_86:4.2
	RISC_OSLib-5_85:4.2
	RISC_OSLib-5_84:4.2
	RISC_OSLib-5_83-2:4.2
	RISC_OSLib-5_83-1:4.2
	RISC_OSLib-5_83:4.2
	RISC_OSLib-5_82:4.2
	RISC_OSLib-5_81:4.2
	RISC_OSLib-5_75-2:4.2
	RISC_OSLib-5_80:4.2
	RISC_OSLib-5_79:4.2
	RISC_OSLib-5_78:4.2
	RISC_OSLib-5_75-1:4.2
	RISC_OSLib-5_77:4.2
	RISC_OSLib-5_76:4.2
	RISC_OSLib-5_75:4.2
	RISC_OSLib-5_74:4.2
	RISC_OSLib-5_73:4.2
	RISC_OSLib-5_72:4.2
	RISC_OSLib-5_71:4.2
	RISC_OSLib-5_70:4.2
	RISC_OSLib-5_69:4.2
	RISC_OSLib-5_68:4.2
	RISC_OSLib-5_67:4.2
	RISC_OSLib-5_66:4.2
	RISC_OSLib-5_65:4.2
	RISC_OSLib-5_64:4.2
	RISC_OSLib-5_63:4.2
	RISC_OSLib-5_62:4.2
	RISC_OSLib-5_61:4.2
	RISC_OSLib-5_60:4.2
	RISC_OSLib-5_59:4.2
	RISC_OSLib-5_58:4.2
	RISC_OSLib-5_57:4.2
	RISC_OSLib-5_56:4.2
	RISC_OSLib-5_55:4.2
	RISC_OSLib-5_54:4.2
	RISC_OSLib-5_53:4.2
	RISC_OSLib-5_52:4.2
	RISC_OSLib-5_51:4.2
	RO_5_07:4.2
	RISC_OSLib-5_50:4.2
	RISC_OSLib-5_49:4.2
	RISC_OSLib-5_46-4_64_2_1:4.2
	NoInlineAsm:4.2.0.2
	RISC_OSLib-5_48:4.2
	RISC_OSLib-5_47:4.2
	RISC_OSLib-5_46:4.2
	RISC_OSLib-5_45:4.2
	RISC_OSLib-5_44:4.2
	RISC_OSLib-5_43:4.2
	RISC_OSLib-5_42:4.2
	RISC_OSLib-5_41:4.2
	RISC_OSLib-5_40:4.2
	RISC_OSLib-5_39:4.2
	RISC_OSLib-5_38:4.2
	RISC_OSLib-5_37:4.2
	RISC_OSLib-5_36:4.2
	RISC_OSLib-5_35:4.2
	RISC_OSLib-5_34:4.2
	RISC_OSLib-5_33-4_50_2_1:4.1.14.1
	sbrodie_dev:4.1.0.14
	sbrodie_dev_bp:4.1
	RISC_OSLib-5_33:4.1
	RISC_OSLib-5_32:4.1
	RISC_OSLib-5_31:4.1
	RISC_OSLib-5_30:4.1
	RISC_OSLib-5_29:4.1
	RISC_OSLib-5_28:4.1
	RISC_OSLib-5_27:4.1
	RISC_OSLib-5_26:4.1
	RISC_OSLib-5_25:4.1
	RISC_OSLib-5_24:4.1
	RISC_OSLib-5_01-4_16_2_5:4.1
	RISC_OSLib-5_23:4.1
	RISC_OSLib-5_22:4.1
	RISC_OSLib-5_21:4.1
	RISC_OSLib-5_20:4.1
	RISC_OSLib-5_19:4.1
	RISC_OSLib-5_18:4.1
	RISC_OSLib-5_17:4.1
	RISC_OSLib-5_16:4.1
	RISC_OSLib-5_15:4.1
	dellis_autobuild_BaseSW:4.1
	RISC_OSLib-5_14:4.1
	RISC_OSLib-5_13:4.1
	RISC_OSLib-5_12:4.1
	RISC_OSLib-5_01-4_16_2_4:4.1
	RISC_OSLib-5_11:4.1
	RISC_OSLib-5_01-4_16_2_3:4.1
	RISC_OSLib-5_01-4_16_2_2:4.1
	RISC_OSLib-5_10:4.1
	RISC_OSLib-5_01-4_16_2_1:4.1
	Bethany:4.1.0.12
	RISC_OSLib-5_09:4.1
	RISC_OSLib-5_08:4.1
	RISC_OSLib-5_07:4.1
	RISC_OSLib-5_06:4.1
	RISC_OSLib-4_97-4_12_2_8:4.1
	RISC_OSLib-5_05:4.1
	RISC_OSLib-5_04:4.1
	sbrodie_sedwards_16Mar2000:4.1
	RISC_OSLib-5_03:4.1
	RISC_OSLib-5_02:4.1
	RISC_OSLib-4_97-4_12_2_7:4.1
	RISC_OSLib-5_01:4.1
	RISC_OSLib-5_00:4.1
	RISC_OSLib-4_99:4.1
	RISC_OSLib-4_98:4.1
	RISC_OSLib-4_97-4_12_2_6:4.1
	RISC_OSLib-4_97-4_12_2_5:4.1
	RISC_OSLib-4_97-4_12_2_4:4.1
	RISC_OSLib-4_97-4_12_2_3:4.1
	RISC_OSLib-4_97-4_12_2_2:4.1
	sbrodie_RISC_OSLib-4_97-4_12_2_1:4.1
	kbracey_32bit:4.1.0.10
	kbracey_32bit_bp:4.1
	dcotton_autobuild_BaseSW:4.2
	RISC_OSLib-4_97:4.1
	RISC_OSLib-4_96:4.1
	RISC_OSLib-4_95:4.1
	RISC_OSLib-4_94:4.1
	RISC_OSLib-4_93:4.1
	RISC_OSLib-4_92:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	sforrest_daytona_appflash-0_31:4.1
	RISC_OSLib-4_91:4.1
	RISC_OSLib-4_90:4.1
	RISC_OSLib-4_89:4.1
	Ursula_merge:4.1
	RISC_OSLib-4_88:4.1
	RISC_OSLib-4_87:4.1
	blaughto_daytona_appflash-0_30:4.1
	rmanby_clib-4_86:4.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.3
date	2016.02.07.16.35.15;	author rsprowson;	state Exp;
branches;
next	4.2;
commitid	TlF3STjWlU3Wg0Uy;

4.2
date	2001.08.23.13.53.46;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.25.09;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1
	4.1.14.1;
next	;

4.1.1.1
date	96.11.05.09.25.09;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.19.53.32;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.11.30.04;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.19.49.16;	author nturton;	state Exp;
branches;
next	;

4.1.14.1
date	2001.07.02.15.01.13;	author sbrodie;	state Exp;
branches;
next	;


desc
@@


4.3
log
@Open colour picker menus in the right place
Function dboxtcol() always opens colour pickers as transient submenus (in the flags to ColourPicker_OpenDialogue, plus listening for the menus deleted message) but chose to open the dialogue at the current mouse pointer, so obscuring part of the menu rather than opening it where the Style Guide wants it.
wimp.h:
  Add a struct definition of menuwarn messages.
txtedit.c/dbox.c/ctl.c:
  Use the menuwarn struct rather than indexing the words[].
dboxtcol.c:
  Provided the last wimp event was the menu warning, use the x/y coordinates from that instead of the mouse pointer.
  Remove some local defines in favour of central ones.
  Make sure we use 0x80000000/0x7F000000 like the PRM says for the other 2 corners of the dialogue, not 0,0.
Tested in a disc build of !Draw.

Version 5.86. Not tagged
@
text
@/* Copyright 1996 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/************************************************************************/
/* © Acorn Computers Ltd, 1992.                                         */
/*                                                                      */
/* This file forms part of an unsupported source release of RISC_OSLib. */
/*                                                                      */
/* It may be freely used to create executable images for saleable       */
/* products but cannot be sold in source form or as an object library   */
/* without the prior written consent of Acorn Computers Ltd.            */
/*                                                                      */
/* If this file is re-distributed (even if modified) it should retain   */
/* this copyright notice.                                               */
/*                                                                      */
/************************************************************************/

/*
 * Title: c.dboxtcol
 * Purpose: display dbox to allow setting of colours
 * History: IDJ: 05-Feb-92: prepared for source release
 *
 */


#include "colourpick.h"
#include "event.h"
#include "dboxtcol.h"
#include "help.h"
#include "os.h"
#include "wimp.h"
#include "wimpt.h"
#include "win.h"

#include "swis.h"

#undef  NULL
#define NULL 0

static BOOL Open, Chosen;
static dboxtcol_colour Colour;
static dboxtcol_colourhandler Proc;
static void *Handle;
static wimp_w W;
static int Model = 0;

static BOOL Unknowns (wimp_eventstr *event_str, void *h)

{  h = h;

   switch (event_str->e)
   {  case wimp_ESEND:
      case wimp_ESENDWANTACK:
         switch (event_str->data.msg.hdr.action)
         {  case wimp_MMENUSDELETED:
               Open = FALSE;
               return TRUE;
            break;

            case message_COLOUR_PICKER_COLOUR_CHOICE:
               Chosen = TRUE;

               Colour = (event_str->data.msg.data.words [1] &
                     colourpicker_COLOUR_TRANSPARENT) != 0?
                     dboxtcol_Transparent:
                     event_str->data.msg.data.words [2];

               if (Proc != NULL) (*Proc) (Colour, Handle);
               return TRUE;
            break;

            case message_COLOUR_PICKER_COLOUR_CHANGED:
              Model = event_str->data.msg.data.words [4];
            break;

            case wimp_MHELPREQUEST:
               /*If we get a help-request on this colour picker, we must
                  "handle" it to prevent other parts of RISC_OSLib trying to
                  deal with it.*/
               if (event_str->data.msg.data.helprequest.m.w == W)
                  return TRUE;
            break;
         }
      break;
   }

   return FALSE;
}

BOOL dboxtcol (dboxtcol_colour *colour_out, BOOL allow_transparent,
      char *name, dboxtcol_colourhandler proc, void *handle)

{  BOOL transparent;
   wimp_eventstr *e;
   os_error *error = NULL;
   colourpicker_dialogue dialogue;
   colourpicker_d d;

   static BOOL Added_Messages = FALSE;

   if (!Added_Messages)
   {  static int Messages [] = {message_COLOUR_PICKER_COLOUR_CHOICE,
            message_COLOUR_PICKER_COLOUR_CHANGED, wimp_MMENUSDELETED, 0};

      if ((error = _swix (Wimp_AddMessages, _IN (0), Messages)) != NULL)
         goto finish;

      Added_Messages = TRUE;
   }

   Open = TRUE;
   Chosen = FALSE;
   Colour = colour_out != NULL? *colour_out: dboxtcol_Transparent;
   Proc = proc;
   Handle = handle;

   transparent = allow_transparent && Colour == dboxtcol_Transparent;

   e = wimpt_last_event();
   if (e->e == wimp_ESEND && e->data.msg.hdr.action == wimp_MMENUWARN) {
     /* this is a dbox that is actually part of the menu tree. */
     dialogue.visible.x0 = e->data.msg.data.menuwarn.x;
     dialogue.visible.y1 = e->data.msg.data.menuwarn.y;
   } else {
     wimp_mousestr mouse_str;
     /* a floater: float it near the pointer. */
     wimpt_noerr (wimp_get_point_info (&mouse_str));
     dialogue.visible.x0 = mouse_str.x;
     dialogue.visible.y1 = mouse_str.y;
   }

   dialogue.flags =
      (allow_transparent? colourpicker_DIALOGUE_OFFERS_TRANSPARENT: 0) |
      colourpicker_DIALOGUE_TYPE_CLICK << colourpicker_DIALOGUE_TYPE_SHIFT |
      (transparent? colourpicker_DIALOGUE_TRANSPARENT: 0);
   dialogue.title      = name;
   dialogue.visible.y0 = 0x80000000;
   dialogue.visible.x1 = 0x7FFFFFFF;
   dialogue.xscroll    = 0;
   dialogue.yscroll    = 0;
   dialogue.colour     = Colour;
   dialogue.size       = 4;
   dialogue.info [0]   = Model;

   if ((error = _swix (ColourPicker_OpenDialogue,
         _IN (0) | _IN (1) | _OUT (0) | _OUT (1),
         colourpicker_OPEN_TRANSIENT | colourpicker_OPEN_SUB_MENU,
         &dialogue, &d, &W)) != NULL)
      goto finish;

   /*Poll the WIMP until the window goes away.*/
   win_add_unknown_event_processor (&Unknowns, 0);
   do event_process (); while (Open);
   win_remove_unknown_event_processor (&Unknowns, 0);

   if (colour_out != NULL) *colour_out = Colour;

finish:
   wimpt_complain (error);
   return Chosen;
}
@


4.2
log
@* Merged in (via sbrodie's branch) public source release of RISC_OSLib.
* Fixed C library tty so it can output '\b' (backspace).
* Made offsetof() and va_arg() macros work with C++.

Version 5.34. Tagged as 'RISC_OSLib-5_34'
@
text
@a50 6
#undef  message_MENUS_DELETED
#define message_MENUS_DELETED 0x400C9

#undef  ColourPicker_OpenDialogue
#define ColourPicker_OpenDialogue 0x47702

d66 1
a66 1
         {  case message_MENUS_DELETED:
d105 1
a105 1
   wimp_mousestr mouse_str;
d114 1
a114 1
            message_COLOUR_PICKER_COLOUR_CHANGED, message_MENUS_DELETED, 0};
d130 12
a141 1
   wimpt_noerr (wimp_get_point_info (&mouse_str));
d148 2
a149 4
   dialogue.visible.x0 = mouse_str.x;
   dialogue.visible.y0 = 0;
   dialogue.visible.x1 = 0;
   dialogue.visible.y1 = mouse_str.y;
@


4.1
log
@Initial revision
@
text
@d15 20
a34 1
/*dboxtcol.c - RISC_OSLib-compatible ColourPicker interface*/
a35 1
/* Purpose
a36 16
      Display a dialogue box which shows a true colour value, and which can
   be edited. If the user edits it (or presses OK) then update the colour
   variable and return TRUE. Allow_transparent enables selection of a
   "see-through" colour.

*/

/* History

   14 July 1993 JRC Use ColourPicker, replacing code by A P Thompson.
*/

/*From CLib*/
#include <swis.h>

/*From RISC_OSLib*/
d45 2
@


4.1.14.1
log
@  Merge of multiple versions of RISC_OSLib.
Detail:
  This work may be incomplete - hence import on a branch.
  It has NOT been tested.
Admin:
  Might even build.


Version 5.33, 4.50.2.1. Tagged as 'RISC_OSLib-5_33-4_50_2_1'
@
text
@d15 1
a15 20
/************************************************************************/
/* © Acorn Computers Ltd, 1992.                                         */
/*                                                                      */
/* This file forms part of an unsupported source release of RISC_OSLib. */
/*                                                                      */
/* It may be freely used to create executable images for saleable       */
/* products but cannot be sold in source form or as an object library   */
/* without the prior written consent of Acorn Computers Ltd.            */
/*                                                                      */
/* If this file is re-distributed (even if modified) it should retain   */
/* this copyright notice.                                               */
/*                                                                      */
/************************************************************************/

/*
 * Title: c.dboxtcol
 * Purpose: display dbox to allow setting of colours
 * History: IDJ: 05-Feb-92: prepared for source release
 *
 */
d17 1
d19 16
a42 2

#include "swis.h"
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
