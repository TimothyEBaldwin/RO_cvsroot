head	4.20;
access;
symbols
	Messages-1_12:4.20
	Messages-1_11:4.20
	Messages-1_10:4.19
	Messages-1_09:4.19
	Messages-1_08:4.19
	Messages-1_07:4.18
	RO_5_07:4.17
	Messages-1_06:4.17
	Messages-1_05-4_25_2_3:4.16
	Messages-1_05-4_25_2_2:4.16
	Messages-1_05-4_25_2_1:4.16
	sbrodie_dev:4.16.0.2
	sbrodie_dev_bp:4.16
	Messages-1_05:4.16
	Messages-1_04:4.15
	Messages-1_03:4.14
	Messages-1_02:4.13
	Messages-1_01:4.13
	Messages-1_00:4.13
	Messages-0_99:4.13
	dellis_autobuild_BaseSW:4.12
	Messages-0_98:4.12
	Messages-0_97:4.12
	Messages-0_96:4.11
	Messages-0_95:4.10
	Messages-0_94:4.10
	dcotton_Messages_13062000:4.10
	dcotton_Messages_10062000:4.9
	Messages-0_93:4.8
	Messages-0_92:4.8
	Messages-0_91:4.8
	sbrodie_sedwards_16Mar2000:4.8
	dcotton_autobuild_BaseSW:4.16
	Messages-0_90:4.8
	Ursula_merge:4.6.2.2
	nturton_Messages-0_84:4.6
	Messages-0_89:4.8
	Messages-0_88:4.8
	Messages-0_87:4.7
	Messages-0_86:4.7
	Messages-0_85:4.7
	mstphens_UrsulaRiscPCBuild_20Nov98:4.6.2.2.2.1
	Ursula_RiscPC:4.6.2.2.0.2
	nicke_Messages-0_79:4.1.7.4
	rthornb_UrsulaBuild-19Aug1998:4.6.2.2
	UrsulaBuild_FinalSoftload:4.6.2.2
	rthornb_UrsulaBuild-12Aug1998:4.6.2.2
	aglover_UrsulaBuild-05Aug1998:4.6.2.2
	rthornb_UrsulaBuild-29Jul1998:4.6.2.2
	rthornb_UrsulaBuild-22Jul1998:4.6.2.2
	rthornb_UrsulaBuild-15Jul1998:4.6.2.2
	rthornb_UrsulaBuild-07Jul1998:4.6.2.2
	rthornb_UrsulaBuild-17Jun1998:4.6.2.2
	rthornb_UrsulaBuild-03Jun1998:4.6.2.2
	rthornb_UrsulaBuild-27May1998:4.6.2.2
	rthornb_Messages-0_85:4.6.2.2
	rthornb_UrsulaBuild-21May1998:4.6.2.2
	rthornb_UrsulaBuild_01May1998:4.6.2.2
	afrost_Funai01-33:4.1.7.3
	afrost_NC2_Generic:4.1.7.3
	Spinner_RCA116:4.1.7.3
	Spinner_B20_2:4.1.7.3
	Spinner_19_3:4.1.7.2
	Spinner_B18:4.1.7.2
	Spinner_B17:4.1.7.2
	Spinner_B15:4.1.7.2
	Spinner_B14:4.1.7.2
	Spinner_B13:4.1.7.2
	Spinner_B12:4.1.7.2
	Spinner_B10:4.1.7.2
	Daytona:4.6.0.4
	Daytona_bp:4.6
	Ursula:4.6.0.2
	Ursula_bp:4.6
	Spinner_B7:4.1.7.2
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.4
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.20
date	2014.09.01.22.21.07;	author rsprowson;	state Exp;
branches;
next	4.19;
commitid	EkteMavdrKzy1HOx;

4.19
date	2011.10.16.07.29.52;	author rsprowson;	state Exp;
branches;
next	4.18;
commitid	qyAik1QTMQfHSxDv;

4.18
date	2009.06.07.17.11.26;	author bavison;	state Exp;
branches;
next	4.17;

4.17
date	2003.12.02.15.50.00;	author bavison;	state Exp;
branches;
next	4.16;

4.16
date	2001.01.08.12.25.23;	author sbrodie;	state Exp;
branches;
next	4.15;

4.15
date	2000.12.14.18.02.21;	author sbrodie;	state Exp;
branches;
next	4.14;

4.14
date	2000.12.11.12.54.04;	author sbrodie;	state Exp;
branches;
next	4.13;

4.13
date	2000.10.17.08.21.37;	author rthornbu;	state Exp;
branches;
next	4.12;

4.12
date	2000.08.13.15.53.01;	author dcotton;	state Exp;
branches;
next	4.11;

4.11
date	2000.08.10.17.26.41;	author dcotton;	state Exp;
branches;
next	4.10;

4.10
date	2000.06.13.16.53.45;	author dcotton;	state Exp;
branches;
next	4.9;

4.9
date	2000.06.10.10.31.00;	author dcotton;	state Exp;
branches;
next	4.8;

4.8
date	99.05.06.10.59.58;	author kbracey;	state Exp;
branches;
next	4.7;

4.7
date	99.04.29.15.45.17;	author kbracey;	state Exp;
branches;
next	4.6;

4.6
date	97.05.12.23.11.16;	author kbracey;	state Exp;
branches
	4.6.2.1;
next	4.5;

4.5
date	97.05.12.22.13.56;	author kbracey;	state Exp;
branches;
next	4.4;

4.4
date	97.05.12.21.12.22;	author kbracey;	state Exp;
branches;
next	4.3;

4.3
date	97.05.12.14.12.19;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.01.20.14.14.09;	author nturton;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.38.34;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.6.2.1
date	97.05.20.13.38.15;	author kbracey;	state Exp;
branches;
next	4.6.2.2;

4.6.2.2
date	98.03.26.14.13.46;	author rthornb;	state Exp;
branches
	4.6.2.2.2.1;
next	;

4.6.2.2.2.1
date	98.11.20.20.09.33;	author aglover;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.38.34;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.01.50.06;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.44.53;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.59.33;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.04.24.15.09.31;	author nturton;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.07.29.09.48.10;	author nturton;	state Exp;
branches;
next	4.1.7.4;

4.1.7.4
date	97.09.05.09.20.32;	author rbuckley;	state Exp;
branches;
next	;


desc
@@


4.20
log
@Build fix
Pass the location of <resdata> in as a predefine, otherwise we end up with a dependency on <resdata> that the makefile undefines one line later, which upsets AMU.
Retagged as Messages-1_11.
@
text
@# Copyright 1996 Acorn Computers Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for Messages module
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 02-Jun-94  AMcC         Created.
# 08-Dec-94  AMcC         Adjust rules and dependencies so that
#                         tokens don't need to be generated every time
#                         - remove data.Dictionary to regenerate tokens
# 05 Sep 1997 RWB       Corrected error on usage of WFLAGS

#
# Generic options:
#
include Makefiles:StdTools

#
# Program specific options:
#
SOURCE    = s.${TARGET}
BUILTDIR  = rm.${BUILD}.<Build$LocaleListNumeric>
BUILT     = ${BUILTDIR}.${TARGET}
RESDIR    = Resources.${BUILD}.<Build$LocaleListNumeric>
PROCESSDIR= Processed.${BUILD}.<Build$LocaleListNumeric>
UTILS     = Utils
DATA      = Data.${BUILD}.<Build$LocaleListNumeric>
# Note: RESDATA mustn't be in PROCESSDIR !!
RESDATA   = ${DATA}.Data
HELPTAGS  = ${DATA}.HelpTags
HELPMESS  = ${DATA}.HelpMess
HELPTOKENS= ${DATA}.HelpTokens
DICTTAGS  = ${DATA}.DictTags
DICTMESS  = ${DATA}.DictMess
DICTTOKENS= ${DATA}.DictTokens
DICTIONARY= ${DATA}.Dictionary
DIRS      = ${DATA}.Dirs

MINDICT   = Global.${LOCALE}.MinDict
MINDICTT  = Global.${LOCALE}.MinDictT

#
# Utility programs:
#
TAGEXT  = ${UTILS}.TagExtract
MSGEXT  = ${UTILS}.MsgExt
MSGTOK  = ${UTILS}.MsgTok
TOKGEN  = ${UTILS}.TokGen
MSGEXT2 = ${UTILS}.MsgExt2
MSGTOK2 = ${UTILS}.MsgTok2
TOKGEN2 = ${UTILS}.TokGen2
SCANRES = ${UTILS}.ScanRes
RESCOMM = ${UTILS}.ResCommon
LOCALECHK = ${UTILS}.LocaleChk

#
# Generic rules:
#
rom: ${BUILT}
        @@echo ${COMPONENT}: rom module built for Build: ${BUILD}.<Build$LocaleListNumeric>

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

install_rom: ${BUILT}
        ${CP} ${BUILT} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

#
# Clean: clean current build and locale, except dictionary and HelpTokens
# (note - called from srcbuild with TARGET and COMPONENT set only to "Messages"
# and no options - but must clean all targets).
#
clean:
        ${XWIPE} ${BUILTDIR}.* ${WFLAGS}
        ${RM} ${RESDATA}
        ${RM} ${DATA}.Tokenised
        ${RM} ${HELPTAGS}
        ${RM} ${DICTTAGS}
        ${XWIPE} ${RESDIR}.^.* ${WFLAGS}
        ${XWIPE} ${PROCESSDIR}.^.* ${WFLAGS}
        ${RM} s.LocaleList
        @@echo ${COMPONENT}: cleaned (Dictionary & HelpTokens not removed)

#
# Clean_all: totally clean all builds and locales
#
clean_all:
        ${XWIPE} Data ${WFLAGS}
        ${XWIPE} o ${WFLAGS}
        ${XWIPE} rm ${WFLAGS}
        ${RM} s.LocaleList
        ${XWIPE} Resources.* ${WFLAGS}
        ${XWIPE} Processed.* ${WFLAGS}
        @@echo ${COMPONENT}: all cleaned

resources:
        ${MKDIR} ${RESDIR}.<Locale>.Resources.Global
        SetMacro LocalGlobal$Path Global.<Locale>.,Global.UK.
        ${CP} LocalGlobal:Messages ${RESDIR}.<Locale>.Resources.Global.Messages ${CPFLAGS}
        Unset LocalGlobal$Path
        @@echo ${COMPONENT}: resource files copied

${BUILTDIR}.Messages: s.LocaleList ${SOURCE} ${DATA}.Tokenised ${DIRS} force
        ${SCANRES} ${PROCESSDIR} ${RESDATA}
        ${AS} ${ASFLAGS} -o o.Messages ${SOURCE} -pd "ResData SETS \"${RESDATA}\""
        ${LD} ${LDFLAGS} -o $@@ -rmf o.Messages

${BUILTDIR}.MessagesHI: s.LocaleList ${SOURCE} ${DIRS} force
        ${MKDIR} rm.${BUILD}.<Build$LocaleListNumeric>
        ${AS} ${ASFLAGS} -o o.MessagesHI ${SOURCE}
        ${LD} ${LDFLAGS} -o $@@ -rmf o.MessagesHI

${BUILTDIR}.MessData: ${DATA}.Tokenised ${DIRS}
        ${SCANRES} ${PROCESSDIR} $@@

force:; @@|

s.LocaleList:; Utils.LocaleChk

#
# Binary Build Environment rules
#
BBETYPE = messages
bbe-messages: bbe-generic-resources-get-alias ${TAGEXT}
  ${MKDIR} ${BBEDIR}.Processed
  ${MKDIR} ${BBEDIR}.Resources
  ${MKDIR} ${BBEDIR}.${UTILS}
  BBE_Export_Dir Global.${LOCALE}
  BBE_Export_Dir s
  ${CP} ${BBEDIR}.s.BBEDefs ${BBEDIR}.s.Defs DF~C~V~R
  BBE_Export_File ${TAGEXT}
  BBE_Export_File ${MSGEXT}
  BBE_Export_File ${MSGTOK}
  BBE_Export_File ${TOKGEN}
  BBE_Export_File ${MSGEXT2}
  BBE_Export_File ${MSGTOK2}
  BBE_Export_File ${TOKGEN2}
  BBE_Export_File ${SCANRES}
  BBE_Export_File ${RESCOMM}
  BBE_Export_File ${LOCALECHK}
  BBE_Export_File ${UTILS}.RemoveEmpt
  BBE_Export_File ${UTILS}.HelpAppend
  BBE_Export_File VersionASM
  BBE_Export_File VersionNum
  BBE_Export_File Makefile
  ${TOUCH} ${BBEDIR}.${UTILS}.Makefile
  ${STRIPDEPEND} ${BBEDIR}.Makefile

#
# Tokenise the Messages file using Help and Dictionary Tokens
#
${DATA}.Tokenised: ${DICTIONARY} ${HELPTOKENS} ${HELPTAGS}
        ${PERL} Utils.HelpAppend ${PROCESSDIR} ${HELPTOKENS}
        ${MSGTOK} ${HELPTOKENS} ${HELPTAGS} 
        ${CP} ${DICTIONARY} ${PROCESSDIR}.Common.Resources.Kernel.Dictionary ${CPFLAGS}
        ${MSGTOK2} ${DICTTOKENS} ${DICTTAGS}
        ${TOUCH} ${DATA}.Tokenised; settype ${DATA}.Tokenised fff

#
# Copy Local Resources, then extract Help and Dictionary token tags
#
${HELPTAGS}: ${TAGEXT} ${DIRS}
        @@echo Copying Resources to Processed directory for tokenising ...
        ${MKDIR} ${PROCESSDIR}
        ${RESCOMM} Resources.${BUILD}.<Build$LocaleListNumeric> ${PROCESSDIR}
        ${PERL} Utils.RemoveEmpt ${PROCESSDIR}
        Do ${TAGEXT} ${PROCESSDIR} ${DICTTAGS} ${HELPTAGS}

#
# Help tokens
#
${HELPTOKENS}:
        ${MSGEXT} ${HELPMESS} ${HELPTAGS}
        ${TOKGEN} ${HELPMESS} ${HELPTOKENS}

#
# Use minimum Dictionary tokens:
#
#${DICTIONARY}: ${MINDICT}
#        ${CP} ${MINDICT}  ${DICTIONARY} ${CPFLAGS}
#        ${CP} ${MINDICTT} ${DICTTOKENS} ${CPFLAGS}

#
# Use optimal Dictionary tokens:
#
${DICTIONARY}:
        ${MSGEXT2} ${DICTMESS} ${DICTTAGS}
        ${TOKGEN2} ${DICTMESS} ${DICTTOKENS} ${DICTIONARY}

${TAGEXT}:
        Dir ${UTILS}
        ${MAKE}
        Up

${DIRS}:
        ${MKDIR} Data.${LOCALE}
        ${MKDIR} ${DATA}
        ${MKDIR} o
        ${MKDIR} ${PROCESSDIR}
        ${MKDIR} rm.${BUILD}.<Build$LocaleListNumeric>
        ${TOUCH} ${DIRS}
        
# Dynamic dependencies:
@


4.19
log
@Build fix. Be quiet when cleaning.

Version 1.08. Tagged as 'Messages-1_08'
@
text
@d121 1
a121 2
        set resdata ${RESDATA}
        ${AS} ${ASFLAGS} -o o.Messages ${SOURCE}
a122 1
        unset resdata
@


4.18
log
@  Build fix
Detail:
  Some users reported problems building the sources if they had other
  installations of perl on their build machine. The build system was using a
  mixture of "perl" and "<Perl$Dir>.perl" to invoke the interpreter, and
  sometimes but not always using "do" to expand system variables on the
  command line. This has now been standardised to use "do <Perl$Dir>.perl in
  all cases, and where possible, to use the makefile macro ${PERL}.
Admin:
  Checked that a Tungsten build still works on a build machine with no other
  perl installation. "perl" was aliased to an error to ensure it wasn't used.

Version 1.06. Not tagged
@
text
@d26 1
a26 1
# 05 Sep 1997 RWB	Corrected error on usage of WFLAGS
d90 1
a90 1
        ${WIPE} ${BUILTDIR}.* ${WFLAGS}
d95 2
a96 2
        ${WIPE} ${RESDIR}.^.* ${WFLAGS}
        ${WIPE} ${PROCESSDIR}.^.* ${WFLAGS}
d104 6
a109 6
	${WIPE} Data ${WFLAGS}
	${WIPE} o ${WFLAGS}
	${WIPE} rm ${WFLAGS}
	${RM} s.LocaleList
        ${WIPE} Resources.* ${WFLAGS}
	${WIPE} Processed.* ${WFLAGS}
d182 1
a182 1
	${MKDIR} ${PROCESSDIR}
d214 7
a220 7
	${MKDIR} Data.${LOCALE}
	${MKDIR} ${DATA}
	${MKDIR} o
	${MKDIR} ${PROCESSDIR}
	${MKDIR} rm.${BUILD}.<Build$LocaleListNumeric>
	${TOUCH} ${DIRS}
	
@


4.17
log
@  Given a thrashing to make it build on a 32-bit machine.
Detail:
  * Switched to build the module using objasm instead of aasm
  * Rebuilt all the utils APCS-32, involved making them C99 compliant
  * Fixed a bug in MsgTok whereby single character tokens would screw up
    the output (because the tokenised version is longer than the original).
    Not really sure how we got away with this in the past, and not sure why
    the token generator produces single-character tokens to begin with.
Admin:
  Tested in a Tungsten build.

Version 1.06. Tagged as 'Messages-1_06'
@
text
@d171 1
a171 1
        Perl Utils.HelpAppend ${PROCESSDIR} ${HELPTOKENS}
d184 1
a184 1
        Perl Utils.RemoveEmpt ${PROCESSDIR}
@


4.16
log
@  Changes to support BBE more cleanly.
Detail:
  The included header files are included only in a standard build.  In the
    BBE, the definitions for the 3 SWIs it uses are provided explicitly.
    This means that nearly all of the assembler headers can be removed
    from the BBE.  This is useful because those headers contain many
    details about different customers' hardware and software which other
    customers (of the BBE) should not see.  Hdr:Machine.Machine is the
    only file that may need to be modified in this respect.
  During BBE export, BBEDefs is copied as Defs so that s/Common remains
    unaltered in the BBE.
Admin:
  Tested in manual build.
  Required by RiscOS/Export 0.01 or later (Export-0_01)

Version 1.05. Tagged as 'Messages-1_05'
@
text
@a30 1
AASMFLAGS = -module
d122 2
a123 1
        ${AASM} ${AASMFLAGS} -To $@@ -From ${SOURCE}
d128 2
a129 1
        ${AASM} ${AASMFLAGS} -To $@@ -From ${SOURCE}
@


4.15
log
@  BBE support.
Detail:
  The messages module needs to export itself very carefully to the BBE
    so that it can still be rebuilt from scratch when required.
Admin:
  Tested in BBE.
  Does not affect other builds.
  Requires BuildSys 2.76 or later.
  Requires Library 0.62 or later.

Version 1.04. Tagged as 'Messages-1_04'
@
text
@d147 1
@


4.14
log
@  Tentative changes to support BBE.
Detail:
  The Messages module has peculiar requirements in that it needs to be
    a fully functional source export to the BBE installation.
Admin:
  Not tested; changes grafted on from earlier version which was tested.
  Should not affect other builds.

Version 1.03. Tagged as 'Messages-1_03'
@
text
@d31 2
a32 12
AS      = aasm
CP      = copy
MKDIR   = mkdir -p
RM      = remove
WIPE    = -wipe
MAKE    = amu

CCFLAGS = -c -depend !Depend -IC:
ASFLAGS = -depend !Depend -Stamp -quit -module
CPFLAGS = ~cfr~v
TOUCH   = create
WFLAGS  = ~cr~v
d123 1
a123 1
        ${AS} ${ASFLAGS} -To $@@ -From ${SOURCE}
d128 1
a128 1
        ${AS} ${ASFLAGS} -To $@@ -From ${SOURCE}
a141 3
  BBE_Export_Dir Global.${LOCALE}
  BBE_Export_Dir s
  ${CP} Mk* ${BBEDIR}.* ${CPFLAGS}
d145 19
a163 12
  ${CP} ${TAGEXT}  ${BBEDIR}.${TAGEXT}  ${CPFLAGS}
  ${CP} ${MSGEXT}  ${BBEDIR}.${MSGEXT}  ${CPFLAGS}
  ${CP} ${MSGTOK}  ${BBEDIR}.${MSGTOK}  ${CPFLAGS}
  ${CP} ${TOKGEN}  ${BBEDIR}.${TOKGEN}  ${CPFLAGS}
  ${CP} ${MSGEXT2} ${BBEDIR}.${MSGEXT2} ${CPFLAGS}
  ${CP} ${MSGTOK2} ${BBEDIR}.${MSGTOK2} ${CPFLAGS}
  ${CP} ${TOKGEN2} ${BBEDIR}.${TOKGEN2} ${CPFLAGS}
  ${CP} ${SCANRES} ${BBEDIR}.${SCANRES} ${CPFLAGS}
  ${CP} ${RESCOMM} ${BBEDIR}.${RESCOMM} ${CPFLAGS}
  ${CP} ${LOCALECHK} ${BBEDIR}.${LOCALECHK} ${CPFLAGS}
  ${CP} Version* ${BBEDIR}.* ${CPFLAGS}

@


4.13
log
@  If the configured territory does not exist, the resources from an already
  defined default territory are taken.
Detail:
  Needed for Bethany as the UK territory is not hard-coded in the kernel as
  one set of ROMs does not contain UK.  If an unknown territory (say 99 for
  example) was selected, the unit would data abort on start up as it could
  not find the correct resources.
  At build time, the application 'LocaleChk' is run that defines a locale
  table which is built into the Messages module.
Admin:
  The new Messages module has been tested in both the Bethany builds (one with
  and one without UK) and the correct behaviour is seen.

Version 0.99. Tagged as 'Messages-0_99'
@
text
@d148 24
@


4.12
log
@	Uodated ScanRes and ResCommon.

Detail:
	ScanRes now uses Service_International rather than the
Territory_NameToNumber swi. Also added the caseless strcmp() routine to allow
certain string comparisons to work.
	ResCommon now places resources that are common between all the
resource sets into a 'Common' directory, rather than in a numeric form. This
allows ScanRes to place them in the '00' directory that the messages module
expects on start-up.

Admin:
	Tested in Bethany and Lazarus builds.

Version 0.97. Tagged as 'Messages-0_97'
@
text
@d80 1
d108 1
d118 1
d130 1
a130 2

${BUILTDIR}.Messages: ${SOURCE} ${DATA}.Tokenised ${DIRS}
d136 1
a136 1
${BUILTDIR}.MessagesHI: ${SOURCE} ${DIRS}
d143 4
a200 1

@


4.11
log
@	Yet more magic ways of fitting even more territory resources into one
build.

Detail:
	We now need to fit five resource sets into the first Bethany ROM
image. The previous simple scheme that I implemented did not allow this, so
the ResCommon utility has been extensively overhauled to detect more
commonality between resource sets and hence reduce the ROM requirements for
the resources.
	For instance if there are three files, each containing a byte as
follows:
	File:	1	2	3
	Data:	A	B	A
	Then files 1 and 3 will be common, whilst 2 would have it's own,
individual, version of the file.
	This process is undertaken for all files in the resource sets. For a
Bethany build with five territories (and hence resource sets) this parsing
takes about seven minutes to calculate all commonality and copy the files
into the correct processed directories on a RiscPC with RapIde interface.

Admin:
	Tested in Bethany builds with 3 and 5 different resource sets, and in
Lazarus builds with 1 resource set. This all appears to work correctly, with
please use with caution; the first time you do a build with this version,
check the resources in the build to ensure that they at least look correct
with nothing missing.
	There are some limitations of the current system; for more detais of
these please see the 'ToDo' comments at the end of the ResCommon sources.

Version 0.96. Tagged as 'Messages-0_96'
@
text
@d147 1
a147 1
        ${CP} ${DICTIONARY} ${PROCESSDIR}.<Build$LocaleListNumeric>.Resources.Kernel.Dictionary ${CPFLAGS}
@


4.10
log
@	More changes.
Detail:
	* ResCommon no longer called with Verbose flag set.
	* A new Perl script, RemoveEmpt, added, that strips out any emtpy
directories in the processed directory.
	* ResCommon now deals correctly with squashed filed - it reads in the
header of the file and ignores the exec address.
	* get_filetype() now works correctly.
	* ResCommon has been generally tidied up.
Admin:
	Still under development. Should work more reliably than the previous
version.

Version 0.93. Not tagged
@
text
@d134 1
a134 1
${BUILTDIR}.MessagesHI: ${SOURCE} 
d147 1
a147 1
        ${CP} ${DICTIONARY} ${PROCESSDIR}.Common.Resources.Kernel.Dictionary ${CPFLAGS}
d156 2
a157 2
        ${CP} Resources Processed ${CPFLAGS}
        ${RESCOMM} ${PROCESSDIR}
d191 1
@


4.9
log
@	Many changes. Warning, Danger! Danger!
	This version of the module deals with multiple territory blocks being
held in ResourceFS.

Detail:
	* Fixed a bug in TokGen2. MAX_TOKEN_LEN2 was set to 256, when it
actually should be 254 (to allow for 2 byte to hold length and status). This
was causing an overflow which meant that large messages were not being
correctly tokenised. Also added a check for tokens that are too long, to at
least make sure that the buildmaster is informed that something has gone
screwy with the token generation instead of continuing on regardless.
	* Created a simple Perl script, HelpApend, that appends common help
data onto the end of each of the individual territory blocks.
	* Bug fixed in s.Common: Pointer in list was not being advanced.
	* ScanRes altered to allow nested resorce blocks.
	* Bug fixed in ResCommon - the -simulate flag now works in the
correct manner, and not the inverse (ooops!)
	* MsgTok2 now gives a warning if the input file is not present.
	* The main MakeFile has been altered to go through the extra stages
needed by the multiple-resource system.
	* Added the ResCommon binary.

To be done:
	* Make ScanRes use Service_Territory 0 instead of
Territory_NameToNumber to work out territory number to name mappings.
	* Make ResCommon cope with Squash files.
	* Make ResCommon remove all empty directories from the resource
directories.
	* Tidy up the code.
	* Add documentation.
	* Thoroughly test on different builds.

Admin:
	Must be used with srcbuild 20 or later.
	Important notice: From this version onwards, the TerritoryManager
*must* be placed ahead of Messages in the ROM, but after ResourceFS.
	This module has not yet been tested without the LocaleList system
variable being set.
	Work in progress. Do not use for anything release-critical.

Version 0.93. Not tagged
@
text
@d157 2
a158 1
        ${RESCOMM} ${PROCESSDIR} -v
@


4.8
log
@Made sure "clean" rule cleans all targets for current locale+build.

Version 0.88. Tagged as 'Messages-0_88'
@
text
@d33 1
a33 1
MKDIR   = cdir
d48 1
a48 1
BUILTDIR  = rm.${LOCALE}.${BUILD}
d50 2
a51 2
PROCESSDIR= Processed.${LOCALE}.${BUILD}
RESDIR    = Resources.${LOCALE}.${BUILD}
d53 1
a53 1
DATA      = Data.${LOCALE}.${BUILD}
d79 1
d85 1
a85 1
        @@echo ${COMPONENT}: rom module built for Build: ${BUILD}
d105 2
a106 2
        ${WIPE} ${RESDIR}.* ${WFLAGS}
        ${WIPE} ${PROCESSDIR}.* ${WFLAGS}
d121 4
a124 2
        ${MKDIR} ${RESDIR}.Resources.Global
        ${CP} Global.${LOCALE}.Messages ${RESDIR}.Resources.Global.Messages ${CPFLAGS}
d127 2
a128 1
rm.${LOCALE}.${BUILD}.Messages: ${SOURCE} ${DATA}.Tokenised ${DIRS}
d134 2
a135 1
rm.${LOCALE}.${BUILD}.MessagesHI: ${SOURCE} ${DIRS}
d138 1
a138 1
rm.${LOCALE}.${BUILD}.MessData: ${DATA}.Tokenised ${DIRS}
d145 3
a147 3
        Print ${HELPTOKENS} { >> ${PROCESSDIR}.Resources.Help.Messages }
        ${MSGTOK} ${HELPTOKENS} ${HELPTAGS}
        ${CP} ${DICTIONARY} ${PROCESSDIR}.Resources.Kernel.Dictionary ${CPFLAGS}
d157 2
a158 1
        ${TAGEXT} ${PROCESSDIR} ${DICTTAGS} ${HELPTAGS}
a186 1
	${MKDIR} Data
d190 1
a190 3
	${MKDIR} rm
	${MKDIR} rm.${LOCALE}
	${MKDIR} rm.${LOCALE}.${BUILD}
d192 1
@


4.7
log
@Spinner branch merged. Changed to use srccommit.
Added extra targets for placing resources beyond the first 8Mb of ROM.

Version 0.85. Tagged as 'Messages-0_85'
@
text
@d48 2
a49 1
BUILT     = rm.${LOCALE}.${BUILD}.${TARGET}
d95 2
d99 1
a99 1
        ${RM} ${BUILT}
@


4.6
log
@Fixed some dependencies this time
@
text
@d26 1
a26 1
#
d47 2
a48 3
COMPONENT = Messages
SOURCE    = s.Messages
TARGET    = rm.${LOCALE}.${BUILD}.Messages
d82 1
a82 1
rom: ${TARGET}
d88 2
a89 2
install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
d96 1
a96 1
        ${RM} ${TARGET}
d101 2
a102 1
        ${WIPE} Resources.* ${WFLAGS}
d109 3
a111 2
	${WIPE} Data.* ${WFLAGS}
	${WIPE} rm.* ${WFLAGS}
d121 1
a121 1
${TARGET}: ${SOURCE} ${DATA}.Tokenised ${DIRS}
d127 6
d181 1
a187 13
rm.Morris4.Messages: Hdr:ListOpts
rm.Morris4.Messages: Hdr:Macros
rm.Morris4.Messages: Hdr:System
rm.Morris4.Messages: Hdr:SWIs
rm.Morris4.Messages: Hdr:CPU.Generic26
rm.Morris4.Messages: Hdr:IO.GenericIO
rm.Morris4.Messages: Hdr:RISCOS
rm.Morris4.Messages: Hdr:ModHand
rm.Morris4.Messages: Hdr:Services
rm.Morris4.Messages: Hdr:Proc
rm.Morris4.Messages: Hdr:ResourceFS
rm.Morris4.Messages: Version
rm.Morris4.Messages: Hdr:NDRDebug
@


4.6.2.1
log
@Fixed directory creation again
@
text
@a176 3
	${MKDIR} Processed
	${MKDIR} Processed.${LOCALE}
	${MKDIR} Processed.${LOCALE}.${BUILD}
d180 13
a192 26
rm.UK.Morris4.Messages: Hdr:ListOpts
rm.UK.Morris4.Messages: Hdr:Macros
rm.UK.Morris4.Messages: Hdr:System
rm.UK.Morris4.Messages: Hdr:SWIs
rm.UK.Morris4.Messages: Hdr:CPU.Generic26
rm.UK.Morris4.Messages: Hdr:IO.GenericIO
rm.UK.Morris4.Messages: Hdr:RISCOS
rm.UK.Morris4.Messages: Hdr:ModHand
rm.UK.Morris4.Messages: Hdr:Services
rm.UK.Morris4.Messages: Hdr:Proc
rm.UK.Morris4.Messages: Hdr:ResourceFS
rm.UK.Morris4.Messages: Version
rm.UK.Morris4.Messages: Hdr:NDRDebug
rm.UK.Ursula4.Messages: Hdr:ListOpts
rm.UK.Ursula4.Messages: Hdr:Macros
rm.UK.Ursula4.Messages: Hdr:System
rm.UK.Ursula4.Messages: Hdr:SWIs
rm.UK.Ursula4.Messages: Hdr:CPU.Generic26
rm.UK.Ursula4.Messages: Hdr:IO.GenericIO
rm.UK.Ursula4.Messages: Hdr:RISCOS
rm.UK.Ursula4.Messages: Hdr:ModHand
rm.UK.Ursula4.Messages: Hdr:Services
rm.UK.Ursula4.Messages: Hdr:Proc
rm.UK.Ursula4.Messages: Hdr:ResourceFS
rm.UK.Ursula4.Messages: Version
rm.UK.Ursula4.Messages: Hdr:NDRDebug
@


4.6.2.2
log
@Removed dynamic dependancies from Makefiles and removed all reference to Prefix
@
text
@d183 26
@


4.6.2.2.2.1
log
@Makefile edits and various plumbing to make the darn thing build
@
text
@d130 1
a130 1
        Print ${HELPTOKENS} { > ${PROCESSDIR}.Resources.Help.Messages }
@


4.5
log
@Fixed directory creation again
@
text
@d63 1
d120 1
a120 1
${TARGET}: ${SOURCE} ${DATA}.Tokenised dirs
d139 1
a139 1
${HELPTAGS}: ${TAGEXT} dirs
d170 1
a170 1
dirs:
d174 2
d177 1
@


4.4
log
@Fixed directory creation
@
text
@d119 1
a119 5
${TARGET}: ${SOURCE} ${DATA}.Tokenised
	${MKDIR} Data
	${MKDIR} Data.${LOCALE}
	${MKDIR} Data.${LOCALE}.${BUILD}
	${MKDIR} rm.${LOCALE}.${BUILD}
d170 2
d173 1
@


4.3
log
@Split processes into <Locale>.<Build> directories, after fashion of
Spinner branch, but maintaining separate tokenised directory.
@
text
@d120 4
a123 2
	${MKDIR} ${DATA}
	${MKDIR} rm.${BUILD}
@


4.2
log
@Module merged
@
text
@d49 3
a51 4
TARGET    = rm.Messages
PROCESSDIR= Resources
LDIR      = ${LOCALE}
RESDIR    = <resource$dir>
d53 1
a53 1
DATA      = Data
d64 2
a65 1
MINDICT   = ${DATA}.MinDict
d83 1
a83 1
        @@echo ${COMPONENT}: module built
d92 3
d105 1
a105 1
# Clean_all: removes Dictionary and HelpTokens and ${LOCALE}.*
d108 2
a109 10
        ${RM} ${TARGET}
        ${RM} ${RESDATA}
        ${RM} ${DATA}.Tokenised
        ${RM} ${HELPTAGS}
        ${RM} ${HELPMESS}
        ${RM} ${HELPTOKENS}
        ${RM} ${DICTTAGS}
        ${RM} ${DICTMESS}
        ${RM} ${DICTTOKENS}
        ${RM} ${DICTIONARY}
d111 1
d120 2
d140 3
a142 3
${HELPTAGS}:
        @@echo Copying ${LOCALE} Resources to Resources directory for tokenising ...
        ${CP} ${LOCALE} Resources ${CPFLAGS}
d155 3
a157 3
#${DICTIONARY}: ${DATA}.MinDict
#        ${CP} ${DATA}.MinDict  ${DICTIONARY} ${CPFLAGS}
#        ${CP} ${DATA}.MinDictT ${DICTTOKENS}  ${CPFLAGS}
d171 3
a174 13
rm.Morris2.Messages: Hdr:ListOpts
rm.Morris2.Messages: Hdr:Macros
rm.Morris2.Messages: Hdr:System
rm.Morris2.Messages: Hdr:SWIs
rm.Morris2.Messages: Hdr:CPU.Generic26
rm.Morris2.Messages: Hdr:IO.GenericIO
rm.Morris2.Messages: Hdr:RISCOS
rm.Morris2.Messages: Hdr:ModHand
rm.Morris2.Messages: Hdr:Services
rm.Morris2.Messages: Hdr:Proc
rm.Morris2.Messages: Hdr:ResourceFS
rm.Morris2.Messages: Version
rm.Morris2.Messages: Hdr:NDRDebug
a187 26
rm.Messages: Hdr:ListOpts
rm.Messages: Hdr:Macros
rm.Messages: Hdr:System
rm.Messages: Hdr:SWIs
rm.Messages: Hdr:CPU.Generic26
rm.Messages: Hdr:IO.GenericIO
rm.Messages: Hdr:RISCOS
rm.Messages: Hdr:ModHand
rm.Messages: Hdr:Services
rm.Messages: Hdr:Proc
rm.Messages: Hdr:ResourceFS
rm.Messages: Version
rm.Messages: Hdr:NDRDebug
rm.Omega4.Messages: Hdr:ListOpts
rm.Omega4.Messages: Hdr:Macros
rm.Omega4.Messages: Hdr:System
rm.Omega4.Messages: Hdr:SWIs
rm.Omega4.Messages: Hdr:CPU.Generic26
rm.Omega4.Messages: Hdr:IO.GenericIO
rm.Omega4.Messages: Hdr:RISCOS
rm.Omega4.Messages: Hdr:ModHand
rm.Omega4.Messages: Hdr:Services
rm.Omega4.Messages: Hdr:Proc
rm.Omega4.Messages: Hdr:ResourceFS
rm.Omega4.Messages: Version
rm.Omega4.Messages: Hdr:NDRDebug
@


4.1
log
@Initial revision
@
text
@d49 4
a52 2
TARGET    = rm.${SYSTEM}.Messages
RESDIR    = Resources.${LOCALE}.${SYSTEM}
d55 1
a55 1
# Note: RESDATA mustn't be in RESDIR !!
d83 1
a83 1
        @@echo ${COMPONENT}: rom module built for System: ${SYSTEM}
d101 3
d124 1
a124 1
        ${MKDIR} rm.${SYSTEM}
d129 5
a133 3
${DATA}.Tokenised: ${DICTIONARY} ${HELPTAGS}
        ${MKDIR} ${RESDIR}.Resources.Kernel
        ${CP} ${DICTIONARY} ${RESDIR}.Resources.Kernel.Dictionary ${CPFLAGS}
d135 1
a136 2
        Print ${HELPTOKENS} { >> ${RESDIR}.Resources.Help.Messages }
        ${SCANRES} ${RESDIR} ${RESDATA}
d139 21
a159 2
${HELPTAGS}: ${TAGEXT}
        ${TAGEXT} ${RESDIR} ${DICTTAGS} ${HELPTAGS}
d161 3
a164 1
        ${MSGEXT} ${HELPMESS} ${HELPTAGS}
a165 1
        ${TOKGEN} ${HELPMESS} ${HELPTOKENS}
d200 26
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@a173 13
rm.Omega4.Messages: Hdr:ListOpts
rm.Omega4.Messages: Hdr:Macros
rm.Omega4.Messages: Hdr:System
rm.Omega4.Messages: Hdr:SWIs
rm.Omega4.Messages: Hdr:CPU.Generic26
rm.Omega4.Messages: Hdr:IO.GenericIO
rm.Omega4.Messages: Hdr:RISCOS
rm.Omega4.Messages: Hdr:ModHand
rm.Omega4.Messages: Hdr:Services
rm.Omega4.Messages: Hdr:Proc
rm.Omega4.Messages: Hdr:ResourceFS
rm.Omega4.Messages: Version
rm.Omega4.Messages: Hdr:NDRDebug
@


4.1.7.2
log
@Made to work correctly with different builds
@
text
@d49 2
a50 2
TARGET    = rm.${BUILD}.Messages
RESDIR    = Resources.${LOCALE}.${BUILD}
d52 1
a52 1
DATA      = Data.${BUILD}
d63 1
a63 1
MINDICT   = Global.${LOCALE}.MinDict
d81 1
a81 1
        @@echo ${COMPONENT}: rom module built for Build: ${BUILD}
d96 1
a96 1
        ${WIPE} ${RESDIR}.* ${WFLAGS}
d100 10
a109 2
	${WIPE} Data.* ${WFLAGS}
	${WIPE} rm.* {WFLAGS}
d118 2
a119 2
${TARGET}: ${SOURCE} ${DATA}.Tokenised dirs
        ${MKDIR} rm.${BUILD}
a146 3
dirs:
	${MKDIR} ${DATA}

a186 52
rm.RCA4.Messages: Hdr:ListOpts
rm.RCA4.Messages: Hdr:Macros
rm.RCA4.Messages: Hdr:System
rm.RCA4.Messages: Hdr:SWIs
rm.RCA4.Messages: Hdr:CPU.Generic26
rm.RCA4.Messages: Hdr:IO.GenericIO
rm.RCA4.Messages: Hdr:RISCOS
rm.RCA4.Messages: Hdr:ModHand
rm.RCA4.Messages: Hdr:Services
rm.RCA4.Messages: Hdr:Proc
rm.RCA4.Messages: Hdr:ResourceFS
rm.RCA4.Messages: Version
rm.RCA4.Messages: Hdr:NDRDebug
rm.RCA.Messages: Hdr:ListOpts
rm.RCA.Messages: Hdr:Macros
rm.RCA.Messages: Hdr:System
rm.RCA.Messages: Hdr:SWIs
rm.RCA.Messages: Hdr:CPU.Generic26
rm.RCA.Messages: Hdr:IO.GenericIO
rm.RCA.Messages: Hdr:RISCOS
rm.RCA.Messages: Hdr:ModHand
rm.RCA.Messages: Hdr:Services
rm.RCA.Messages: Hdr:Proc
rm.RCA.Messages: Hdr:ResourceFS
rm.RCA.Messages: Version
rm.RCA.Messages: Hdr:NDRDebug
rm.RCA8.Messages: Hdr:ListOpts
rm.RCA8.Messages: Hdr:Macros
rm.RCA8.Messages: Hdr:System
rm.RCA8.Messages: Hdr:SWIs
rm.RCA8.Messages: Hdr:CPU.Generic26
rm.RCA8.Messages: Hdr:IO.GenericIO
rm.RCA8.Messages: Hdr:RISCOS
rm.RCA8.Messages: Hdr:ModHand
rm.RCA8.Messages: Hdr:Services
rm.RCA8.Messages: Hdr:Proc
rm.RCA8.Messages: Hdr:ResourceFS
rm.RCA8.Messages: Version
rm.RCA8.Messages: Hdr:NDRDebug
rm.Boca8.Messages: Hdr:ListOpts
rm.Boca8.Messages: Hdr:Macros
rm.Boca8.Messages: Hdr:System
rm.Boca8.Messages: Hdr:SWIs
rm.Boca8.Messages: Hdr:CPU.Generic26
rm.Boca8.Messages: Hdr:IO.GenericIO
rm.Boca8.Messages: Hdr:RISCOS
rm.Boca8.Messages: Hdr:ModHand
rm.Boca8.Messages: Hdr:Services
rm.Boca8.Messages: Hdr:Proc
rm.Boca8.Messages: Hdr:ResourceFS
rm.Boca8.Messages: Version
rm.Boca8.Messages: Hdr:NDRDebug
@


4.1.7.3
log
@Tidied up directory creating
@
text
@d110 1
a110 1
${TARGET}: ${SOURCE} ${DATA}.Tokenised
a125 1
	${MKDIR} ${DATA}
d139 3
d208 13
a233 13
rm.RCA8.Messages: Hdr:ListOpts
rm.RCA8.Messages: Hdr:Macros
rm.RCA8.Messages: Hdr:System
rm.RCA8.Messages: Hdr:SWIs
rm.RCA8.Messages: Hdr:CPU.Generic26
rm.RCA8.Messages: Hdr:IO.GenericIO
rm.RCA8.Messages: Hdr:RISCOS
rm.RCA8.Messages: Hdr:ModHand
rm.RCA8.Messages: Hdr:Services
rm.RCA8.Messages: Hdr:Proc
rm.RCA8.Messages: Hdr:ResourceFS
rm.RCA8.Messages: Version
rm.RCA8.Messages: Hdr:NDRDebug
@


4.1.7.4
log
@Corrected usage of WFLAGS.
@
text
@d26 1
a26 1
# 05 Sep 1997 RWB	Corrected error on usage of WFLAGS
d101 1
a101 1
	${WIPE} rm.* ${WFLAGS}
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@d49 2
a50 4
TARGET    = rm.Messages
PROCESSDIR= Resources
LDIR      = ${LOCALE}
RESDIR    = <resource$dir>
d53 1
a53 1
# Note: RESDATA mustn't be in PROCESSDIR !!
d81 1
a81 1
        @@echo ${COMPONENT}: module built
a98 3
#
# Clean_all: removes Dictionary and HelpTokens and ${LOCALE}.*
#
d119 1
a119 1
        ${SCANRES} ${PROCESSDIR} ${RESDATA}
d124 3
a126 5
#
# Tokenise the Messages file using Help and Dictionary Tokens
#
${DATA}.Tokenised: ${DICTIONARY} ${HELPTOKENS} ${HELPTAGS}
        Print ${HELPTOKENS} { >> ${PROCESSDIR}.Resources.Help.Messages }
a127 1
        ${CP} ${DICTIONARY} ${PROCESSDIR}.Resources.Kernel.Dictionary ${CPFLAGS}
d129 2
d133 2
a134 7
#
# Copy Local Resources, then extract Help and Dictionary token tags
#
${HELPTAGS}:
        @@echo Copying ${LOCALE} Resources to Resources directory for tokenising ...
        ${CP} ${LOCALE} Resources ${CPFLAGS}
        ${TAGEXT} ${PROCESSDIR} ${DICTTAGS} ${HELPTAGS}
d136 1
a136 4
#
# Help tokens
#
${HELPTOKENS}:
d138 1
a139 13

#
# Use minimum Dictionary tokens:
#
#${DICTIONARY}: ${DATA}.MinDict
#        ${CP} ${DATA}.MinDict  ${DICTIONARY} ${CPFLAGS}
#        ${CP} ${DATA}.MinDictT ${DICTTOKENS}  ${CPFLAGS}

#
# Use optimal Dictionary tokens:
#
${DICTIONARY}:
        ${MSGEXT2} ${DICTMESS} ${DICTTAGS}
a173 13
rm.Messages: Hdr:ListOpts
rm.Messages: Hdr:Macros
rm.Messages: Hdr:System
rm.Messages: Hdr:SWIs
rm.Messages: Hdr:CPU.Generic26
rm.Messages: Hdr:IO.GenericIO
rm.Messages: Hdr:RISCOS
rm.Messages: Hdr:ModHand
rm.Messages: Hdr:Services
rm.Messages: Hdr:Proc
rm.Messages: Hdr:ResourceFS
rm.Messages: Version
rm.Messages: Hdr:NDRDebug
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
