head	1.10;
access;
symbols
	IOMD-0_36:1.10
	SMP:1.10.0.2
	SMP_bp:1.10
	IOMD-0_35:1.10
	IOMD-0_34:1.10
	IOMD-0_33:1.10
	IOMD-0_32:1.10
	IOMD-0_31:1.10
	IOMD-0_30:1.10
	IOMD-0_29:1.10
	IOMD-0_28:1.9
	IOMD-0_27:1.9
	IOMD-0_26:1.9
	IOMD-0_25:1.9
	IOMD-0_24:1.9
	IOMD-0_23:1.9
	IOMD-0_22:1.8
	IOMD-0_20:1.8
	IOMD-0_19:1.8
	IOMD-0_18:1.8
	IOMD-0_17:1.7
	IOMD-0_16:1.7
	IOMD-0_15:1.7
	IOMD-0_14:1.7
	IOMD-0_13:1.7
	IOMD-0_12:1.6
	IOMD-0_11:1.6
	IOMD-0_10:1.5
	IOMD-0_09:1.5
	IOMD-0_08:1.5
	IOMD-0_07:1.4
	IOMD-0_06:1.3
	IOMD-0_05:1.3
	IOMD-0_04:1.3
	IOMD-0_03:1.3
	IOMD-0_02:1.2
	HAL_merge:1.1.2.8
	IOMD-0_01:1.2
	Kernel-5_35-4_79_2_59:1.1.2.8
	Kernel-5_35-4_79_2_58:1.1.2.8
	Kernel-5_35-4_79_2_57:1.1.2.8
	Kernel-5_35-4_79_2_56:1.1.2.8
	Kernel-5_35-4_79_2_55:1.1.2.8
	Kernel-5_35-4_79_2_54:1.1.2.8
	Kernel-5_35-4_79_2_53:1.1.2.8
	Kernel-5_35-4_79_2_52:1.1.2.8
	Kernel-5_35-4_79_2_51:1.1.2.8
	Kernel-5_35-4_79_2_50:1.1.2.8
	Kernel-5_35-4_79_2_49:1.1.2.8
	Kernel-5_35-4_79_2_48:1.1.2.8
	Kernel-5_35-4_79_2_47:1.1.2.7
	Kernel-5_35-4_79_2_46:1.1.2.7
	Kernel-5_35-4_79_2_45:1.1.2.7
	Kernel-5_35-4_79_2_44:1.1.2.7
	MSI_Demo_merge:1.1.2.7
	Kernel-5_35-4_79_2_25_2_2:1.1.2.7
	Kernel-5_35-4_79_2_43:1.1.2.7
	Kernel-5_35-4_79_2_42:1.1.2.7
	Kernel-5_35-4_79_2_41:1.1.2.7
	Kernel-5_35-4_79_2_40:1.1.2.7
	Kernel-5_35-4_79_2_39:1.1.2.7
	Kernel-5_35-4_79_2_38:1.1.2.7
	Kernel-5_35-4_79_2_37:1.1.2.7
	Kernel-5_35-4_79_2_36:1.1.2.7
	Kernel-5_35-4_79_2_35:1.1.2.7
	Kernel-5_35-4_79_2_34:1.1.2.7
	Kernel-5_35-4_79_2_33:1.1.2.7
	Kernel-5_35-4_79_2_32:1.1.2.7
	Kernel-5_35-4_79_2_25_2_1:1.1.2.7
	MSI_Demo:1.1.2.7.0.2
	Kernel-5_35-4_79_2_31:1.1.2.7
	Kernel-5_35-4_79_2_30:1.1.2.7
	Kernel-5_35-4_79_2_29:1.1.2.7
	Kernel-5_35-4_79_2_28:1.1.2.7
	Kernel-5_35-4_79_2_27:1.1.2.7
	Kernel-5_35-4_79_2_26:1.1.2.7
	Kernel-5_35-4_79_2_25:1.1.2.7
	Kernel-5_35-4_79_2_24:1.1.2.7
	Kernel-5_35-4_79_2_23:1.1.2.7
	Kernel-5_35-4_79_2_22:1.1.2.7
	Kernel-5_35-4_79_2_21:1.1.2.7
	Kernel-5_35-4_79_2_20:1.1.2.7
	Kernel-5_35-4_79_2_19:1.1.2.7
	Kernel-5_35-4_79_2_18:1.1.2.7
	Kernel-5_35-4_79_2_17:1.1.2.7
	Kernel-5_35-4_79_2_16:1.1.2.7
	Kernel-5_35-4_79_2_15:1.1.2.7
	Kernel-5_35-4_79_2_14:1.1.2.7
	Kernel-5_35-4_79_2_13:1.1.2.7
	Kernel-5_35-4_79_2_12:1.1.2.7
	Kernel-5_35-4_79_2_11:1.1.2.7
	Kernel-5_35-4_79_2_10:1.1.2.7
	Kernel-5_35-4_79_2_9:1.1.2.7
	Kernel-5_35-4_79_2_8:1.1.2.4
	Kernel-5_35-4_79_2_7:1.1.2.2
	Kernel-5_35-4_79_2_6:1.1.2.2
	Kernel-5_35-4_79_2_5:1.1.2.2
	Kernel-5_35-4_79_2_4:1.1.2.1
	Kernel-5_35-4_79_2_3:1.1.2.1
	Kernel-5_35-4_79_2_2:1.1.2.1
	HAL:1.1.0.2;
locks; strict;
comment	@# @;


1.10
date	2013.10.28.22.28.51;	author rsprowson;	state Exp;
branches;
next	1.9;
commitid	MrM5i56lHItnY6bx;

1.9
date	2013.02.02.09.12.19;	author rsprowson;	state Exp;
branches;
next	1.8;
commitid	MY6QD1zOoCvdbBCw;

1.8
date	2012.07.15.12.07.27;	author rsprowson;	state Exp;
branches;
next	1.7;
commitid	th0BmFZji9LRDEcw;

1.7
date	2012.06.19.23.38.25;	author jlee;	state Exp;
branches;
next	1.6;
commitid	bSrBAroyIB3Jin9w;

1.6
date	2012.02.25.17.16.20;	author jlee;	state Exp;
branches;
next	1.5;
commitid	Dn81wPJ3GobPSyUv;

1.5
date	2011.06.22.00.56.08;	author jlee;	state Exp;
branches;
next	1.4;
commitid	udJTrSwtAzLNqBov;

1.4
date	2010.12.02.20.28.02;	author bavison;	state Exp;
branches;
next	1.3;

1.3
date	2009.07.14.18.40.41;	author srevill;	state Exp;
branches;
next	1.2;

1.2
date	2008.12.22.00.15.07;	author bavison;	state Exp;
branches;
next	1.1;

1.1
date	2000.10.02.08.52.19;	author kbracey;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2000.10.02.08.52.19;	author kbracey;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2000.10.05.13.54.48;	author kbracey;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2000.10.05.16.37.33;	author mstephen;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2000.10.05.16.46.36;	author dellis;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2000.10.06.09.08.11;	author kbracey;	state Exp;
branches;
next	1.1.2.6;

1.1.2.6
date	2000.10.09.15.59.14;	author kbracey;	state Exp;
branches;
next	1.1.2.7;

1.1.2.7
date	2000.10.16.11.37.10;	author mstephen;	state Exp;
branches;
next	1.1.2.8;

1.1.2.8
date	2002.10.07.17.29.32;	author kbracey;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Add RTC device
HAL RTC device added after probing IIC address &A0.
Moved CallOS macro into a header.

Version 0.29. Tagged as 'IOMD-0_29'
@
text
@# Copyright 2000 Pace Micro Technology plc
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for IOMD HAL
#

COMPONENT  = IOMD HAL
TARGET     = IOMD
OBJS       = Top Boot ATA IIC Interrupts MachineID NVRAM \
             Timers Video cbits KbdScan Debug Post IOMD21DMA RTC
HDRS       =
CMHGFILE   =
CUSTOMRES  = custom
CUSTOMROM  = custom
ROM_TARGET = custom
LNK_TARGET = custom
AIFDBG     = aif._IOMD
GPADBG     = gpa.GPA

include CModule

CCFLAGS   += -ff -APCS 3/32bit/nofp/noswst
ASFLAGS   += -APCS 3/nofp/noswst
AASMFLAGS += -APCS 3/nofp/noswst

resources:
        @@${ECHO} ${COMPONENT}: no resources

rom: aof.${TARGET}
        @@${ECHO} ${COMPONENT}: rom module built

_debug: ${GPADBG}
        @@echo ${COMPONENT}: debug image built

install_rom: linked.${TARGET}
        ${CP} linked.${TARGET} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

aof.${TARGET}: ${ROM_OBJS_} ${ROM_LIBS} ${DIRS} ${ROM_DEPEND}
        ${LD} -o $@@ -aof ${ROM_OBJS_} ${ROM_LIBS}

linked.${TARGET}: aof.${TARGET}
        ${LD} ${LDFLAGS} ${LDLINKFLAGS} -o $@@ -bin -base 0xFC000000 aof.${TARGET}

${AIFDBG}: ${ROM_OBJS_} ${ROM_LIBS}
        ${MKDIR} aif
        ${LD} -aif -bin -d -o ${AIFDBG} ${ROM_OBJS_} ${ROM_LIBS}

${GPADBG}: ${AIFDBG}
        ToGPA -s ${AIFDBG} ${GPADBG}

# Dynamic dependencies:
@


1.9
log
@Add HAL device for IOMD's DMA controller
Tested with simple DMA test podule 8067660000012 rev 0.10 and DMAManager 0.20.

Version 0.23. Tagged as 'IOMD-0_23'
@
text
@d21 1
a21 1
             Timers Video cbits KbdScan Debug Post IOMD21DMA
@


1.8
log
@Addition of POST checking
Unlike some more recent targets, there are a lot of optional/removeable bits on IOMD platforms which may stop the machine booting, this checks for
* VRAM (non fatal if missing)
* RAM
* ROM checksum
* Video timing
* IOMD
in the event of a failure the fault code is flashed on the floppy drive LED (pattern decoder in TRM appendix A).

Video.s: the POST code highlighted that the VIDCTAB had the wrong VCO reference clock on Medusa - this is now corrected for a 60Hz mode.
IOMD.hdr: share the address line bits
Tested on Risc PC + A7000, the timing emulation is not accurate enough on RPCEmu, so POST is skipped under emulation.

Version 0.18. Tagged as 'IOMD-0_18'
@
text
@d21 1
a21 1
             Timers Video cbits KbdScan Debug Post
@


1.7
log
@Add debugging code. Fix detection of RAM in bank 3.
Detail:
  hdr/Debug, hdr/UART, s/Boot, s/Debug, Makefile - Added HAL_DebugTX/HAL_DebugRX implementations, and assorted functions/macros for getting pre-MMU debug output from the HAL. Use Debug switch in hdr/Debug to turn debugging on/off (currently off by default).
  s/Top - Added lots of debug output to help track down RAM detection/configuration issues. Fixed RAM detection result for bank 3 being overwritten with result for bank 2 in NoRelocate.
Admin:
  Tested under RPCEmu & StrongARM softload
  Warning - RPCEmu doesn't emulate the serial line status register. This means debug builds will hang on startup.


Version 0.13. Tagged as 'IOMD-0_13'
@
text
@d18 8
a25 8
COMPONENT = IOMD HAL
TARGET = IOMD
OBJS = Top Boot ATA IIC Interrupts MachineID NVRAM Timers Video cbits KbdScan Debug

HDRS =
CMHGFILE =
CUSTOMRES = custom
CUSTOMROM = custom
d28 2
a29 2
AIFDBG    = aif._IOMD
GPADBG    = gpa.GPA
a30 1
include StdTools
d33 2
a34 2
CCFLAGS += -ff -APCS 3/32bit/nofp/noswst
ASFLAGS += -APCS 3/nofp/noswst
@


1.6
log
@Rewrite Makefile & RAM setup code. Remove/tidy other scripts. Add support for compressed ROMs, keyboard scan, HAL_Reset, HAL_MonitorLeadID and HAL_PhysInfo.
Detail:
  Makefile, MkClean,fd7, MkRom,fd7 - Rewritten
  CopyIt,feb, CopyIt2,feb, CopyItKB,feb, GlueIt,feb, aif, bin, gpa, o - Deleted obsolete files/folders
  s/Boot, s/Top - Moved image entry point from s/Boot to s/Top, to match other HALs. Rewritten RAM setup code to avoid poking dangerous registers during softloads, and to hopefully fix problems people have been having with some memory configurations.
  c/cbits - C code for use during RAM initialisation. Examines the detected RAM banks to work out the optimal physical RAM layout and where to relocate the ROM image, taking into account any ROM compression.
  s/ATA - Convert tabs to spaces for consistency. Fix conditional MOV pc,lr in HAL_ATACableID.
  s/Boot - Added HAL_PhysInfo implementation, based around pre-HAL kernel code. Added HAL_Reset implementation, using similar code to the softload tool to disable the MMU and restart the ROM. Convert tabs to spaces for consistency.
  s/Video, hdr/StaticWS - Added HAL_MonitorLeadID implementation, based around pre-HAL kernel code. Retab Video_init.
  s/KbdScan, hdr/StaticWS - Added HAL_KbdScan_* implementation, based around pre-HAL kernel code.
  s/NVRAM - Convert tabs to spaces for consistency
  hdr/Copro15ops - ARMv3/v4 cache/TLB macros for use during HAL_Reset
  hdr/IOMD - New header to pull together all the physical memory map definitions
Admin:
  Tested in IOMD ROM softload on RiscPC, plus as 'real' ROM under RPCEmu
  New RAM setup code may be a bit buggy still


Version 0.11. Tagged as 'IOMD-0_11'
@
text
@d20 1
a20 1
OBJS = Top Boot ATA IIC Interrupts MachineID NVRAM Timers Video cbits KbdScan
@


1.5
log
@IOMD HAL improvements
Detail:
  Makefile - Specify link base address to fix any absolute address issues
  s/Boot - Add support for new HAL_ControllerAddress reason code to get the 82C710 address. Correct HAL_HardwareInfo. Make HAL_CleanerSpace return the address of ROM bank 1, as per pre-HAL kernel.
  hdr/StaticWS - New workspace entries for 82C710 & CleanerSpace addresses
Admin:
  Tested in ROM softload on RiscPC


Version 0.08. Tagged as 'IOMD-0_08'
@
text
@d15 1
a15 8
# Makefile for Kernel
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 25-May-94  AMcC         Created.
d18 19
a36 5
#
# Paths
#
EXP_HDR = <export$dir>
C_EXP_HDR = <cexport$dir>.Global.h
d38 2
a39 15
#
# Generic options:
#
MKDIR   = mkdir -p
AS      = aasm
ARMASM  = objasm
CP      = copy
RM      = remove
CCFLAGS = -c -depend !Depend -IC:
ASFLAGS = -depend !Depend ${THROWBACK} -Stamp -quit -To $@@ -From
ARMASMFLAGS = -depend !Depend -g -APCS 3/nofp/noswst ${THROWBACK}
CPFLAGS = ~cfr~v

TOKENISE = tokenise
TOKENS   = Hdr:Tokens
d41 2
a42 8
#
# Program specific options:
#
COMPONENT = IOMD
TARGET    = bin.IOMD
DBGTARGET = aif.IOMD
GPATARGET = gpa.IOMD
EXPORTS   =
d44 2
a45 1
OBJECTS   = o.Boot o.IIC o.NVRAM o.Video o.Interrupts o.MachineID o.Timers o.ATA
d47 2
a48 13
.s.o:;	${ARMASM} ${ARMASMFLAGS} $< $@@

#
# Generic rules:
#
rom: ${TARGET}
        @@echo ${COMPONENT}: rom module built

debug: ${GPATARGET}
        @@echo ${COMPONENT}: debug module built

install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
d51 2
a52 13
clean:
	${RM} ROM
        ${RM} ${TARGET}
	-Wipe o.* ~C~V
	-Wipe aif.* ~C~V
	-Wipe gpa.* ~C~V
        @@echo ${COMPONENT}: cleaned

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

resources:
        @@echo ${COMPONENT}: nothing to do
d54 2
a55 2
${TARGET}: ${OBJECTS}
	Link -bin -o $@@ ${OBJECTS} -base 0xFC000000
d57 3
a59 2
${DBGTARGET}: ${OBJECTS}
        Link -bin -aif -d -o $@@ ${OBJECTS} -base 0xFC000000
d61 2
a62 2
${GPATARGET}: ${DBGTARGET}
	ToGPA -s ${DBGTARGET} $@@
@


1.4
log
@  Added RPCEmu support
Detail:
  Not supplied
Admin:
  Changes by Tom Walker

Version 0.07. Tagged as 'IOMD-0_07'
@
text
@d88 1
a88 1
	Link -bin -o $@@ ${OBJECTS}
d91 1
a91 1
        Link -bin -aif -d -o $@@ ${OBJECTS}
@


1.3
log
@Removed some resources junk from the Makefile.

This looks like a cut-n-paste error of including some stuff relating to
exporting resources which do not exist in this component. This will fix the
only (current) build error in the IOMDHALDev build.

Version 0.03. Tagged as 'IOMD-0_03'
@
text
@d56 1
a56 1
OBJECTS   = o.Boot o.IIC o.NVRAM o.Video o.Interrupts o.MachineID o.Timers
@


1.2
log
@Merged IOMD HAL to trunk.

Version 0.01. Tagged as 'IOMD-0_01'
@
text
@d54 1
a54 1
EXPORTS   = 
d84 2
a85 17
resources: resources-${CMDHELP}
        @@echo ${COMPONENT}: resource files copied

resources_common:
        ${MKDIR} ${RESDIR}.${COMPONENT}
        Set Kernel$Messages LocalRes:Messages
        IfThere LocalRes:<UserIF>.Messages Then Set Kernel$Messages LocalRes:<UserIF>.Messages
        TokenCheck LocalRes:<UserIF>.Messages
        ${CP} <Kernel$Messages>  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
        UnSet Kernel$Messages

resources-None: resources_common
	@@

resources-: resources_common
        TokenCheck LocalRes:Messages
        print LocalRes:CmdHelp { >> ${RESDIR}.${COMPONENT}.Messages }
@


1.1
log
@file Makefile was initially added on branch HAL.
@
text
@d1 111
@


1.1.2.1
log
@More HAL work. IOMD HAL work in progress. Lots of my own little build
scripts. Don't touch this.

Version 5.35, 4.79.2.2. Tagged as 'Kernel-5_35-4_79_2_2'
@
text
@a0 111
# Copyright 2000 Pace Micro Technology plc
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for Kernel
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 25-May-94  AMcC         Created.
#

#
# Paths
#
EXP_HDR = <export$dir>
C_EXP_HDR = <cexport$dir>.Global.h

#
# Generic options:
#
MKDIR   = mkdir -p
AS      = aasm
ARMASM  = objasm
CP      = copy
RM      = remove
CCFLAGS = -c -depend !Depend -IC:
ASFLAGS = -depend !Depend ${THROWBACK} -Stamp -quit -To $@@ -From
ARMASMFLAGS = -depend !Depend -g -APCS 3/nofp/noswst ${THROWBACK}
CPFLAGS = ~cfr~v

TOKENISE = tokenise
TOKENS   = Hdr:Tokens

#
# Program specific options:
#
COMPONENT = IOMD
TARGET    = bin.IOMD
DBGTARGET = aif.IOMD
GPATARGET = gpa.IOMD
EXPORTS   = 

OBJECTS   = o.Boot o.IIC

.s.o:;	${ARMASM} ${ARMASMFLAGS} $< $@@

#
# Generic rules:
#
rom: ${TARGET}
        @@echo ${COMPONENT}: rom module built

debug: ${GPATARGET}
        @@echo ${COMPONENT}: debug module built

install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

clean:
        ${RM} ${TARGET}
	Wipe o.* ~C~V
        @@echo ${COMPONENT}: cleaned

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

resources: resources-${CMDHELP}
        @@echo ${COMPONENT}: resource files copied

resources_common:
        ${MKDIR} ${RESDIR}.${COMPONENT}
        Set Kernel$Messages LocalRes:Messages
        IfThere LocalRes:<UserIF>.Messages Then Set Kernel$Messages LocalRes:<UserIF>.Messages
        TokenCheck LocalRes:<UserIF>.Messages
        ${CP} <Kernel$Messages>  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
        UnSet Kernel$Messages

resources-None: resources_common
	@@

resources-: resources_common
        TokenCheck LocalRes:Messages
        print LocalRes:CmdHelp { >> ${RESDIR}.${COMPONENT}.Messages }

${TARGET}: ${OBJECTS}
	Link -bin -o $@@ ${OBJECTS}

${DBGTARGET}: ${OBJECTS}
        Link -bin -aif -d -o $@@ ${OBJECTS}

${GPATARGET}: ${DBGTARGET}
	ToGPA -s ${DBGTARGET} $@@

# Dynamic dependencies:
o.IOMD: s.IOMD Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:CPU.ARM600 Hdr:IO.IOMD Hdr:IO.IOMD Hdr:MEMM.ARM600 Hdr:VIDC.VIDC20 Hdr:Proc Hdr:OSEntries
o.IIC: s.IIC Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.Boot: s.Boot Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:CPU.ARM600 Hdr:IO.IOMD Hdr:IO.IOMD Hdr:MEMM.ARM600 Hdr:VIDC.VIDC20 Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.2
log
@More HAL work. IOMD HAL fleshed out somewhat - system gets most of the way
through initialisation.

Version 5.35, 4.79.2.5. Tagged as 'Kernel-5_35-4_79_2_5'
@
text
@d56 1
a56 1
OBJECTS   = o.Boot o.IIC o.Video o.Interrupts o.MachineID o.Timers
a110 3
o.Video: s.Video Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.MachineID: s.MachineID Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.Timers: s.Timers Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
a111 1
o.Interrupts: s.Interrupts Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:DevNos Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.3
log
@first attemp at mjs video code in real HAL
@
text
@d110 3
a114 2
o.IIC: s.IIC Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.Video: s.Video Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS hdr.Video
a115 1
o.MachineID: s.MachineID Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.4
log
@  Added HAL NVRAM support
Detail:
  Added the HAL NVRAM entries.
  Modified i2cutils to use the HAL entries for NVRAM and behave sensibly if the HAL reports that there is no NVRAM, in which case there must be a forced reset_cmos call so that the cache gets set up sensibly.
Admin:
  Tested under the RPC emulator and appears to be working correctly, although some calls to IIC are still being made in the no nvram case.

Version 5.35, 4.79.2.8. Tagged as 'Kernel-5_35-4_79_2_8'
@
text
@d56 1
a56 1
OBJECTS   = o.Boot o.IIC o.NVRAM o.Video o.Interrupts o.MachineID o.Timers
d109 7
@


1.1.2.5
log
@Wahey! This version gives you a display.

It says "Abort on data transfer".
@
text
@a73 1
	${RM} ROM
d75 1
a75 3
	-Wipe o.* ~C~V
	-Wipe aif.* ~C~V
	-Wipe gpa.* ~C~V
a108 4
o.IIC: s.IIC Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.NVRAM: s.NVRAM Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.Video: s.Video Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS hdr.Video
o.Boot: s.Boot Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:CPU.ARM600 Hdr:IO.IOMD Hdr:IO.IOMD Hdr:MEMM.ARM600 Hdr:VIDC.VIDC20 Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.6
log
@More L7200 HAL work
@
text
@a111 1
o.Boot: s.Boot Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:CPU.ARM600 Hdr:IO.IOMD Hdr:IO.IOMD Hdr:MEMM.ARM600 Hdr:VIDC.VIDC20 Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
d115 1
a115 3
o.Interrupts: s.Interrupts Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:DevNos Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.MachineID: s.MachineID Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
o.Timers: s.Timers Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:IO.IOMD Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.7
log
@add some HAL_Video calls, attempt to deal with lack of h/w scroll

Version 5.35, 4.79.2.9. Tagged as 'Kernel-5_35-4_79_2_9'
@
text
@d112 1
a118 1
o.Boot: s.Boot Hdr:ListOpts Hdr:Macros Hdr:System Hdr:SWIs Hdr:CPU.Generic26 Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:CPU.Generic32 Hdr:IO.GenericIO Hdr:RISCOS Hdr:Machine.<Machine> Hdr:Machine.Machine Hdr:ImageSize.<ImageSize> Hdr:CPU.ARM600 Hdr:IO.IOMD Hdr:IO.IOMD Hdr:MEMM.ARM600 Hdr:VIDC.VIDC20 Hdr:Proc Hdr:OSEntries Hdr:HALEntries hdr.StaticWS
@


1.1.2.8
log
@Lots of Tungsten work.

Version 5.35, 4.79.2.48. Tagged as 'Kernel-5_35-4_79_2_48'
@
text
@d112 7
a118 135
o.IIC: s.IIC
o.IIC: Hdr:ListOpts
o.IIC: Hdr:Macros
o.IIC: Hdr:System
o.IIC: Hdr:SWIs
o.IIC: Hdr:CPU.Generic26
o.IIC: Hdr:Machine.<Machine>
o.IIC: Hdr:Machine.Machine
o.IIC: Hdr:CPU.Generic32
o.IIC: Hdr:IO.GenericIO
o.IIC: Hdr:RISCOS
o.IIC: Hdr:Machine.<Machine>
o.IIC: Hdr:Machine.Machine
o.IIC: Hdr:ImageSize.<ImageSize>
o.IIC: Hdr:IO.IOMD
o.IIC: Hdr:OSEntries
o.IIC: Hdr:HALEntries
o.IIC: hdr.StaticWS
o.NVRAM: s.NVRAM
o.NVRAM: Hdr:ListOpts
o.NVRAM: Hdr:Macros
o.NVRAM: Hdr:System
o.NVRAM: Hdr:SWIs
o.NVRAM: Hdr:CPU.Generic26
o.NVRAM: Hdr:Machine.<Machine>
o.NVRAM: Hdr:Machine.Machine
o.NVRAM: Hdr:CPU.Generic32
o.NVRAM: Hdr:IO.GenericIO
o.NVRAM: Hdr:RISCOS
o.NVRAM: Hdr:Machine.<Machine>
o.NVRAM: Hdr:Machine.Machine
o.NVRAM: Hdr:ImageSize.<ImageSize>
o.NVRAM: Hdr:IO.IOMD
o.NVRAM: Hdr:OSEntries
o.NVRAM: Hdr:HALEntries
o.NVRAM: hdr.StaticWS
o.Video: s.Video
o.Video: Hdr:ListOpts
o.Video: Hdr:Macros
o.Video: Hdr:System
o.Video: Hdr:SWIs
o.Video: Hdr:CPU.Generic26
o.Video: Hdr:Machine.<Machine>
o.Video: Hdr:Machine.Machine
o.Video: Hdr:CPU.Generic32
o.Video: Hdr:IO.GenericIO
o.Video: Hdr:RISCOS
o.Video: Hdr:Machine.<Machine>
o.Video: Hdr:Machine.Machine
o.Video: Hdr:ImageSize.<ImageSize>
o.Video: Hdr:IO.IOMD
o.Video: Hdr:Proc
o.Video: Hdr:OSEntries
o.Video: Hdr:HALEntries
o.Video: hdr.StaticWS
o.Video: hdr.Video
o.Interrupts: s.Interrupts
o.Interrupts: Hdr:ListOpts
o.Interrupts: Hdr:Macros
o.Interrupts: Hdr:System
o.Interrupts: Hdr:SWIs
o.Interrupts: Hdr:CPU.Generic26
o.Interrupts: Hdr:Machine.<Machine>
o.Interrupts: Hdr:Machine.Machine
o.Interrupts: Hdr:CPU.Generic32
o.Interrupts: Hdr:IO.GenericIO
o.Interrupts: Hdr:RISCOS
o.Interrupts: Hdr:Machine.<Machine>
o.Interrupts: Hdr:Machine.Machine
o.Interrupts: Hdr:ImageSize.<ImageSize>
o.Interrupts: Hdr:IO.IOMD
o.Interrupts: Hdr:DevNos
o.Interrupts: Hdr:OSEntries
o.Interrupts: Hdr:HALEntries
o.Interrupts: hdr.StaticWS
o.MachineID: s.MachineID
o.MachineID: Hdr:ListOpts
o.MachineID: Hdr:Macros
o.MachineID: Hdr:System
o.MachineID: Hdr:SWIs
o.MachineID: Hdr:CPU.Generic26
o.MachineID: Hdr:Machine.<Machine>
o.MachineID: Hdr:Machine.Machine
o.MachineID: Hdr:CPU.Generic32
o.MachineID: Hdr:IO.GenericIO
o.MachineID: Hdr:RISCOS
o.MachineID: Hdr:Machine.<Machine>
o.MachineID: Hdr:Machine.Machine
o.MachineID: Hdr:ImageSize.<ImageSize>
o.MachineID: Hdr:IO.IOMD
o.MachineID: Hdr:Proc
o.MachineID: Hdr:OSEntries
o.MachineID: Hdr:HALEntries
o.MachineID: hdr.StaticWS
o.Timers: s.Timers
o.Timers: Hdr:ListOpts
o.Timers: Hdr:Macros
o.Timers: Hdr:System
o.Timers: Hdr:SWIs
o.Timers: Hdr:CPU.Generic26
o.Timers: Hdr:Machine.<Machine>
o.Timers: Hdr:Machine.Machine
o.Timers: Hdr:CPU.Generic32
o.Timers: Hdr:IO.GenericIO
o.Timers: Hdr:RISCOS
o.Timers: Hdr:Machine.<Machine>
o.Timers: Hdr:Machine.Machine
o.Timers: Hdr:ImageSize.<ImageSize>
o.Timers: Hdr:IO.IOMD
o.Timers: Hdr:OSEntries
o.Timers: Hdr:HALEntries
o.Timers: hdr.StaticWS
o.Boot: s.Boot
o.Boot: Hdr:ListOpts
o.Boot: Hdr:Macros
o.Boot: Hdr:System
o.Boot: Hdr:SWIs
o.Boot: Hdr:CPU.Generic26
o.Boot: Hdr:Machine.<Machine>
o.Boot: Hdr:Machine.Machine
o.Boot: Hdr:CPU.Generic32
o.Boot: Hdr:IO.GenericIO
o.Boot: Hdr:RISCOS
o.Boot: Hdr:Machine.<Machine>
o.Boot: Hdr:Machine.Machine
o.Boot: Hdr:ImageSize.<ImageSize>
o.Boot: Hdr:CPU.ARM600
o.Boot: Hdr:IO.IOMD
o.Boot: Hdr:IO.IOMD
o.Boot: Hdr:MEMM.ARM600
o.Boot: Hdr:VIDC.VIDC20
o.Boot: Hdr:Proc
o.Boot: Hdr:OSEntries
o.Boot: Hdr:HALEntries
o.Boot: hdr.StaticWS
@


