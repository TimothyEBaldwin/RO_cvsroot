head	1.26;
access;
symbols
	OMAP3-1_18:1.26
	OMAP3-1_17:1.26
	OMAP3-1_16:1.26
	OMAP3-1_15:1.26
	OMAP3-1_14:1.25
	SMP:1.24.0.2
	SMP_bp:1.24
	OMAP3-1_13:1.24
	OMAP3-1_12:1.24
	OMAP3-1_11:1.24
	OMAP3-1_10:1.24
	OMAP3-1_09:1.24
	OMAP3-1_08:1.24
	OMAP3-1_07:1.23
	OMAP3-1_06:1.23
	OMAP3-1_05:1.23
	OMAP3-1_04:1.23
	OMAP3-1_03:1.23
	OMAP3-1_02:1.23
	OMAP3-1_01:1.23
	OMAP3-1_00:1.23
	OMAP3-0_99:1.23
	OMAP3-0_98:1.23
	OMAP3-0_97:1.22
	OMAP3-0_96:1.22
	OMAP3-0_95:1.22
	OMAP3-0_94:1.22
	OMAP3-0_93:1.22
	OMAP3-0_92:1.22
	OMAP3-0_91:1.22
	OMAP3-0_90:1.22
	OMAP3-0_89:1.22
	OMAP3-0_88:1.22
	OMAP3-0_87:1.22
	OMAP3-0_86:1.22
	OMAP3-0_85:1.22
	OMAP3-0_84:1.22
	OMAP3-0_83:1.22
	OMAP3-0_82:1.21
	OMAP3-0_81:1.21
	OMAP3-0_80:1.20
	OMAP3-0_79:1.20
	OMAP3-0_78:1.19
	OMAP3-0_77:1.19
	OMAP3-0_76:1.19
	OMAP3-0_75:1.19
	OMAP3-0_74:1.19
	OMAP3-0_73:1.19
	OMAP3-0_72:1.19
	OMAP3-0_71:1.19
	OMAP3-0_70:1.19
	OMAP3-0_69:1.19
	OMAP3-0_68:1.19
	OMAP3-0_67:1.19
	OMAP3-0_66:1.19
	OMAP3-0_65:1.18
	OMAP3-0_64:1.18
	OMAP3-0_63:1.18
	OMAP3-0_62:1.18
	OMAP3-0_61:1.17
	OMAP3-0_60:1.17
	OMAP3-0_59:1.17
	OMAP3-0_58:1.17
	OMAP3-0_57:1.17
	OMAP3-0_56:1.17
	OMAP3-0_55:1.16
	OMAP3-0_54:1.16
	OMAP3-0_53:1.16
	OMAP3-0_52:1.16
	OMAP3-0_51:1.16
	OMAP3-0_50:1.16
	OMAP3-0_49:1.15
	OMAP3-0_48:1.15
	OMAP3-0_47:1.15
	OMAP3-0_46:1.15
	OMAP3-0_45:1.15
	OMAP3-0_44:1.15
	OMAP3-0_43:1.15
	OMAP3-0_42:1.14
	OMAP3-0_41:1.14
	OMAP3-0_40:1.13
	OMAP3-0_39:1.13
	OMAP3-0_38:1.13
	OMAP3-0_37:1.12
	OMAP3-0_36:1.12
	OMAP3-0_35:1.12
	OMAP3-0_34:1.12
	OMAP3-0_33:1.12
	OMAP3-0_32:1.12
	OMAP3-0_31:1.12
	OMAP3-0_30:1.12
	OMAP3-0_29:1.12
	OMAP3-0_28:1.12
	OMAP3-0_27:1.12
	OMAP3-0_26:1.12
	OMAP3-0_25:1.12
	OMAP3-0_24:1.12
	OMAP3-0_23:1.11
	OMAP3-0_22:1.11
	OMAP3-0_21:1.11
	OMAP3-0_20:1.11
	OMAP3-0_19:1.11
	OMAP3-0_18:1.10
	OMAP3-0_17:1.9
	OMAP3-0_16:1.9
	OMAP3-0_15:1.8
	OMAP3-0_14:1.8
	OMAP3-0_13:1.8
	OMAP3-0_12:1.7
	OMAP3-0_11:1.6
	OMAP3-0_10:1.5
	OMAP3-0_09:1.5
	OMAP3-0_08:1.5
	OMAP3-0_07:1.4
	OMAP3-0_06:1.4
	OMAP3-0_05:1.3
	OMAP3-0_04:1.3
	OMAP3-0_03:1.3
	OMAP3-0_02:1.3
	OMAP3-0_01:1.2
	OMAP3-0_00:1.1;
locks; strict;
comment	@# @;


1.26
date	2017.09.09.10.45.38;	author rool;	state Exp;
branches;
next	1.25;
commitid	7FzPWEY96oS9Hv6A;

1.25
date	2017.07.30.12.07.16;	author rool;	state Exp;
branches;
next	1.24;
commitid	G1766gzLo7SOsf1A;

1.24
date	2016.01.08.23.01.40;	author jlee;	state Exp;
branches;
next	1.23;
commitid	Infb2G92SOfknbQy;

1.23
date	2014.10.25.17.35.33;	author rsprowson;	state Exp;
branches;
next	1.22;
commitid	f6nsEIQ8JetkIBVx;

1.22
date	2012.11.21.23.36.53;	author jlee;	state Exp;
branches;
next	1.21;
commitid	FEuG5wzxvhvijitw;

1.21
date	2012.09.30.16.36.37;	author jlee;	state Exp;
branches;
next	1.20;
commitid	mVbXtrwyVtNKEzmw;

1.20
date	2012.09.21.15.17.00;	author jlee;	state Exp;
branches;
next	1.19;
commitid	x7ZCrdwZgdjnvplw;

1.19
date	2012.06.07.23.15.12;	author bavison;	state Exp;
branches;
next	1.18;
commitid	AkxjZwpvyQFFyP7w;

1.18
date	2012.04.08.22.37.44;	author jlee;	state Exp;
branches;
next	1.17;
commitid	3W6tvBOo1ezoh70w;

1.17
date	2012.01.07.21.22.11;	author rsprowson;	state Exp;
branches;
next	1.16;
commitid	ZJYg3muaiybPOhOv;

1.16
date	2011.11.06.13.51.15;	author jlee;	state Exp;
branches;
next	1.15;
commitid	xDHSfy5FwWIFjhGv;

1.15
date	2011.05.22.19.35.59;	author jlee;	state Exp;
branches;
next	1.14;
commitid	VEzaKWvEB8QKCIkv;

1.14
date	2011.03.19.18.43.32;	author jlee;	state Exp;
branches;
next	1.13;
commitid	luFqb0o1sKujoucv;

1.13
date	2011.01.23.22.48.06;	author jlee;	state Exp;
branches;
next	1.12;

1.12
date	2010.03.20.01.07.02;	author jlee;	state Exp;
branches;
next	1.11;

1.11
date	2010.01.24.02.49.24;	author jlee;	state Exp;
branches;
next	1.10;

1.10
date	2010.01.16.04.09.36;	author jlee;	state Exp;
branches;
next	1.9;

1.9
date	2009.11.28.22.30.54;	author jlee;	state Exp;
branches;
next	1.8;

1.8
date	2009.07.23.01.02.57;	author jlee;	state Exp;
branches;
next	1.7;

1.7
date	2009.07.17.00.16.21;	author jlee;	state Exp;
branches;
next	1.6;

1.6
date	2009.06.15.23.44.30;	author bavison;	state Exp;
branches;
next	1.5;

1.5
date	2009.05.09.19.04.56;	author jlee;	state Exp;
branches;
next	1.4;

1.4
date	2009.04.22.22.03.36;	author jlee;	state Exp;
branches;
next	1.3;

1.3
date	2009.02.21.18.51.42;	author jlee;	state Exp;
branches;
next	1.2;

1.2
date	2009.02.01.13.58.01;	author jlee;	state Exp;
branches;
next	1.1;

1.1
date	2009.01.27.21.28.47;	author bavison;	state Exp;
branches;
next	;


desc
@@


1.26
log
@Participate in keyboard scan dependencies
Detail:
  Replace keyboard scan code with list of modules that the kernel needs to do the same.
  Reorder the HALEntries to match Kernel-5_89.
  Delete unused workspace.
  Don't link against HAL USB library.
Admin:
  Submission for USB bounty.

Version 1.15. Tagged as 'OMAP3-1_15'
@
text
@# Copyright 2009 Castle Technology Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for OMAP-3 HAL
#

COMPONENT = OMAP-3 HAL
TARGET = OMAP3
OBJS = Top Boot Interrupts Timers CLib CLibAsm UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x SDIO KbdMatrix PAudio BMU

HDRS =
CMHGFILE =
CUSTOMRES = custom
CUSTOMROM = custom
ROM_TARGET = custom
LNK_TARGET = custom
AIFDBG    = aif._${TARGET}
GPADBG    = gpa.GPA

include CModule

CCFLAGS += -ff -APCS 3/32bit/nofp/noswst
ASFLAGS += -APCS 3/nofp/noswst

resources:
        @@${ECHO} ${COMPONENT}: no resources

rom: aof.${TARGET}
        @@${ECHO} ${COMPONENT}: rom module built

_debug: ${GPADBG}
        @@echo ${COMPONENT}: debug image built

install_rom: linked.${TARGET}
        ${CP} linked.${TARGET} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

aof.${TARGET}: ${ROM_OBJS_} ${ROM_LIBS} ${DIRS} ${ROM_DEPEND}
        ${LD} -o $@@ -aof ${ROM_OBJS_} ${ROM_LIBS}

linked.${TARGET}: aof.${TARGET}
        ${LD} ${LDFLAGS} ${LDLINKFLAGS} -o $@@ -bin -base 0xFC000000 aof.${TARGET}

${AIFDBG}: ${ROM_OBJS_} ${ROM_LIBS}
        ${MKDIR} aif
        ${LD} -aif -bin -d -o ${AIFDBG} ${ROM_OBJS_} ${ROM_LIBS}

${GPADBG}: ${AIFDBG}
        ToGPA -s ${AIFDBG} ${GPADBG}

# Dynamic dependencies:
@


1.25
log
@Build fix
Admin:
  As a side effect of changes in USBDriver-1_20, rename the library object.

Version 1.14. Tagged as 'OMAP3-1_14'
@
text
@a20 1
USBDIR = <Lib$Dir>.USB
a34 1
ROM_LIBS += ${USBDIR}.o.MUSBDriver ${USBDIR}.o.EHCIHALLib ${USBDIR}.o.USBDriver
@


1.24
log
@Fix build error. Add HAL_PlatformName implementation.
Detail:
  s/Boot, Makefile, s/Stubs - Remove references to deleted HAL ATA calls. Delete s/Subs it's now redundant.
  hdr/board, s/board, s/Top - Refactor how board names are stored so that we can differentiate between OMAP3 and DM37x versions of boards (at least the BeagleBoard and the Pandora come in OMAP3 and DM37x variants)
  s/Boot - Add HAL_PlatformName implementation, using the new board name system
Admin:
  Tested on BB-xM


Version 1.08. Tagged as 'OMAP3-1_08'
@
text
@d36 1
a36 1
ROM_LIBS += ${USBDIR}.o.MUSBDriver ${USBDIR}.o.EHCIDriver ${USBDIR}.o.USBDriver
@


1.23
log
@Don't bother providing even dummy implementations of USB port and overcurrent functions
As the flag bit in HAL_USBControllerInfo isn't set, no need to provide them.
Use symbols from Hdr:HALEntries when building the USB info.
No need for AASMFLAGS in the makefile.
Built, but not tested.

Version 0.98. Tagged as 'OMAP3-0_98'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x SDIO KbdMatrix PAudio BMU
@


1.22
log
@Add BMU support for Pandora & TouchBook
Detail:
  s/BMU, Makefile - BMU HAL device implementations for the Pandora & TouchBook
  hdr/StaticWS - Reserve workspace for the BMU devices
  s/Boot - Add the BMU devices to HAL device initialisation. Move Enable_main_battery_charging into s/BMU.
Admin:
  Tested in ROM on BB-xM, Pandora, TouchBook


Version 0.83. Tagged as 'OMAP3-0_83'
@
text
@d29 1
a29 1
AIFDBG    = aif._OMAP3
a31 1
include StdTools
a35 1
AASMFLAGS += -APCS 3/nofp/noswst
@


1.21
log
@Implement Pandora keyboard scan & audio support
Detail:
  s/PAudio, Makefile - Added Pandora audio driver. The Pandora uses a different audio setup to all the other OMAP boards, so to keep things simple the implementation is kept in its own file seperate from the main one.
  s/KbdMatrix, hdr/StaticWS - Implemented Pandora boot-time keyboard scan. This uses the keyboard matrix & GPIO keys instead of the USB libraries.
  s/Boot - Moved call to Audio_Init into the per-board HAL_InitDevices code so that Pandora can call PandoraAudio_Init instead.
  s/SDIO - For MMC1, avoid touching VSIM if the bus width is only 4 bits (i.e. on Pandora). On Pandora VSIM is used for the audio DAC instead.
Admin:
  Tested on Pandora


Version 0.81. Tagged as 'OMAP3-0_81'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x SDIO KbdMatrix PAudio
@


1.20
log
@Tidy up board-specific code. Improve Pandora support.
Detail:
  hdr/board, s/board, s/Boot - Tidied up board-specific code a bit by adding more board-specific function pointers to the BoardConfig struct instead of relying on manual board detection in code.
  s/board - Disable Pandora VideoGPIO as turning the LCD on & off seems to result in graphical corruption, most likely due to settings which were set by the SPI interface being lost.
  s/KbdMatrix, Makefile - New file for handling the Pandora's keyboard matrix (and anything else that may require keyboard matrix code in the HAL). Contains stub code for the boot-time keyboard scan, and code to register a keyboard HAL device for detection by the PandoraKey module.
  s/Boot - Add soft-off support for Pandora. Add Pandora-specific initialisation code to enable some extra power supplies (touchscreen, nubs, audio DAC, EHCI PHY)
  s/KbdScan - Use Pandora-specific keyboard scan code instead of USB code when running on Pandora
  s/SDIO - Correct sense of MMC activity LEDs on Pandora. Now only lit during periods of activity, to match behaviour of the Pandora Linux distro.
  s/Video - Add some switched out hack code to allow easier debugging of aborts that occur during ROM initialisation
Admin:
  Tested on Pandora, rev C2 BB, rev A2 BB-xM, rev C1 TouchBook


Version 0.79. Tagged as 'OMAP3-0_79'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x SDIO KbdMatrix
@


1.19
log
@  Added HAL devices for main board SDHCI controllers
Detail:
  * For Beagleboard and Beagleboard-xM, supports MMC1, and is tested
  * For DevKit8000, supports MMC1 (but untested)
  * For IGEPv2, supports MMC1 and MMC2 (but untested)
  * No support for controllers on other boards at the present time
Admin:
  Requires headers exported from SDIODriver

Version 0.66. Tagged as 'OMAP3-0_66'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x SDIO
@


1.18
log
@Add AM/DM37x SmartReflex driver
Detail:
  s/SR37x, hdr/SR37x - New files containing SmartReflex driver targeting AM/DM37x chips. Initialises SmartReflex for both VDD1 & VDD2, but currently only VDD1/DPLL1 settings can be adjusted at runtime (via CPUClk HAL device)
  Makefile - Add SR37x to object list
  hdr/CPUClk - Adjust OPPTbl_Max so CPUClk workspace size is >= SR37x workspace size (both drivers share their HAL workspace, since only one can be active at once)
  hdr/GPIO - Add TPS_GPPUPDCTR1 definition
  hdr/PRCM - Add SmartReflex related registers
  hdr/omap3530 - Add "control device status" register & extra AM/DM37x revision numbers
  s/CPUClk:
  - Modify CPUClk_PreInit to try initialising the SmartReflex driver.
  - Ensure SmartReflex is disabled in the TPS if using CPUClk driver.
  - Fix 'OPP60' typo in AMDM37x table.
  - Move DPLL adjustment code into its own function to allow it to be shared with SmartReflex driver.
  - Add a few ROUTs and ASSERTs for safety.
Admin:
  Both new & old CPUClk devices tested on BB-xM


Version 0.62. Tagged as 'OMAP3-0_62'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan SR37x
@


1.17
log
@Prep for SDFS and support for hardware CMOS adapter board.
To avoid conflicting use of the SDIO controller by higher level filing system (and the need for a HAL to somehow ask for a disc to be reinserted) this HAL onwards supports hardware CMOS attached via the JTAG connector.
On power up the presence and size of EEPROM is detected (sizes from 256 to 2048 bytes are understood corresponding to 24AA02 to 24AA16 family of parts).
If no EEPROM is found the HAL falls back to permitting a CMOS file to be loaded off the SD card, but crucially this is done by uboot before FileCore starts.
If no EEPROM is found, or the CMOS file looks suspicious, some fake CMOS is made and the kernel defaults used.
The "ProbeEESize" switch enables size probing, otherwise 256 bytes is assumed.
The "TryLoadedCMOS" switch enables use of a CMOS file from the SD card, if that's off and nothing is found the HAL declares that there is no CMOS at all!
The respective boot script needs the line
  fatload mmc 0:1 0x4020F000 cmos
adding to it, though the filename 'cmos' is arbitrary and only used as a suggestion.

Version 0.56. Tagged as 'OMAP3-0_56'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory CPUClk KbdScan
@


1.16
log
@Add Dave Higton's CMOS save code
Detail:
  Makefile - fixed warning about StdRules being included twice (via CModule)
  c/NVMem, c/fat, h/NVMem, h/common, h/fat, hdr/StaticWS, s/NVMemory, s/RTC - Added Dave Higton's code to create/update the 'CMOS' file on NVRAM writes
Admin:
  Tested on rev A2 BB-xM


Version 0.50. Tagged as 'OMAP3-0_50'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory NVMem fat CPUClk KbdScan
@


1.15
log
@Update OMAP3 HAL to support keyboard scan on boot, plus other changes
Detail:
  Makefile, s/KdbScan, hdr/StaticWS - Code to handle keyboard scanning, via the new HAL build of the USB drivers.
  s/Stubs - Removed old stub keyboard scan routines
  s/CPUClk - ADR -> ADRL to cope with new workspace layout
  s/Boot, s/Top, hdr/Post - Modified to use new HALSize variable for determining the HAL size. Trimmed dead code/definitions.
  s/Boot - FIQDebug code now copes with the different USER button GPIO used on the BB-xM
  s/board - Increased max pixel rate from 86.5MHz to 100MHz. This allows a wider range of screen modes to be used, although it is beyond the spec of the video controller, and not all boards will be able to reach 100MHz. This should match the value used in the initial ARMini units.
Admin:
  Tested on rev C2 BB, A2 BB-xM, C1 TouchBook
  Needs latest USB drivers, Kernel source, BuildSys & Env (not all of which have been checked in yet)


Version 0.43. Tagged as 'OMAP3-0_43'
@
text
@a31 1
include StdRules
@


1.14
log
@Add CPUClk HAL device implementation
Detail:
  Makefile, s/CPUClk, hdr/CPUClk, s/Boot, hdr/StaticWS - Provide an implementation of the new HALDevice_CPUClk HAL device. Allows OMAP35x and DM37x CPU's to be set to any of the standard OPPs as listed in the datasheets. Doesn't yet support 1GHz on DM37x.
  hdr/NIC, hdr/PRCM, hdr/omap3530, s/TPS - Misc additions/tweaks/fixes.
Admin:
  Tested on rev C2 BB, A2 BB-xM, C1 TouchBook
  Requires latest PortableHAL & Kernel


Version 0.41. Tagged as 'OMAP3-0_41'
@
text
@d20 2
a21 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory NVMem fat CPUClk
d39 1
d60 1
a60 1
${AIFDBG}: ${ROM_OBJS_}
d62 1
a62 1
        ${LD} -aif -bin -d -o ${AIFDBG} ${ROM_OBJS_}
@


1.13
log
@Add Dave Higton's SD/MMC & CMOS code
Detail:
  c/NVMem, c/fat, h/NVMem, h/common, h/fat - C code for reading a 'CMOS' file off the SD card on boot, for use as a CMOS RAM image
  c/CLib - Added extra functions needed by the SD/MMC driver
  s/NVMemory - Implementation of the HAL NVRAM API, for reading/writing the loaded CMOS file. The read/write functions handle RISC OS's CMOS address mangling, so that CMOS files saved by *SaveCMOS can be used as-is.
  hdr/StaticWS - Updated with workspace needed by the new code
  s/Boot - Initialise the CMOS cache on boot
  s/Stubs - Removed the stub NVRAM function
  Makefile - Added the new files
Admin:
  Tested on rev A2 BB-xM.


Version 0.38. Tagged as 'OMAP3-0_38'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC NVMemory NVMem fat
@


1.12
log
@Add basic GPMC setup code and NIC HAL devices to OMAP HAL
Detail:
  s/GPMC, hdr/GPMC, hdr/StaticWS - basic code to reset the GPMC and configure chip selects
  s/NIC, hdr/NIC, hdr/StaticWS - code to expose any onboard NICs (SMSC9221, DM9000) to RISC OS as simple HAL devices.
  Makefile - added GPMC & NIC source files
  s/board, hdr/board - Expanded board config struct to include a pointer to extra code to call at the end of HAL_InitDevices, to allow board-specific devices to be initialised
  s/boot - Extra HAL_InitDevices code to set up the NICs on the IGEP/DevKit
  s/GPIO, hdr/GPIO - Improved functionality to allow GPIO IRQs to be used
  s/SDMA, s/Video - Tweaked the HAL device descriptors to indicate that the devices are on the L3 interconnect
Admin:
  Tested on rev C2 beagleboard. IGEP/DevKit entry points booted OK, but no attempts were made to look for or interact with the new HAL devices!


Version 0.24. Tagged as 'OMAP3-0_24'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO GPMC NIC
@


1.11
log
@Update OMAP HAL to support different board configs, plus use new YearLOIsGood flag to ensure correct RTC handling, plus other misc tidying
Detail:
  The OMAP HAL now has multiple entry points, one per board config. See Top.s/board.s for more info.
  audio.s - Moved APLL_CTL value to board config
  board.s - New file to list all the settings for the different board configs
  boot.s - Change HAL_Init to deal with the new board config stuff
  debug.s - Debug UART now specified in board config
  GPIO.s - A few utility functions for handling OMAP/TPS GPIO pins
  I2C.s - Update to use new board config struct
  RAM.s - Disable the beagleboard-specific RAM init code. Instead we'll just rely on u-boot to initialise all our RAM for us.
  RTC.s - Get rid of the magic numbers, and use the YearLOIsGood flag to indicate to RISC OS that YearLO is 2-digit BCD
  Top.s - Got rid of old debug code and rewrote initial flow to handle detecting & storing the board config
  UART.s - Update to use board config struct, support multiple UARTs
  USB.s - Get EHCI PHY power GPIO from board config
  Video.s - Get DVI framer power GPIO and max pixel rate from board config. Add 'PassiveVideo' option, to build a driver that doesn't alter the video output settings - should hopefully result in a usable display on Touch Book, etc.
  board.hdr - Definition of board config table struct
  GPIO.hdr - Add lots of macros for handling OMAP GPIO pins, new constants for OMAP/TPS GPIO
  I2C.hdr - Added I2C transfer block struct, HAL I2C API transfer states (both moved here from other source files)
  omap3530.hdr - Move/remove some unwanted constants, disable DebugChar for now
  StaticWS.hdr - Move I2C transfer block struct to I2C.hdr, add board config struct to HAL workspace, get rid of unused 64K AllocArea
  Timers.hdr - Tidy up constants a bit
  UART.hdr - Add UARTCLK (moved from StaticWS.hdr), UART IRQ #'s
  Makefile - add GPIO.s
Admin:
  Tested on rev C2 beagleboard. Board configs for other board types may be inaccurate in a couple of places.


Version 0.19. Tagged as 'OMAP3-0_19'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio GPIO
@


1.10
log
@Add sound support to OMAP3 HAL, plus other changes
Detail:
  hdr/Audio, s/Audio, Makefile, hdr/StaticWS, s/Boot - Add sound support to OMAP3 HAL. Should work with a TPS65950 connected to I2C1/McBSP2, as per beagleboard.
  s/TPS, s/RTC - Moved TPSRead, TPSWrite functions out of s/RTC and into their own file
  hdr/SDMA, s/SDMA - Add support for packet-based transfer (for audio), improve debug code, remove TestRAMToRAM test code
  s/I2C - Update to handle spurious RDR interrupts as mentioned in OMAP3 errata
  s/Video - Enable support for the larger porch & sync timing registers found in OMAP3 ES3.1 and above
Admin:
  Tested on rev C2 beagleboard


Version 0.18. Tagged as 'OMAP3-0_18'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA TPS Audio
@


1.9
log
@OMAP3 DMA support, video device, debugging improvements
Detail:
  Boot.s - Make FIQDebug work again
  Boot.s - Add support for DMA & video devices
  Interrupts.s, hdr/omap3530 - Add 'ExtraDebugInterrupts' option
  hdr/SDMA, SDMA.s, Makefile - DMA code which presents itself to RISC OS as a set of single-buffered, interrupt-driven DMA channels.
  hdr/StaticWS - Add extra DMA, video & debug entries to workspace
  Interrupts.s - Add 'DebugDisablePrevious' debug option for more flexibility in tracking down noncleared IRQs with ExtraDebugInterrupts
  RAM.s - Use DMA to clear RAM on boot. RAM clear now takes less than 1 second on a rev C board, whereas before it used to take several.
  Video.s - Add simple HAL device to expose information needed by upcoming RISC OS module based video driver.
Admin:
  Tested on rev C2 beagleboard.


Version 0.16. Tagged as 'OMAP3-0_16'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC SDMA
@


1.8
log
@Add HAL RTC support to OMAP3 kernel, improve IIC code
Detail:
  s/RTC - Implementation of new HAL RTC API. Uses the RTC built into the TWL/TPS companion chip.
  s/Boot - Initialise RTC HALDevice
  s/I2C - Add workaround for apparent hardware limitation of the OMAP I2C controllers; where appropriate multiple iic_transfers will now be merged together into one transfer, to ensure that a start bit is always sent at the start of each transfer
  hdr/omap3530 - Tweak DebugReg and DebugRegByte to allow LR to be output
  Makefile - add s.RTC to list of files. Fix GPADBG definition to not conflict with the 'gpa' folder that one of the makefile fragments creates.
Admin:
  Tested on rev C2 beagleboard


Version 0.13. Tagged as 'OMAP3-0_13'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C RTC
@


1.7
log
@Add I2C support to OMAP3 HAL. Fix FIQ handling. Improve debugging code.
Detail:
  Makefile, s/Boot, s/I2C, hdr/I2C, hdr/StaticWS - Adds I2C support to the OMAP3 HAL, via both HAL_IIC* and HAL_Video_IICOp.
  s/Interrupts - Fix bug causing incorrect clearing of FIQs
  s/Debug, s/Boot, hdr/omap3530 - Improve debugging code, and add simple FIQ debugger that outputs the PC to the serial port when the beagleboard USER button is pressed
  s/Stubs - Remove old stub functions
Admin:
  Tested on rev C2 beagleboard


Version 0.12. Tagged as 'OMAP3-0_12'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB I2C
d29 1
a29 1
GPADBG    = GPA
@


1.6
log
@  Build change
Detail:
  CPU version is no longer specified in the makefile - it's better to inherit
  it from the build environment now that we actually set it appropriately.
Admin:
  Built and briefly tested.

Version 0.10. Not tagged
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video USB
@


1.5
log
@OMAP3 HAL USB (EHCI) support, interrupt handling fixes
Detail:
  Makefile - added USB to objects list
  s/Boot, s/USB, hdr/StaticWS, hdr/USB - USB EHCI code
  s/Debug, s/Stubs, s/Timers, s/Top, s/UART, s/Video - Debugging tweaks and header dependency fixes
  s/Interrupts, hdr/omap3530 - Interrupt fixes & debugging code
  hdr/PRCM - typo fix
Admin:
  Tested on rev C2 beagleboard


Version 0.08. Tagged as 'OMAP3-0_08'
@
text
@d35 3
a37 3
CCFLAGS += -ff -cpu 5TE -APCS 3/32bit/nofp/noswst
ASFLAGS += -APCS 3/nofp/noswst -cpu 5TE
AASMFLAGS += -APCS 3/nofp/noswst -cpu 5TE
@


1.4
log
@OMAP3 HAL video support, safer RAM initialisation
Detail:
  Makefile - Enable compilation of s.video
  hdr/StaticWS - New workspace entries for video support
  hdr/Video - Typo fix, VENC registers
  s/Boot - Change initialisation order for video support
  s/Debug - Added DebugMemDump routine
  s/RAM - Added code to verify RAM config, to avoid crash if a board looks like a revision C but doesn't have the extra RAM
  s/Stubs - Disable stub video functions
  s/Video - Working video code, beginnings of TV-out code
Admin:
  Tested on rev C2 beagleboard. Video code may only function correctly if kernel is loaded via u-boot.


Version 0.06. Tagged as 'OMAP3-0_06'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM Video
@


1.3
log
@  OMAP3 HAL fixes and updates to allow booting on real hardware.
Detail:
  Makefile - add s.PRCM to objects
  s/Boot - Call PRCM_SetClocks during HAL_Init. Added (disabled) debugging code.
  s/Interrupts - Updated HAL_IRQSource, HAL_FIQSource to query ARM interrupt state instead of relying on INTC alone to detect whether an interrupt is firing or not.
  s/PRCM - Code to measure system clock frequency, store it for HAL purposes, and notify the OMAP of the frequency in order to ensure correct operation.
  s/Timers - Use measured system clock frequency as the timer frequency instead of hard-coded value. Return correct values from HAL_TimerPeriod.
  s/Top - Added (disabled) debugging code. Updated ARM initialisation to use correct cache cleaning procedure.
  s/Video - Further minor work towards completing video driver.
  hdr/CoPro15ops - Deprecate ARM_flush_* macros
  hdr/PRCM - Add more register addresses
  hdr/StaticWS - Add entried for PowerMan & 32K timer logical addresses, system clock speed
  hdr/Timers - remove incorrect, hard-coded timer frequency
  hdr/omap3530 - remove unused FlashCheck global, add DebugChar macro
Admin:
  Tested with HALTester and the RISC OS kernel using qemu-omap3.
  Tested with HALTester on a rev. B6 beagleboard.


Version 0.02. Tagged as 'OMAP3-0_02'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug PRCM
@


1.2
log
@Basic OMAP3 HAL
Detail:
  Performs startup procedure suitable for any location in ROM or RAM. UART, timer, counter, interrupt & debug functionality implemented. Video support incomplete and nonfunctional.
Admin:
  Tested with HALTester & RISC OS kernel under qemu-omap3


Version 0.01. Tagged as 'OMAP3-0_01'
@
text
@d20 1
a20 1
OBJS = Top Boot Interrupts Timers CLib CLibAsm Stubs UART Debug
@


1.1
log
@  Initial commit of a bare bones component for the OMAP3 HAL.
Detail:
  The code does nothing (an infinite loop) but the Makefile implements all
  necessary phases of a ROM build.
Admin:
  Used in a test build.

Version 0.00. Not tagged
@
text
@d1 14
d20 1
a20 1
OBJS = Top
d28 2
d35 4
d45 3
d58 7
@

