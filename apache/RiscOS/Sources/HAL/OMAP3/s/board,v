head	1.20;
access;
symbols
	OMAP3-1_18:1.20
	OMAP3-1_17:1.20
	OMAP3-1_16:1.20
	OMAP3-1_15:1.20
	OMAP3-1_14:1.20
	SMP:1.20.0.2
	SMP_bp:1.20
	OMAP3-1_13:1.20
	OMAP3-1_12:1.20
	OMAP3-1_11:1.20
	OMAP3-1_10:1.20
	OMAP3-1_09:1.20
	OMAP3-1_08:1.20
	OMAP3-1_07:1.19
	OMAP3-1_06:1.19
	OMAP3-1_05:1.19
	OMAP3-1_04:1.19
	OMAP3-1_03:1.19
	OMAP3-1_02:1.19
	OMAP3-1_01:1.19
	OMAP3-1_00:1.19
	OMAP3-0_99:1.19
	OMAP3-0_98:1.19
	OMAP3-0_97:1.19
	OMAP3-0_96:1.19
	OMAP3-0_95:1.19
	OMAP3-0_94:1.19
	OMAP3-0_93:1.18
	OMAP3-0_92:1.18
	OMAP3-0_91:1.18
	OMAP3-0_90:1.18
	OMAP3-0_89:1.18
	OMAP3-0_88:1.18
	OMAP3-0_87:1.18
	OMAP3-0_86:1.18
	OMAP3-0_85:1.18
	OMAP3-0_84:1.18
	OMAP3-0_83:1.18
	OMAP3-0_82:1.18
	OMAP3-0_81:1.18
	OMAP3-0_80:1.18
	OMAP3-0_79:1.18
	OMAP3-0_78:1.17
	OMAP3-0_77:1.16
	OMAP3-0_76:1.16
	OMAP3-0_75:1.16
	OMAP3-0_74:1.16
	OMAP3-0_73:1.16
	OMAP3-0_72:1.16
	OMAP3-0_71:1.16
	OMAP3-0_70:1.16
	OMAP3-0_69:1.16
	OMAP3-0_68:1.16
	OMAP3-0_67:1.15
	OMAP3-0_66:1.15
	OMAP3-0_65:1.15
	OMAP3-0_64:1.15
	OMAP3-0_63:1.14
	OMAP3-0_62:1.14
	OMAP3-0_61:1.14
	OMAP3-0_60:1.14
	OMAP3-0_59:1.14
	OMAP3-0_58:1.14
	OMAP3-0_57:1.14
	OMAP3-0_56:1.14
	OMAP3-0_55:1.14
	OMAP3-0_54:1.14
	OMAP3-0_53:1.14
	OMAP3-0_52:1.14
	OMAP3-0_51:1.13
	OMAP3-0_50:1.12
	OMAP3-0_49:1.12
	OMAP3-0_48:1.12
	OMAP3-0_47:1.11
	OMAP3-0_46:1.11
	OMAP3-0_45:1.11
	OMAP3-0_44:1.11
	OMAP3-0_43:1.11
	OMAP3-0_42:1.10
	OMAP3-0_41:1.10
	OMAP3-0_40:1.10
	OMAP3-0_39:1.10
	OMAP3-0_38:1.9
	OMAP3-0_37:1.9
	OMAP3-0_36:1.9
	OMAP3-0_35:1.8
	OMAP3-0_34:1.8
	OMAP3-0_33:1.7
	OMAP3-0_32:1.6
	OMAP3-0_31:1.5
	OMAP3-0_30:1.5
	OMAP3-0_29:1.5
	OMAP3-0_28:1.5
	OMAP3-0_27:1.5
	OMAP3-0_26:1.5
	OMAP3-0_25:1.5
	OMAP3-0_24:1.5
	OMAP3-0_23:1.4
	OMAP3-0_22:1.3
	OMAP3-0_21:1.2
	OMAP3-0_20:1.1
	OMAP3-0_19:1.1;
locks; strict;
comment	@# @;


1.20
date	2016.01.08.23.01.48;	author jlee;	state Exp;
branches;
next	1.19;
commitid	Infb2G92SOfknbQy;

1.19
date	2013.12.17.23.49.47;	author jlee;	state Exp;
branches;
next	1.18;
commitid	xmZ8fZAPbpltOxhx;

1.18
date	2012.09.21.15.17.06;	author jlee;	state Exp;
branches;
next	1.17;
commitid	x7ZCrdwZgdjnvplw;

1.17
date	2012.08.07.22.16.32;	author jlee;	state Exp;
branches;
next	1.16;
commitid	1DvzzXQusUjYgFfw;

1.16
date	2012.07.02.17.50.24;	author bavison;	state Exp;
branches;
next	1.15;
commitid	Ukt7tNPf83vnX0bw;

1.15
date	2012.06.04.23.45.11;	author jlee;	state Exp;
branches;
next	1.14;
commitid	m70jrk0mZm9UOr7w;

1.14
date	2011.12.04.19.14.50;	author jlee;	state Exp;
branches;
next	1.13;
commitid	ITJDzEpHbl3ScUJv;

1.13
date	2011.11.29.22.46.15;	author jlee;	state Exp;
branches;
next	1.12;
commitid	bYJYUuZQ3ItlxhJv;

1.12
date	2011.07.31.18.56.21;	author jlee;	state Exp;
branches;
next	1.11;
commitid	trdyxuPEj4eC9Itv;

1.11
date	2011.05.22.19.36.06;	author jlee;	state Exp;
branches;
next	1.10;
commitid	VEzaKWvEB8QKCIkv;

1.10
date	2011.02.19.22.26.29;	author jlee;	state Exp;
branches;
next	1.9;

1.9
date	2010.11.08.22.56.26;	author jlee;	state Exp;
branches;
next	1.8;

1.8
date	2010.10.31.20.03.30;	author jlee;	state Exp;
branches;
next	1.7;

1.7
date	2010.10.26.23.27.14;	author jlee;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.14.20.58.50;	author jlee;	state Exp;
branches;
next	1.5;

1.5
date	2010.03.20.01.07.07;	author jlee;	state Exp;
branches;
next	1.4;

1.4
date	2010.02.28.19.47.14;	author jlee;	state Exp;
branches;
next	1.3;

1.3
date	2010.01.31.18.08.53;	author jlee;	state Exp;
branches;
next	1.2;

1.2
date	2010.01.30.00.23.21;	author jlee;	state Exp;
branches;
next	1.1;

1.1
date	2010.01.24.02.49.33;	author jlee;	state Exp;
branches;
next	;


desc
@@


1.20
log
@Fix build error. Add HAL_PlatformName implementation.
Detail:
  s/Boot, Makefile, s/Stubs - Remove references to deleted HAL ATA calls. Delete s/Subs it's now redundant.
  hdr/board, s/board, s/Top - Refactor how board names are stored so that we can differentiate between OMAP3 and DM37x versions of boards (at least the BeagleBoard and the Pandora come in OMAP3 and DM37x variants)
  s/Boot - Add HAL_PlatformName implementation, using the new board name system
Admin:
  Tested on BB-xM


Version 1.08. Tagged as 'OMAP3-1_08'
@
text
@; Copyright 2010 Castle Technology Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;

        ; Board names, OMAP3 + DM37x variants
        MACRO
        BOARDNAME $codename, $name
BoardConfigName_$codename._OMAP3 = "OMAP3 $name", 0
        ASSERT . - BoardConfigNames <= 255
BoardConfigName_$codename._DM37x = "DM37x $name", 0
        MEND
        MACRO
        BOARDNAME2 $codename, $name, $name2
BoardConfigName_$codename._OMAP3 = "$name", 0
        ASSERT . - BoardConfigNames <= 255
BoardConfigName_$codename._DM37x = "$name2", 0
        MEND

        EXPORT   BoardConfigNames
BoardConfigNames
        BOARDNAME2 BeagleBoard, "BeagleBoard", "BeagleBoard-xM"
        BOARDNAME DevKit8000, "DevKit8000"
        BOARDNAME IGEPv2, "IGEPv2" 
        BOARDNAME Pandora, "Pandora" 
        BOARDNAME TouchBook, "Touch Book" 
        BOARDNAME OMAP35xEVM, "EVM" ; (avoid "OMAP3 OMAP3 EVM") 
        ALIGN

        ; Array writer macros
        MACRO
        DCDArray $string, $len, $pre, $post
        LCLS     string2
 [ $len > 0
   [ "$string" = ""
        % $len*4
   |
string2 SETS " DCD      $pre" :CC: ("$string" :LEFT: 1) :CC: "$post"
        $string2
string2 SETS " DCDArray " :CC: ("$string" :RIGHT: ((:LEN: "$string")-1)) :CC: "," :CC: :STR: ($len-1) :CC: ",$pre,$post"
        $string2
   ]
 |
        ASSERT "$string" = ""
 ]
        MEND
        
        MACRO
        DCBArray $string, $len, $pre, $post
        LCLS     string2
 [ $len > 0
   [ "$string" = ""
        % $len
   |
string2 SETS " DCB      $pre" :CC: ("$string" :LEFT: 1) :CC: "$post"
        $string2
string2 SETS " DCBArray " :CC: ("$string" :RIGHT: ((:LEN: "$string")-1)) :CC: "," :CC: :STR: ($len-1) :CC: ",$pre,$post"
        $string2
   ]
 |
        ASSERT "$string" = ""
 ]
        MEND

        ; Big ugly macro for defining a board config
        ; Note - $mixers is the set of enabled mixers (not including the system)
        MACRO
        BOARDCFG $name, $codename, $debuguart, $haluarts, $defaultuart, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $mixers, $vbcflags, $vbclcdnum, $vbclcdptr
01
        DCD      $debuguart
        DCDArray "$haluarts", 4, L4_UART
        DCBArray "$haluarts", 4, UART, _IRQ
        DCB      $defaultuart-1
        DCB      BoardConfigName_$codename._OMAP3 - BoardConfigNames
        DCB      BoardConfigName_$codename._DM37x - BoardConfigNames
        %        1
        ASSERT   (:LEN: "$hali2cs") >= $numi2c
        ASSERT   ((:LEN: "$hali2cs") >= $videoi2c) :LOR: ($videoi2c = 255)
        DCDArray "$hali2cs", 3, L4_I2C
        DCBArray "$hali2cs", 3, I2C, _IRQ
        DCB      $numi2c
        DCB      $videoi2c
        DCB      $apll_ctl
        DCB      $videogpio
        DCB      $usbgpio
        ASSERT   MixerChannels = 8
        ASSERT   $mixers <= 255
        DCB      255-($mixers :OR: (1<<MixerChannel_System)) ; convert to mask of disabled channels
        DCB      $vbcflags
        DCB      $vbclcdnum
        DCB      :LEN: "$haluarts"
        DCD      $vbclcdptr
        IMPORT   Board_Init_$codename
        DCD      Board_Init_$codename
        IMPORT   Board_InitDevices_$codename
        DCD      Board_InitDevices_$codename
        IMPORT   Board_PowerOff_$codename
        DCD      Board_PowerOff_$codename
        DCD      MachID_$codename
        ASSERT (. - %BT01) = BoardConfig_Size
        MEND

        ; Macro for defining LCDConfig structs
        MACRO
$label  LCDCONFIG $dsi_bpp, $dsi_lanes, $acbias_freq, $lcdtype, $flags, $timings, $maxpixrate
$label  DCB       $dsi_bpp
        DCB       $dsi_lanes
        DCB       $acbias_freq
        DCB       LCDConfig_LCDType_$lcdtype
        DCD       $flags
        IMPORT    Video_Power_$label
        DCD       Video_Power_$label
        DCD       $timings
        DCD       $maxpixrate
        ASSERT (. - $label) = LCDConfig_Size
        MEND

        ; Macro for defining LCDTimings structs
        MACRO
$label  LCDTIMING $pixelrate, $hsw, $hfp, $hbp, $width, $vsw, $vfp, $vbp, $height, $syncpol
$label  DCD       $pixelrate*1000
        DCW       $hsw
        DCW       $hfp
        DCW       $hbp
        DCW       $width
        DCW       $vsw
        DCW       $vfp
        DCW       $vbp
        DCW       $height
        DCD       $syncpol
        ASSERT (. - $label) = LCDTimings_Size
        MEND

        ; Make the mixer constants a bit nicer
M_HSO   *   1<<MixerChannel_HeadsetOut
M_AI    *   1<<MixerChannel_AuxInput
M_PD    *   1<<MixerChannel_Predriver
M_HF    *   1<<MixerChannel_HandsFree

        ; And VBC flags
VBC_SV   *  VideoBoardConfig_Flags_SVideo
VBC_C    *  VideoBoardConfig_Flags_Composite
VBC_Both *  VideoBoardConfig_Flags_SVideo+VideoBoardConfig_Flags_Composite

        ; And now the table of board configs

BoardConfigTable
        ;        Name           CodeName     DebugUART UARTs  DefaultUART I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MixerChans       VBC_Flags VBC_LCDNum VBC_LCDPtr     
        BOARDCFG "BeagleBoard", BeagleBoard, L4_UART3, "123", 3,          "123", 3,     2,       &16,     170,            147,    M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI
        BOARDCFG "DevKit8000",  DevKit8000,  L4_UART3, "123", 3,          "132", 3,     2,       &16,     GPIO_PIN_MAX+7, 147,    M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI       ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      IGEPv2,      L4_UART3, "123", 3,          "123", 3,     2,       &16,     170,            24,     M_HSO+M_AI,      0,        1,         VBC_DVI
        BOARDCFG "Pandora",     Pandora,     L4_UART3, "123", 3,          "123", 3,     255,     &16,     255,            16,     M_HSO+M_AI+M_PD, VBC_Both, 1,         VBC_Pandora
        BOARDCFG "Touch Book",  TouchBook,   L4_UART3, "123", 3,          "123", 3,     255,     &16,     176,            147,    M_HSO+M_AI+M_HF, 0,        1,         VBC_TouchBook
        BOARDCFG "OMAP3 EVM",   OMAP35xEVM,  L4_UART1, "123", 1,          "123", 3,     255,     &16,     GPIO_PIN_MAX+7, 21,     M_HSO+M_AI,      VBC_Both, 1,         VBC_DVI       
BoardConfigTable_End

              ;         DSI_BPP DSI_LANES ACBias_freq LCDType     Flags                       LCDTimings     Max_PixelRate
VBC_DVI       LCDCONFIG 24,     3,        &28,        TFT,        0,                          0,             100000
VBC_Pandora   LCDCONFIG 24,     3,        0,          TFT,        LCDConfig_Flags_IPC,        LCD_Pandora,   0
VBC_TouchBook LCDCONFIG 24,     3,        0,          TFT,        LCDConfig_Flags_Brightness, LCD_TouchBook, 0

              ;         PixelRate HSW HFP HBP Width VSW VFP VBP Height SyncPol
LCD_Pandora   LCDTIMING 36000,    1,  68, 214,800,  1,  39, 34, 480,   SyncPol_InvertHSync+SyncPol_InvertVSync ; http://www.mail-archive.com/linux-omap@@vger.kernel.org/msg22228.html
LCD_TouchBook LCDTIMING 64000,    3,  3,  39, 1024, 1,  2,  7,  600,   0 ; http://www.mail-archive.com/linux-omap@@vger.kernel.org/msg19279.html - Looks like panel is only 16bpp?? and almost 100Hz! 

        END
@


1.19
log
@Re-enable Pandora TV-out support
Detail:
  s/board - Re-enable Pandora TV-out support now that we have the ability to turn TV-out power on/off
  hdr/board, s/Video - Add the new TV-out power control function to the video board config struct. All OMAP boards should be able to use the same implementation, which enables/disables the VDAC power supply in the TPS
Admin:
  Tested on BB-xM and Pandora
  TV detection (and TV-out in general) now works properly on the Pandora


Version 0.94. Tagged as 'OMAP3-0_94'
@
text
@d16 24
d84 3
a86 1
        %        3
a108 3
        ASSERT   (:LEN: "$name") < ?BoardConfig_Name
        DCB      "$name"
        %        ?BoardConfig_Name-(:LEN: "$name")
@


1.18
log
@Tidy up board-specific code. Improve Pandora support.
Detail:
  hdr/board, s/board, s/Boot - Tidied up board-specific code a bit by adding more board-specific function pointers to the BoardConfig struct instead of relying on manual board detection in code.
  s/board - Disable Pandora VideoGPIO as turning the LCD on & off seems to result in graphical corruption, most likely due to settings which were set by the SPI interface being lost.
  s/KbdMatrix, Makefile - New file for handling the Pandora's keyboard matrix (and anything else that may require keyboard matrix code in the HAL). Contains stub code for the boot-time keyboard scan, and code to register a keyboard HAL device for detection by the PandoraKey module.
  s/Boot - Add soft-off support for Pandora. Add Pandora-specific initialisation code to enable some extra power supplies (touchscreen, nubs, audio DAC, EHCI PHY)
  s/KbdScan - Use Pandora-specific keyboard scan code instead of USB code when running on Pandora
  s/SDIO - Correct sense of MMC activity LEDs on Pandora. Now only lit during periods of activity, to match behaviour of the Pandora Linux distro.
  s/Video - Add some switched out hack code to allow easier debugging of aborts that occur during ROM initialisation
Admin:
  Tested on Pandora, rev C2 BB, rev A2 BB-xM, rev C1 TouchBook


Version 0.79. Tagged as 'OMAP3-0_79'
@
text
@d139 1
a139 1
        BOARDCFG "Pandora",     Pandora,     L4_UART3, "123", 3,          "123", 3,     255,     &16,     255,            16,     M_HSO+M_AI+M_PD, 0,        1,         VBC_Pandora
@


1.17
log
@Temporarily disable TV-out on Pandora
Detail:
  s/board - Temporarily disable TV-out on Pandora, as the current TV detection code in OMAPVideo is believed to be causing false-positives with new some of the newer units.
Admin:
  Builds, but untested


Version 0.78. Tagged as 'OMAP3-0_78'
@
text
@d54 1
a54 1
        BOARDCFG $name, $debuguart, $haluarts, $defaultuart, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $machid, $mixers, $vbcflags, $vbclcdnum, $vbclcdptr, $haldevices
d77 7
a83 3
        IMPORT   Board_InitDevices_$haldevices
        DCD      Board_InitDevices_$haldevices
        ASSERT   (:LEN: "$name") < 20
d85 2
a86 2
        %        20-(:LEN: "$name")
        DCD      $machid
d135 7
a141 7
        ;        Name           DebugUART UARTs  DefaultUART I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MachID              MixerChans       VBC_Flags VBC_LCDNum VBC_LCDPtr     InitDevices
        BOARDCFG "BeagleBoard", L4_UART3, "123", 3,          "123", 3,     2,       &16,     170,            147,    MachID_BeagleBoard, M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       BeagleBoard
        BOARDCFG "DevKit8000",  L4_UART3, "123", 3,          "132", 3,     2,       &16,     GPIO_PIN_MAX+7, 147,    MachID_DevKit8000,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       DevKit      ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "123", 3,          "123", 3,     2,       &16,     170,            24,     MachID_IGEPv2,      M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP
        BOARDCFG "Pandora",     L4_UART3, "123", 3,          "123", 3,     255,     &16,     157,            16,     MachID_Pandora,     M_HSO+M_AI+M_PD, 0,        1,         VBC_Pandora,   Pandora
        BOARDCFG "Touch Book",  L4_UART3, "123", 3,          "123", 3,     255,     &16,     176,            147,    MachID_TouchBook,   M_HSO+M_AI+M_HF, 0,        1,         VBC_TouchBook, None
        BOARDCFG "OMAP3 EVM",   L4_UART1, "123", 1,          "123", 3,     255,     &16,     GPIO_PIN_MAX+7, 21,     MachID_OMAP35xEVM,  M_HSO+M_AI,      VBC_Both, 1,         VBC_DVI,       None
d146 1
a146 1
VBC_Pandora   LCDCONFIG 24,     3,        0,          TFT,        LCDConfig_Flags_IPC,        LCD_Pandora,   0 ; TODO - Verify DSI_BPP, DSI_LANES, ACBias_freq
@


1.16
log
@  Added support for the SD slots and WiFi SDIO chip on the Pandora console
Detail:
  Information gathered from the "Pandora Hacker Guide" is a little sketchy
  so try with caution. Uniquely, the Pandora uses all 3 SD controllers on the
  OMAP3.
Admin:
  Checked that still functions on a beagleboard, but untested on Pandora!

Version 0.68. Tagged as 'OMAP3-0_68'
@
text
@d135 1
a135 1
        BOARDCFG "Pandora",     L4_UART3, "123", 3,          "123", 3,     255,     &16,     157,            16,     MachID_Pandora,     M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora,   Pandora
@


1.15
log
@Add HAL_UARTDefault implementation. Delete old HAL video code. Add some SmartReflex tweaks.
Detail:
  hdr/board, s/board, s/Boot, s/UART - Added HAL_UARTDefault implementation, to allow OS_SerialOp to be used
  hdr/StaticWS, hdr/omap3530, s/Boot, s/Interrupts, s/Video - Removed old HAL video code. The OMAPVideo module is a much better video driver.
  s/SR37x - Add some SmartReflex tweaks which we can try if we run into any stability issues with the current code.
Admin:
  Tested on rev A2 BB-xM


Version 0.64. Tagged as 'OMAP3-0_64'
@
text
@d135 1
a135 1
        BOARDCFG "Pandora",     L4_UART3, "123", 3,          "123", 3,     255,     &16,     157,            16,     MachID_Pandora,     M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora,   None
@


1.14
log
@Add preliminary OMAP3 EVM support. Fix HAL_UARTModemControl
Detail:
  hdr/board, s/Boot, s/Top, s/board - Added preliminary support for OMAP3 EVM boards. Only generation 2 boards are supported at the moment.
  s/UART - Fixed HAL_UARTModemControl to pay attention to the 'mask' parameter
Admin:
  Tested on rev A2 BB-xM. EVM support might not be fully working.


Version 0.52. Tagged as 'OMAP3-0_52'
@
text
@d54 1
a54 1
        BOARDCFG $name, $debuguart, $haluarts, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $machid, $mixers, $vbcflags, $vbclcdnum, $vbclcdptr, $haldevices
d59 2
d131 7
a137 7
        ;        Name           DebugUART UARTs  I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MachID              MixerChans       VBC_Flags VBC_LCDNum VBC_LCDPtr     InitDevices
        BOARDCFG "BeagleBoard", L4_UART3, "123", "123", 3,     2,       &16,     170,            147,    MachID_BeagleBoard, M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       BeagleBoard
        BOARDCFG "DevKit8000",  L4_UART3, "123", "132", 3,     2,       &16,     GPIO_PIN_MAX+7, 147,    MachID_DevKit8000,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       DevKit      ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "123", "123", 3,     2,       &16,     170,            24,     MachID_IGEPv2,      M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP
        BOARDCFG "Pandora",     L4_UART3, "123", "123", 3,     255,     &16,     157,            16,     MachID_Pandora,     M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora,   None
        BOARDCFG "Touch Book",  L4_UART3, "123", "123", 3,     255,     &16,     176,            147,    MachID_TouchBook,   M_HSO+M_AI+M_HF, 0,        1,         VBC_TouchBook, None
        BOARDCFG "OMAP3 EVM",   L4_UART1, "123", "123", 3,     255,     &16,     GPIO_PIN_MAX+7, 21,     MachID_OMAP35xEVM,  M_HSO+M_AI,      VBC_Both, 1,         VBC_DVI,       None
@


1.13
log
@Fix OMAP3 HAL UART code
Detail:
  hdr/UART - Added a couple more register addresses, removed incorrect FIFO64 flag
  hdr/omap3530 - Corrected UART 2 address
  s/Boot - Ensure we perform phys2log address conversion for all UART addresses, not just the first 3. Also avoid resetting the debug UART.
  s/UART - Fix HAL UART calls to obey the programming rules laid out in the TRM
  s/board - Change the order in which the UARTs are exposed to RISC OS so that they match the hardware order. HAL UART 0 is now OMAP UART1, etc.
Admin:
  Tested on rev A2 BB-xM


Version 0.51. Tagged as 'OMAP3-0_51'
@
text
@d122 3
a124 2
VBC_SV  *   VideoBoardConfig_Flags_SVideo
VBC_C   *   VideoBoardConfig_Flags_Composite
d135 1
@


1.12
log
@Add new support for the new GPIO HAL device
Detail:
  hdr/board - Add information about determining the IGEP board revision
  hdr/StaticWS - Add workspace for storing the GPIO HAL device
  s/board - Update BeagleBoard entry to have a custom HAL device init func
  s/Boot - Fix HAL_Init to not configure GPIOs 171-173 if not running on a beagleboard. Update HAL_InitDevices to preserve the right registers and initialise the GPIO devices where appropriate.
  s/GPIO - Added GPIO_InitDevice function to do the actual initialisation
Admin:
  Tested on rev A2 BB-xM


Version 0.48. Tagged as 'OMAP3-0_48'
@
text
@d129 5
a133 5
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 3,     2,       &16,     170,            147,    MachID_BeagleBoard, M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       BeagleBoard
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 3,     2,       &16,     GPIO_PIN_MAX+7, 147,    MachID_DevKit8000,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       DevKit      ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 3,     2,       &16,     170,            24,     MachID_IGEPv2,      M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP
        BOARDCFG "Pandora",     L4_UART3, "312", "123", 3,     255,     &16,     157,            16,     MachID_Pandora,     M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora,   None
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     176,            147,    MachID_TouchBook,   M_HSO+M_AI+M_HF, 0,        1,         VBC_TouchBook, None
@


1.11
log
@Update OMAP3 HAL to support keyboard scan on boot, plus other changes
Detail:
  Makefile, s/KdbScan, hdr/StaticWS - Code to handle keyboard scanning, via the new HAL build of the USB drivers.
  s/Stubs - Removed old stub keyboard scan routines
  s/CPUClk - ADR -> ADRL to cope with new workspace layout
  s/Boot, s/Top, hdr/Post - Modified to use new HALSize variable for determining the HAL size. Trimmed dead code/definitions.
  s/Boot - FIQDebug code now copes with the different USER button GPIO used on the BB-xM
  s/board - Increased max pixel rate from 86.5MHz to 100MHz. This allows a wider range of screen modes to be used, although it is beyond the spec of the video controller, and not all boards will be able to reach 100MHz. This should match the value used in the initial ARMini units.
Admin:
  Tested on rev C2 BB, A2 BB-xM, C1 TouchBook
  Needs latest USB drivers, Kernel source, BuildSys & Env (not all of which have been checked in yet)


Version 0.43. Tagged as 'OMAP3-0_43'
@
text
@d129 1
a129 1
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 3,     2,       &16,     170,            147,    MachID_BeagleBoard, M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       None
@


1.10
log
@Update OMAP3 HAL to cope with kernel support for multiple IIC buses
Detail:
  s/I2C - Changed HAL_Video_IICOp to call RISCOS_IICOpV instead of using its own polling based transfer loop. Updated IIC_DoOp_Poll to work with multiple buses.
  s/board - Allow the OS to see the video IIC buses now that any transfers on them will be using OS_IICOp's queueing/re-entrancy code
Admin:
  Tested on rev A2 BB-xM


Version 0.39. Tagged as 'OMAP3-0_39'
@
text
@d137 1
a137 1
VBC_DVI       LCDCONFIG 24,     3,        &28,        TFT,        0,                          0,             86500
@


1.9
log
@Probable fix for IGEP video issues
Detail:
  s/board - filled in the VideoGPIO entry for the IGEP. From looking at recent linux sources it's quite clear that GPIO 170 is used for enabling the DVI framer, and 24 is used for resetting the EHCI controller.
Admin:
  Tested-ish on rev C2 beagleboard by setting GPIO 170 (pre-xM video GPIO) to an input shortly after boot (i.e. to the default setting, as it would be on an IGEP).
  IGEP-like display failures then followed, but everything went back to normal when the GPIO was set back to being an output.


Version 0.36. Tagged as 'OMAP3-0_36'
@
text
@d129 3
a131 3
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 2,     2,       &16,     170,            147,    MachID_BeagleBoard, M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       None
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 147,    MachID_DevKit8000,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       DevKit      ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     170,            24,     MachID_IGEPv2,      M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP
@


1.8
log
@Miscellaneous OMAP3 HAL updates
Detail:
  s/Boot - HAL_Reset now sets the PRM_RSTCTRL.RST_DPLL3 bit instead of the PRM_RSTCTRL_GS bit. This matches what Linux does, and seems to fix resets on the TouchBook.
  s/board - Changed TouchBook audio to use the hands-free output instead of the predriver. This fixes speaker output (although it's currently listed as "line out" by the sound setup configure plugin)
  hdr/board, s/board, s/Video - Update the LCDConfig struct to contain an entry for controlling LCD power/brightness. Hook up basic power controls for current machine types.
Admin:
  Tested on rev C2 beagleboard & C1 touchbook.
  Video changes mean that OMAPVideo 0.08 or newer is required.


Version 0.34. Tagged as 'OMAP3-0_34'
@
text
@d131 1
a131 1
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     255,            24,     MachID_IGEPv2,      M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP        ; TODO - Verify lack of video GPIO, and use of GPIO24
@


1.7
log
@Miscellaneous OMAP3 HAL improvements
Detail:
  hdr/board, s/board, s/Boot - Linux machine IDs are now defined via constants in hdr/board instead of magic numbers on a per-use basis
  s/Boot - Added video fix for BB-xM rev A3.
  s/Boot - Added code to enable tablet battery charging on TouchBook.
  s/Boot - Added support for power-off on TouchBook
  s/GPIO - Fixed bug in GPIOx_SetAsOutput that would prevent LEDs from being disabled properly
  s/I2C - Updated code to ignore BF interrupts. Added debugging code to help track down unexpected errors, and to check that IIC_DoOp_Poll is being called with interrupts disabled.
  s/SDMA - Call HAL_IRQClear when resetting the DMA controller device. This fixes the "previous IRQ not cleared" loop that would occur during RISC OS's pre-reset sequence
Admin:
  Tested on rev C2 beagleboard, C1 touchbook, A3 BBxM.
  Resets should now work reliably on all machines, except TouchBook, which still seems to hang. But on the bright side, the TouchBook is currently the only machine to support soft-off.


Version 0.33. Tagged as 'OMAP3-0_33'
@
text
@d92 2
d119 1
d133 1
a133 1
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     176,            147,    MachID_TouchBook,   M_HSO+M_AI+M_PD, 0,        1,         VBC_TouchBook, None
d136 4
a139 4
              ;         DSI_BPP DSI_LANES ACBias_freq LCDType     Flags                LCDTimings     Max_PixelRate
VBC_DVI       LCDCONFIG 24,     3,        &28,        TFT,        0,                   0,             86500
VBC_Pandora   LCDCONFIG 24,     3,        0,          TFT,        LCDConfig_Flags_IPC, LCD_Pandora,   0 ; TODO - Verify DSI_BPP, DSI_LANES, ACBias_freq
VBC_TouchBook LCDCONFIG 24,     3,        0,          TFT,        0,                   LCD_TouchBook, 0
@


1.6
log
@BeagleBoard-xM, TouchBook fixes
Detail:
  s/board, hdr/board, hdr/omap3530, hdr/UART - Add support for 4th UART available on AM/DM37x (i.e. BeagleBoard-xM)
  hdr/omap3530 - Add details of CONTROL_IDCODE register & known hawkeye/revision numbers for OMAP type/revision detection
  s/Boot, s/GPIO, hdr/GPIO, s/I2C, hdr/StaticWS - Allow TPS LED drivers to be used as (output-only) GPIOs. Add new polled I/O I2C function, and appropriate logic to make GPIO code use it instead of RISCOS_IICOpV if RISC OS hasn't finished initialising yet. Add code to initialise some extra BB/TB GPIOs on boot.
  s/Timers, hdr/Timers - Stop RISC OS from using GPTIMER9, because it's used to drive the screen backlight on the TouchBook
  s/Video - Use appropriate porch/sync limits on non-OMAP35x
  s/PRCM - Don't mess with the system clock divider when calculating system clock speed (AM/DM37x fix)
Admin:
  Tested on rev C2 beagleboard, rev A2 BB-xM (indirectly), rev C1 TouchBook


Version 0.32. Tagged as 'OMAP3-0_32'
@
text
@d125 6
a130 6
        ;        Name           DebugUART UARTs  I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MachID MixerChans       VBC_Flags VBC_LCDNum VBC_LCDPtr     InitDevices
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 2,     2,       &16,     170,            147,    1546,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       None
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 147,    2330,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI,       DevKit      ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     255,            24,     2344,  M_HSO+M_AI,      0,        1,         VBC_DVI,       IGEP        ; TODO - Verify lack of video GPIO, and use of GPIO24
        BOARDCFG "Pandora",     L4_UART3, "312", "123", 3,     255,     &16,     157,            16,     1761,  M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora,   None
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     176,            147,    2393,  M_HSO+M_AI+M_PD, 0,        1,         VBC_TouchBook, None
@


1.5
log
@Add basic GPMC setup code and NIC HAL devices to OMAP HAL
Detail:
  s/GPMC, hdr/GPMC, hdr/StaticWS - basic code to reset the GPMC and configure chip selects
  s/NIC, hdr/NIC, hdr/StaticWS - code to expose any onboard NICs (SMSC9221, DM9000) to RISC OS as simple HAL devices.
  Makefile - added GPMC & NIC source files
  s/board, hdr/board - Expanded board config struct to include a pointer to extra code to call at the end of HAL_InitDevices, to allow board-specific devices to be initialised
  s/boot - Extra HAL_InitDevices code to set up the NICs on the IGEP/DevKit
  s/GPIO, hdr/GPIO - Improved functionality to allow GPIO IRQs to be used
  s/SDMA, s/Video - Tweaked the HAL device descriptors to indicate that the devices are on the L3 interconnect
Admin:
  Tested on rev C2 beagleboard. IGEP/DevKit entry points booted OK, but no attempts were made to look for or interact with the new HAL devices!


Version 0.24. Tagged as 'OMAP3-0_24'
@
text
@d57 2
a58 3
        DCDArray "$haluarts", 3, L4_UART
        DCBArray "$haluarts", 3, UART, _IRQ
        DCB      :LEN: "$haluarts"
d73 1
a73 1
        %        1
@


1.4
log
@Update OMAP3 HAL to support new OMAPVideo module, plus other minor changes
Detail:
  hdr/StaticWS, hdr/Video, hdr/board, hdr/omap3530, s/Boot, s/Video, s/board - Add new HALDoesVideo switch to control whether the HAL provides the video driver or whether a HAL device is used to expose the video hardware to the OMAPVideo module. Switch defaults to the 'off' state, i.e. OMAPVideo provides the video driver. Also updated the board config struct to contain more detailed information about the video capabilities of each board.
  s/Audio - fix the FIFO underflow/overflow IRQ handler to disable the IRQ after the underflow/overflow has been detection. This prevents the OS from (potentially) getting stuck in a loop servicing the interrupt and never reaching the state where it can shut down & re-initialise the audio to fix the error properly.
  s/Debug - add DebugCallstack function that disables IRQs/FIQs and dumps the stack contents over the serial port
Admin:
  Tested on rev C2 beagleboard.


Version 0.23. Tagged as 'OMAP3-0_23'
@
text
@d54 1
a54 1
        BOARDCFG $name, $debuguart, $haluarts, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $machid, $mixers, $vbcflags, $vbclcdnum, $vbclcdptr
d76 2
d126 6
a131 6
        ;        Name           DebugUART UARTs  I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MachID MixerChans       VBC_Flags VBC_LCDNum VBC_LCDPtr
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 2,     2,       &16,     170,            147,    1546,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 147,    2330,  M_HSO+M_AI,      VBC_SV,   1,         VBC_DVI       ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     255,            24,     2344,  M_HSO+M_AI,      0,        1,         VBC_DVI       ; TODO - Verify lack of video GPIO, and use of GPIO24
        BOARDCFG "Pandora",     L4_UART3, "312", "123", 3,     255,     &16,     157,            16,     1761,  M_HSO+M_AI+M_PD, VBC_SV,   1,         VBC_Pandora
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     176,            147,    2393,  M_HSO+M_AI+M_PD, 0,        1,         VBC_TouchBook
@


1.3
log
@Change DevKit8000 USBGPIO setting
Detail:
  s/board - DevKit8000 USBGPIO setting has been changed from 255 (none) to GPIO 147.
  I'm still not convinced that GPIO147 is connected to anything, but if it works with that setting then we might as well use it.
Admin:
  Untested; but according to Tank it makes USB work.


Version 0.22. Tagged as 'OMAP3-0_22'
@
text
@d54 1
a54 1
        BOARDCFG $name, $debuguart, $haluarts, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $maxpixrate, $machid, $mixers
d72 4
a75 2
        %        3
        DCD      $maxpixrate
d83 29
d117 4
d124 6
a129 6
        ;        Name           DebugUART UARTs  I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MaxPixRate MachID MixerChans
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 2,     2,       &16,     170,            147,    75000,     1546,  M_HSO+M_AI 
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 147,    75000,     2330,  M_HSO+M_AI ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     255,            24,     75000,     2344,  M_HSO+M_AI ; TODO - Verify lack of video GPIO, and use of GPIO24
        BOARDCFG "Pandora",     L4_UART3, "312", "123", 3,     255,     &16,     255,            16,     75000,     1761,  M_HSO+M_AI+M_PD 
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     255,            147,    75000,     2393,  M_HSO+M_AI+M_PD 
d132 9
@


1.2
log
@Various OMAP3 HAL power management improvements, plus add support for board config autodetection via Linux machine ID
Detail:
  s/board, hdr/board - Add Linux machine ID & available mixer channels to board config table
  s/Top - Add new entry point at offset &64, for booting as a fake Linux kernel. Searches the board config table until it finds a config matching the machine ID passed in R1. Also minor ROM copy optimisation, unsigned pointer comparison fixes
  s/Audio, hdr/Audio - Use board config to lock-out mixer channels that aren't connected to any hardware, to avoid excessive power drain or other problems if the channels get turned on. Also perform many other setting tweaks to tidy up default settings for unused mixer paths/channels.
  s/Video - Fix Video_Init logic when deciding whether to reset DSS, enable DSI PLL drift guard
  s/I2C - Increase I2C timeout values, since the previous values were perhaps a bit low
  s/Audio, s/I2C, s/Interrupts, s/RAM, s/SDMA, s/Timers, s/UART, hdr/UART, s/USB, s/Video - Enable autoidle/smart idle where possible to help save power.
Admin:
  Tested on rev C2 beagleboard


Version 0.21. Tagged as 'OMAP3-0_21'
@
text
@d91 1
a91 1
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 255,    75000,     2330,  M_HSO+M_AI ; TODO - If USB host is completely broken, we should hide it from RO
@


1.1
log
@Update OMAP HAL to support different board configs, plus use new YearLOIsGood flag to ensure correct RTC handling, plus other misc tidying
Detail:
  The OMAP HAL now has multiple entry points, one per board config. See Top.s/board.s for more info.
  audio.s - Moved APLL_CTL value to board config
  board.s - New file to list all the settings for the different board configs
  boot.s - Change HAL_Init to deal with the new board config stuff
  debug.s - Debug UART now specified in board config
  GPIO.s - A few utility functions for handling OMAP/TPS GPIO pins
  I2C.s - Update to use new board config struct
  RAM.s - Disable the beagleboard-specific RAM init code. Instead we'll just rely on u-boot to initialise all our RAM for us.
  RTC.s - Get rid of the magic numbers, and use the YearLOIsGood flag to indicate to RISC OS that YearLO is 2-digit BCD
  Top.s - Got rid of old debug code and rewrote initial flow to handle detecting & storing the board config
  UART.s - Update to use board config struct, support multiple UARTs
  USB.s - Get EHCI PHY power GPIO from board config
  Video.s - Get DVI framer power GPIO and max pixel rate from board config. Add 'PassiveVideo' option, to build a driver that doesn't alter the video output settings - should hopefully result in a usable display on Touch Book, etc.
  board.hdr - Definition of board config table struct
  GPIO.hdr - Add lots of macros for handling OMAP GPIO pins, new constants for OMAP/TPS GPIO
  I2C.hdr - Added I2C transfer block struct, HAL I2C API transfer states (both moved here from other source files)
  omap3530.hdr - Move/remove some unwanted constants, disable DebugChar for now
  StaticWS.hdr - Move I2C transfer block struct to I2C.hdr, add board config struct to HAL workspace, get rid of unused 64K AllocArea
  Timers.hdr - Tidy up constants a bit
  UART.hdr - Add UARTCLK (moved from StaticWS.hdr), UART IRQ #'s
  Makefile - add GPIO.s
Admin:
  Tested on rev C2 beagleboard. Board configs for other board types may be inaccurate in a couple of places.


Version 0.19. Tagged as 'OMAP3-0_19'
@
text
@d52 1
d54 1
a54 1
        BOARDCFG $name, $debuguart, $haluarts, $hali2cs, $numi2c, $videoi2c, $apll_ctl, $videogpio, $usbgpio, $maxpixrate
d69 4
d77 1
d81 5
d89 6
a94 6
        ;        Name           DebugUART UARTs  I2Cs   NumI2C VideoI2C APLL_CTL VideoGPIO       USBGPIO MaxPixRate
        BOARDCFG "BeagleBoard", L4_UART3, "312", "123", 2,     2,       &16,     170,            147,    75000
        BOARDCFG "DevKit8000",  L4_UART3, "312", "132", 2,     2,       &16,     GPIO_PIN_MAX+7, 255,    75000 ; TODO - If USB host is completely broken, we should hide it from RO
        BOARDCFG "IGEPv2",      L4_UART3, "312", "123", 2,     2,       &16,     255,            24,     75000 ; TODO - Verify lack of video GPIO, and use of GPIO24
        BOARDCFG "Pandora",     L4_UART3, "312", "123", 3,     255,     &16,     255,            16,     75000
        BOARDCFG "Touch Book",  L4_UART3, "312", "123", 3,     255,     &16,     255,            147,    75000
@

