head	1.17;
access;
symbols
	OMAP3-1_18:1.17
	OMAP3-1_17:1.17
	OMAP3-1_16:1.17
	OMAP3-1_15:1.16
	OMAP3-1_14:1.16
	SMP:1.16.0.2
	SMP_bp:1.16
	OMAP3-1_13:1.16
	OMAP3-1_12:1.16
	OMAP3-1_11:1.16
	OMAP3-1_10:1.16
	OMAP3-1_09:1.16
	OMAP3-1_08:1.16
	OMAP3-1_07:1.15
	OMAP3-1_06:1.15
	OMAP3-1_05:1.15
	OMAP3-1_04:1.15
	OMAP3-1_03:1.15
	OMAP3-1_02:1.15
	OMAP3-1_01:1.15
	OMAP3-1_00:1.15
	OMAP3-0_99:1.15
	OMAP3-0_98:1.15
	OMAP3-0_97:1.15
	OMAP3-0_96:1.15
	OMAP3-0_95:1.15
	OMAP3-0_94:1.15
	OMAP3-0_93:1.14
	OMAP3-0_92:1.14
	OMAP3-0_91:1.14
	OMAP3-0_90:1.14
	OMAP3-0_89:1.14
	OMAP3-0_88:1.14
	OMAP3-0_87:1.14
	OMAP3-0_86:1.14
	OMAP3-0_85:1.14
	OMAP3-0_84:1.14
	OMAP3-0_83:1.14
	OMAP3-0_82:1.14
	OMAP3-0_81:1.14
	OMAP3-0_80:1.14
	OMAP3-0_79:1.14
	OMAP3-0_78:1.13
	OMAP3-0_77:1.13
	OMAP3-0_76:1.13
	OMAP3-0_75:1.13
	OMAP3-0_74:1.13
	OMAP3-0_73:1.12
	OMAP3-0_72:1.12
	OMAP3-0_71:1.12
	OMAP3-0_70:1.12
	OMAP3-0_69:1.12
	OMAP3-0_68:1.12
	OMAP3-0_67:1.12
	OMAP3-0_66:1.12
	OMAP3-0_65:1.12
	OMAP3-0_64:1.12
	OMAP3-0_63:1.11
	OMAP3-0_62:1.11
	OMAP3-0_61:1.11
	OMAP3-0_60:1.10
	OMAP3-0_59:1.10
	OMAP3-0_58:1.10
	OMAP3-0_57:1.10
	OMAP3-0_56:1.10
	OMAP3-0_55:1.10
	OMAP3-0_54:1.10
	OMAP3-0_53:1.10
	OMAP3-0_52:1.10
	OMAP3-0_51:1.9
	OMAP3-0_50:1.9
	OMAP3-0_49:1.9
	OMAP3-0_48:1.9
	OMAP3-0_47:1.8
	OMAP3-0_46:1.8
	OMAP3-0_45:1.8
	OMAP3-0_44:1.8
	OMAP3-0_43:1.7
	OMAP3-0_42:1.7
	OMAP3-0_41:1.7
	OMAP3-0_40:1.7
	OMAP3-0_39:1.7
	OMAP3-0_38:1.7
	OMAP3-0_37:1.7
	OMAP3-0_36:1.7
	OMAP3-0_35:1.7
	OMAP3-0_34:1.7
	OMAP3-0_33:1.6
	OMAP3-0_32:1.5
	OMAP3-0_31:1.4
	OMAP3-0_30:1.4
	OMAP3-0_29:1.4
	OMAP3-0_28:1.4
	OMAP3-0_27:1.4
	OMAP3-0_26:1.4
	OMAP3-0_25:1.4
	OMAP3-0_24:1.4
	OMAP3-0_23:1.3
	OMAP3-0_22:1.2
	OMAP3-0_21:1.2
	OMAP3-0_20:1.1
	OMAP3-0_19:1.1;
locks; strict;
comment	@# @;


1.17
date	2018.03.30.07.55.36;	author rsprowson;	state Exp;
branches;
next	1.16;
commitid	KtoigwpzbOUegswA;

1.16
date	2016.01.08.23.01.45;	author jlee;	state Exp;
branches;
next	1.15;
commitid	Infb2G92SOfknbQy;

1.15
date	2013.12.17.23.49.44;	author jlee;	state Exp;
branches;
next	1.14;
commitid	xmZ8fZAPbpltOxhx;

1.14
date	2012.09.21.15.17.03;	author jlee;	state Exp;
branches;
next	1.13;
commitid	x7ZCrdwZgdjnvplw;

1.13
date	2012.07.18.23.02.42;	author jlee;	state Exp;
branches;
next	1.12;
commitid	gm1WcfapVdjFa6dw;

1.12
date	2012.06.04.23.45.08;	author jlee;	state Exp;
branches;
next	1.11;
commitid	m70jrk0mZm9UOr7w;

1.11
date	2012.03.25.11.49.04;	author rsprowson;	state Exp;
branches;
next	1.10;
commitid	c99VvmwezV2J8gYv;

1.10
date	2011.12.04.19.14.48;	author jlee;	state Exp;
branches;
next	1.9;
commitid	ITJDzEpHbl3ScUJv;

1.9
date	2011.07.31.18.56.17;	author jlee;	state Exp;
branches;
next	1.8;
commitid	trdyxuPEj4eC9Itv;

1.8
date	2011.05.23.22.36.56;	author jlee;	state Exp;
branches;
next	1.7;
commitid	bnISDC4C6dEOARkv;

1.7
date	2010.10.31.20.03.23;	author jlee;	state Exp;
branches;
next	1.6;

1.6
date	2010.10.26.23.27.10;	author jlee;	state Exp;
branches;
next	1.5;

1.5
date	2010.09.14.20.58.47;	author jlee;	state Exp;
branches;
next	1.4;

1.4
date	2010.03.20.01.07.06;	author jlee;	state Exp;
branches;
next	1.3;

1.3
date	2010.02.28.19.47.12;	author jlee;	state Exp;
branches;
next	1.2;

1.2
date	2010.01.30.00.23.18;	author jlee;	state Exp;
branches;
next	1.1;

1.1
date	2010.01.24.02.49.29;	author jlee;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Make type and revision private
Adopt the board type and revision enum privately in board.hdr (mass search & replace exercise).
Don't re-export it via a stub GPIO device; it's private.

Version 1.16. Tagged as 'OMAP3-1_16'
@
text
@; Copyright 2010 Castle Technology Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;


; Board configuration struct

                         ^ 0
BoardConfig_DebugUART    # 4 ; Physical address of debug UART

BoardConfig_HALUART      # 4*4 ; Physical addresses of UARTs, in HAL API order
BoardConfig_HALUARTIRQ   # 4 ; 4 bytes of IRQ numbers for HAL UARTs
BoardConfig_DefaultUART  # 1 ; Default UART index
BoardConfig_NameOMAP3    # 1 ; Offset of board name from BoardConfigNames (n.b. offset rather than pointer so name can be output during pre-MMU phase)
BoardConfig_NameDM37x    # 1
                         # 1 ; Spare

BoardConfig_HALI2C       # 4*3 ; Physical addresses of I2Cs, in HAL API order
BoardConfig_HALI2CIRQ    # 3 ; 3 bytes of IRQ numbers of HAL I2Cs
BoardConfig_NumI2C       # 1 ; Number of I2Cs to expose via HAL

BoardConfig_VideoI2C     # 1 ; Index of video I2C bus in above tables, 255 for none
BoardConfig_APLL_CTL     # 1 ; APLL_CTL value for TPS audio
BoardConfig_VideoGPIO    # 1 ; GPIOx of DVI framer, 255 for none
BoardConfig_USBGPIO      # 1 ; GPIOx of USB PHY, 255 for none

BoardConfig_MixerChans   # 1 ; Mask of disabled mixer channels
BoardConfig_VBC_Flags    # 1 ; VideoBoardConfig flags
BoardConfig_VBC_LCDNum   # 1 ; Number of LCD configs
BoardConfig_NumUART      # 1 ; Number of UARTs to expose via HAL

BoardConfig_VBC_LCDPtr   # 4 ; Pointer to LCD config list
BoardConfig_Init         # 4 ; Board-specific code for HAL_Init
BoardConfig_InitDevices  # 4 ; Board-specific version of HAL_InitDevices
BoardConfig_PowerOff     # 4 ; Board-specific power off routine
BoardConfig_MachID       # 4 ; Linux machine ID, as per arch/arm/tools/mach-types

BoardConfig_Size         # 0

        ASSERT (BoardConfig_Size :AND: 3) = 0

; Linux machine IDs:
MachID_BeagleBoard       * 1546
MachID_DevKit8000        * 2330
MachID_IGEPv2            * 2344
MachID_Pandora           * 1761
MachID_TouchBook         * 2393
MachID_OMAP35xEVM        * 1535
MachID_OMAP4430SDP       * 2160
MachID_PandaBoard        * 2791

; Beagleboard board revision GPIOs:
; Board revision is indicated by GPIOs 171-173
BeagleBoard_AB           * 2_111
BeagleBoard_C123         * 2_110
BeagleBoard_C4           * 2_101
BeagleBoard_xMA          * 2_000
BeagleBoard_xMB          * 2_001 ; (May actually be same as xMA?)
BeagleBoard_xMC          * 2_010

; IGEPv2 board revision GPIOs:
; Board revision is indicated by GPIO 28
IGEPv2_BC                * 2_1
IGEPv2_C                 * 2_0

; Enumerations of the board type, and any minor revisions within that type
                                  ^ 0
BoardType_OMAP3_BeagleBoard       # 1 ; It's a BeagleBoard or BB-xM
BoardType_OMAP3_DevKit8000        # 1 ; It's a DevKit 8000
BoardType_OMAP3_IGEPv2            # 1 ; It's an IGEP v2
BoardType_OMAP3_Pandora           # 1 ; It's a Pandora
BoardType_OMAP3_TouchBook         # 1 ; It's a TouchBook
                                  ^ 0
BoardRevision_BeagleBoard_AB      # 1 ; BB Rev A or B
BoardRevision_BeagleBoard_C123    # 1 ; BB Rev C1, C2 or C3
BoardRevision_BeagleBoard_C4      # 1 ; BB Rev C4
BoardRevision_BeagleBoard_xMA     # 1 ; BB-xM Rev A
BoardRevision_BeagleBoard_xMB     # 1 ; BB-xM Rev B
BoardRevision_BeagleBoard_xMC     # 1 ; BB-xM Rev C
                                  ^ 0
BoardRevision_DevKit8000_Unknown  # 1 ; Any
                                  ^ 0
BoardRevision_IGEPv2_BC           # 1 ; Rev B or C (B-compatible)
BoardRevision_IGEPv2_C            # 1 ; Rev C (not a B-compatible one)
                                  ^ 0
BoardRevision_Pandora_Unknown     # 1 ; Any
                                  ^ 0
BoardRevision_TouchBook_Unknown   # 1 ; Any

; todo - SDRC register settings? function pointers for more flexible setup?
;        (board revision detection, USB PHY, DVI framer, HAL devices, etc.)

; Video configuration structs - these must match up with the definitions in the OMAPVideo driver

                          ^ 0
LCDTimings_PixelRate      # 4 ; Required pixel rate (Hz)
LCDTimings_HSW            # 2
LCDTimings_HFP            # 2
LCDTimings_HBP            # 2
LCDTimings_Width          # 2
LCDTimings_VSW            # 2
LCDTimings_VFP            # 2
LCDTimings_VBP            # 2
LCDTimings_Height         # 2
LCDTimings_SyncPol        # 4 ; vidclist3 syncpol flags
LCDTimings_Size           # 0

                          ^ 0
LCDConfig_DSI_BPP         # 1 ; BPP of DSI output
LCDConfig_DSI_LANES       # 1 ; Number of data lanes of DSI output
LCDConfig_ACBias_Freq     # 1 ; AC bias pin frequency
LCDConfig_LCDType         # 1 ; LCD type
LCDConfig_Flags           # 4 ; Extra flags
LCDConfig_Power           # 4 ; Function ptr to enable/disable power to panel/output path/etc. R0=hal device, R1=brightness (0-65536)
LCDConfig_LCDTimings      # 4 ; Pointer to required timings, if fixed panel
LCDConfig_Max_PixelRate   # 4 ; Max pixel rate (Hz), if flexible panel
LCDConfig_Size            # 0


LCDConfig_LCDType_None       * 0
LCDConfig_LCDType_TFT        * 1
LCDConfig_LCDType_STN_Colour * 2
LCDConfig_LCDType_STN_Mono4  * 3
LCDConfig_LCDType_STN_Mono8  * 4

LCDConfig_Flags_RF           * 1
LCDConfig_Flags_IEO          * 2
LCDConfig_Flags_IPC          * 4
LCDConfig_Flags_Brightness   * 8 ; LCDConfig_Power can be used to control backlight brightness


                                 ^ 0
VideoBoardConfig_sys_clk         # 4 ; System clock frequency
VideoBoardConfig_Max_Porch       # 2 ; Max porch value
VideoBoardConfig_Max_Sync        # 2 ; Max sync value
VideoBoardConfig_DMA_Ptr         # 4 ; Pointer to SDMA registers
VideoBoardConfig_DMA_Device      # 4 ; SDMA IRQ number
VideoBoardConfig_DMA_Chans       # 4 ; Mask of available SDMA channels
VideoBoardConfig_Flags           # 1 ; Extra flags
VideoBoardConfig_Num_LCDs        # 1 ; Number of LCD outputs available
VideoBoardConfig_MySize          # 2 ; sizeof(VideoBoardConfig), or 0 for old HAL
VideoBoardConfig_LCD_Configs     # 4 ; Pointer to list of LCD configs
VideoBoardConfig_TVDet_Func      # 4 ; Function to poll TV detection signal
VideoBoardConfig_TVPower_Func    # 4 ; Function to control TV out power. R0=hal device, R1=on/off flag
VideoBoardConfig_Size            # 0

VideoBoardConfig_Flags_SVideo    * 1
VideoBoardConfig_Flags_Composite * 2

        END
@


1.16
log
@Fix build error. Add HAL_PlatformName implementation.
Detail:
  s/Boot, Makefile, s/Stubs - Remove references to deleted HAL ATA calls. Delete s/Subs it's now redundant.
  hdr/board, s/board, s/Top - Refactor how board names are stored so that we can differentiate between OMAP3 and DM37x versions of boards (at least the BeagleBoard and the Pandora come in OMAP3 and DM37x variants)
  s/Boot - Add HAL_PlatformName implementation, using the new board name system
Admin:
  Tested on BB-xM


Version 1.08. Tagged as 'OMAP3-1_08'
@
text
@d77 26
a102 1
; todo - SDRC register settings? function pointers for more flexible setup? (board revision detection, USB PHY, DVI framer, HAL devices, etc.)
@


1.15
log
@Re-enable Pandora TV-out support
Detail:
  s/board - Re-enable Pandora TV-out support now that we have the ability to turn TV-out power on/off
  hdr/board, s/Video - Add the new TV-out power control function to the video board config struct. All OMAP boards should be able to use the same implementation, which enables/disables the VDAC power supply in the TPS
Admin:
  Tested on BB-xM and Pandora
  TV detection (and TV-out in general) now works properly on the Pandora


Version 0.94. Tagged as 'OMAP3-0_94'
@
text
@d25 3
a27 1
                         # 3 ; Spare
a46 1
BoardConfig_Name         # 12 ; Config name
@


1.14
log
@Tidy up board-specific code. Improve Pandora support.
Detail:
  hdr/board, s/board, s/Boot - Tidied up board-specific code a bit by adding more board-specific function pointers to the BoardConfig struct instead of relying on manual board detection in code.
  s/board - Disable Pandora VideoGPIO as turning the LCD on & off seems to result in graphical corruption, most likely due to settings which were set by the SPI interface being lost.
  s/KbdMatrix, Makefile - New file for handling the Pandora's keyboard matrix (and anything else that may require keyboard matrix code in the HAL). Contains stub code for the boot-time keyboard scan, and code to register a keyboard HAL device for detection by the PandoraKey module.
  s/Boot - Add soft-off support for Pandora. Add Pandora-specific initialisation code to enable some extra power supplies (touchscreen, nubs, audio DAC, EHCI PHY)
  s/KbdScan - Use Pandora-specific keyboard scan code instead of USB code when running on Pandora
  s/SDIO - Correct sense of MMC activity LEDs on Pandora. Now only lit during periods of activity, to match behaviour of the Pandora Linux distro.
  s/Video - Add some switched out hack code to allow easier debugging of aborts that occur during ROM initialisation
Admin:
  Tested on Pandora, rev C2 BB, rev A2 BB-xM, rev C1 TouchBook


Version 0.79. Tagged as 'OMAP3-0_79'
@
text
@d129 1
@


1.13
log
@Add support for TV detection
Detail:
  hdr/board, s/Video - Video device now implements the tvdet_func function for polling the TV detect GPIO
Admin:
  Tested on BB-xM with high processor vectors


Version 0.74. Tagged as 'OMAP3-0_74'
@
text
@d42 1
d44 2
a45 1
BoardConfig_Name         # 20 ; Config name
@


1.12
log
@Add HAL_UARTDefault implementation. Delete old HAL video code. Add some SmartReflex tweaks.
Detail:
  hdr/board, s/board, s/Boot, s/UART - Added HAL_UARTDefault implementation, to allow OS_SerialOp to be used
  hdr/StaticWS, hdr/omap3530, s/Boot, s/Interrupts, s/Video - Removed old HAL video code. The OMAPVideo module is a much better video driver.
  s/SR37x - Add some SmartReflex tweaks which we can try if we run into any stability issues with the current code.
Admin:
  Tested on rev A2 BB-xM


Version 0.64. Tagged as 'OMAP3-0_64'
@
text
@d124 1
a124 1
                                 # 2 ; Padding
d126 1
@


1.11
log
@Line some things up.
To help OMAP4 tracking changes a number of the changes were purely cosmetic lining up differences, this change is where OMAP3 wasn't on a conventional column layout.

Version 0.61. Tagged as 'OMAP3-0_61'
@
text
@d24 2
@


1.10
log
@Add preliminary OMAP3 EVM support. Fix HAL_UARTModemControl
Detail:
  hdr/board, s/Boot, s/Top, s/board - Added preliminary support for OMAP3 EVM boards. Only generation 2 boards are supported at the moment.
  s/UART - Fixed HAL_UARTModemControl to pay attention to the 'mask' parameter
Admin:
  Tested on rev A2 BB-xM. EVM support might not be fully working.


Version 0.52. Tagged as 'OMAP3-0_52'
@
text
@d55 2
@


1.9
log
@Add new support for the new GPIO HAL device
Detail:
  hdr/board - Add information about determining the IGEP board revision
  hdr/StaticWS - Add workspace for storing the GPIO HAL device
  s/board - Update BeagleBoard entry to have a custom HAL device init func
  s/Boot - Fix HAL_Init to not configure GPIOs 171-173 if not running on a beagleboard. Update HAL_InitDevices to preserve the right registers and initialise the GPIO devices where appropriate.
  s/GPIO - Added GPIO_InitDevice function to do the actual initialisation
Admin:
  Tested on rev A2 BB-xM


Version 0.48. Tagged as 'OMAP3-0_48'
@
text
@d54 1
@


1.8
log
@Add code to detect exact BeagleBoard revision, and to deal with new EHCI power controls on xM rev C
Detail:
  hdr/board - Definitions for GPIO values used to detect beagleboard revision
  s/Boot - Added code to detect BB revision via GPIO lines, in order to determine the correct setting for the TPS pin which controls the EHCI power
Admin:
  Tested on BB rev C2, BB-xM rev A2.
  BB xM rev C should work now!


Version 0.44. Tagged as 'OMAP3-0_44'
@
text
@d64 5
@


1.7
log
@Miscellaneous OMAP3 HAL updates
Detail:
  s/Boot - HAL_Reset now sets the PRM_RSTCTRL.RST_DPLL3 bit instead of the PRM_RSTCTRL_GS bit. This matches what Linux does, and seems to fix resets on the TouchBook.
  s/board - Changed TouchBook audio to use the hands-free output instead of the predriver. This fixes speaker output (although it's currently listed as "line out" by the sound setup configure plugin)
  hdr/board, s/board, s/Video - Update the LCDConfig struct to contain an entry for controlling LCD power/brightness. Hook up basic power controls for current machine types.
Admin:
  Tested on rev C2 beagleboard & C1 touchbook.
  Video changes mean that OMAPVideo 0.08 or newer is required.


Version 0.34. Tagged as 'OMAP3-0_34'
@
text
@d55 9
@


1.6
log
@Miscellaneous OMAP3 HAL improvements
Detail:
  hdr/board, s/board, s/Boot - Linux machine IDs are now defined via constants in hdr/board instead of magic numbers on a per-use basis
  s/Boot - Added video fix for BB-xM rev A3.
  s/Boot - Added code to enable tablet battery charging on TouchBook.
  s/Boot - Added support for power-off on TouchBook
  s/GPIO - Fixed bug in GPIOx_SetAsOutput that would prevent LEDs from being disabled properly
  s/I2C - Updated code to ignore BF interrupts. Added debugging code to help track down unexpected errors, and to check that IIC_DoOp_Poll is being called with interrupts disabled.
  s/SDMA - Call HAL_IRQClear when resetting the DMA controller device. This fixes the "previous IRQ not cleared" loop that would occur during RISC OS's pre-reset sequence
Admin:
  Tested on rev C2 beagleboard, C1 touchbook, A3 BBxM.
  Resets should now work reliably on all machines, except TouchBook, which still seems to hang. But on the bright side, the TouchBook is currently the only machine to support soft-off.


Version 0.33. Tagged as 'OMAP3-0_33'
@
text
@d78 1
d90 4
a93 3
LCDConfig_Flags_RF   * 1
LCDConfig_Flags_IEO  * 2
LCDConfig_Flags_IPC  * 4
@


1.5
log
@BeagleBoard-xM, TouchBook fixes
Detail:
  s/board, hdr/board, hdr/omap3530, hdr/UART - Add support for 4th UART available on AM/DM37x (i.e. BeagleBoard-xM)
  hdr/omap3530 - Add details of CONTROL_IDCODE register & known hawkeye/revision numbers for OMAP type/revision detection
  s/Boot, s/GPIO, hdr/GPIO, s/I2C, hdr/StaticWS - Allow TPS LED drivers to be used as (output-only) GPIOs. Add new polled I/O I2C function, and appropriate logic to make GPIO code use it instead of RISCOS_IICOpV if RISC OS hasn't finished initialising yet. Add code to initialise some extra BB/TB GPIOs on boot.
  s/Timers, hdr/Timers - Stop RISC OS from using GPTIMER9, because it's used to drive the screen backlight on the TouchBook
  s/Video - Use appropriate porch/sync limits on non-OMAP35x
  s/PRCM - Don't mess with the system clock divider when calculating system clock speed (AM/DM37x fix)
Admin:
  Tested on rev C2 beagleboard, rev A2 BB-xM (indirectly), rev C1 TouchBook


Version 0.32. Tagged as 'OMAP3-0_32'
@
text
@d48 7
@


1.4
log
@Add basic GPMC setup code and NIC HAL devices to OMAP HAL
Detail:
  s/GPMC, hdr/GPMC, hdr/StaticWS - basic code to reset the GPMC and configure chip selects
  s/NIC, hdr/NIC, hdr/StaticWS - code to expose any onboard NICs (SMSC9221, DM9000) to RISC OS as simple HAL devices.
  Makefile - added GPMC & NIC source files
  s/board, hdr/board - Expanded board config struct to include a pointer to extra code to call at the end of HAL_InitDevices, to allow board-specific devices to be initialised
  s/boot - Extra HAL_InitDevices code to set up the NICs on the IGEP/DevKit
  s/GPIO, hdr/GPIO - Improved functionality to allow GPIO IRQs to be used
  s/SDMA, s/Video - Tweaked the HAL device descriptors to indicate that the devices are on the L3 interconnect
Admin:
  Tested on rev C2 beagleboard. IGEP/DevKit entry points booted OK, but no attempts were made to look for or interact with the new HAL devices!


Version 0.24. Tagged as 'OMAP3-0_24'
@
text
@d22 2
a23 3
BoardConfig_HALUART      # 4*3 ; Physical addresses of UARTs, in HAL API order
BoardConfig_HALUARTIRQ   # 3 ; 3 bytes of IRQ numbers for HAL UARTs
BoardConfig_NumUART      # 1 ; Number of UARTs to expose via HAL
d37 1
a37 1
                         # 1 ; Padding
@


1.3
log
@Update OMAP3 HAL to support new OMAPVideo module, plus other minor changes
Detail:
  hdr/StaticWS, hdr/Video, hdr/board, hdr/omap3530, s/Boot, s/Video, s/board - Add new HALDoesVideo switch to control whether the HAL provides the video driver or whether a HAL device is used to expose the video hardware to the OMAPVideo module. Switch defaults to the 'off' state, i.e. OMAPVideo provides the video driver. Also updated the board config struct to contain more detailed information about the video capabilities of each board.
  s/Audio - fix the FIFO underflow/overflow IRQ handler to disable the IRQ after the underflow/overflow has been detection. This prevents the OS from (potentially) getting stuck in a loop servicing the interrupt and never reaching the state where it can shut down & re-initialise the audio to fix the error properly.
  s/Debug - add DebugCallstack function that disables IRQs/FIQs and dumps the stack contents over the serial port
Admin:
  Tested on rev C2 beagleboard.


Version 0.23. Tagged as 'OMAP3-0_23'
@
text
@d41 1
@


1.2
log
@Various OMAP3 HAL power management improvements, plus add support for board config autodetection via Linux machine ID
Detail:
  s/board, hdr/board - Add Linux machine ID & available mixer channels to board config table
  s/Top - Add new entry point at offset &64, for booting as a fake Linux kernel. Searches the board config table until it finds a config matching the machine ID passed in R1. Also minor ROM copy optimisation, unsigned pointer comparison fixes
  s/Audio, hdr/Audio - Use board config to lock-out mixer channels that aren't connected to any hardware, to avoid excessive power drain or other problems if the channels get turned on. Also perform many other setting tweaks to tidy up default settings for unused mixer paths/channels.
  s/Video - Fix Video_Init logic when deciding whether to reset DSS, enable DSI PLL drift guard
  s/I2C - Increase I2C timeout values, since the previous values were perhaps a bit low
  s/Audio, s/I2C, s/Interrupts, s/RAM, s/SDMA, s/Timers, s/UART, hdr/UART, s/USB, s/Video - Enable autoidle/smart idle where possible to help save power.
Admin:
  Tested on rev C2 beagleboard


Version 0.21. Tagged as 'OMAP3-0_21'
@
text
@d36 3
a38 1
                         # 3 ; Padding
d40 1
a40 1
BoardConfig_MaxPixRate   # 4 ; Video max pixel rate, kHz
d50 53
@


1.1
log
@Update OMAP HAL to support different board configs, plus use new YearLOIsGood flag to ensure correct RTC handling, plus other misc tidying
Detail:
  The OMAP HAL now has multiple entry points, one per board config. See Top.s/board.s for more info.
  audio.s - Moved APLL_CTL value to board config
  board.s - New file to list all the settings for the different board configs
  boot.s - Change HAL_Init to deal with the new board config stuff
  debug.s - Debug UART now specified in board config
  GPIO.s - A few utility functions for handling OMAP/TPS GPIO pins
  I2C.s - Update to use new board config struct
  RAM.s - Disable the beagleboard-specific RAM init code. Instead we'll just rely on u-boot to initialise all our RAM for us.
  RTC.s - Get rid of the magic numbers, and use the YearLOIsGood flag to indicate to RISC OS that YearLO is 2-digit BCD
  Top.s - Got rid of old debug code and rewrote initial flow to handle detecting & storing the board config
  UART.s - Update to use board config struct, support multiple UARTs
  USB.s - Get EHCI PHY power GPIO from board config
  Video.s - Get DVI framer power GPIO and max pixel rate from board config. Add 'PassiveVideo' option, to build a driver that doesn't alter the video output settings - should hopefully result in a usable display on Touch Book, etc.
  board.hdr - Definition of board config table struct
  GPIO.hdr - Add lots of macros for handling OMAP GPIO pins, new constants for OMAP/TPS GPIO
  I2C.hdr - Added I2C transfer block struct, HAL I2C API transfer states (both moved here from other source files)
  omap3530.hdr - Move/remove some unwanted constants, disable DebugChar for now
  StaticWS.hdr - Move I2C transfer block struct to I2C.hdr, add board config struct to HAL workspace, get rid of unused 64K AllocArea
  Timers.hdr - Tidy up constants a bit
  UART.hdr - Add UARTCLK (moved from StaticWS.hdr), UART IRQ #'s
  Makefile - add GPIO.s
Admin:
  Tested on rev C2 beagleboard. Board configs for other board types may be inaccurate in a couple of places.


Version 0.19. Tagged as 'OMAP3-0_19'
@
text
@d35 3
d40 1
@

