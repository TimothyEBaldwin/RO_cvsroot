head	4.13;
access;
symbols
	ScrModes-0_71:4.13
	ScrModes-0_70:4.13
	ScrModes-0_69:4.13
	ScrModes-0_68:4.13
	ScrModes-0_67:4.13
	ScrModes-0_66:4.13
	ScrModes-0_65:4.13
	ScrModes-0_64:4.13
	ScrModes-0_62:4.13
	ScrModes-0_61:4.13
	ScrModes-0_60:4.13
	ScrModes-0_59:4.13
	ScrModes-0_58:4.13
	ScrModes-0_57:4.13
	ScrModes-0_56-smalltables:4.13
	ScrModes-0_56:4.13
	ScrModes-0_55-mallocfree:4.13
	ScrModes-0_55-cvs3fix:4.13
	ScrModes-0_55:4.13
	ScrModes-0_53-split:4.13
	ScrModes-0_54:4.13
	ScrModes-0_53-tables:4.12
	ScrModes-0_53:4.11
	ScrModes-0_52:4.11
	ScrModes-0_51:4.11
	ScrModes-0_50:4.11
	ScrModes-0_49:4.11
	ScrModes-0_48:4.10
	ScrModes-0_47:4.10
	ScrModes-0_46:4.10
	ScrModes-0_45:4.10
	ScrModes-0_44:4.10
	ScrModes-0_43:4.10
	ScrModes-0_42:4.10
	ScrModes-0_41:4.10
	ScrModes-0_40:4.10
	ScrModes-0_39:4.10
	ScrModes-0_38:4.10
	ScrModes-0_37:4.10
	ScrModes-0_36:4.10
	ScrModes-0_35:4.10
	ScrModes-0_34:4.9
	ScrModes-0_33:4.9
	ScrModes-0_32:4.8
	ScrModes-0_31:4.6
	RO_5_07:4.5
	ScrModes-0_30:4.5
	ScrModes-0_29:4.5
	ScrModes-0_28:4.4
	dellis_autobuild_BaseSW:4.4
	ScrModes-0_27:4.4
	ScrModes-0_26:4.3
	sbrodie_sedwards_16Mar2000:4.3
	ScrModes-0_25:4.3
	ScrModes-0_24:4.3
	dcotton_autobuild_BaseSW:4.4
	ScrModes-0_23:4.3
	ScrModes-0_22:4.3
	ScrModes-0_21:4.3
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.1
	Ursula_RiscPC:4.1.4.1.0.2
	ScrModes-0_20:4.2
	rthornb_UrsulaBuild-19Aug1998:4.1.4.1
	UrsulaBuild_FinalSoftload:4.1.4.1
	rthornb_UrsulaBuild-12Aug1998:4.1.4.1
	aglover_UrsulaBuild-05Aug1998:4.1.4.1
	rthornb_UrsulaBuild-29Jul1998:4.1.4.1
	rthornb_UrsulaBuild-22Jul1998:4.1.4.1
	rthornb_UrsulaBuild-15Jul1998:4.1.4.1
	rthornb_UrsulaBuild-07Jul1998:4.1.4.1
	rthornb_UrsulaBuild-17Jun1998:4.1.4.1
	rthornb_UrsulaBuild-03Jun1998:4.1.4.1
	rthornb_UrsulaBuild-27May1998:4.1.4.1
	rthornb_UrsulaBuild-21May1998:4.1.4.1
	rthornb_UrsulaBuild_01May1998:4.1.4.1
	afrost_NC2_Generic:4.1.7.3
	afrost_Funai01-33:4.1.7.3
	Spinner_RCA116:4.1.7.3
	Spinner_B20_2:4.1.7.3
	Spinner_19_3:4.1.7.3
	Spinner_B18:4.1.7.3
	Spinner_B17:4.1.7.3
	Spinner_B15:4.1.7.3
	Spinner_B14:4.1.7.3
	Spinner_B13:4.1.7.3
	Spinner_B12:4.1.7.3
	Spinner_B10:4.1.7.3
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.3
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.3
	Spin_3Apr97:4.1.7.3
	RCA_bp:4.1
	ARTtmp:4.1.7.3.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.13
date	2016.05.14.12.45.33;	author rool;	state Exp;
branches;
next	4.12;
commitid	DAkVsTOsI1rFSr6z;

4.12
date	2016.05.14.12.40.18;	author rool;	state Exp;
branches;
next	4.11;
commitid	UkO7RI5AYo6IQr6z;

4.11
date	2015.11.29.20.34.43;	author jlee;	state Exp;
branches;
next	4.10;
commitid	X917PzTaosbDQ1Ly;

4.10
date	2013.01.06.21.19.50;	author rsprowson;	state Exp;
branches;
next	4.9;
commitid	Xbz0V5WctaNB4czw;

4.9
date	2012.08.12.16.21.21;	author rsprowson;	state Exp;
branches;
next	4.8;
commitid	nNXWhBWs82za9hgw;

4.8
date	2012.07.22.10.06.58;	author rsprowson;	state Exp;
branches;
next	4.7;
commitid	7jMDXidCJtWfKxdw;

4.7
date	2012.07.14.19.38.52;	author rsprowson;	state Exp;
branches;
next	4.6;
commitid	YTNC4KmzhMQIazcw;

4.6
date	2012.01.14.23.04.49;	author srevill;	state Exp;
branches;
next	4.5;
commitid	M49bYcHrcN15acPv;

4.5
date	2002.04.12.13.50.38;	author srevill;	state Exp;
branches;
next	4.4;

4.4
date	2000.06.06.12.42.58;	author kbracey;	state Exp;
branches;
next	4.3;

4.3
date	99.09.16.13.19.18;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	98.09.21.13.53.43;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.46.29;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.46.29;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.02.50.31;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	98.03.26.14.47.11;	author rthornb;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.13.01.57;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.24.05;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.03.11.19.20.20;	author nturton;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.03.19.21.43.47;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.13
log
@Split out MDF and EDID support
Detail:
  Main source file split into 3.
Admin:
  Tested briefly, functionality unchanged.
  Submission for the EDID bounty.
  Tagged as ScrModes-0_53-split
@
text
@# Copyright 1996 Acorn Computers Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for ScrModes
#

COMPONENT     = ScrModes
OBJS          = ScrModes tables mdfsupport edidsupport
CMHGFILE      = ScrModesv
HDRS          =
ASMHDRS       = ScrModes
ASMCHDRS      = ScrModes
CDFLAGS       = -DDODEBUG=1
CMHGDEPENDS   = ScrModes
RESFSDIR      = ${RESDIR}.ScreenMode

include CModule

# Dynamic dependencies:
@


4.12
log
@Split out data tables, stylistic refactoring
Detail:
  Move the 500+ lines of tables into a new source file and remove storage inferred by former CEAModes.h.
  Tame some of the rampant style from various authors, even within 1 function, to something reasonably consistent.
  Uppercase the 'debug' macro to 'IFDEBUG'.
  Relocate ScrModes specific defines out of EDIDModes header, rename to edidmemory.h.
  Add monitor type 6 to monitors.h.
  Fix for unguarded debug printout "Can't allocate space for monitor list" in parseedid.
Admin:
  Tested briefly, functionality unchanged.
  Submission for the EDID bounty.
  Tagged as ScrModes-0_53-tables
@
text
@d19 1
a19 1
OBJS          = ScrModes tables
@


4.11
log
@Add support for parsing and reporting the contents of CEA 861-D audio-related EDID blocks
Detail:
  Makefile - Export a C version of hdr/ScrModes
  Resources/Germany/Messages, Resources/UK/Messages, h/errors - Add new error message
  cmhg/ScrModesv, hdr/ScrModes - Declare existence of ScreenModes_EnumerateAudioFormats SWI. Declare ScreenModes_ReadInfo reason codes.
  h/modex - Extend MonitorDefinition struct to allow it to store the speaker mask & audio format information that's extracted from the EDID
  c/ScrModes - Extend support for processing of CEA extension blocks. All block revisions > 0 should now be accepted, and rudimentary parsing of CEA data block collections is implemented (currently, only extracts information from audio related blocks). Add SWI ScreenModes_EnumerateAudioFormats to allow details of the supported formats to be returned in either "raw" or "friendly" forms. Add ScreenModes_ReadInfo reason code 1 to allow reading of the speaker mask (+ validity bits). Also fix *LoadModeFile to allow EDID blocks to be loaded without first having to issue *ReadEDID first (EDIDEnabled flag issue).
Admin:
  Tested on iMX6 with assorted EDID blocks
  German messages file in need of translation


Version 0.49. Tagged as 'ScrModes-0_49'
@
text
@d19 1
a19 1
OBJS          = ScrModes
@


4.10
log
@Filter out impossible modes from a modefile super set
New function, build_a_vidclist() allows the GraphicsV Vet_Mode entry point to be called when validating a mode, so the graphics driver can decide on a mode by mode basis whether it can be achieved.
This resolves the problem where an MDF has a super set of modes that the hardware only supports a subset of.
Also
* Inlined inform_modefilechanged
* Removed redundant CFLAGS from makefile
* Made a few braces and spaces consistent with their surroundings

Tested in an IOMD ROM build on a machine with and without VRAM fitted, looking in display manager that the menus are rebuilt accordingly.
Fixes ticket #315.

Version 0.35. Tagged as 'ScrModes-0_35'
@
text
@d23 1
@


4.9
log
@Retire VIDCBandwidthLimit command
Was previously for internal use only, but largely irrelevant as the majoirty of targets don't contain a VIDC, and those that do use a GraphicsV driver anyway.
* CMHG and resources updated to remove the command from the command/syntax table
* Don't bother probing OS_ReadSysInfo 2 for the video controller, assume it's always GraphicsV
* Don't try vetting modes based on VIDC limitations (leave that to VIDC20Video module)
* Don't listen to the kernel's bandwidth limit suggestion, always use INT32_MAX
Also
* Fix potential null pointer dereference if there's not enough RAM to build an ICONSPRITES command
* Rather than setting up an atexit() handler in the module init, just use a module finalisation handler
* Makefile tickled to not use Norcroft specific flags

Version 0.33. Tagged as 'ScrModes-0_33'
@
text
@a22 1
CFLAGS       += ${C_NO_FNAMES} ${C_MODULE}
@


4.8
log
@Makefile correction
Resources go in 'ScreenMode' not 'ScrModes'.
Retagged as 'ScrModes-0_32'.
@
text
@d23 1
a23 1
CFLAGS       += -ff -zM
@


4.7
log
@Clean up pass
* Makefile recreated from fragments
* Swap to C99 types, remove 'machtypes.h'
* Use centralised SWI and service call definitions, remove 'newswis.h' and 'services.h'
* Error E21 taken out of resources, CMHG generates this one for free
* Compiler warnings squashed

Version 0.32. Tagged as 'ScrModes-0_32'
@
text
@d26 1
@


4.6
log
@Replace "-wipe" with "x wipe" in makefiles to remove annoying errors.

Version 0.31. Tagged as 'ScrModes-0_31'
@
text
@a16 7
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 25-May-94  AMcC         Created.
#
d18 8
a25 4
#
# Paths
#
EXP_HDR = <export$dir>
d27 1
a27 113
#
# Generic options:
#
MKDIR   = cdir
AS      = objasm
CC      = cc
CMHG    = cmhg
CP      = copy
LD      = link
RM      = remove
WIPE    = x wipe

AFLAGS = -depend !Depend -Stamp -quit
CFLAGS  = -c -depend !Depend -ff -zM ${INCLUDES} ${DFLAGS}
CPFLAGS = ~cfr~v
WFLAGS  = ~c~v

#
# Libraries
#
CLIB      = CLIB:o.stubs
RLIB      = RISCOSLIB:o.risc_oslib
RSTUBS    = RISCOSLIB:o.rstubs
ROMSTUBS  = RISCOSLIB:o.romstubs
ROMCSTUBS = RISCOSLIB:o.romcstubs
ABSSYM    = RISC_OSLib:o.AbsSym

#
# Include files
#
INCLUDES = -IC:

DFLAGS   = -DDODEBUG=0

#
# Program specific options:
#
COMPONENT = ScrModes
TARGET    = aof.ScrModes
OBJS      = ScrModes.o ScrModesv.o
EXPORTS   = ${EXP_HDR}.${COMPONENT}

#
# Rule patterns
#
.c.o:;      ${CC} ${CFLAGS} -o $@@ $<
.cmhg.o:;   ${CMHG} -p -o $@@ $<
.s.o:;      ${AS} ${AFLAGS} $< $@@

#
# build a relocatable module:
#
all: rm.ScrModes

#
# RISC OS ROM build rules:
#
rom: ${TARGET}
        @@echo ${COMPONENT}: rom module built

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

install: rm.ScrModes
        ${MKDIR} ${INSTDIR}
        ${CP} rm.ScrModes ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: ram module installed

clean:
        ${WIPE} o.* ${WFLAGS}
        ${WIPE} rm.* ${WFLAGS}
        ${WIPE} linked.* ${WFLAGS}
        ${RM} ${TARGET}
        @@echo ${COMPONENT}: cleaned

resources: resources-${CMDHELP}
        @@echo ${COMPONENT}: resource files copied

resources_common:
        ${MKDIR} ${RESDIR}.ScreenMode
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.ScreenMode.Messages  ${CPFLAGS}

resources-None: resources_common
	@@

resources-: resources_common
	TokenCheck LocalRes:CmdHelp
	print LocalRes:CmdHelp { >> ${RESDIR}.ScreenMode.Messages }

#
# ROM target (re-linked at ROM Image build time)
#
${TARGET}: ${OBJS} ${ROMCSTUBS}
        ${LD} -o $@@ -aof ${OBJS} ${ROMCSTUBS}

#
# Final link for the ROM Image (using given base address)
#
rom_link:
        ${LD} -o linked.${COMPONENT} -rmf -base ${ADDRESS} ${TARGET} ${ABSSYM}
        ${CP} linked.${COMPONENT} ${LINKDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: rom_link complete

rm.ScrModes: ${OBJS} ${CLIB}
        ${LD} -o $@@ -module ${OBJS} ${CLIB}

${EXP_HDR}.${COMPONENT}: hdr.${COMPONENT}
        ${CP} hdr.${COMPONENT} $@@ ${CPFLAGS}
@


4.5
log
@  Makefile improvements.
Detail:
  * Added/fixed the install rule for disc builds as required for the Baseline
    builds.
  * The MkClean file now calls stripdepnd to remove dynamic dependencies.
Admin:
  Builds and installs.

Version 0.29. Tagged as 'ScrModes-0_29'
@
text
@d40 1
a40 1
WIPE    = -wipe
@


4.4
log
@Now attempts to substitute a 1bpp mode for unknown mode numbers passed to
Service_ModeTranslation - previously just left it to the Kernel, which would
select mode 25 with hilarious results on an NC/STB.

Version 0.27. Tagged as 'ScrModes-0_27'
@
text
@d97 5
@


4.3
log
@Added support for "external_clock" keyword - if specified, gives the
frequency of HCLK, and instructs the kernel to use it instead of the VCO.
Corresponds to video control parameter 9 (PRM 5a-126).

Version 0.21. Tagged as 'ScrModes-0_21'
@
text
@d43 1
a43 1
CFLAGS  = -c -depend !Depend -zM ${INCLUDES} ${DFLAGS}
@


4.2
log
@Makefile changed to use LocalRes$Path and Link 5.08.
German resources imported.
Spinner branch merged.
Changed to use srccommit.

Version 0.20. Tagged as 'ScrModes-0_20'
@
text
@a139 9
o.ScrModes:	c.ScrModes
o.ScrModes:	C:h.kernel
o.ScrModes:	C:h.swis
o.ScrModes:	h.newswis
o.ScrModes:	h.errors
o.ScrModes:	h.services
o.ScrModes:	h.monitors
o.ScrModes:	h.machtypes
o.ScrModes:	h.modex
@


4.1
log
@Initial revision
@
text
@d76 1
a76 1
.cmhg.o:;   ${CMHG} -o $@@ $<
a100 1
        ${WIPE} map.* ${WFLAGS}
d104 4
a107 1
resources:
d109 9
a117 2
        ${CP} Resources.${LOCALE}.Messages  ${RESDIR}.ScreenMode.Messages  ${CPFLAGS}
        @@echo ${COMPONENT}: resource files copied
d129 1
a129 2
        ${LD} -o linked.${COMPONENT} -map -bin -base ${ADDRESS} ${TARGET} ${ABSSYM} > map.${COMPONENT}
        truncate map.${COMPONENT} linked.${COMPONENT}
@


4.1.4.1
log
@Removed dynamic dependancies from Makefiles and removed all reference to Prefix
@
text
@d132 9
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@Command line messages removed
@
text
@d105 1
a105 4
resources: resources-${CMDHELP}
        @@echo ${COMPONENT}: resource files copied

resources_common:
d108 1
a108 6

resources-None: resources_common
	@@

resources-: resources_common
	print Resources.${LOCALE}.CmdHelp { >> ${RESDIR}.${COMPONENT}.Messages }
@


4.1.7.3
log
@Fixed export of command line help to correct directory.
@
text
@d116 1
a116 1
	print Resources.${LOCALE}.CmdHelp { >> ${RESDIR}.ScreenMode.Messages }
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
