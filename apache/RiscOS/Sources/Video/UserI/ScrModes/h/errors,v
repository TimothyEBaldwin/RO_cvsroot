head	4.6;
access;
symbols
	ScrModes-0_71:4.6
	ScrModes-0_70:4.6
	ScrModes-0_69:4.6
	ScrModes-0_68:4.6
	ScrModes-0_67:4.6
	ScrModes-0_66:4.5
	ScrModes-0_65:4.5
	ScrModes-0_64:4.5
	ScrModes-0_62:4.5
	ScrModes-0_61:4.5
	ScrModes-0_60:4.5
	ScrModes-0_59:4.5
	ScrModes-0_58:4.5
	ScrModes-0_57:4.5
	ScrModes-0_56-smalltables:4.5
	ScrModes-0_56:4.5
	ScrModes-0_55-mallocfree:4.5
	ScrModes-0_55-cvs3fix:4.5
	ScrModes-0_55:4.5
	ScrModes-0_53-split:4.5
	ScrModes-0_54:4.5
	ScrModes-0_53-tables:4.5
	ScrModes-0_53:4.4
	ScrModes-0_52:4.4
	ScrModes-0_51:4.4
	ScrModes-0_50:4.4
	ScrModes-0_49:4.4
	ScrModes-0_48:4.3
	ScrModes-0_47:4.3
	ScrModes-0_46:4.3
	ScrModes-0_45:4.3
	ScrModes-0_44:4.3
	ScrModes-0_43:4.3
	ScrModes-0_42:4.3
	ScrModes-0_41:4.3
	ScrModes-0_40:4.3
	ScrModes-0_39:4.3
	ScrModes-0_38:4.2
	ScrModes-0_37:4.2
	ScrModes-0_36:4.2
	ScrModes-0_35:4.2
	ScrModes-0_34:4.2
	ScrModes-0_33:4.2
	ScrModes-0_32:4.2
	ScrModes-0_31:4.1
	RO_5_07:4.1
	ScrModes-0_30:4.1
	ScrModes-0_29:4.1
	ScrModes-0_28:4.1
	dellis_autobuild_BaseSW:4.1
	ScrModes-0_27:4.1
	ScrModes-0_26:4.1
	sbrodie_sedwards_16Mar2000:4.1
	ScrModes-0_25:4.1
	ScrModes-0_24:4.1
	dcotton_autobuild_BaseSW:4.1
	ScrModes-0_23:4.1
	ScrModes-0_22:4.1
	ScrModes-0_21:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	ScrModes-0_20:4.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_NC2_Generic:4.1.7.1
	afrost_Funai01-33:4.1.7.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.6
date	2017.07.11.21.12.06;	author jlee;	state Exp;
branches;
next	4.5;
commitid	emGX2N9I3ony5RYz;

4.5
date	2016.05.14.12.40.25;	author rool;	state Exp;
branches;
next	4.4;
commitid	UkO7RI5AYo6IQr6z;

4.4
date	2015.11.29.20.34.58;	author jlee;	state Exp;
branches;
next	4.3;
commitid	X917PzTaosbDQ1Ly;

4.3
date	2015.02.08.16.18.08;	author srevill;	state Exp;
branches;
next	4.2;
commitid	diy9pjBgTsmrSd9y;

4.2
date	2012.07.14.19.39.02;	author rsprowson;	state Exp;
branches;
next	4.1;
commitid	YTNC4KmzhMQIazcw;

4.1
date	96.11.05.09.46.31;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.46.31;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.02.50.50;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.13.02.08;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.24.12;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.6
log
@Make EDID handling more robust
Detail:
  c/edidsupport:
  - Make readedid() check that the EDID has a valid header. Previously only the checksum was checked, which is wholly insufficient (e.g. an EDID block full of null bytes would be considered valid). loadedid() also updated for consistency, although with the current code the header will have already been detected by loadmodefile().
  - Add some extra checks to readedidblock() to cope with more situations in which the GraphicsV call could fail. Fix confusing comment/code ordering.
  h/errors, Resources/Germany/Messages, Resources/UK/Messages - Add new "Invalid EDID block" error, for use when no valid header is found
Admin:
  Tested on Raspberry Pi 3
  Booting an EDID-enabled Pi without a monitor (and with the broken BCMVideo 0.47) no longer results in an (unintelligible) error box on entry to the desktop + system stuck in mode 0
  However, note that other issues in the boot sequence mean that booting with EDID enabled and no monitor still isn't 100% working (PreDesk Repeat will terminate early, potentially skipping some directories)


Version 0.67. Tagged as 'ScrModes-0_67'
@
text
@/* Copyright 1996 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* errors.h */

#define ERROR_BASE 0x00000BE0           /* now claimed in Hdr.NewErrors */

/* This file must be kept consistent with the Messages file */
#define ERR_OPENFAIL       0    /* File '%0' could not be opened */
#define ERR_NOSPACE        1    /* RMA allocation failed */
#define ERR_INCONSISTENT   2    /* Inconsistent parameters for mode '%1' in file %0 */
#define ERR_EOF            3    /* Unexpected end of file at line %1 of file %0 */
#define ERR_EXPCHAR        4    /* Character '%2' was expected at line %1 of file %0 */
#define ERR_VALUEOVF       5    /* Overlarge value for parameter at line %1 of file %0 */
#define ERR_EXTRAINPUT     6    /* Extraneous trailing input at line %1 of file %0 */
#define ERR_EXPNUM         7    /* Number expected at line %1 of file %0 */
#define ERR_EXPKEY         8    /* Keyword %2 was expected at line %1 of file %0 */
#define ERR_REPKEY         9    /* Keyword %2 repeated at line %1 of file %0 */
#define ERR_NOMODENAME    10    /* No mode_name field in mode ending at line %1 of file %0 */
#define ERR_INCOMPLETE    11    /* Incomplete definition for mode '%2' in file %0 */
#define ERR_UNKNOWNPAR    12    /* Unknown parameter name at line %1 of file %0 */
#define ERR_WRONGCONTEXT  13    /* Wrong context for keyword '%2' at line %1 of file %0 */
#define ERR_UNKNOWNFMT    14    /* Unknown file format code at line %1 of file %0 */
#define ERR_BLANKMONTITLE 15    /* Blank monitor title given at line %1 of file %0 */
#if 0
#define ERR_BLANKMODENAME 16    /* Blank mode name at line %1 of file %0 */
#define ERR_DUPMODENAME   17    /* Duplicate mode name '%1' in file %0 */
#endif
#define ERR_NOMODES       18    /* No mode definitions found in file %0 */
#define ERR_INVALIDPAR    19    /* Invalid parameter value at line %1 of file %0 */
#define ERR_NOMODEFILE    20    /* No monitor description file loaded */
#if 0
#define ERR_UNKNOWNSWI    21    /* SWI value out of range for module ScreenModes */
#endif
#define ERR_BADREADINFO   22    /* Unknown ScreenModes_ReadInfo call */
#define ERR_EXPNUM2       23    /* Number expected */
#define ERR_VALUEOVF2     24    /* Overlarge value for parameter */
#define ERR_BADCHECKSUM   25    /* EDID Checksum failed */
#define ERR_CANTREADEDID  26    /* Cannot read EDID */
#define ERR_IICOPFAIL     27    /* IICStatus reported an error reading EDID */
#define ERR_BADENUMAUDIO  28    /* Bad ScreenModes_EnumerateAudioFormats flags */
#define ERR_INVALIDEDID   29    /* Invalid EDID block */

/* EOF errors.h */

@


4.5
log
@Split out data tables, stylistic refactoring
Detail:
  Move the 500+ lines of tables into a new source file and remove storage inferred by former CEAModes.h.
  Tame some of the rampant style from various authors, even within 1 function, to something reasonably consistent.
  Uppercase the 'debug' macro to 'IFDEBUG'.
  Relocate ScrModes specific defines out of EDIDModes header, rename to edidmemory.h.
  Add monitor type 6 to monitors.h.
  Fix for unguarded debug printout "Can't allocate space for monitor list" in parseedid.
Admin:
  Tested briefly, functionality unchanged.
  Submission for the EDID bounty.
  Tagged as ScrModes-0_53-tables
@
text
@d53 1
@


4.4
log
@Add support for parsing and reporting the contents of CEA 861-D audio-related EDID blocks
Detail:
  Makefile - Export a C version of hdr/ScrModes
  Resources/Germany/Messages, Resources/UK/Messages, h/errors - Add new error message
  cmhg/ScrModesv, hdr/ScrModes - Declare existence of ScreenModes_EnumerateAudioFormats SWI. Declare ScreenModes_ReadInfo reason codes.
  h/modex - Extend MonitorDefinition struct to allow it to store the speaker mask & audio format information that's extracted from the EDID
  c/ScrModes - Extend support for processing of CEA extension blocks. All block revisions > 0 should now be accepted, and rudimentary parsing of CEA data block collections is implemented (currently, only extracts information from audio related blocks). Add SWI ScreenModes_EnumerateAudioFormats to allow details of the supported formats to be returned in either "raw" or "friendly" forms. Add ScreenModes_ReadInfo reason code 1 to allow reading of the speaker mask (+ validity bits). Also fix *LoadModeFile to allow EDID blocks to be loaded without first having to issue *ReadEDID first (EDIDEnabled flag issue).
Admin:
  Tested on iMX6 with assorted EDID blocks
  German messages file in need of translation


Version 0.49. Tagged as 'ScrModes-0_49'
@
text
@d51 1
a51 1
#define ERR_IICOPFAIL     27    /* IICStatus reported an error reading EDID*/
@


4.3
log
@Added prototype EDID support code.

This should be considered beta-quality work-in-progress code that gives us a
new *command (ReadEDID) that attempts to read the list of supported display
mode information from a connected monitory and configure the system for it,
as if an MDF file had been loaded containing that information.

Admin:

Community testing is required for this feature. Please try replacing the
LoadModeFile line in your !Boot.Choices.Boot.PreDesk.Configure.Monitor
file with a line saying "ReadEDID". If you get a sensible looking list
of modes when the machine boots, then things should be OK. If you see an
error, please get in touch with ROOL on the "Bounties - ReadEDID" topic.
You'll clearly need to be running a ROM with this version of ScreenModes
in it!

Version 0.39. Tagged as 'ScrModes-0_39'
@
text
@d52 1
@


4.2
log
@Clean up pass
* Makefile recreated from fragments
* Swap to C99 types, remove 'machtypes.h'
* Use centralised SWI and service call definitions, remove 'newswis.h' and 'services.h'
* Error E21 taken out of resources, CMHG generates this one for free
* Compiler warnings squashed

Version 0.32. Tagged as 'ScrModes-0_32'
@
text
@d49 3
@


4.1
log
@Initial revision
@
text
@d43 1
d45 1
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
