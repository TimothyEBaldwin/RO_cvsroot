head	4.19;
access;
symbols
	Colours-1_95:4.19
	Colours-1_94:4.18
	Colours-1_93:4.18
	Colours-1_92:4.18
	Colours-1_91:4.18
	Colours-1_90:4.18
	Colours-1_89:4.18
	Colours-1_88:4.18
	Colours-1_87:4.18
	Colours-1_86:4.18
	Colours-1_85:4.18
	Colours-1_84:4.16
	Colours-1_83:4.15
	Colours-1_82:4.15
	Colours-1_81:4.14
	Colours-1_80:4.14
	Colours-1_79:4.13
	Colours-1_78:4.12
	Colours-1_77:4.12
	Colours-1_76:4.11
	RO_5_07:4.10
	Colours-1_75:4.9
	Colours-1_74:4.8
	Colours-1_73:4.7
	Colours-1_72:4.6
	dellis_autobuild_BaseSW:4.6
	Colours-1_71:4.6
	Colours-1_70:4.6
	Colours-1_69:4.6
	sbrodie_sedwards_16Mar2000:4.6
	dcotton_autobuild_BaseSW:4.9
	Colours-1_68:4.6
	Colours-1_67:4.5
	Ursula_merge:4.2.2.2
	nturton_Colours-1_65:4.4
	dcotton_colours_MPTInitialBuild:4.1.7.2
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2.2.2.2.1
	Ursula_RiscPC:4.2.2.2.0.2
	rthornb_UrsulaBuild-19Aug1998:4.2.2.2
	UrsulaBuild_FinalSoftload:4.2.2.2
	rthornb_UrsulaBuild-12Aug1998:4.2.2.2
	aglover_UrsulaBuild-05Aug1998:4.2.2.2
	rthornb_UrsulaBuild-29Jul1998:4.2.2.2
	rthornb_UrsulaBuild-22Jul1998:4.2.2.2
	rthornb_UrsulaBuild-15Jul1998:4.2.2.2
	rthornb_UrsulaBuild-07Jul1998:4.2.2.2
	rthornb_UrsulaBuild-17Jun1998:4.2.2.2
	rthornb_UrsulaBuild-03Jun1998:4.2.2.2
	rthornb_UrsulaBuild-27May1998:4.2.2.2
	rthornb_UrsulaBuild-21May1998:4.2.2.2
	rthornb_UrsulaBuild_01May1998:4.2.2.2
	afrost_Funai01-33:4.1.7.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.2.0.6
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.2
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.19
date	2016.05.29.15.00.28;	author rsprowson;	state Exp;
branches;
next	4.18;
commitid	s5XX49QiIIkg9o8z;

4.18
date	2013.05.22.20.20.37;	author rsprowson;	state Exp;
branches;
next	4.17;
commitid	MAl9mKqgdm8BmFQw;

4.17
date	2013.02.11.08.14.31;	author rsprowson;	state Exp;
branches;
next	4.16;
commitid	fsgIEEtgergszKDw;

4.16
date	2013.02.09.18.42.45;	author rsprowson;	state Exp;
branches;
next	4.15;
commitid	XLAcAYecDjGX6yDw;

4.15
date	2012.02.19.22.30.00;	author jlee;	state Exp;
branches;
next	4.14;
commitid	QerGMp2mSmpoOOTv;

4.14
date	2011.12.07.00.01.46;	author jlee;	state Exp;
branches;
next	4.13;
commitid	27mvDhzFumslJbKv;

4.13
date	2011.09.21.20.57.46;	author jlee;	state Exp;
branches;
next	4.12;
commitid	frd3o2x5DhvG9pAv;

4.12
date	2009.06.13.22.50.25;	author bavison;	state Exp;
branches;
next	4.11;

4.11
date	2004.11.09.18.39.50;	author bavison;	state Exp;
branches;
next	4.10;

4.10
date	2004.07.11.19.57.58;	author srevill;	state Exp;
branches;
next	4.9;

4.9
date	2001.05.14.15.16.00;	author sbrodie;	state Exp;
branches;
next	4.8;

4.8
date	2000.12.07.14.43.50;	author sbrodie;	state Exp;
branches;
next	4.7;

4.7
date	2000.12.07.12.18.35;	author sbrodie;	state Exp;
branches;
next	4.6;

4.6
date	99.08.18.12.51.30;	author rthornb;	state Exp;
branches;
next	4.5;

4.5
date	99.08.05.09.51.54;	author kbracey;	state Exp;
branches;
next	4.4;

4.4
date	98.10.29.14.24.38;	author nturton;	state Exp;
branches;
next	4.3;

4.3
date	98.10.29.12.48.32;	author nturton;	state Exp;
branches;
next	4.2;

4.2
date	97.01.21.17.49.12;	author nturton;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.42.04;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.2.2.1
date	98.03.26.14.45.27;	author rthornb;	state Exp;
branches;
next	4.2.2.2;

4.2.2.2
date	98.04.15.07.03.31;	author mstphens;	state Exp;
branches
	4.2.2.2.2.1;
next	;

4.2.2.2.2.1
date	98.11.20.20.16.53;	author aglover;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.42.04;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.02.06.09;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.47.19;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.10.16;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	98.09.16.17.12.26;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.19
log
@Remove use of RESOURCEEXTRA
Requires BuildSys-6_91.

Version 1.95. Tagged as 'Colours-1_95'
@
text
@# Copyright 1996 Acorn Computers Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for Colour Translation module
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 25-May-94  AMcC         Created.
# 10-Mar-95  GPS          Changed method for building ROM tables.
# 14-May-01  SNB          Changed to used fragment makefiles
#

COMPONENT = ColourTrans
TARGET    = Colours
ROM_SOURCE = MakeNew
HEADER1   = ColourTran
INSTRES_FILES = Tables.4greys:Tables   Palettes.4greys:Palettes \
                Tables.8greys:Tables   Palettes.8greys:Palettes \
                Tables.4desktop:Tables Palettes.4desktop:Palettes \
                Tables.8desktop:Tables Palettes.8desktop:Palettes
INSTRES_DEPENDS = MakeTables

include StdTools
include AAsmModule

clean::
        ${XWIPE} Tables.* ${WFLAGS}
        ${XWIPE} Palettes.* ${WFLAGS}
        ${XWIPE} MkTables.o.* ${WFLAGS}
        ${RM} MkTables.maketables

#
# Static dependencies:
#
MakeTables: MkTables.maketables
        ${XWIPE} Tables.* ${WFLAGS}
        ${RUN}MkTables.maketables @@
        ${SQUASH} Tables.4greys
        ${SQUASH} Tables.8greys  
        ${SQUASH} Tables.4desktop

MkTables.maketables: MkTables.c.maketables
        ${CD} MkTables
        ${MAKE} -f maketables/mk COMPONENT=maketables THROWBACK=${THROWBACK}
        ${CD} ^

# Dynamic dependencies:
@


4.18
log
@Makefile tweak
Exporting resources twice without a clean would give an error from squash, because squash sets the filetype to 'squash', but maketables just truncates the tables it makes (preserving the filetype) so on the second time around squash thinks you want to decompress what is infact a palette table.
Retagged as Colours-1_85.
@
text
@a28 1

d31 5
a35 2

RESOURCEEXTRA = resources-colourtrans
a39 13
#
# Binary build environment
#
# Enhance the export rule to include the Tables and MkTables directories
BBETYPE   = local
bbe-local: bbe-generic
  BBE_Export_Dir Tables
  BBE_Export_Dir MkTables
  BBE_Export_Dir Palettes

#
# Generic rules:
#
d46 4
a49 1
resources-colourtrans: MkTables.maketables
a54 4
        ${MKDIR} ${RESFSDIR}
        ${CP} Palettes ${RESFSDIR}.* ${CPFLAGS}
        ${CP} Tables   ${RESFSDIR}.* ${CPFLAGS}
        @@echo ${COMPONENT}: extra resource files copied
@


4.17
log
@Rework maketables to not need ColourTrans loaded at build time
During generation of the 32k colour lookup tables, the tool already has to hand the 5:5:5 RGB value and 8:8:8 RGB palette, so can do the colour lookup itself. This removes the need to build a platform agnostic ColourTrans module, it's just C code.
* Replace make_32k_table() with brute force colour matcher
* Use <stdio.h> functions to write out the output, change to use <stdint.h>
* Simplify top level makefile
* Header.s: minor warning squashed
Binary output compared with Colours-1_83.

Version 1.85. Tagged as 'Colours-1_85'
@
text
@d53 1
a54 1
        ${XWIPE} Palettes.* ${WFLAGS}
a55 1
        ${RM} MkTables.module
d58 1
@


4.16
log
@Use machine '32' when generating MakeTables
Previously 'All32' was used, but since HdrSrc-2_24 that no longer has sight of STB or HAL switches so the temporary module didn't build properly during the resources phase. It's still all a bit yucky.
Tidied 2 easy warnings in MakeTables.

Version 1.84. Tagged as 'Colours-1_84'
@
text
@a34 1

a36 1
include AppLibs
a56 1
        @@echo ${COMPONENT}: cleaned
d58 5
a62 1
resources-colourtrans: Palettes.8desktop
d68 1
a68 1
MkTables.maketables:   MkTables.c.maketables
a72 22
MkTables.module: MkTables.o.module
        ${LD} -rmf -o $@@ MkTables.o.module

# Manually build a version which should be safe to softload on the host
# (assuming the host is running RISC OS!)
# This is all very nasty
MkTables.o.module: MkTables.o._dirs
        set OldMachine <Machine>
        set Machine 32
        %objasm -APCS 3/32bit -cpu 3 -Stamp -quit -depend !Depend -ihdr -i<Hdr$Dir>.Global -i<Hdr$Dir>.Interface -i<Hdr$Dir>.Interface2 -pd "APCS SETS \"APCS-32\"" -pd "Machine SETS \"32\"" -o $@@ ${ROM_SOURCE} -PD "standalone SETL {TRUE}"
        set Machine <OldMachine>         

Palettes.8desktop: MkTables.maketables MkTables.module
        rmload MkTables.module
        ${RUN}MkTables.maketables @@
        ${SQUASH} Tables.4greys
        ${SQUASH} Tables.8greys  
        ${SQUASH} Tables.4desktop
        
MkTables.o._dirs:
        ${MKDIR} MkTables.o

@


4.15
log
@Disable squashing of 8desktop file
Detail:
  Makefile - Don't squash the 8desktop file, because the InverseTable module references it directly and doesn't expect it to be squashed.
Admin:
  Tested with Iyonix ROM softload
  Fixes corrupt blended fonts in 8bpp modes


Version 1.82. Tagged as 'Colours-1_82'
@
text
@d80 2
a81 2
        set Machine All32
        %objasm -APCS 3/32bit -cpu 3 -Stamp -quit -depend !Depend -ihdr -i<Hdr$Dir>.Global -i<Hdr$Dir>.Interface -i<Hdr$Dir>.Interface2 -pd "APCS SETS \"APCS-32\"" -pd "Machine SETS \"All32\"" -o $@@ ${ROM_SOURCE} -PD "standalone SETL {TRUE}"
@


4.14
log
@Squash the 4desktop and 8desktop colour tables
Detail:
  Makefile - Squeeze some more space from the Iyonix ROM image by squashing the 4desktop and 8desktop colour tables. Also use ${SQUASH} utility instead of custom dosqueeze utility.
  MkTables/dosqueeze,ffb - Delete obsolete squash utility
Admin:
  Tested in Iyonix ROM softload


Version 1.80. Tagged as 'Colours-1_80'
@
text
@a89 1
        ${SQUASH} Tables.8desktop
@


4.13
log
@Make ColourTrans safe to build
Detail:
  Previously ColourTrans was softloading the ROM version of itself as part of the process of generating the 4/8bpp colour tables.
  However with objasm 4 supporting the use of the ARMv6 MOVW, etc. instructions for generating immediate constants, this can cause the host to lock up if running on an older CPU.
  To fix this, the makefile now builds an extra copy of the module targeting the 'All32' machine, which should be safe to softload on any reasonable (RISC OS) host.
Admin:
  Tested with OMAP ROM build on Iyonix with objasm 4. No more nasty crash/hang.


Version 1.79. Tagged as 'Colours-1_79'
@
text
@d86 5
a90 4
        ${RUN}MkTables.maketables @@  
        settype Tables.8greys text
        settype Tables.4greys text
        ${RUN}MkTables.dosqueeze
@


4.12
log
@  Build fix
Detail:
  The build utility MkTables.maketables, compiled at build time, is now built
  using the HostTools shared makefile, and so will execute on any RISC OS
  build host even if the default compiler options are to target an
  incompatible ARM architecture.
Admin:
  Tested using an APCS-R build on an Iyonix.

Version 1.76. Not tagged
@
text
@d58 1
d72 14
a85 2
Palettes.8desktop: MkTables.maketables ${ROM_MODULE}
        ifthere ${ROM_MODULE} then rmload ${ROM_MODULE} else rmload rm.${TARGET}
@


4.11
log
@Since the just-built ColourTrans module is loaded in the resources phase,
the makefile needs to e aware that the module binary is in a different
location during a BBE build than it is in a native build.

Retagged since this won't affect code generation for existing builds.
@
text
@d66 4
a69 5
MkTables.o.maketables: MkTables.c.maketables
        ${CC} $(ccflags) -c -o $@@ MkTables.c.maketables

MkTables.maketables:   MkTables.o.maketables ${CLIB} MkTables.o._dirs
        link $(linkflags) -o $@@ MkTables.o.maketables ${CLIB}
d73 1
a73 1
        MkTables.maketables @@  
d76 1
a76 1
        MkTables.dosqueeze
@


4.10
log
@  Changed makefile to clean more quietly.
Admin:
  Tested in STB Baseline build.

Version 1.76. Tagged as 'Colours-1_76'
@
text
@d73 1
a73 1
        rmload ${ROM_MODULE}
@


4.9
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.72 or later.
  Requires BuildSys 3.09 or later.
  Requires Env 0.65 or later.

Version 1.75. Tagged as 'Colours-1_75'
@
text
@d54 3
a56 3
        ${WIPE} Tables.* ${WFLAGS}
        ${WIPE} MkTables.o.* ${WFLAGS}
        ${WIPE} Palettes.* ${WFLAGS}
@


4.8
log
@BBE export requires the Palettes directory too.
Tested in BBE - exported BBE can now rebuild ColourTrans resources.

Version 1.74. Tagged as 'Colours-1_74'
@
text
@d24 1
d27 8
a34 4
#
# Paths
#
EXP_HDR = <export$dir>
d36 3
a38 21
#
# Generic options:
#
MKDIR   = cdir
AS      = aasm
CP      = copy
CC      = cc
RM      = remove
WIPE    = -wipe
CCFLAGS = -c -depend !Depend -IC:
ASFLAGS = -depend !Depend -Stamp -quit -module -To $@@ -From
CPFLAGS = ~cfr~v
WFLAGS  = ~CR~V
CLIB    = CLIB:o.stubs
#
# Program specific options:
#
COMPONENT = Colours
SOURCE    = MakeNew
TARGET    = rm.Colours
EXPORTS   = ${EXP_HDR}.ColourTran
d53 1
a53 12
rom: ${TARGET}
        @@echo ${COMPONENT}: rom module built

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

clean:
        ${RM} ${TARGET}
d60 5
a64 17
resources: Palettes.8desktop
        ${MKDIR} ${RESDIR}.${COMPONENT}
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${COMPONENT}.Messages ${CPFLAGS}
        ${CP} Palettes ${RESDIR}.${COMPONENT}.Palettes ${CPFLAGS}
        ${CP} Tables   ${RESDIR}.${COMPONENT}.Tables   ${CPFLAGS}
        @@echo ${COMPONENT}: resource files copied

${TARGET}: ${SOURCE}
        ${AS} ${ASFLAGS} ${SOURCE}

${EXP_HDR}.ColourTran: hdr.ColourTran
        ${CP} hdr.ColourTran $@@ ${CPFLAGS}

Colours200: MakeOld
        ${AS} ${ASFLAGS} MakeOld
        @@echo ${COMPONENT}: Colours200 built
d67 1
a67 1
        ${CC} $(ccflags) -o $@@ MkTables.c.maketables
d72 2
a73 2
Palettes.8desktop: MkTables.maketables rm.Colours
        rmload rm.Colours
@


4.7
log
@  Added Binary Build Environment rules to Makefile.
Detail:
  The new binary build rules are experimental.  They augment the resource
    export by ensure that the support software and files that are required
    by the resources phase are installed in the BBE.
Admin:
  Tested in experimental context only - will not affect other builds.

Version 1.73. Tagged as 'Colours-1_73'
@
text
@d61 1
@


4.6
log
@Modified Makefile to create the object directory within MkTables as without
this the build fails.

Version 1.68. Tagged as 'Colours-1_68'
@
text
@d54 9
@


4.5
log
@Spinner and Ursula branches merged.
Changed to use srccommit.

Version 1.67. Tagged as 'Colours-1_67'
@
text
@d95 1
a95 1
MkTables.maketables:   MkTables.o.maketables ${CLIB} 
d105 3
@


4.4
log
@Palettes directory now cleaned.
@
text
@d76 2
a77 1
        ${CP} Resources.${LOCALE}.Messages  ${RESDIR}.${COMPONENT}.Messages ${CPFLAGS}
@


4.3
log
@Module cleaned.  Dynamic dependencies removed.
@
text
@d70 1
@


4.2
log
@Version Spin_merge taken
@
text
@d39 1
d43 1
d68 3
a103 44
MkTables.o.maketables:	MkTables.c.maketables
MkTables.o.maketables:	C:h.swis
MkTables.o.maketables:	C:h.kernel
rm.Colours: s.Header
rm.Colours: hdr:ListOpts
rm.Colours: hdr:Macros
rm.Colours: hdr:System
rm.Colours: Hdr:SWIs
rm.Colours: Hdr:CPU.Generic26
rm.Colours: Hdr:IO.GenericIO
rm.Colours: Hdr:RISCOS
rm.Colours: hdr:FSNumbers
rm.Colours: hdr:ModHand
rm.Colours: hdr:NewErrors
rm.Colours: hdr:VduExt
rm.Colours: hdr:Services
rm.Colours: hdr:Font
rm.Colours: hdr:Sprite
rm.Colours: hdr:PublicWS
rm.Colours: hdr:ExtraLong
rm.Colours: hdr:Proc
rm.Colours: hdr:MsgTrans
rm.Colours: hdr:DDVMacros
rm.Colours: hdr:PaletteV
rm.Colours: hdr:ColourTran
rm.Colours: hdr:Symbols
rm.Colours: hdr:HostFS
rm.Colours: hdr:variables
rm.Colours: hdr:NDRDebug
rm.Colours: Version
rm.Colours: s.Commons
rm.Colours: s.MainSWIs
rm.Colours: s.Cache
rm.Colours: s.FontColour
rm.Colours: s.Dither
rm.Colours: s.NewModels
rm.Colours: s.Palettes
rm.Colours: s.MsgCode
rm.Colours: s.FileCal
rm.Colours: s.Calibrate
rm.Colours: s.DevicePal
rm.Colours: s.DevicePal2
rm.Colours: s.Enhanced
rm.Colours: s.Tables32K
@


4.2.2.1
log
@Removed dynamic dependancies from Makefiles and removed all reference to Prefix
@
text
@d99 44
@


4.2.2.2
log
@update to ursula service format
@
text
@a98 1

@


4.2.2.2.2.1
log
@Makefile edits and various plumbing to make the darn thing build
@
text
@a91 1
        ${MKDIR} Tables
d99 1
@


4.1
log
@Initial revision
@
text
@d99 3
a142 3
MkTables.o.maketables:	MkTables.c.maketables
MkTables.o.maketables:	C:h.swis
MkTables.o.maketables:	C:h.kernel
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@a98 3
MkTables.o.maketables:	MkTables.c.maketables
MkTables.o.maketables:	C:h.swis
MkTables.o.maketables:	C:h.kernel
d140 3
@


4.1.7.2
log
@Modified Makefile to use LocalRes$Path.
@
text
@d70 1
a70 2
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${COMPONENT}.Messages ${CPFLAGS}
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@a98 3
MkTables.o.maketables:	MkTables.c.maketables
MkTables.o.maketables:	C:h.swis
MkTables.o.maketables:	C:h.kernel
d140 3
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
