head	4.42;
access;
symbols
	Manager-3_80:4.42
	Manager-3_79:4.41
	Manager-3_78:4.40
	Manager-3_77:4.39
	Manager-3_76:4.38
	Manager-3_75:4.37
	Manager-3_74:4.36
	Manager-3_73:4.35
	Manager-3_72:4.34
	Manager-3_71:4.33
	Manager-3_70:4.32
	Manager-3_69:4.31
	Manager-3_68:4.30
	Manager-3_67:4.29
	Manager-3_66:4.28
	Manager-3_65:4.27
	Manager-3_64:4.26
	Manager-3_63:4.25
	Manager-3_62:4.23
	Manager-3_61:4.22
	Manager-3_60:4.21
	RO_5_07:4.19
	Manager-3_59:4.20
	Manager-3_58:4.19
	Manager-3_57:4.18
	Manager-3_56:4.17
	Manager-3_55:4.16
	Manager-3_54:4.15
	Manager-3_53:4.14
	Manager-3_52:4.13
	Manager-3_51:4.12
	Manager-3_50:4.11
	Manager-3_49:4.10
	dellis_autobuild_BaseSW:4.9
	Manager-3_48:4.9
	sbrodie_sedwards_16Mar2000:4.8
	dcotton_autobuild_BaseSW:4.12
	Manager-3_47:4.8
	Manager-3_46:4.7
	Manager-3_45:4.6
	Manager-3_44:4.5
	Manager-3_43:4.4
	Manager-3_42:4.3
	Manager-3_41-4_2_2_13:4.2.2.13
	Manager-3_41-4_2_2_12:4.2.2.12
	Manager-3_41-4_2_2_11:4.2.2.11
	Manager-3_41-4_2_2_10:4.2.2.10
	Manager-3_41-4_2_2_9:4.2.2.9
	Manager-3_41-4_2_2_8:4.2.2.8
	Manager-3_41-4_2_2_7:4.2.2.7
	Manager-3_41-4_2_2_6:4.2.2.6
	Manager-3_41-4_2_2_5:4.2.2.5
	Manager-3_41-4_2_2_4:4.2.2.4
	Manager-3_41-4_2_2_3:4.2.2.3
	Manager-3_41-4_2_2_2:4.2.2.2
	Manager-3_41-4_2_2_1:4.2.2.1
	NRaine:4.2.0.2
	Manager-3_41:4.2
	Manager-3_40-1_1_2_2:1.1.2.1
	smiddle_2Mar1998_Fonts16:1.1.0.2;
locks; strict;
comment	@# @;
expand	@v@;


4.42
date	2018.08.13.21.18.38;	author jlee;	state Exp;
branches;
next	4.41;
commitid	zwkox5zv4JSIk0OA;

4.41
date	2018.02.04.17.59.06;	author jlee;	state Exp;
branches;
next	4.40;
commitid	j2vB3tzLOoKUkzpA;

4.40
date	2017.02.28.22.10.06;	author rsprowson;	state Exp;
branches;
next	4.39;
commitid	BWhSeBzrqOpBGLHz;

4.39
date	2016.05.08.17.35.29;	author jlee;	state Exp;
branches;
next	4.38;
commitid	bwQAeF4Oae6iGH5z;

4.38
date	2014.07.23.00.08.55;	author jlee;	state Exp;
branches;
next	4.37;
commitid	4mXVca8vR5IBWqJx;

4.37
date	2013.08.06.23.55.02;	author jlee;	state Exp;
branches;
next	4.36;
commitid	XZW0yxi515Wl7s0x;

4.36
date	2012.05.07.17.58.36;	author bavison;	state Exp;
branches;
next	4.35;
commitid	ErorRftiYjkQNO3w;

4.35
date	2012.03.18.14.20.34;	author jlee;	state Exp;
branches;
next	4.34;
commitid	BYyyZaxMOobGcnXv;

4.34
date	2012.02.25.18.15.22;	author jlee;	state Exp;
branches;
next	4.33;
commitid	bMaGSllOAEo5dzUv;

4.33
date	2012.01.27.21.08.27;	author rsprowson;	state Exp;
branches;
next	4.32;
commitid	cFxHM94cGf7g6RQv;

4.32
date	2011.12.06.00.06.32;	author jlee;	state Exp;
branches;
next	4.31;
commitid	PU1uxpB734xYM3Kv;

4.31
date	2011.09.24.15.06.03;	author jlee;	state Exp;
branches;
next	4.30;
commitid	ktcX7FIigldY6LAv;

4.30
date	2011.09.23.23.27.33;	author jlee;	state Exp;
branches;
next	4.29;
commitid	qn68FelQVO4ZUFAv;

4.29
date	2011.07.24.21.50.12;	author jlee;	state Exp;
branches;
next	4.28;
commitid	JyO8c4ELgLkflPsv;

4.28
date	2010.01.02.19.35.09;	author rsprowson;	state Exp;
branches;
next	4.27;

4.27
date	2009.11.06.23.28.22;	author jlee;	state Exp;
branches;
next	4.26;

4.26
date	2009.07.06.16.50.33;	author jbell;	state Exp;
branches;
next	4.25;

4.25
date	2009.06.16.00.37.40;	author bavison;	state Exp;
branches;
next	4.24;

4.24
date	2009.06.11.22.02.42;	author bavison;	state Exp;
branches;
next	4.23;

4.23
date	2009.05.14.17.24.38;	author jbell;	state Exp;
branches;
next	4.22;

4.22
date	2008.06.06.00.24.38;	author bavison;	state Exp;
branches;
next	4.21;

4.21
date	2005.08.03.12.23.34;	author kbracey;	state Exp;
branches;
next	4.20;

4.20
date	2004.08.04.10.42.04;	author bavison;	state Exp;
branches;
next	4.19;

4.19
date	2004.02.16.15.30.02;	author kbracey;	state Exp;
branches;
next	4.18;

4.18
date	2003.05.13.23.00.02;	author rsprowson;	state Exp;
branches;
next	4.17;

4.17
date	2003.01.31.11.55.19;	author rsprowson;	state Exp;
branches;
next	4.16;

4.16
date	2002.12.18.22.14.53;	author kbracey;	state Exp;
branches;
next	4.15;

4.15
date	2002.04.12.12.50.53;	author kbracey;	state Exp;
branches;
next	4.14;

4.14
date	2002.02.22.13.31.52;	author kbracey;	state Exp;
branches;
next	4.13;

4.13
date	2001.11.12.14.59.57;	author kbracey;	state Exp;
branches;
next	4.12;

4.12
date	2001.05.10.15.26.51;	author kbracey;	state Exp;
branches;
next	4.11;

4.11
date	2001.03.23.17.09.22;	author sbrodie;	state Exp;
branches;
next	4.10;

4.10
date	2000.11.21.13.18.20;	author sbrodie;	state Exp;
branches;
next	4.9;

4.9
date	2000.05.12.12.39.43;	author kbracey;	state Exp;
branches;
next	4.8;

4.8
date	99.09.22.11.26.15;	author kbracey;	state Exp;
branches;
next	4.7;

4.7
date	99.08.03.17.31.34;	author kbracey;	state Exp;
branches;
next	4.6;

4.6
date	99.03.01.15.22.22;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	99.02.22.14.58.43;	author kbracey;	state Exp;
branches;
next	4.4;

4.4
date	99.02.22.12.00.06;	author kbracey;	state Exp;
branches;
next	4.3;

4.3
date	99.02.18.16.48.50;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	98.10.07.16.43.00;	author kbracey;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	98.10.07.16.37.39;	author kbracey;	state Exp;
branches;
next	1.1;

1.1
date	98.03.03.13.22.17;	author smiddle;	state dead;
branches
	1.1.2.1;
next	;

4.2.2.1
date	98.10.07.17.13.09;	author kbracey;	state Exp;
branches;
next	4.2.2.2;

4.2.2.2
date	98.10.08.12.20.38;	author kbracey;	state Exp;
branches;
next	4.2.2.3;

4.2.2.3
date	98.10.08.12.24.51;	author kbracey;	state Exp;
branches;
next	4.2.2.4;

4.2.2.4
date	98.10.09.08.57.38;	author kbracey;	state Exp;
branches;
next	4.2.2.5;

4.2.2.5
date	98.10.13.12.31.27;	author kbracey;	state Exp;
branches;
next	4.2.2.6;

4.2.2.6
date	98.10.19.15.57.08;	author kbracey;	state Exp;
branches;
next	4.2.2.7;

4.2.2.7
date	98.10.20.09.26.28;	author kbracey;	state Exp;
branches;
next	4.2.2.8;

4.2.2.8
date	98.10.20.10.47.09;	author kbracey;	state Exp;
branches;
next	4.2.2.9;

4.2.2.9
date	98.10.20.12.58.10;	author kbracey;	state Exp;
branches;
next	4.2.2.10;

4.2.2.10
date	98.10.22.14.54.28;	author kbracey;	state Exp;
branches;
next	4.2.2.11;

4.2.2.11
date	98.10.26.12.06.12;	author kbracey;	state Exp;
branches;
next	4.2.2.12;

4.2.2.12
date	98.10.30.16.20.35;	author kbracey;	state Exp;
branches;
next	4.2.2.13;

4.2.2.13
date	98.11.17.13.34.33;	author kbracey;	state Exp;
branches;
next	;

1.1.2.1
date	98.03.03.13.22.17;	author smiddle;	state Exp;
branches;
next	;


desc
@@


4.42
log
@Fix background blending sometimes setting alpha to zero in 32bpp modes
Detail:
  s/Blending - blend_putdata_32bpp contains an optimisation to avoid reading the screen pixel if the text pixel is fully opaque. However this means that the source alpha can't be preserved, going against the rules set out in the comment preceeding setblendingdata (and in reality, the alpha channel would be set to zero). Fix this by introducing a new blend_putdata_32bppA variant which always reads from the screen, ensuring the alpha channel can be preserved.
Admin:
  Tested on Raspberry Pi 3B
  Hardware overlays underneath the desktop are no longer visible through the zero-alpha font pixels


Version 3.80. Tagged as 'Manager-3_80'
@
text
@;
; This file is automatically maintained by srccommit, do not edit manually.
; Last processed by srccommit version: 1.1.
;
                        GBLS    Module_MajorVersion
                        GBLA    Module_Version
                        GBLS    Module_MinorVersion
                        GBLS    Module_Date
                        GBLS    Module_FullVersion
                        GBLS    Module_ApplicationDate
                        GBLS    Module_HelpVersion
                        GBLS    Module_ComponentName
                        GBLS    Module_ComponentPath
Module_MajorVersion     SETS    "3.80"
Module_Version          SETA    380
Module_MinorVersion     SETS    ""
Module_Date             SETS    "13 Aug 2018"
Module_ApplicationDate  SETS    "13-Aug-18"
Module_ComponentName    SETS    "Manager"
Module_ComponentPath    SETS    "castle/RiscOS/Sources/Video/Render/Fonts/Manager"
Module_FullVersion      SETS    "3.80"
Module_HelpVersion      SETS    "3.80 (13 Aug 2018)"
                        END
@


4.41
log
@Fix bad error pointer returned by Font_LoseFont
Detail:
  s/Fonts01 - Change a TEQ to a CMP to ensure the V flag is cleared; if a font handle like &80000000 was supplied then the opening CMP would set the V flag, accidentally causing the code to return a garbage error pointer.
  s/Errors - Apparently AddError requires '$' to be doubly-escaped to '$$$$' to stop objasm from throwing a warning.
Admin:
  Tested on wandboard
  Fixes AODT on SYS "Font_LoseFont",&80000000


Version 3.79. Tagged as 'Manager-3_79'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.79"
Module_Version          SETA    379
d17 2
a18 2
Module_Date             SETS    "04 Feb 2018"
Module_ApplicationDate  SETS    "04-Feb-18"
d21 2
a22 2
Module_FullVersion      SETS    "3.79"
Module_HelpVersion      SETS    "3.79 (04 Feb 2018)"
@


4.40
log
@Fix for failure to plot bitmap fonts when the font cache is above 256MB
The bitmapped font paintmagnified routine uses bit indexes, which needs an effective 35 bit address (for a 4bpp IntMetrics+x90y45 font).
In preparation for Medusa (>=256MB machine) the top 3 bits are kept in paint_inptr and the bottom 32 bits in the inptr register (R4).
However, a mixup meant the top 3 bits from paint_inptr were added before an extra 2 bit shift, so the font cache address becomes nonsense, leading to an abort.

Fonts02.s: Reorder the calculation.

Tested with Porterhouse bitmap font, with the font cache at &37000000 (ie. one of the top 3 bits are set), using it as the desktop font, in !Edit, printing to a PostScript and bit image printer, and in !TechWriter.

Version 3.78. Tagged as 'Manager-3_78'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.78"
Module_Version          SETA    378
d17 2
a18 2
Module_Date             SETS    "28 Feb 2017"
Module_ApplicationDate  SETS    "28-Feb-17"
d21 2
a22 2
Module_FullVersion      SETS    "3.78"
Module_HelpVersion      SETS    "3.78 (28 Feb 2017)"
@


4.39
log
@Avoid unnecesary remainder calculations
Detail:
  s/BlendingS, s/Font_Arith, s/Fonts03, s/Fonts04 - Avoid unnecessary remainder calculations in DivRem macro
Admin:
  Tested on Cortex-A15


Version 3.77. Tagged as 'Manager-3_77'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.77"
Module_Version          SETA    377
d17 2
a18 2
Module_Date             SETS    "08 May 2016"
Module_ApplicationDate  SETS    "08-May-16"
d21 2
a22 2
Module_FullVersion      SETS    "3.77"
Module_HelpVersion      SETS    "3.77 (08 May 2016)"
@


4.38
log
@Fix issues when font cache is located in high end of RAM
Detail:
  s/Fonts01, s/Fonts04, s/Funcache - Fix comparisons against PIX_UNCACHED to be unsigned instead of signed. Fix another couple of signed range checks which should have been unsigned.
  s/Fonts01 - Fix 32bit conversion issue in debug code around the SWI dispatcher; was failing to save the PSR correctly and resulting in every SWI in debug builds to throw a spurious error.
Admin:
  Tested on BB-xM


Version 3.76. Tagged as 'Manager-3_76'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.76"
Module_Version          SETA    376
d17 2
a18 2
Module_Date             SETS    "23 Jul 2014"
Module_ApplicationDate  SETS    "23-Jul-14"
d21 2
a22 2
Module_FullVersion      SETS    "3.76"
Module_HelpVersion      SETS    "3.76 (23 Jul 2014)"
@


4.37
log
@Update to cope with new pixel formats
Detail:
  s/Fonts01, s/Fonts02 - Cache the current mode flags & NColour values
  s/Blending - Font blending code improved to add support for new pixel formats. Supremacy blending code split off into seperate file as it's too big for a macro.
  s/BlendingS - New file containing the guts of the supremacy blending code. Old code only supported supremacy blending in 32bpp &TBGR modes; new code supports supremacy blending in 16bpp 4444 &TBGR, as well as alpha blending in 32bpp &TBGR and 16bpp 4444 &TBGR, and red/blue swapped modes (as well as the main blending code supporting all new RGB modes).
Admin:
  Tested on BB-xM
  Part of an implementation of the Extended Framebuffer Format Spec:
  http://www.riscosopen.org/wiki/documentation/show/Extended%20Framebuffer%20Format%20Specification


Version 3.75. Tagged as 'Manager-3_75'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.75"
Module_Version          SETA    375
d17 2
a18 2
Module_Date             SETS    "07 Aug 2013"
Module_ApplicationDate  SETS    "07-Aug-13"
d21 2
a22 2
Module_FullVersion      SETS    "3.75"
Module_HelpVersion      SETS    "3.75 (07 Aug 2013)"
@


4.36
log
@  Font rendering speed optimisations
Detail:
  Prevention of needless screen reads in unblended font rendering.
  Some simple code migration to eliminate load-use dependencies.
  Non-blended rendering to screen was actually slower than blended on the
  IYONIX pc because of the needless reads; these changes redress the balance.
Admin:
  Changes received from Adrian Lees

Version 3.74. Tagged as 'Manager-3_74'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.74"
Module_Version          SETA    374
d17 2
a18 2
Module_Date             SETS    "07 May 2012"
Module_ApplicationDate  SETS    "07-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "3.74"
Module_HelpVersion      SETS    "3.74 (07 May 2012)"
@


4.35
log
@Fix long multiply optimisation bugs
Detail:
  s/Font_Arith:
  - Fixed getpixsize to take the high half of the multiply from the right register.
  - Corrected scaleycoord description to state R0 is corrupted
  - Fixed scaleycoord to place output in correct register
  - Fixed mul_R0_R1 to not corrupt R1
  s/Fonts04:
  - Fixed first long multiply in scalescaffoldx and scalescaffoldy to leave correct value in R1 ready for the second multiply
Admin:
  Tested in Iyonix ROM softload
  PDF files now render correctly
  scaleycoord and mul_R0_R1 bugs were somewhat inconsequential, since those routines currently go unused when long multiplies are in use


Version 3.73. Tagged as 'Manager-3_73'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.73"
Module_Version          SETA    373
d17 2
a18 2
Module_Date             SETS    "18 Mar 2012"
Module_ApplicationDate  SETS    "18-Mar-12"
d21 2
a22 2
Module_FullVersion      SETS    "3.73"
Module_HelpVersion      SETS    "3.73 (18 Mar 2012)"
@


4.34
log
@Use long multiplies where possible. Simple blended font optimisations.
Detail:
  s/Blending - Optimise blended font plotting a bit. Now use UBFX/BFI on ARMv6T2+, for a speed gain of a few percent. Pre-ARMv6T2 code optimised to get rid of unneeded shifts and result clamping
  s/Font_Arith, s/Fonts04 - Make use of long multiplies where possible. If long multiplies are in use, some routines have been inlined since they're now just a handful of instructions instead of 10 or so.
Admin:
  Tested in IOMD & OMAP3 ROMs
  Blended fonts and transformed fonts seem to work OK


Version 3.72. Tagged as 'Manager-3_72'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.72"
Module_Version          SETA    372
d17 2
a18 2
Module_Date             SETS    "25 Feb 2012"
Module_ApplicationDate  SETS    "25-Feb-12"
d21 2
a22 2
Module_FullVersion      SETS    "3.72"
Module_HelpVersion      SETS    "3.72 (25 Feb 2012)"
@


4.33
log
@Get extra header file for Service_International.
Allow the font prefix to contain path variables (ending in colon) as well as paths (ending in dot).

Version 3.71. Tagged as 'Manager-3_71'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.71"
Module_Version          SETA    371
d17 2
a18 2
Module_Date             SETS    "27 Jan 2012"
Module_ApplicationDate  SETS    "27-Jan-12"
d21 2
a22 2
Module_FullVersion      SETS    "3.71"
Module_HelpVersion      SETS    "3.71 (27 Jan 2012)"
@


4.32
log
@Use correct CLZ check
Detail:
  s/Font_BasFP - Only look for ARMv5 support when deciding if CLZ is available, not ARMv5T
Admin:
  Tested in OMAP3 ROM


Version 3.70. Tagged as 'Manager-3_70'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.70"
Module_Version          SETA    370
d17 2
a18 2
Module_Date             SETS    "06 Dec 2011"
Module_ApplicationDate  SETS    "06-Dec-11"
d21 2
a22 2
Module_FullVersion      SETS    "3.70"
Module_HelpVersion      SETS    "3.70 (06 Dec 2011)"
@


4.31
log
@Fix objasm 4 warnings. Allow math code to make use of CLZ. Fix potential crash.
Detail:
  s/Font_BasFP - Uses Hdr:CPU.Arch to decide whether to use CLZ in IFLT routine. Also fixed nasty crash on 32bit systems where FNRMB tail-calls IFLTA; 32bit versions of IFLT stack the LR, but FNRMB wasn't stacking it before jumping into the middle of the code.
  s/Fonts01 - Split up an LDM to avoid deprecated LDM {LR,PC} warning
Admin:
  Tested on rev A2 BB-xM


Version 3.69. Tagged as 'Manager-3_69'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.69"
Module_Version          SETA    369
d17 2
a18 2
Module_Date             SETS    "24 Sep 2011"
Module_ApplicationDate  SETS    "24-Sep-11"
d21 2
a22 2
Module_FullVersion      SETS    "3.69"
Module_HelpVersion      SETS    "3.69 (24 Sep 2011)"
@


4.30
log
@Fix issues rendering Cyberbit font
Detail:
  s/Fonts01 - Increase scratchsize from 8K to 12K. 8K was slightly too small for Cyberbit char 0x98f8.
  s/Fonts04 - Fix CachePixels to correctly return any errors generated by CacheChunk
Admin:
  Tested on rev A2 BB-xM.
  Cyberbit char 0x98f8 now renders properly instead of returning a duff error pointer.


Version 3.68. Tagged as 'Manager-3_68'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.68"
Module_Version          SETA    368
d21 2
a22 2
Module_FullVersion      SETS    "3.68"
Module_HelpVersion      SETS    "3.68 (24 Sep 2011)"
@


4.29
log
@Fix null pointer access
Detail:
  s/Fonts01 - hdr*_PixoPtr is optional, but SWIFont_CharBBox was loading from it without checking, causing random data to be read from zero page in some situations.
Admin:
  Tested on rev C2 BB.


Version 3.67. Tagged as 'Manager-3_67'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.67"
Module_Version          SETA    367
d17 2
a18 2
Module_Date             SETS    "24 Jul 2011"
Module_ApplicationDate  SETS    "24-Jul-11"
d21 2
a22 2
Module_FullVersion      SETS    "3.67"
Module_HelpVersion      SETS    "3.67 (24 Jul 2011)"
@


4.28
log
@Validate paths supplied to *FontInstall/Remove
Detail:
Paths supplied to *FontInstall/*FontRemove didn't actually have to be paths, and the directory scanner would attempt to recurse into the object supplied leading to lots of bogus error messages when using anything font related that attempted to recache the font list (eg. opening a font menu).
Added check that for every element supplied must end in a dot.
Trimmed unnecessary 'Version' file, using VersionASM directly.
Updated messages file with new error message.

Version 3.66. Tagged as 'Manager-3_66'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.66"
Module_Version          SETA    366
d17 2
a18 2
Module_Date             SETS    "02 Jan 2010"
Module_ApplicationDate  SETS    "02-Jan-10"
d21 2
a22 2
Module_FullVersion      SETS    "3.66"
Module_HelpVersion      SETS    "3.66 (02 Jan 2010)"
@


4.27
log
@Make FontManager NoUnaligned-safe
Detail:
  Various bits of the font manager load character widths and heights from arrays of shorts. These bits of code now use the LDSHA macro where possible, to avoid exceptions when NoUnaligned is TRUE and alignment exceptions are turned on.
Admin:
  Tested on rev C2 beagleboard.


Version 3.65. Tagged as 'Manager-3_65'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.65"
Module_Version          SETA    365
d17 2
a18 2
Module_Date             SETS    "06 Nov 2009"
Module_ApplicationDate  SETS    "06-Nov-09"
d21 2
a22 2
Module_FullVersion      SETS    "3.65"
Module_HelpVersion      SETS    "3.65 (06 Nov 2009)"
@


4.26
log
@  Stop Font_EnumerateCharacters skipping the first available character range.
Detail:
  The first call to Font_EnumerateCharacters will always fail to find an
  internal character code (as an external code of 0 has no mapping). On exit,
  the first available external character code should be placed in R1 ready
  for the next call.

  If the provided external code has no mapping, and a range was processed,
  then the next external code to enumerate is determined by selecting the
  lowest external code in the range after the one processed.

  In the case of the first call, this is wrong -- it should return the
  lowest external code in the range processed (i.e. the lowest external code
  in the first range available).
Admin:
  Tested on RISC OS 4.02.


Version 3.64. Tagged as 'Manager-3_64'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.64"
Module_Version          SETA    364
d17 2
a18 2
Module_Date             SETS    "06 Jul 2009"
Module_ApplicationDate  SETS    "06-Jul-09"
d21 2
a22 2
Module_FullVersion      SETS    "3.64"
Module_HelpVersion      SETS    "3.64 (06 Jul 2009)"
@


4.25
log
@  Architecture-specific speedups
Detail:
  Various new architecture features used to read signed and unsigned
  halfwords and 3-byte values from arbitrary alignments - used for parsing
  UTF-16 strings and embedded control sequences.
  * when targetting only ARMv4 or later, uses LDRSB, LDRH, LDRSH
  * when targetting only ARMv6 or later, uses unaligned LDR (unless the
    NoUaligned switch is set in Hdr:Machine.Machine)
  * when targetting only ARMv6T2 or later, uses SBFX (not currently
    supported by objasm, so uses DCI instead)
  Added ENTRY directive to permit building of GPA debug listing.
Admin:
  Builds, but not tested.

Version 3.63. Tagged as 'Manager-3_63'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.63"
Module_Version          SETA    363
d17 2
a18 2
Module_Date             SETS    "16 Jun 2009"
Module_ApplicationDate  SETS    "16-Jun-09"
d21 2
a22 2
Module_FullVersion      SETS    "3.63"
Module_HelpVersion      SETS    "3.63 (16 Jun 2009)"
@


4.24
log
@  GET and #include file pathnames changed
Detail:
  Uses suffixed file extensions for compatiblity with both Norcroft and GCC.
Admin:
  Supplied by Peter Naulls, tested at ROOL

Version 3.62. Not tagged
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.62"
Module_Version          SETA    362
d17 2
a18 2
Module_Date             SETS    "11 Jun 2009"
Module_ApplicationDate  SETS    "11-Jun-09"
d21 2
a22 2
Module_FullVersion      SETS    "3.62"
Module_HelpVersion      SETS    "3.62 (11 Jun 2009)"
@


4.23
log
@ Seriously reduce the amount of build options, purging those that have
 been enabled by default for years.
Detail:
 Remaining options are: usesetpalette, newunderline, checkhandles,
 lessercheckhandles, and blendingOn.
Admin:
 Resulting binary is identical to 3.61.


Version 3.62. Tagged as 'Manager-3_62'
@
text
@d17 2
a18 2
Module_Date             SETS    "14 May 2009"
Module_ApplicationDate  SETS    "14-May-09"
d22 1
a22 1
Module_HelpVersion      SETS    "3.62 (14 May 2009)"
@


4.22
log
@  Make FontManager softload on modern ROL OS versions.
Detail:
  In recent ROL OS versions, the font cache dynamic area is managed
  entirely by the FontManager module -- the kernel no longer creates
  this dynamic area itself. This change prevented the UCS FontManager
  from loading, as it expected the font cache to already exist.

  The FontManager code has been modified to create the font cache DA
  itself if it detects that it does not exist. It will destroy the
  font cache DA on finalisation if it created the DA in the first place
  and it provides an appropriate dynamic area handler to process DA
  resize requests.

  So as to permit loading this version of the FontManager on all OS
  versions, the Font_ChangeArea SWI is still provided, the module
  initialisation code will do the right thing if it detects that the
  font cache DA already exists, and the finalisation code will only
  destroy the font cache DA if it was created by the initialisation
  code.
Admin:
  Contributed by John-Mark Bell.
  Tested on an A9home with RO 4.42. This worked fine with the A9home's
  built-in ROM fonts. Additionally tested with a softloaded copy of the
  ROMFonts module from RO 5.11. This also performed as expected.
  Successfully tested UCS functionality using NetSurf with both language
  (Marugothic, Song) and symbol (TTF2f conversions of Cyberbit and others)
  fonts.
  Also successfully tested on RO 5.11, indicating no regression in
  behaviour.
  Unsuccessfully tested on RO 4.02 under RPCEmu. A vanilla build of
  FM 3.60 also fails on this setup. In both cases, the DPI values listed
  by *FontList are 4294967205 (= (2^32-1) - 90), which implies that the
  DPI calculations have been broken at some point. A 26bit version of
  FM 3.54 does not exhibit this behaviour.

Version 3.61. Tagged as 'Manager-3_61'
@
text
@d3 1
a3 1
; Last processed by srccommit version: 1.2.
d14 2
a15 2
Module_MajorVersion     SETS    "3.61"
Module_Version          SETA    361
d17 2
a18 2
Module_Date             SETS    "06 Jun 2008"
Module_ApplicationDate  SETS    "06-Jun-08"
d21 2
a22 2
Module_FullVersion      SETS    "3.61"
Module_HelpVersion      SETS    "3.61 (06 Jun 2008)"
@


4.21
log
@Added support for supremacy blending in 32bpp modes only. If bit 14 is set
in Font_Paint as well as bit 11 (for blending), then the blending takes into
account the supremacy bits of the screen data when compositing. If not in a
32-bpp mode, then an error is returned.

In addition, when bits 11 and 14 are set, the supremacy bits in the chosen
foreground colour (set via ColourTrans_SetFontColours or similar) are used,
so you can plot semi-transparent text. This is a limited facility - it's
not available below 32bpp, and it doesn't work for text above FontMax2.

Also, fixed a bug which meant that successive paints with different blending
flags had to be separated by colour-setting calls to get the new flags to
be obeyed.

Note that, as in previous versions, the blending still doesn't correct for
gamma.

Version 3.60. Tagged as 'Manager-3_60'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.60"
Module_Version          SETA    360
d17 2
a18 2
Module_Date             SETS    "03 Aug 2005"
Module_ApplicationDate  SETS    "03-Aug-05"
d20 3
a22 3
Module_ComponentPath    SETS    "RiscOS/Sources/Video/Render/Fonts/Manager"
Module_FullVersion      SETS    "3.60"
Module_HelpVersion      SETS    "3.60 (03 Aug 2005)"
@


4.20
log
@A fix for not being able to configure FontMax* from the supervisor prompt,
which trips up any machine with high address space.

Version 3.59. Tagged as 'Manager-3_59'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.59"
Module_Version          SETA    359
d17 2
a18 2
Module_Date             SETS    "04 Aug 2004"
Module_ApplicationDate  SETS    "04-Aug-04"
d21 2
a22 2
Module_FullVersion      SETS    "3.59"
Module_HelpVersion      SETS    "3.59 (04 Aug 2004)"
@


4.19
log
@Fixed a bug introduced in 3.57 - Font_SwitchOutputToBuffer was interpreting
R1 wrongly.

Version 3.58. Tagged as 'Manager-3_58'
@
text
@d3 1
a3 1
; Last processed by srccommit version: 1.68.
d14 2
a15 2
Module_MajorVersion     SETS    "3.58"
Module_Version          SETA    358
d17 2
a18 2
Module_Date             SETS    "16 Feb 2004"
Module_ApplicationDate  SETS    "16-Feb-04"
d21 2
a22 2
Module_FullVersion      SETS    "3.58"
Module_HelpVersion      SETS    "3.58 (16 Feb 2004)"
@


4.18
log
@A signed pointer comparison was stopping postscript font matching from
working in some circumstances as it asked for the answer back on the
stack which is now top bit set.Fixed.
Also went through and tightened up all the signed comparisons as a number
of other calls considered anything <= 0 to mean 0.The worst offender
being "Font_ReadFontMetrics".
A number of places assumed SWIs preserved flags,now don't.
Optimised two places,an excess MOV and avoiding screen reads when the
BIC mask is &FFFFFFFF.

Version 3.57. Tagged as 'Manager-3_57'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.57"
Module_Version          SETA    357
d17 2
a18 2
Module_Date             SETS    "13 May 2003"
Module_ApplicationDate  SETS    "13-May-03"
d21 2
a22 2
Module_FullVersion      SETS    "3.57"
Module_HelpVersion      SETS    "3.57 (13 May 2003)"
@


4.17
log
@Screen reads avoided in Font_Paint when a rubout box is required but the
BIC mask is &FFFFFFFF
Font_ReadFontMetrics now attempts to cache previously calculated data
to speed up repeated calls (this fix from KJB).

Version 3.56. Tagged as 'Manager-3_56'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.56"
Module_Version          SETA    356
d17 2
a18 2
Module_Date             SETS    "31 Jan 2003"
Module_ApplicationDate  SETS    "31-Jan-03"
d21 2
a22 2
Module_FullVersion      SETS    "3.56"
Module_HelpVersion      SETS    "3.56 (31 Jan 2003)"
@


4.16
log
@Font_ReadMetrics will now return kerning information (this was on
the todo list of the UCS font manager spec) such that postscript will
kern properly: MakePSFont relied on it.
See switch "newmapping"
Improvements to cacheing behaviour.

Version 3.55. Tagged as 'Manager-3_55'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.55"
Module_Version          SETA    355
d17 2
a18 2
Module_Date             SETS    "18 Dec 2002"
Module_ApplicationDate  SETS    "18-Dec-02"
d21 2
a22 2
Module_FullVersion      SETS    "3.55"
Module_HelpVersion      SETS    "3.55 (18 Dec 2002)"
@


4.15
log
@Fixes two bugs introduced in version 3.52:

* Bounding box measurements were frequently incorrect.
* Dependency flags were not processed reliably in cases where there were
  more than 32 chunks.

Version 3.54. Tagged as 'Manager-3_54'
@
text
@d3 1
a3 1
; Last processed by srccommit version: 1.62.
d10 1
a10 2
                        GBLS    Module_ApplicationDate2
                        GBLS    Module_ApplicationDate4
d14 2
a15 2
Module_MajorVersion     SETS    "3.54"
Module_Version          SETA    354
d17 2
a18 3
Module_Date             SETS    "12 Apr 2002"
Module_ApplicationDate2 SETS    "12-Apr-02"
Module_ApplicationDate4 SETS    "12-Apr-2002"
d21 2
a22 2
Module_FullVersion      SETS    "3.54"
Module_HelpVersion      SETS    "3.54 (12 Apr 2002)"
@


4.14
log
@* Now handles new "/uXXXXX" identifiers in encoding files.
* 32-bit scaffold table support added (see Doc.BigTables)
* Occasional crash when font cache full fixed (bug introduced at same time
  as, but independently from, Unicode support).

And in FontEd:

* Nice new icon
* 3D look-and-feel
* Solid dragging
* Big table support
* Can now handle more than 15K of scaffolding
* Packing and dependencies fixed - can now reliably load and save our
  Far Eastern fonts (and they load faster, because it doesn't try to
  "correct" the packing)
* Width of font index display now adjustable
* Font index grid now drawn correctly with large fonts
* Font index bitmap generation accelerated

Version 3.53. Tagged as 'Manager-3_53'
@
text
@d15 2
a16 2
Module_MajorVersion     SETS    "3.53"
Module_Version          SETA    353
d18 3
a20 3
Module_Date             SETS    "22 Feb 2002"
Module_ApplicationDate2 SETS    "22-Feb-02"
Module_ApplicationDate4 SETS    "22-Feb-2002"
d23 2
a24 2
Module_FullVersion      SETS    "3.53"
Module_HelpVersion      SETS    "3.53 (22 Feb 2002)"
@


4.13
log
@Now supports chunk dependencies outside the first 32 chunks. Needed for the
Korean font.

Version 3.52. Tagged as 'Manager-3_52'
@
text
@d3 1
d15 2
a16 2
Module_MajorVersion     SETS    "3.52"
Module_Version          SETA    352
d18 3
a20 3
Module_Date             SETS    "12 Nov 2001"
Module_ApplicationDate2 SETS    "12-Nov-01"
Module_ApplicationDate4 SETS    "12-Nov-2001"
d23 2
a24 2
Module_FullVersion      SETS    "3.52"
Module_HelpVersion      SETS    "3.52 (12 Nov 2001)"
@


4.12
log
@Converted the msr/mrs macros for ObjAsm.

Version 3.51. Tagged as 'Manager-3_51'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.51"
Module_Version          SETA    351
d17 3
a19 3
Module_Date             SETS    "10 May 2001"
Module_ApplicationDate2 SETS    "10-May-01"
Module_ApplicationDate4 SETS    "10-May-2001"
d22 2
a23 2
Module_FullVersion      SETS    "3.51"
Module_HelpVersion      SETS    "3.51 (10 May 2001)"
@


4.11
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.72 or later.
  Requires BuildSys 3.09 or later.
  Requires Env 0.65 or later.

Version 3.50. Tagged as 'Manager-3_50'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.50"
Module_Version          SETA    350
d17 3
a19 3
Module_Date             SETS    "23 Mar 2001"
Module_ApplicationDate2 SETS    "23-Mar-01"
Module_ApplicationDate4 SETS    "23-Mar-2001"
d22 2
a23 2
Module_FullVersion      SETS    "3.50"
Module_HelpVersion      SETS    "3.50 (23 Mar 2001)"
@


4.10
log
@  Added 32-bit flag to module header.
Admin:
  Built.

Version 3.49. Tagged as 'Manager-3_49'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "3.49"
Module_Version          SETA    349
d17 3
a19 3
Module_Date             SETS    "21 Nov 2000"
Module_ApplicationDate2 SETS    "21-Nov-00"
Module_ApplicationDate4 SETS    "21-Nov-2000"
d22 2
a23 2
Module_FullVersion      SETS    "3.49"
Module_HelpVersion      SETS    "3.49 (21 Nov 2000)"
@


4.9
log
@32-bit compatible.

Version 3.48. Tagged as 'Manager-3_48'
@
text
@d9 7
a15 2
Module_MajorVersion     SETS    "3.48"
Module_Version          SETA    348
d17 7
a23 2
Module_Date             SETS    "12 May 2000"
Module_FullVersion      SETS    "3.48"
@


4.8
log
@Fixed encoding problem - characters named "/uniXXXX" in a base encoding were
not matched in a non-Unicode target encoding; this affected Latin8.

Version 3.47. Tagged as 'Manager-3_47'
@
text
@d4 10
a13 10
			GBLS	Module_MajorVersion
			GBLA    Module_Version
			GBLS	Module_MinorVersion
			GBLS	Module_Date
			GBLS	Module_FullVersion
Module_MajorVersion	SETS    "3.47"
Module_Version          SETA    347
Module_MinorVersion	SETS	""
Module_Date		SETS    "22 Sep 1999"
Module_FullVersion      SETS    "3.47"
@


4.7
log
@Ursula branch remerged (got lost during UCS changes).

Version 3.46. Tagged as 'Manager-3_46'
@
text
@d9 2
a10 2
Module_MajorVersion	SETS    "3.46"
Module_Version          SETA    346
d12 2
a13 2
Module_Date		SETS    "03 Aug 1999"
Module_FullVersion      SETS    "3.46"
@


4.6
log
@System would crash horribly if first identifier in an encoding file was
of the form "/uniXXXX".
Guaranteed priority given to "/uniXXXX" glyph, rather than named glyph, for
a given UCS code point. (eg "/uni03A9" must be preferred to "/Omega" for
character U+03A9).

Version 3.45. Tagged as 'Manager-3_45'
@
text
@d8 3
a10 2
Module_MajorVersion	SETS    "3.45"
Module_Version          SETA    345
d12 3
a14 2
Module_Date		SETS    "01 Mar 1999"
		        END
@


4.5
log
@metmisc and metkerns put into automatic relocation area of workspace. Fixes
problem of monospaced fonts going squiffy first seen in Russian demo.

Version 3.44. Tagged as 'Manager-3_44'
@
text
@d8 2
a9 2
Module_MajorVersion	SETS    "3.44"
Module_Version          SETA    344
d11 1
a11 1
Module_Date		SETS    "22 Feb 1999"
@


4.4
log
@Changed to handle /uniXXXXYYYY surrogate form, as per version 1.1 of
"Unicode and glyph names".
A few redundant code fragments snipped.
MinVersion for saved cache files upped to 342 (because there are both
Unicode and non-Unicode version 3.41's out there).

Version 3.43. Tagged as 'Manager-3_43'
@
text
@d8 2
a9 2
Module_MajorVersion	SETS    "3.43"
Module_Version          SETA    343
@


4.3
log
@Unicode Font Manager moved onto trunk.

Version 3.42. Tagged as 'Manager-3_42'
@
text
@d8 2
a9 2
Module_MajorVersion	SETS    "3.42"
Module_Version          SETA    342
d11 1
a11 1
Module_Date		SETS    "18 Feb 1999"
@


4.2
log
@Spinner branch merged. German resources imported.
srccommitted, but doesn't include VersionASM yet :)

Version 3.41. Tagged as 'Manager-3_41'
@
text
@d8 2
a9 2
Module_MajorVersion	SETS    "3.41"
Module_Version          SETA    341
d11 1
a11 1
Module_Date		SETS    "07 Oct 1998"
@


4.2.2.1
log
@First commit of Unicode Font Manager. Alpha quality only, folks.

Version 3.41, 4.2.2.1. Tagged as 'Manager-3_41-4_2_2_1'
@
text
@d10 1
a10 1
Module_MinorVersion	SETS	"4.2.2.1"
@


4.2.2.2
log
@Some fixes to cope with ROM fonts with bit 31 of their address set.

Version 3.41, 4.2.2.2. Tagged as 'Manager-3_41-4_2_2_2'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.2"
Module_Date		SETS    "08 Oct 1998"
@


4.2.2.3
log
@Module help changed to show minor version number. Removed "(Background
blending)" string.

Version 3.41, 4.2.2.3. Tagged as 'Manager-3_41-4_2_2_3'
@
text
@d10 1
a10 1
Module_MinorVersion	SETS	"4.2.2.3"
@


4.2.2.4
log
@Was failing to parse control sequences if current font handle was undefined.

Version 3.41, 4.2.2.4. Tagged as 'Manager-3_41-4_2_2_4'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.4"
Module_Date		SETS    "09 Oct 1998"
@


4.2.2.5
log
@Added support for 16-bit composite character references. Note that dependency
bits only work up to character 1023 at the moment.

Version 3.41, 4.2.2.5. Tagged as 'Manager-3_41-4_2_2_5'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.5"
Module_Date		SETS    "13 Oct 1998"
@


4.2.2.6
log
@Modified to cope with new Hdr:CMOS

Version 3.41, 4.2.2.6. Tagged as 'Manager-3_41-4_2_2_6'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.6"
Module_Date		SETS    "19 Oct 1998"
@


4.2.2.7
log
@Multiple-base encoding support.
Unknown characters mapped to U+E000.
Assorted bugs fixed.
Font_MakeBitmap works again (but using bitmaps still problematical)

Version 3.41, 4.2.2.7. Tagged as 'Manager-3_41-4_2_2_7'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.7"
Module_Date		SETS    "20 Oct 1998"
@


4.2.2.8
log
@Don't crash if Font_FindFont fails

Version 3.41, 4.2.2.8. Tagged as 'Manager-3_41-4_2_2_8'
@
text
@d10 1
a10 1
Module_MinorVersion	SETS	"4.2.2.8"
@


4.2.2.9
log
@RISCOS_UCSOnly idea removed - default is now to not remap non-"language"
fonts if alphabet isn't UTF8, but you can map explicitly if required.
Saved cache files store base address to prevent them being loaded at the
address.

Version 3.41, 4.2.2.9. Tagged as 'Manager-3_41-4_2_2_9'
@
text
@d10 1
a10 1
Module_MinorVersion	SETS	"4.2.2.9"
@


4.2.2.10
log
@Font_ReadFontMetrics resurrected (except kerning, which is only accessible
in a new format, useless until external<->internal mapping SWIs are
implemented).
Kerning works once more.
A few source tidy-ups and optimisations.

Version 3.41, 4.2.2.10. Tagged as 'Manager-3_41-4_2_2_10'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.10"
Module_Date		SETS    "22 Oct 1998"
@


4.2.2.11
log
@Use of IntMetrics bounding boxes reinstated.
Font_EnumerateCharacters SWI added.
Checks that encoding exists when Font_FindFont is called.

Version 3.41, 4.2.2.11. Tagged as 'Manager-3_41-4_2_2_11'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.11"
Module_Date		SETS    "26 Oct 1998"
@


4.2.2.12
log
@Assorted bugfixes and tidy-ups. Now working pretty reliably with bitmap
files. x90y45 files still a bit wobbly, and Font_UncacheFile (and hence
Font_MakeBitmap sometimes) still all over the place.

Version 3.41, 4.2.2.12. Tagged as 'Manager-3_41-4_2_2_12'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.12"
Module_Date		SETS    "30 Oct 1998"
@


4.2.2.13
log
@Bug fix in pixo block deletion.
Font_Paint didn't handle 16 or 32-bit control sequences.

Version 3.41, 4.2.2.13. Tagged as 'Manager-3_41-4_2_2_13'
@
text
@d10 2
a11 2
Module_MinorVersion	SETS	"4.2.2.13"
Module_Date		SETS    "17 Nov 1998"
@


4.1
log
@created by srccommit.
@
text
@d8 2
a9 2
Module_MajorVersion	SETS    "3.40"
Module_Version          SETA    340
@


1.1
log
@file VersionASM was initially added on branch smiddle_2Mar1998_Fonts16.
@
text
@d1 12
@


1.1.2.1
log
@Checked in RBrowning sources to own branch for 16bit development. This module has been checked
to build the same as it did in his hard disc.

Version 3.40, 1.1.2.2. Tagged as 'Manager-3_40-1_1_2_2'
@
text
@a0 10
;
; This file is automatically maintained by srccommit, do not edit manually.
;
			GBLS	Module_MajorVersion
			GBLS	Module_MinorVersion
			GBLS	Module_Date
Module_MajorVersion	SETS    "3.40"
Module_MinorVersion	SETS	"1.1.2.2"
Module_Date		SETS    "03 Mar 1998"
		        END
@
