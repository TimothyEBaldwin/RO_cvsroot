head	4.6;
access;
symbols
	PDumpers-1_46:4.6
	PDumpers-1_45:4.6
	PDumpers-1_44:4.6
	PDumpers-1_43:4.6
	PDumpers-1_42:4.6
	PDumpers-1_41:4.6
	RO_5_07:4.6
	PDumpers-1_40:4.6
	PDumpers-1_39:4.6
	PDumpers-1_38:4.6
	PDumpers-1_33:4.4
	PDumpers-1_32:4.4
	PDumpers-1_31:4.4
	PDumpers-1_30:4.4
	PDumpers-1_29:4.4
	PDumpers-1_28:4.3
	PDumpers-1_27:4.3
	PDumpers-1_26:4.3
	PDumpers-1_25:4.3
	Spin_merge-1_21:4.1.7.3
	PDumpers-1_24:4.3
	PDumpers-1_23:4.3
	PDumpers-1_22:4.3
	dellis_autobuild_BaseSW:4.3
	PDumpers-1_21:4.3
	sbrodie_sedwards_16Mar2000:4.3
	dcotton_autobuild_BaseSW:4.4
	dcotton_MPT2_build_16061999:4.1.7.3
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.7.3
	Ursula_RiscPC:4.1.7.3.0.4
	nicke_PDumpers-1_21:4.1.7.3
	rthornb_UrsulaBuild-19Aug1998:4.1.7.3
	UrsulaBuild_FinalSoftload:4.1.7.3
	rthornb_UrsulaBuild-12Aug1998:4.1.7.3
	aglover_UrsulaBuild-05Aug1998:4.1.7.3
	rthornb_UrsulaBuild-29Jul1998:4.1.7.3
	rthornb_UrsulaBuild-22Jul1998:4.1.7.3
	hsimons_BOCA-1_2-Release:4.1.7.3
	rthornb_UrsulaBuild-15Jul1998:4.1.7.3
	rthornb_UrsulaBuild-07Jul1998:4.1.7.3
	rthornb_UrsulaBuild-17Jun1998:4.1.7.3
	rthornb_UrsulaBuild-03Jun1998:4.1.7.3
	rthornb_UrsulaBuild-27May1998:4.1.7.3
	rthornb_UrsulaBuild-21May1998:4.1.7.3
	rthornb_UrsulaBuild_01May1998:4.1.7.3
	afrost_NC2_Generic:4.1.7.3
	afrost_Funai01-33:4.1.7.3
	Ursula:4.1.7.3.0.2
	Ursula_bp:4.1.7.3
	Ursula_31Mar1998:4.3
	Spinner_RCA116:4.1.7.3
	Spinner_B20_2:4.1.7.3
	Spinner_19_3:4.1.7.3
	Spinner_B18:4.1.7.3
	Spinner_B17:4.1.7.3
	Spinner_B15:4.1.7.3
	Spinner_B14:4.1.7.3
	Spinner_B13:4.1.7.3
	Spinner_B12:4.1.7.3
	Spin_merge_28May97:4.1.7.2
	Spinner_B10:4.1.7.3
	Spin_merge_16May97:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Spinner_B7:4.1.7.2
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.3
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.6
date	2002.12.17.18.54.43;	author srevill;	state Exp;
branches;
next	4.5;

4.5
date	2002.11.15.16.05.23;	author srevill;	state dead;
branches;
next	4.4;

4.4
date	2001.09.18.09.25.32;	author mboura;	state Exp;
branches;
next	4.3;

4.3
date	97.05.28.12.19.58;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.05.16.12.47.05;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.49.11;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.49.11;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.03.10.39;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.13.30.15;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.33.37;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.04.30.17.17.35;	author scormie;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.05.22.10.48.45;	author jcoxhead;	state Exp;
branches;
next	;


desc
@@


4.6
log
@Build changes,no code changes.
Took out the bodge of prefixing all the files GOT from the Generic
directory with a G,and replaced it with use of new flag "-J" in objasm.
Improved clean rule in top MakeFile.
Deleted some unused !Mk files.

Version 1.38. Tagged as 'PDumpers-1_38'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; > StartJob

;..............................................................................
; 
; Handle the starting of a job.  This simply involves loading the palette
; file and attachig it to the private word associated with the job.  This
; is handled by the Support module.
;
; in    R0 ->private word
;       R2 strip type
;
; out   V =1 => R0 -> error block
                      
StartJob_Monochrome ROUT
StartJob_Grey       ROUT
StartJob_Colour256  ROUT
StartJob_Multi	ROUT
StartJob_16Bit	ROUT
StartJob_24Bit	ROUT

        PDumper_Entry ""

	Debug	Calls, "StartJob entry"

        STR     R1, FileHandle 

        ADR     R2, pd_error_flag_set
	LDR	r1, [r2]		; ensure that PDumper_OutputReg does not ignore error
        TST     r1, # 1 :SHL: 1         ; is there an outstanding OS_GBPB error
	BIC	r1, r1, #3		; (clears error-this-job and GBPB-error-this-job)
        STR     R1, [R2]

        BEQ     %FT20                   ; no outstanding OS_GBPB error

        ; send a large number of ASCII NULL in an attempt to flush printer buffer
        ; which may have been left with an incomplete raster line
        ; 11.5" (A3 width) * 1200 dpi * 4 bytes per dot (cmyk) = 55200
        PDumper_Reset
        MOV     r2, #64 :SHL: 10
        MOV     r1, #0
10    
        PDumper_OutputReg r1
        SUBS    r2, r2, #1
        BGE     %BT10

20
        MOV     R1,#0                   ;Flags for this call are zero
        ADR     R2,palette_filename     ;->Filename for the job
        SWI     XPDumper_StartJob
        PDumper_Error

        PDumper_Exit

        END
@


4.5
log
@Renamed generic driver sources
Makefiles rewritten
Converted to use objasm
First pass at 32 bit compatibility.

Version 1.34. Tagged as 'PDumpers-1_34'
@
text
@@


4.4
log
@Summarry:
Fix of bug #5159. (Interim)
Detail:
At the start of a print job, now checks for an outstanding OS_GBPB error. If there is, then the printer has probably been left with an incomplete raster line in its input buffer. The generic start page code will then send 64K of ASCII NULL to flush it.
PDumperLJ.s.StartPage now uses the generic code (whish was identical apart from a few debugging lines).
Admin:
Tested with HP 610C using the 550C driver.

Version 1.29. Tagged as 'PDumpers-1_29'
@
text
@@


4.3
log
@Spinner branch taken
@
text
@d37 4
d43 1
d47 14
@


4.2
log
@Spinner branch merged
@
text
@d31 3
@


4.1
log
@Initial revision
@
text
@a33 1
        MOV     R1, #0                  ; ensure that PDumper_OutputReg does not ignore error
d35 2
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@  Introduce 'PDumper in use' error, reported if PDumper is reentered (in the
foreground).
   Introduce 'GBPB error' bit, suppresses calls to OS_GBPB while set.
   Use local error block for MessageTrans.
@
text
@d34 1
a35 2
	LDR	r1, [r2]		; ensure that PDumper_OutputReg does not ignore error
	BIC	r1, r1, #3		; (clears error-this-job and GBPB-error-this-job)
@


4.1.7.3
log
@   Unbreak 15- and 24-bit strip-type code.
@
text
@a30 3
StartJob_Multi	ROUT
StartJob_16Bit	ROUT
StartJob_24Bit	ROUT
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
