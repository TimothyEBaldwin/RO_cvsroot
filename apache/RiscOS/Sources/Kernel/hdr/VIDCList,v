head	4.1;
access;
symbols
	Kernel-6_14:4.1
	Kernel-6_01-3:4.1
	Kernel-6_13:4.1
	Kernel-6_12:4.1
	Kernel-6_11:4.1
	Kernel-6_10:4.1
	Kernel-6_09:4.1
	Kernel-6_08-4_129_2_10:4.1
	Kernel-6_08-4_129_2_9:4.1
	Kernel-6_08:4.1
	Kernel-6_07:4.1
	Kernel-6_06:4.1
	Kernel-6_05-4_129_2_8:4.1
	Kernel-6_05:4.1
	Kernel-6_04:4.1
	Kernel-6_03:4.1
	Kernel-6_01-2:4.1
	Kernel-6_01-4_146_2_1:4.1
	Kernel-6_02:4.1
	Kernel-6_01-1:4.1
	Kernel-6_01:4.1
	Kernel-6_00:4.1
	Kernel-5_99:4.1
	Kernel-5_98:4.1
	Kernel-5_97-4_129_2_7:4.1
	Kernel-5_97:4.1
	Kernel-5_96:4.1
	Kernel-5_95:4.1
	Kernel-5_94:4.1
	Kernel-5_93:4.1
	Kernel-5_92:4.1
	Kernel-5_91:4.1
	Kernel-5_90:4.1
	Kernel-5_89-4_129_2_6:4.1
	Kernel-5_89:4.1
	Kernel-5_88-4_129_2_5:4.1
	Kernel-5_88-4_129_2_4:4.1
	Kernel-5_88:4.1
	Kernel-5_87:4.1
	Kernel-5_86-4_129_2_3:4.1
	Kernel-5_86-4_129_2_2:4.1
	Kernel-5_86-4_129_2_1:4.1
	Kernel-5_86:4.1
	SMP:4.1.0.2
	SMP_bp:4.1
	Kernel-5_85:4.1
	Kernel-5_54-1:4.1
	Kernel-5_84:4.1
	Kernel-5_83:4.1
	Kernel-5_82:4.1
	Kernel-5_81:4.1
	Kernel-5_80:4.1
	Kernel-5_79:4.1
	Kernel-5_78:4.1
	Kernel-5_77:4.1
	Kernel-5_76:4.1
	Kernel-5_75:4.1
	Kernel-5_74:4.1
	Kernel-5_73:4.1
	Kernel-5_72:4.1
	Kernel-5_71:4.1
	Kernel-5_70:4.1
	Kernel-5_69:4.1
	Kernel-5_68:4.1
	Kernel-5_67:4.1
	Kernel-5_66:4.1
	Kernel-5_65:4.1
	Kernel-5_64:4.1
	Kernel-5_63:4.1
	Kernel-5_62:4.1
	Kernel-5_61:4.1
	Kernel-5_60:4.1
	Kernel-5_59:4.1
	Kernel-5_58:4.1
	Kernel-5_57:4.1
	Kernel-5_56:4.1
	Kernel-5_55:4.1
	Kernel-5_54:4.1
	Kernel-5_53:4.1
	Kernel-5_52:4.1
	Kernel-5_51:4.1
	Kernel-5_50:4.1
	Kernel-5_49:4.1
	HAL_merge:1.1.2.2
	Kernel-5_48:4.1
	Kernel-5_35-4_79_2_327:1.1.2.2
	Kernel-5_35-4_79_2_326:1.1.2.2
	Kernel-5_35-4_79_2_325:1.1.2.2
	Kernel-5_35-4_79_2_324:1.1.2.2
	Kernel-5_35-4_79_2_323:1.1.2.2
	Kernel-5_35-4_79_2_322:1.1.2.2
	Kernel-5_35-4_79_2_321:1.1.2.2
	Kernel-5_35-4_79_2_320:1.1.2.2
	Kernel-5_35-4_79_2_319:1.1.2.2
	Kernel-5_35-4_79_2_318:1.1.2.2
	Kernel-5_35-4_79_2_317:1.1.2.2
	Kernel-5_35-4_79_2_316:1.1.2.2
	Kernel-5_35-4_79_2_315:1.1.2.2
	Kernel-5_35-4_79_2_314:1.1.2.2
	Kernel-5_35-4_79_2_313:1.1.2.2
	Kernel-5_35-4_79_2_312:1.1.2.2
	Kernel-5_35-4_79_2_311:1.1.2.2
	Kernel-5_35-4_79_2_310:1.1.2.2
	Kernel-5_35-4_79_2_309:1.1.2.2
	Kernel-5_35-4_79_2_308:1.1.2.2
	Kernel-5_35-4_79_2_307:1.1.2.2
	Kernel-5_35-4_79_2_306:1.1.2.2
	Kernel-5_35-4_79_2_305:1.1.2.2
	Kernel-5_35-4_79_2_304:1.1.2.2
	Kernel-5_35-4_79_2_303:1.1.2.2
	Kernel-5_35-4_79_2_302:1.1.2.2
	Kernel-5_35-4_79_2_301:1.1.2.2
	Kernel-5_35-4_79_2_300:1.1.2.2
	Kernel-5_35-4_79_2_299:1.1.2.2
	Kernel-5_35-4_79_2_298:1.1.2.2
	Kernel-5_35-4_79_2_297:1.1.2.2
	Kernel-5_35-4_79_2_296:1.1.2.2
	Kernel-5_35-4_79_2_295:1.1.2.2
	Kernel-5_35-4_79_2_294:1.1.2.2
	Kernel-5_35-4_79_2_293:1.1.2.2
	Kernel-5_35-4_79_2_292:1.1.2.2
	Kernel-5_35-4_79_2_291:1.1.2.2
	Kernel-5_35-4_79_2_290:1.1.2.2
	Kernel-5_35-4_79_2_289:1.1.2.2
	Kernel-5_35-4_79_2_288:1.1.2.2
	Kernel-5_35-4_79_2_287:1.1.2.2
	Kernel-5_35-4_79_2_286:1.1.2.2
	Kernel-5_35-4_79_2_285:1.1.2.2
	Kernel-5_35-4_79_2_284:1.1.2.2
	Kernel-5_35-4_79_2_283:1.1.2.2
	Kernel-5_35-4_79_2_282:1.1.2.2
	Kernel-5_35-4_79_2_281:1.1.2.2
	Kernel-5_35-4_79_2_280:1.1.2.2
	Kernel-5_35-4_79_2_279:1.1.2.2
	Kernel-5_35-4_79_2_278:1.1.2.2
	Kernel-5_35-4_79_2_277:1.1.2.2
	Kernel-5_35-4_79_2_276:1.1.2.2
	Kernel-5_35-4_79_2_275:1.1.2.2
	Kernel-5_35-4_79_2_274:1.1.2.2
	Kernel-5_35-4_79_2_273:1.1.2.2
	Kernel-5_35-4_79_2_272:1.1.2.2
	Kernel-5_35-4_79_2_271:1.1.2.2
	Kernel-5_35-4_79_2_270:1.1.2.2
	Kernel-5_35-4_79_2_269:1.1.2.2
	Kernel-5_35-4_79_2_268:1.1.2.2
	Kernel-5_35-4_79_2_267:1.1.2.2
	Kernel-5_35-4_79_2_266:1.1.2.2
	Kernel-5_35-4_79_2_265:1.1.2.2
	Kernel-5_35-4_79_2_264:1.1.2.2
	Kernel-5_35-4_79_2_263:1.1.2.2
	Kernel-5_35-4_79_2_262:1.1.2.2
	Kernel-5_35-4_79_2_261:1.1.2.2
	Kernel-5_35-4_79_2_260:1.1.2.2
	Kernel-5_35-4_79_2_259:1.1.2.2
	Kernel-5_35-4_79_2_258:1.1.2.2
	Kernel-5_35-4_79_2_257:1.1.2.2
	Kernel-5_35-4_79_2_256:1.1.2.2
	Kernel-5_35-4_79_2_255:1.1.2.2
	Kernel-5_35-4_79_2_254:1.1.2.2
	Kernel-5_35-4_79_2_253:1.1.2.2
	Kernel-5_35-4_79_2_252:1.1.2.2
	Kernel-5_35-4_79_2_251:1.1.2.2
	Kernel-5_35-4_79_2_250:1.1.2.2
	Kernel-5_35-4_79_2_249:1.1.2.2
	Kernel-5_35-4_79_2_248:1.1.2.2
	Kernel-5_35-4_79_2_247:1.1.2.2
	Kernel-5_35-4_79_2_246:1.1.2.2
	Kernel-5_35-4_79_2_245:1.1.2.2
	Kernel-5_35-4_79_2_244:1.1.2.2
	Kernel-5_35-4_79_2_243:1.1.2.2
	Kernel-5_35-4_79_2_242:1.1.2.2
	Kernel-5_35-4_79_2_241:1.1.2.2
	Kernel-5_35-4_79_2_240:1.1.2.2
	Kernel-5_35-4_79_2_239:1.1.2.2
	Kernel-5_35-4_79_2_238:1.1.2.2
	Kernel-5_35-4_79_2_237:1.1.2.2
	Kernel-5_35-4_79_2_236:1.1.2.2
	Kernel-5_35-4_79_2_235:1.1.2.2
	Kernel-5_35-4_79_2_234:1.1.2.2
	Kernel-5_35-4_79_2_233:1.1.2.2
	Kernel-5_35-4_79_2_232:1.1.2.2
	Kernel-5_35-4_79_2_231:1.1.2.2
	Kernel-5_35-4_79_2_230:1.1.2.2
	Kernel-5_35-4_79_2_229:1.1.2.1
	Kernel-5_35-4_79_2_228:1.1.2.1
	Kernel-5_35-4_79_2_227:1.1.2.1
	Kernel-5_35-4_79_2_226:1.1.2.1
	Kernel-5_35-4_79_2_225:1.1.2.1
	Kernel-5_35-4_79_2_224:1.1.2.1
	Kernel-5_35-4_79_2_223:1.1.2.1
	Kernel-5_35-4_79_2_222:1.1.2.1
	Kernel-5_35-4_79_2_221:1.1.2.1
	Kernel-5_35-4_79_2_220:1.1.2.1
	Kernel-5_35-4_79_2_219:1.1.2.1
	Kernel-5_35-4_79_2_218:1.1.2.1
	Kernel-5_35-4_79_2_217:1.1.2.1
	Kernel-5_35-4_79_2_216:1.1.2.1
	Kernel-5_35-4_79_2_215:1.1.2.1
	Kernel-5_35-4_79_2_214:1.1.2.1
	Kernel-5_35-4_79_2_213:1.1.2.1
	Kernel-5_35-4_79_2_212:1.1.2.1
	Kernel-5_35-4_79_2_211:1.1.2.1
	Kernel-5_35-4_79_2_210:1.1.2.1
	Kernel-5_35-4_79_2_209:1.1.2.1
	Kernel-5_35-4_79_2_208:1.1.2.1
	Kernel-5_35-4_79_2_207:1.1.2.1
	Kernel-5_35-4_79_2_206:1.1.2.1
	Kernel-5_35-4_79_2_205:1.1.2.1
	Kernel-5_35-4_79_2_204:1.1.2.1
	Kernel-5_35-4_79_2_203:1.1.2.1
	HAL:1.1.0.2;
locks; strict;
comment	@# @;


4.1
date	2016.06.30.20.07.59;	author jlee;	state Exp;
branches;
next	1.1;
commitid	IWoXxARWeuLDOwcz;

1.1
date	2013.12.15.21.34.00;	author jlee;	state dead;
branches
	1.1.2.1;
next	;
commitid	KwuK29hKRyXO7hhx;

1.1.2.1
date	2013.12.15.21.34.00;	author jlee;	state Exp;
branches;
next	1.1.2.2;
commitid	KwuK29hKRyXO7hhx;

1.1.2.2
date	2014.07.20.14.40.01;	author jlee;	state Exp;
branches;
next	;
commitid	H2vibYwcVbxpR7Jx;


desc
@@


4.1
log
@Merge HAL branch to trunk
Detail:
  This change merges the past 15+ years of HAL branch development back to the trunk.
  This is effectively the end for non-HAL builds of the kernel, as no attempt has been made to maintain it during this merge, and all non-HAL & non-32bit code will soon be removed anyway.
  Rather than list everything that's been added to the HAL branch, it's easier to describe the change in terms of the things that the HAL branch was lacking:
  * Trunk version of Docs/32bit contained updated comments for the SVC stack structure during ErrorV
  * Trunk version of s/HeapMan contained a tweak to try and reduce the number of small free blocks that are created
  * Trunk version of s/Kernel contained a change to only copy 248 bytes of the error string to the error buffer (down from 252 bytes), to take into account the extra 4 bytes needed by the PSR. However this goes against the decision that's been made in the HAL branch that the error buffer should be enlarged to 260 bytes instead (ref: https://www.riscosopen.org/tracker/tickets/201), so the HAL build will retain its current behaviour.
  * Trunk version of s/MsgCode had RMNot32bit error in the list of error messages to count when countmsgusage {TRUE}
  * Trunk version of s/PMF/i2cutils contained support for OS_Memory 5, "read/write value of NVRamWriteSize". Currently the HAL branch doesn't have a use for this (in particular, the correct NVRamWriteSize should be specified by the HAL, so there should be no need for software to change it at runtime), and so this code will remain switched out in the HAL build.
Admin:
  Tested on Raspberry Pi


Version 5.48. Tagged as 'Kernel-5_48'
@
text
@; Copyright 2013 Castle Technology Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
        SUBT    VIDC List type 3 format => &.Hdr.VIDCList

OldOpt  SETA    {OPT}
        OPT     OptNoList+OptNoP1List

;
; format of a VIDC list type 3
;
                                ^       0
VIDCList3_Type                  #       4  ; must be '3'
VIDCList3_PixelDepth            #       4  ; Log2BPP
VIDCList3_HorizSyncWidth        #       4
VIDCList3_HorizBackPorch        #       4
VIDCList3_HorizLeftBorder       #       4
VIDCList3_HorizDisplaySize      #       4
VIDCList3_HorizRightBorder      #       4
VIDCList3_HorizFrontPorch       #       4
VIDCList3_VertiSyncWidth        #       4
VIDCList3_VertiBackPorch        #       4
VIDCList3_VertiTopBorder        #       4
VIDCList3_VertiDisplaySize      #       4
VIDCList3_VertiBottomBorder     #       4
VIDCList3_VertiFrontPorch       #       4
VIDCList3_PixelRate             #       4
VIDCList3_SyncPol               #       4  ; sync polarity/flag bits
VIDCList3_ControlList           #       0  ; possibly empty list of pairs of index,value words
;
; and VIDCList3 is terminated by a -1 word
;
; Indices in VIDCList3_ControlList
;
                                ^       1
ControlList_LCDMode             #       1
ControlList_LCDDualPanelMode    #       1
ControlList_LCDOffset0          #       1
ControlList_LCDOffset1          #       1
ControlList_HiResMode           #       1
ControlList_DACControl          #       1
ControlList_RGBPedestals        #       1
ControlList_ExternalRegister    #       1
ControlList_HClockSelect        #       1
ControlList_RClockFrequency     #       1
ControlList_DPMSState           #       1
ControlList_Interlaced          #       1
ControlList_OutputFormat        #       1
ControlList_ExtraBytes          #       1
ControlList_NColour             #       1
ControlList_ModeFlags           #       1
ControlList_InvalidReason       #       0

ControlList_Terminator          *      -1

; bits/flags in VIDCList3_SyncPol word:
;
SyncPol_InvertHSync        *  1   ; 0 = positive, 1 = negative
SyncPol_InvertVSync        *  2   ; 0 = positive, 2 = negative
SyncPol_InterlaceSpecified *  4   ; if set, interlace bit has been specified, else filled in by kernel. Deprecated, use control list item instead.
SyncPol_Interlace          *  8   ; set=interlaced, either specified by service call claimant or filled in from *TV by kernel. Deprecated, use control list item instead.

        OPT     OldOpt

        END
@


1.1
log
@file VIDCList was initially added on branch HAL.
@
text
@d1 76
@


1.1.2.1
log
@Assorted GraphicsV improvements
Detail:
  This set of changes:
  * Adds basic support for multiple GraphicsV drivers, by way of some new OS_ScreenMode reason codes for registering/deregistering, selecting and enumerating drivers (11, 64-68)
  * Tidies up handling of HAL video calls so that the HAL calls will be transformed into a bona fide GraphicsV driver if they're implemented
  * Changes handling of 16bpp gamma table entries so that they're sent to GraphicsV in a generic form instead of in a VIDC-specific form
  * Adds a new GraphicsV call and defines new VIDC list items to allow GraphicsV drivers to utilise the new pixel formats
  File changes:
  * h/VIDCList, hdr/VIDCList, Makefile - Add new header export containing VIDC list type 3 definitions, to avoid repeated definitions in other components
  * Resources/UK/Messages - Add new GraphicsV/OS_ScreenMode error strings and some missing processor type strings
  * hdr/KernelWS - Clean up some pre-GraphicsV definitions, and add new workspace locations for storing the current GraphicsV driver number and the driver list
  * hdr/Options - Remove obsolete InverseTextTransparency option
  * hdr/VduExt - Add VDU variable 192 for storing GraphicsV driver number (same as ROL's VideoV driver number). Remove old 'Flag_*' mode flag definitions (use new 'ModeFlag_*' defintions instead). Add new OS_ScreenMode reason codes.
  * s/ARM600, s/VMSAv6, s/vdu/vdu23, s/vdu/vdugrafa, s/vdu/vdugrafd, s/vdu/vdupalxx, s/vdu/vdupointer, s/vdu/vduwrch - Strip out pre-GraphicsV code. Update GraphicsV code to use correct driver number.
  * s/ArthurSWIs - Pass the default GraphicsV claimant the VduDriverWorkSpace instead of ZeroPage
  * s/Getall - Add Hdr:VIDCList and s/vdu/VduGrafHAL to list of GETs
  * s/NewIRQs - Remove HAL VSync IRQ initialisation, is now handled by grafvhal. Remove old HAL VsyncIRQ entry point, all VSyncs are now handled by VsyncIRQ_ExtEntry.
  * s/PMF/osbyte - Stop OS_Byte 19 waiting forever if no video driver is active
  * s/PMF/osinit - Remove HAL VSync IRQ initialisation, is now handled by grafvhal
  * s/vdu/vducursoft - Use new workspace variable names and flag names
  * s/vdu/vdudecl - Remove old HALDAG_* definitions, GVDAG_* definitions are used instead. Add definition of the per-driver workspace structure and flags.
  * s/vdu/vdudriver - Remove pre-GraphicsV code. Update InitialiseMode to check for and initialise a HAL driver. Use cached driver features word in a few places instead of calling GraphicsV each time. Update PalIndexTable to disable VIDC mangling of 16bpp gamma tables.
  * s/vdu/vdugrafv, s/vdu/vdugrafhal - HAL<->GraphicsV code split off into its own file (vdugrafhal). Default GraphicsV claimant now only deals with VSync events for the active driver.
  * s/vdu/vdumodes - Get rid of old VIDC List type 3 definiton; now in hdr/VIDCList
  * s/vdu/vduswis - Added OS_ScreenMode reason codes 11 and 64-68 for registering, deregistering, selecting and enumerating GraphicsV drivers. Update mode set code to not bother checking if the driver supports the pixel format; instead we assume that the driver's vet mode call will do the check for us.
Admin:
  Tested in Tungsten, IOMD, OMAP3 & BCM2835 ROMs
  Requires HdrSrc-2_38 and updated video driver modes


Version 5.35, 4.79.2.203. Tagged as 'Kernel-5_35-4_79_2_203'
@
text
@a0 76
; Copyright 2013 Castle Technology Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
        SUBT    VIDC List type 3 format => &.Hdr.VIDCList

OldOpt  SETA    {OPT}
        OPT     OptNoList+OptNoP1List

;
; format of a VIDC list type 3
;
                                ^       0
VIDCList3_Type                  #       4  ; must be '3'
VIDCList3_PixelDepth            #       4  ; Log2BPP
VIDCList3_HorizSyncWidth        #       4
VIDCList3_HorizBackPorch        #       4
VIDCList3_HorizLeftBorder       #       4
VIDCList3_HorizDisplaySize      #       4
VIDCList3_HorizRightBorder      #       4
VIDCList3_HorizFrontPorch       #       4
VIDCList3_VertiSyncWidth        #       4
VIDCList3_VertiBackPorch        #       4
VIDCList3_VertiTopBorder        #       4
VIDCList3_VertiDisplaySize      #       4
VIDCList3_VertiBottomBorder     #       4
VIDCList3_VertiFrontPorch       #       4
VIDCList3_PixelRate             #       4
VIDCList3_SyncPol               #       4  ; sync polarity/flag bits
VIDCList3_ControlList           #       0  ; possibly empty list of pairs of index,value words
;
; and VIDCList3 is terminated by a -1 word
;
; Indices in VIDCList3_ControlList
;
                                ^       1
ControlList_LCDMode             #       1
ControlList_LCDDualPanelMode    #       1
ControlList_LCDOffset0          #       1
ControlList_LCDOffset1          #       1
ControlList_HiResMode           #       1
ControlList_DACControl          #       1
ControlList_RGBPedestals        #       1
ControlList_ExternalRegister    #       1
ControlList_HClockSelect        #       1
ControlList_RClockFrequency     #       1
ControlList_DPMSState           #       1
ControlList_Interlaced          #       1  ; deprecated - use the sync/pol flag instead
ControlList_OutputFormat        #       1
ControlList_ExtraBytes          #       1
ControlList_NColour             #       1
ControlList_ModeFlags           #       1
ControlList_InvalidReason       #       0

ControlList_Terminator          *      -1

; bits/flags in VIDCList3_SyncPol word:
;
SyncPol_InvertHSync        *  1
SyncPol_InvertVSync        *  2
SyncPol_InterlaceSpecified *  4   ; if set, interlace bit has been specified, else filled in by kernel
SyncPol_Interlace          *  8   ; set=interlaced, either specified by service call claimant or filled in from *TV by kernel

        OPT     OldOpt

        END
@


1.1.2.2
log
@Reverse interlace deprecation decision
Detail:
  hdr/VIDCList - ControlList_Interlaced is no longer deprecated, instead the sync/pol flags are.
  See discussion on forums for context:
  https://www.riscosopen.org/forum/forums/3/topics/309?page=9#posts-34152
Admin:
  Tested on BB-xM


Version 5.35, 4.79.2.230. Tagged as 'Kernel-5_35-4_79_2_230'
@
text
@d58 1
a58 1
ControlList_Interlaced          #       1
d69 4
a72 4
SyncPol_InvertHSync        *  1   ; 0 = positive, 1 = negative
SyncPol_InvertVSync        *  2   ; 0 = positive, 2 = negative
SyncPol_InterlaceSpecified *  4   ; if set, interlace bit has been specified, else filled in by kernel. Deprecated, use control list item instead.
SyncPol_Interlace          *  8   ; set=interlaced, either specified by service call claimant or filled in from *TV by kernel. Deprecated, use control list item instead.
@


