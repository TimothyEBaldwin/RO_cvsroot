head	4.18;
access;
symbols
	Boot-1_26:4.18
	Boot-1_25:4.18
	Boot-1_24:4.17
	Boot-1_23:4.17
	Boot-1_22:4.16
	Boot-1_21:4.16
	Boot-1_20:4.16
	Boot-1_19:4.16
	Boot-1_18:4.16
	Boot-1_17:4.16
	Boot-1_16:4.15
	Boot-1_15:4.15
	Boot-1_14:4.15
	Boot-1_13:4.15
	Boot-1_12:4.14
	Boot-1_11:4.14
	Boot-1_10:4.13
	Boot-1_09:4.13
	Boot-1_08:4.13
	Boot-1_07:4.13
	Boot-1_06:4.13
	Boot-1_05:4.13
	Boot-1_04:4.12
	Boot-1_03:4.11
	Boot-1_02:4.10
	Boot-1_01:4.9
	Boot-1_00:4.9
	Boot-0_99:4.9
	Boot-0_98:4.8
	Boot-0_97:4.8
	Boot-0_96:4.8
	Boot-0_95:4.8
	Boot-0_94:4.8
	Boot-0_93:4.7
	Boot-0_92:4.7
	Boot-0_91:4.6
	Boot-0_90:4.5
	Boot-0_89:4.4
	Boot-0_88:4.4
	Boot-0_87:4.4
	Boot-0_86:4.4
	Boot-0_85:4.4
	Boot-0_84:4.4
	Boot-0_83:4.4
	Boot-0_82:4.4
	Boot-0_81:4.4
	Boot-0_80:4.4
	Boot-0_79:4.4
	Boot-0_78:4.4
	Boot-0_77:4.4
	Boot-0_76:4.4
	Boot-0_75:4.4
	Boot-0_74:4.4
	Boot-0_73:4.3
	Boot-0_72:4.3
	Boot-0_71:4.2
	Boot-0_70:4.2
	Boot-0_69:4.2
	Boot-0_68:4.2
	Boot-0_67:4.2
	nbingham_boot_991007:4.2
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2
	Ursula_RiscPC:4.2.0.6
	rthornb_UrsulaBuild-19Aug1998:4.2
	UrsulaBuild_FinalSoftload:4.2
	rthornb_UrsulaBuild-12Aug1998:4.2
	aglover_UrsulaBuild-05Aug1998:4.2
	rthornb_UrsulaBuild-29Jul1998:4.2
	rthornb_UrsulaBuild-22Jul1998:4.2
	rthornb_UrsulaBuild-15Jul1998:4.2
	rthornb_UrsulaBuild-07Jul1998:4.2
	rthornb_UrsulaBuild-17Jun1998:4.2
	rthornb_UrsulaBuild-03Jun1998:4.2
	rthornb_UrsulaBuild-27May1998:4.2
	rthornb_UrsulaBuild-21May1998:4.2
	rthornb_UrsulaBuild_01May1998:4.2
	Daytona:4.2.0.4
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	RO_3_71:4.1.3.1
	ART_bp:4.1.1.1
	ART:4.1.1.1.0.2
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.18
date	2016.09.16.08.38.02;	author rsprowson;	state Exp;
branches;
next	4.17;
commitid	ke2k0xw5CSuPuumz;

4.17
date	2015.06.25.21.52.48;	author rsprowson;	state Exp;
branches;
next	4.16;
commitid	RGXIyhJzSrvhkRqy;

4.16
date	2013.05.09.20.10.40;	author rsprowson;	state Exp;
branches;
next	4.15;
commitid	DuPaSmroZvNDJZOw;

4.15
date	2013.03.24.19.06.43;	author rsprowson;	state Exp;
branches;
next	4.14;
commitid	Ioma95nmsRFgR4Jw;

4.14
date	2012.10.08.00.28.39;	author srevill;	state Exp;
branches;
next	4.13;
commitid	S5VuQmfbLiJI2wnw;

4.13
date	2012.09.13.00.19.41;	author srevill;	state Exp;
branches;
next	4.12;
commitid	RQRnOoVJpwptNikw;

4.12
date	2012.09.08.07.25.30;	author rsprowson;	state Exp;
branches;
next	4.11;
commitid	BJTpJBV2hm8wjHjw;

4.11
date	2012.09.07.17.54.24;	author rsprowson;	state Exp;
branches;
next	4.10;
commitid	31IkOAFmM3sgPCjw;

4.10
date	2012.09.01.23.12.53;	author rsprowson;	state Exp;
branches;
next	4.9;
commitid	mVd4G1gchQYhMSiw;

4.9
date	2012.08.22.14.05.04;	author rsprowson;	state Exp;
branches;
next	4.8;
commitid	Hercw3dBKb3m4yhw;

4.8
date	2012.07.22.19.02.12;	author rsprowson;	state Exp;
branches;
next	4.7;
commitid	iqJeZKPz9sb2IAdw;

4.7
date	2012.07.19.18.45.45;	author rsprowson;	state Exp;
branches;
next	4.6;
commitid	GvaPeCASWarsIcdw;

4.6
date	2012.07.19.11.37.27;	author rsprowson;	state Exp;
branches;
next	4.5;
commitid	x6wvxB4CUBaPkadw;

4.5
date	2012.07.15.16.56.27;	author rsprowson;	state Exp;
branches;
next	4.4;
commitid	kBacYOBPRVrWeGcw;

4.4
date	2003.06.10.16.41.54;	author rsprowson;	state Exp;
branches;
next	4.3;

4.3
date	2003.02.13.17.22.42;	author rsprowson;	state Exp;
branches;
next	4.2;

4.2
date	97.05.06.11.29.23;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.52.57;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1;
next	;

4.1.1.1
date	96.11.05.09.52.57;	author nturton;	state Exp;
branches
	4.1.1.1.2.1;
next	;

4.1.1.1.2.1
date	97.04.24.15.09.44;	author kbracey;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.03.47.51;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.18
log
@Remove workaround for pre-RISC OS 3.50
The extra AddToRMA in BootRun is no longer needed, the true cause was a bug fixed in Wimp-5_55 reading IRQsema's address, which caused the RMA to be clamped.
Tested on a real A5000.

Version 1.25. Tagged as 'Boot-1_25'
@
text
@FX 247 2_10101010
FX 229 1

If "<Run$Path>" = ",%." Then Set Run$Path <Boot$Dir>.Library.,,%.
If "<Run$Path>" = "Resources:$.Library.,%.," Then Set Run$Path Resources:$.Library.,<Boot$Dir>.Library.,,%.
 
RMEnsure BootCommands 1.30 RMLoad System:Modules.BootCmds
RMEnsure BootCommands 1.30 Error This !Boot structure requires BootCommands version 1.30 or later
Set Boot$ProgressLoad -progress 0,50
Set Boot$ProgressRun  -progress 50,50
RMEnsure BootCommands 1.44 Unset Boot$Progress*

If Boot$OSVersion < 350 Then RMEnsure CMOSUtils  0.00 RMLoad System:Modules.CMOSUtils
If Boot$OSVersion < 500 Then RMEnsure AppPatcher 0.00 X RMLoad System:Modules.PatchApp

IfThere <Boot$Dir>.^.!Territory Then /<Boot$Dir>.^.!Territory

If Boot$OSVersion >= 350 Then WimpSlot -next 256K
If Boot$OSVersion >= 350 Then FreePool
AddToRMA 768K

Set Alias$BootLoad Echo %%*0|mLoad %%*0|mEcho |<11>|<23>|<8>|<5>|<6>|<0>|<0>|<0>|<0>|<0>|<0>|<11>|m
Set Alias$BootRun  Echo %%*0|mRun %%*0|mEcho |<11>|<23>|<8>|<5>|<6>|<0>|<0>|<0>|<0>|<0>|<0>|<11>|m
Set Alias$BootObey Obey -c %%*0
Set Alias$@@LoadType_FEB BootObey %%*0
Set Alias$@@LoadType_FF2 Error CMOS file found within !Boot (%%0)
Set Alias$@@LoadType_FF8 /%%*0
Set Alias$@@LoadType_FF9 IconSprites %%*0
Set Alias$@@LoadType_FFA RMLoad %%*0
Set Alias$@@LoadType_FFB BASIC -quit %%*0
Set Alias$@@LoadType_FFC /%%*0

/<Boot$Dir>.Utils.HOn

/<Boot$Dir>.Utils.SetChoices
BootObey Choices:Boot.PreDesktop

If "<Wimp$ScrapDir>" = "" Then IfThere <BootResources$Dir>.!Scrap Then /<BootResources$Dir>.!Scrap

IfThere <BootResources$Dir>.!Internet Then /<BootResources$Dir>.!Internet.!Boot
If ("<InetDBase$Path>" <> "") AND ("<Inet$MimeMappings>" = "") Then Set Inet$MimeMappings InetDBase:MimeMap
RMEnsure MimeMap 0.00 X RMReinit MimeMap
RMEnsure MimeMap 0.00 X RMLoad System:Modules.Network.MimeMap

Do Repeat BootLoad <Boot$ToBeLoaded> -files <Boot$ProgressLoad>
Do Repeat BootRun  <Boot$ToBeLoaded> -directories <Boot$ProgressRun>

Unset Alias$@@LoadType_FEB
Unset Alias$@@LoadType_FF8
Set   Alias$@@LoadType_FF9 SLoad %%0
Set   Alias$@@LoadType_FFA RMLoad %%*0
Set   Alias$@@LoadType_FFB Basic -load |"%%0|" %%*1
Unset Alias$@@LoadType_FFC
Unset Alias$BootLoad
Unset Alias$BootRun
Unset Alias$BootObey
Unset Boot$Remote
Unset Boot$Progress*

AppSize 512000K

FX 247 1
FX 229 0
/Choices:Boot.Desktop
@


4.17
log
@Correction to default run path
!Boot was adding its private utilities (!Boot.Utils) to the global run path, which isn't the intent of that directory. Changed singular use of HOn to use a fully qualified path to !Boot.Utils.
User commands should go in !Boot.Library, as before.

Version 1.23. Tagged as 'Boot-1_23'
@
text
@a60 1
If Boot$OSVersion < 350 Then AddToRMA 256K
@


4.16
log
@Boot script fixes
When softloading the Wimp pre RISC OS 3.50 we must kill the BorderUtils module (which gets loaded as a side effect of the Toolbox being loaded when !System is run). While BorderUtils is careful not to fiddle with the workspace of Wimps it doesn't recognise this check is only made when it loads (which passes as the ROM Wimp is acceptable) but subsequent softloading is missed. Generally bad things happen when it pokes the Wimps workspace on every mode change.

PreDesktop scripts were trying to fix up malformed Boot$OSVersions, but since we know we get that right those steps are redundant.

In BootRun the use of AddToRMA hadn't spotted a subtle syntax change.
The AddToRMA utility ignored a trailing 'K' and assumed the number was always in kilobytes. AddToRMA in BootCommands requires a K (or M) suffix otherwise it assumes bytes. So for a number of years only 768 bytes have been added to the RMA, which isn't enough to softload a Wimp on RISC OS 3.10.
As RISC OS 3.10 has no free pool, the AppSize command drains the RMA dry. We push 256K back into it for any subsequent requirements (notably on RISC OS 3.10, sprites are held in the RMA, and the filer seeing some apps could trigger an annoying RMA full error message).

Disabled theme loading on RISC OS 3.10, there's really not enough free RAM to usefully load that many sprites.

Typo in RO310Hook/Boot/Desktop corrected.

Version 1.17. Tagged as 'Boot-1_17'
@
text
@d4 2
a5 2
If "<Run$Path>" = ",%." Then Set Run$Path <Boot$Dir>.Library.,<Boot$Dir>.Utils.,,%.
If "<Run$Path>" = "Resources:$.Library.,%.," Then Set Run$Path Resources:$.Library.,<Boot$Dir>.Library.,<Boot$Dir>.Utils.,,%.
d33 1
a33 1
HOn
@


4.15
log
@Add skeleton hook directory for RISC OS 4.39
Largely a clone of the RO400Hook.
Also
* Update RO400Hook/ResetCMOS to have the right OS version at the end
* In each 'Desktop' file only Filer_Boot the utilities of the same major version number
* BootRun accepts RISC OS Adjust's extra default library prefix, but outputs a corrected Run$Path (where the CSD is checked before the Lib)
* Makefile and docs updated

Tested on RISC OS 4.39, booting to the desktop with no errors.

Version 1.13. Tagged as 'Boot-1_13'
@
text
@d20 1
a20 1
AddToRMA 768
d61 1
@


4.14
log
@Reverted the BootFX bodge now theming is better understood.

The BootFX:PreDesk file is no longer required now it's clear that
the splash screen stuff can't really be themed due to where various
things happen in the boot sequence.

Version 1.11. Tagged as 'Boot-1_11'
@
text
@d5 2
a6 1

@


4.13
log
@Switched the BootFX progress bar on.

Version 1.05. Tagged as 'Boot-1_05'
@
text
@a10 1
X Run BootFX:PreDesk
@


4.12
log
@Add progress hint to repeats
Same as in Boot-1_03 but the switches must come after the command tail according to the help.
Additionally, the option is omitted when an older BootCommands module is present.

Version 1.04. Tagged as 'Boot-1_04'
@
text
@d11 1
@


4.11
log
@Add progress hint to repeats

Version 1.03. Tagged as 'Boot-1_03'
@
text
@d8 3
d44 2
a45 2
Repeat   BootLoad <Boot$ToBeLoaded> -progress 0,50  -files
Repeat   BootRun  <Boot$ToBeLoaded> -progress 50,50 -directories
d57 1
@


4.10
log
@More boot reorganisation
* BootRun no longer bothers checking for CallASWI, since the SharedCLibrary (which is loaded prior to BootRun) does this anyway.
* Try loading the StrongARM app patcher. Note the check is conditioned on 500 since it is assumed any application which has been 32 bitted is now also StrongARM safe, the use of 'X RMLoad' uses cunning on the placement of the PatchApp module in System:Modules.370, thus skipping the load on versions prior to StrongARM too.
* Remove redundant sprite sets from Extras/500 which were no longer being used anyway.
* Import of UserIF specific backdrop textures (Morris4 ones clawed off an old CD, others courtesy of Richard Hallas).
* Makefile rejigged to allow a TARGET=TEXTURES to select which UserIFs to add.
* Updated 'RTexture' to scan the configured theme for its random backdrop in addition to the generics.

Version 1.02. Tagged as 'Boot-1_02'
@
text
@d41 2
a42 2
Repeat   BootLoad <Boot$ToBeLoaded> -files
Repeat   BootRun  <Boot$ToBeLoaded> -directories
@


4.9
log
@Reorder when theme resources are loaded
Needs to be a little later on, after the desktop has been entered, in order that the pended *WIMPMODE command set in Choices:Boot.PreDesk.Configure has been acted upon (so any *ICONSPRITES commands know which is the best resolution to load).
Inlined the (optional) user setting of the theme, rather than unconditionally doing so in Choices:Boot.PreDesktop then having to go back and fix it up again later.
Tested with some different eigen factors with different sprite sets for each, to check the right one gets loaded.

Version 0.99. Tagged as 'Boot-0_99'
@
text
@d10 1
a10 1
If Boot$OSVersion < 500 Then RMEnsure CallASWI   0.00 RMLoad System:Modules.CallASWI
@


4.8
log
@Further convergence
* RO310Hook is now created, but Boot removed (to halt booting on 3.10 until the assembler macros support ARMv2)
* 310/350/360/370/400 predesktop now define Wimp$IconTheme after loading the nested window manager
* 360 now has a default backdrop tiled sprite on entering the desktop
* 400/500/510 now demark sections of 'Desktop' with RISCOS - note, all one word. The installer relies on the lines being of the form '|Start <company> <program> 1.23 <detail>" with a space it would be mis parsed
* Recovered more recent patch for 3.50 from the archives
* Reordered BootRun so the hourglass is on before the (potentially slow) choices directory is cloned
* Added sprites for UserIF=Sovereign

Version 0.94. Tagged as 'Boot-0_94'
@
text
@a34 1
If "<Wimp$IconTheme>" <> "" Then IfThere <BootResources$Dir>.!ThemeDefs Then /<BootResources$Dir>.!ThemeDefs
@


4.7
log
@/Repeat -> Repeat, /AddApp -> AddApp
No longer uses UnplugTBox

Version 0.92. Tagged as 'Boot-0_92'
@
text
@d16 1
a16 3

/<Boot$Dir>.Utils.SetTheme
/<Boot$Dir>.Utils.SetChoices
d30 3
a32 1
AddToRMA 768
d35 1
a41 1
BootObey Choices:Boot.PreDesktop
@


4.6
log
@Try again - CVS bombed out.
Manually tagged as Boot-0_91.
@
text
@a40 1
X BootLoad Boot:Utils.UnplugTbox
@


4.5
log
@Restore a little universality
Makefile updated to use some shared bits.
New (empty) FILES510 definition.
Only !Sprites is mandatory for a given UserIF, !Sprites22 and !Sprites11 may be omitted.
Removed some heading blocks from files deposited on the user's disc.
Copied !Run into locale specific dir since it contains english translations.
Notes moved into Docs dir.

Version 0.90. Tagged as 'Boot-0_90'
@
text
@d6 5
a10 4
RMEnsure VProtect 4.00 RMLoad Boot:Utils.VProtect
If Boot$OSVersion <  350 Then RMEnsure CMOSUtils  0.00 RMLoad Boot:Utils.CMOSUtils
If Boot$OSVersion <  370 Then RMEnsure CallASWI   0.00 RMLoad Boot:Utils.CallASWI
If Boot$OSVersion >= 370 Then RMEnsure AppPatcher 0.00 X RMLoad Boot:Utils.PatchApp
d17 1
d19 1
d34 1
a34 2
If "<System$Path>" = ""   Then Error The !System directory has not been found
If "<Wimp$ScrapDir>" = "" Then IfThere <BootResources$Dir>.!Scrap  Then /<BootResources$Dir>.!Scrap
a35 1
RMEnsure MimeMap 0.00 X RMLoad System:Modules.Network.MimeMap
d38 2
a39 1
X ReadMimeMap
@


4.4
log
@BootRun RMEnsures VProtect 4.00 as that's the first 32 bit one.
BootRun tries to load the mimemap,fixes problem when only ShareFS is
enabled (hence !Internet not run) and the MimeMap never being loaded.
The MimeMap is now a more critical system resource as things like DOSFS
and CDFS use it,not just stuff in the !Internet.

Version 0.74. Tagged as 'Boot-0_74'
@
text
@a0 14
| Copyright 1996 Acorn Computers Ltd
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|     http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
|
@


4.3
log
@Finally got round to storing this stuff.
Many changes,highlights being:
 freepool now creates its 'o' directory in the top Makefile
 safelogin tweaked so it can find its header files again
 stopped EXITS macro moaning about no ENTRYS in Appsize and AddApp
 added 2DTools to universal boot sequence
 Added RO370/400/500Hook though the 370 and 400 are just empty at present
 newer vprotect added from Alan Glover
 add Utils.NetChoices
 delete ~CDReinit binary,shuffle sources a bit
 misc changes to obey files from Steve
The Makefile now expects a TARGET to be defined.Currently the 500 one is
the only one tested,though UNIVERSAL is also defined and outputs a boot
sequence like you would have got with !MkInstall in V0.71.
This picks up files which might differ between boots,and also adds
extra files which change when the UserIF changes.

Version 0.72. Tagged as 'Boot-0_72'
@
text
@d20 1
a20 1
RMEnsure VProtect 2.90 RMLoad Boot:Utils.VProtect
d24 1
d33 1
a33 1
If Boot$OSVersion < 300 then Set Alias$BootObey Obey %%*0 else Set Alias$BootObey Obey -c %%*0
d43 1
d45 7
a51 4
AddToRMA 256
IF "<System$Path>" = ""   Then Error The !System directory has not been found
IF "<Wimp$ScrapDir>" = "" Then IfThere <BootResources$Dir>.!Scrap  Then /<BootResources$Dir>.!Scrap
If <Boot$Remote> Then RMEnsure MBufManager 0.17 BootObey Boot:Utils.NewStack
a53 1

d55 2
a56 4
AddToRMA 768

Repeat BootLoad <Boot$ToBeLoaded> -files
Repeat BootRun  <Boot$ToBeLoaded> -directories
d69 2
a70 1
AppSize 514000K
@


4.2
log
@Version RO_3_71 merged
@
text
@d17 12
a28 4
If "<Run$Path>" = ",%." then Set Run$Path ,%.,<Boot$Dir>.Library.
If Boot$OSVersion >= 300 then RMEnsure VProtect 2.37 RMLoad Boot:Utils.VProtect
If Boot$OSVersion >= 360 then RMEnsure AppPatcher 0.00 RMLoad Boot:Utils.PatchApp
IfThere <Boot$Dir>.MchConfig.<Boot$Unique>.!RO<Boot$OSVersion>CMOS then LoadCMOS Boot:MchConfig.<Boot$Unique>.!RO<Boot$OSVersion>CMOS
d31 1
a31 1
Set Alias$BootRun  Echo %%*0|m/%%*0|mEcho |<11>|<23>|<8>|<5>|<6>|<0>|<0>|<0>|<0>|<0>|<0>|<11>|m
d34 1
d40 10
a49 3
If Boot$OSVersion >= 350 then WimpSlot -next 256K
If Boot$OSVersion >= 350 then /Boot:Utils.FreePool
/Boot:Utils.HOn
d51 5
a55 2
Repeat BootLoad <Choices$Dir>.Boot.PreDesk -files
Repeat BootRun  <Choices$Dir>.Boot.PreDesk -directories
d65 2
@


4.1
log
@Initial revision
@
text
@d18 2
a19 1
If Boot$OSVersion >= 300 then RMEnsure VProtect 1.81 RMLoad Boot:Utils.VProtect
d31 1
a31 1
If Boot$OSVersion >= 350 then WimpSlot -next 100K
@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@d18 1
a18 2
If Boot$OSVersion >= 300 then RMEnsure VProtect 2.37 RMLoad Boot:Utils.VProtect
If Boot$OSVersion >= 360 then RMEnsure AppPatcher 0.00 RMLoad Boot:Utils.PatchApp
d30 1
a30 1
If Boot$OSVersion >= 350 then WimpSlot -next 256K
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@


4.1.1.1.2.1
log
@Merged in RO_3_70.
@
text
@d18 1
a18 2
If Boot$OSVersion >= 300 then RMEnsure VProtect 2.37 RMLoad Boot:Utils.VProtect
If Boot$OSVersion >= 360 then RMEnsure AppPatcher 0.00 RMLoad Boot:Utils.PatchApp
d30 1
a30 1
If Boot$OSVersion >= 350 then WimpSlot -next 256K
@
