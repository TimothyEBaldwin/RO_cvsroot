head	4.10;
access;
symbols
	PS2Driver-0_39:4.10
	PS2Driver-0_38:4.8
	PS2Driver-0_37:4.8
	PS2Driver-0_36:4.8
	PS2Driver-0_35:4.8
	PS2Driver-0_34:4.8
	PS2Driver-0_33:4.7
	PS2Driver-0_32:4.6
	PS2Driver-0_31:4.6
	PS2Driver-0_30:4.6
	PS2Driver-0_29:4.5
	PS2Driver-0_28:4.5
	Ursula_merge:4.2
	nturton_PS2Driver-0_27:4.5
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2
	Ursula_RiscPC:4.2.0.8
	PS2Driver-0_27:4.4
	PS2Driver-0_26:4.3
	nicke_PS2Driver_0_25:4.1.7.5
	rthornb_UrsulaBuild-19Aug1998:4.2
	UrsulaBuild_FinalSoftload:4.2
	rthornb_UrsulaBuild-12Aug1998:4.2
	bavison_PS2Driver-0_20:4.2
	aglover_UrsulaBuild-05Aug1998:4.2
	rthornb_UrsulaBuild-29Jul1998:4.2
	rthornb_UrsulaBuild-22Jul1998:4.2
	rthornb_UrsulaBuild-15Jul1998:4.2
	rthornb_UrsulaBuild-07Jul1998:4.2
	rthornb_UrsulaBuild-17Jun1998:4.2
	PS2Driver-0_25-1_1_2_2:4.1.7.5
	rthornb_UrsulaBuild-03Jun1998:4.2
	rthornb_UrsulaBuild-27May1998:4.2
	rthornb_UrsulaBuild-21May1998:4.2
	rthornb_UrsulaBuild_01May1998:4.2
	afrost_NC2_Generic:4.1.7.4
	Spinner_RCA116:4.1.7.4
	Spinner_B20_2:4.1.7.4
	Spinner_19_3:4.1.7.4
	Spinner_B18:4.1.7.4
	Spinner_B17:4.1.7.4
	Spinner_B15:4.1.7.4
	Spinner_B14:4.1.7.4
	Spinner_B13:4.1.7.4
	Spinner_B12:4.1.7.4
	Spinner_B10:4.1.7.3
	Ursula:4.2.0.6
	Ursula_bp:4.2
	Spinner_B7:4.1.7.3
	Daytona_bp:4.2
	Daytona:4.2.0.2
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.2
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.5
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.10
date	2012.03.02.23.09.45;	author rsprowson;	state Exp;
branches;
next	4.9;
commitid	yTfY0p2OpEu6EmVv;

4.9
date	2009.06.11.21.17.48;	author bavison;	state Exp;
branches;
next	4.8;

4.8
date	2001.03.16.16.01.07;	author sbrodie;	state Exp;
branches;
next	4.7;

4.7
date	2001.03.01.14.10.13;	author sforrest;	state Exp;
branches;
next	4.6;

4.6
date	2000.02.18.14.06.57;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	98.10.30.11.08.41;	author nturton;	state Exp;
branches;
next	4.4;

4.4
date	98.10.22.16.45.22;	author nturton;	state Exp;
branches;
next	4.3;

4.3
date	98.09.04.07.46.55;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.01.21.16.30.26;	author nturton;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.37.09;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.37.09;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.01.38.50;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.00.23;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.53.09;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.03.21.09.45.54;	author tdobson;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.04.23.17.34.58;	author tdobson;	state Exp;
branches;
next	4.1.7.4;

4.1.7.4
date	97.06.03.09.22.46;	author scormie;	state Exp;
branches;
next	4.1.7.5;

4.1.7.5
date	98.06.05.13.53.52;	author smiddle;	state Exp;
branches;
next	;


desc
@@


4.10
log
@Changed KEYV_thing to KeyV_thing to match Hdr:Keyboard.

Version 0.39. Tagged as 'PS2Driver-0_39'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; > Sources.GetAll

;---------------------------------------------------------------------------
;       PS2 mouse driver.
;---------------------------------------------------------------------------

        AREA    |PS2Driver$$Code|, CODE, READONLY, PIC

Module_BaseAddr

;---------------------------------------------------------------------------
;       Get the headers.
;
        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:Machine.<Machine>
        $GetIO
        GET     Hdr:DevNos
        GET     Hdr:ModHand
        GET     Hdr:Services
        GET     Hdr:MsgTrans
        GET     Hdr:ResourceFS
        GET     Hdr:Buffer
        GET     Hdr:FSNumbers
        GET     Hdr:OsBytes
        GET     Hdr:HostFS
        GET     Hdr:NdrDebug
        GET     Hdr:DDVMacros
        GET     Hdr:Proc
        GET     Hdr:Keyboard
        GET     Hdr:Pointer
        GET     Hdr:Debug
        GET     Hdr:Portable

        GET     VersionASM

;---------------------------------------------------------------------------
;       Define global variables.
;

                GBLL    TMLDebug
                GBLL    hostvdu

TMLDebug        SETL    false   ;true ;>>>false
debug           SETL    false   ;true ;>>>false
hostvdu         SETL    false

mod             SETD    false
key             SETD    false
int             SETD    false
drv             SETD    false
table           SETD    false

    [ :LNOT: :DEF: standalone
                GBLL    standalone
standalone      SETL    false
    ]

                GBLL    international
international   SETL    true

                GBLL    CheckForKeyboard
CheckForKeyboard SETL   true

                GBLL    SecondPort
SecondPort      SETL    true

                GBLL    PortInfo
PortInfo        SETL    true

                GBLL    SetMouseStep
SetMouseStep    SETL    true

                GBLL    Fix_MED_04434
Fix_MED_04434   SETL    true

                GBLL    StorkExtraKeys  ;True - extend mapping tables to cope with 'dot' keys
StorkExtraKeys  SETL    true

                GBLL    CaptureInput    ; issue OS_Byte(163,255,byte) on each byte received
CaptureInput    SETL    false

                GBLL    MapWinRToPower  ; this should be true for Funai (1?) build. Off for everyone else
MapWinRToPower  SETL    false

;---------------------------------------------------------------------------
;       Get the sources.
;
                GBLS    GetResFiles
 [ standalone
GetResFiles     SETS    "GET    s.ResFiles"
 |
GetResFiles     SETS    ""
 ]

        GET     Front.s
        GET     Macros.s
        GET     ModHead.s
        $GetResFiles
        GET     PS2Driver.s
        GET     Tail.s

        END
@


4.9
log
@  GET file pathnames changed
Detail:
  Uses suffixed file extensions for compatiblity with both objasm and asasm.
Admin:
  Supplied by Peter Naulls, tested at ROOL

Version 0.38. Not tagged
@
text
@a33 1
        GET     Hdr:KEYV
d40 1
a40 1
        GET     Hdr:CMOS
d45 1
a49 1
        GET     Version
a54 2
;                GBLL    IOMD
;IOMD            SETL    {TRUE}
a115 1
        ;GET     s.Driver
@


4.8
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 0.34. Tagged as 'PS2Driver-0_34'
@
text
@d114 3
a116 3
        GET     s.Front
        GET     s.Macros
        GET     s.ModHead
d118 1
a118 1
        GET     s.PS2Driver
d120 1
a120 1
        GET     s.Tail
@


4.7
log
@
  * Removed dependency on obsolete STB flag.

Detail:

  * STB versions of the module provided support for RCA and IDEA keyboards.
    Support for the RCA variant has been dormant since October 1998: the
    RCASupport flag has been set to FALSE ever since.  I've taken the
    opportunity to remove the code in this version.

    Likewise, support for IDEA keyboards has been similarly removed, but
    only because there is no record of them having been used at all in
    any product, and certainly not recently.  (If required, use CVS to
    merge the support back into later versions.)

    The result of the above activity is that both Desktop and Embedded
    versions are identical, no longer reliant on the STB flag and not
    requiring the new Embedded_UI flag.

Admin:

  * Built and tested on Lazarus 32-bit build.  Desktop variant of the code
    is binary identical to previous versions.

  * StripDepnd support moved from the Makefile to MkClean.

  * Removed build-specific directories in "rm", since these are created
    during assembly.

Version 0.33. Tagged as 'PS2Driver-0_33'
@
text
@d21 2
d72 1
d75 1
@


4.6
log
@PS2Driver now observes key transitions while waiting for KeyV 4, and sends
the list of keys down when KeyV 4 arrives. Another step towards getting
reliable key polling on reset.

Fixes FuncStart (which stopped working when the extra hardware reset was
removed), but IPConfig's double-Alt still isn't working. As far as I can see
it should be possible to make it totally reliable now, but it must be checking
it too early.

Version 0.30. Tagged as 'PS2Driver-0_30'
@
text
@a93 10
                GBLL    RCASupport      ; support extra keys on RCA keyboard and FUNC+digit => Fdigit
RCASupport      SETL    STB :LAND: {FALSE}

; Get the standby header file if we need it.
		GBLS	GET_Standby
 [ RCASupport
GET_Standby	SETS	"        GET     Hdr:Standby"
 ]
$GET_Standby

a95 3

                GBLL    IDEASupport     ; support extra keys on IDEA keyboard
IDEASupport     SETL    STB
@


4.5
log
@Oops.  Get_Standby changed to GET_Standby.  aasm is case sensitive...
@
text
@a78 3
                GBLL    KillAutoRepeat
KillAutoRepeat  SETL    true

@


4.4
log
@Disabled RCASupport, as I don't think anyone uses it any more.

Version 0.27. Tagged as 'PS2Driver-0_27'
@
text
@d105 1
a105 1
$Get_Standby
@


4.3
log
@Merged Spinner branch.
Changed Makefile to use LocalRes:
@
text
@a46 1
        GET     Hdr:Standby
d98 8
a105 1
RCASupport      SETL    STB
@


4.2
log
@Version Spin_merge taken
@
text
@d47 1
d50 1
d97 12
@


4.1
log
@Initial revision
@
text
@d93 3
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@a92 3
                GBLL    StorkExtraKeys  ;True - extend mapping tables to cope with 'dot' keys
StorkExtraKeys  SETL    true

@


4.1.7.2
log
@Version 0.20 TMD - Added changes to make FUNC+digit into Fdigit.
@
text
@a95 3
		GBLL	RCASupport	; support extra keys on RCA keyboard and FUNC+digit => Fdigit
RCASupport	SETL	true

@


4.1.7.3
log
@Version 0.21: TMD Added support for IDEA 122-key keyboard.
@
text
@a98 6
		GBLL	CaptureInput	; issue OS_Byte(163,255,byte) on each byte received
CaptureInput	SETL	false

		GBLL	IDEASupport	; support extra keys on IDEA keyboard
IDEASupport	SETL	true

@


4.1.7.4
log
@Added support for POWER key on RCA keyboard.
@
text
@a46 1
        GET     Hdr:Standby
@


4.1.7.5
log
@Merged in the new Windows keys definitions that have been added to the Trunk version of
this module. This results in a clash as the righ Windows key has a proper definition but
the Funai NC build expects it to generate the same code as the handset POWER key. At some
point the module that relies on this code (presumably Standby) should be changed to pick up
the correct code. In the mean time there is a variable to control which mapping is used and
it set to use the correct mapping. Beware - if this module is used in a Funai build it will
need changing back.
Also converted the module to use srccommit (of course).

Version 0.25, 1.1.2.2. Tagged as 'PS2Driver-0_25-1_1_2_2'
@
text
@a49 1
        GET     VersionASM
a104 3

		GBLL	MapWinRToPower	; this should be true for Funai build. Off for everyone else
MapWinRToPower	SETL	false
@


4.1.5.1
log
@Import from SrcFiler
@
text
@a92 3
                GBLL    StorkExtraKeys  ;True - extend mapping tables to cope with 'dot' keys
StorkExtraKeys  SETL    true

@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@a92 3
                GBLL    StorkExtraKeys  ;True - extend mapping tables to cope with 'dot' keys
StorkExtraKeys  SETL    true

@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
