head	4.1;
access;
symbols
	DualSerial-0_25-4_8_2_16-1:4.1.10.3
	DualSerial-0_25-4_8_2_16:4.1.10.3
	DualSerial-0_25-4_8_2_15:4.1.10.3
	DualSerial-0_25-4_8_2_14:4.1.10.3
	DualSerial-0_25-4_8_2_13:4.1.10.3
	DualSerial-0_25-4_8_2_12:4.1.10.3
	DualSerial-0_25-4_8_2_11:4.1.10.3
	DualSerial-0_29:4.1
	DualSerial-0_25-4_8_2_10:4.1.10.2
	RO_5_07:4.1.10.2
	DualSerial-0_28:4.1
	DualSerial-0_25-4_8_2_9:4.1.10.2
	DualSerial-0_25-4_8_2_8:4.1.10.2
	DualSerial-0_25-4_8_2_7:4.1.10.1
	DualSerial-0_25-4_8_2_6:4.1.10.1
	DualSerial-0_27:4.1
	DualSerial-0_25-4_8_2_5:4.1.10.1
	DualSerial-0_25-4_8_2_4:4.1.10.1
	DualSerial-0_25-4_8_2_3:4.1.10.1
	DualSerial-0_25-4_8_2_2:4.1.10.1
	DualSerial-0_25-4_8_2_1:4.1.10.1
	HAL:4.1.0.10
	DualSerial-0_26:4.1
	DualSerial-0_25:4.1
	kbracey_32bit_merge:4.1
	DualSerial-0_24-4_7_2_4:4.1
	DualSerial-0_24-4_7_2_3:4.1
	DualSerial-0_24-4_7_2_2:4.1
	dellis_autobuild_BaseSW:4.1
	DualSerial-0_24-4_7_2_1:4.1
	kbracey_32bit:4.1.0.8
	DualSerial-0_24:4.1
	sbrodie_sedwards_16Mar2000:4.1
	DualSerial-0_23:4.1
	dcotton_autobuild_BaseSW:4.1
	DualSerial-0_22:4.1
	DualSerial-0_21:4.1
	DualSerial-0_18:4.1
	Daytona_merge:4.1
	DualSerial-0_17:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.7.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1;
locks; strict;
comment	@# @;


4.1
date	96.11.21.12.06.26;	author nturton;	state Exp;
branches
	4.1.4.1
	4.1.5.1
	4.1.7.1
	4.1.10.1;
next	;

4.1.4.1
date	98.07.21.13.36.46;	author wturner;	state dead;
branches;
next	;

4.1.5.1
date	96.11.21.12.06.26;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.45.42;	author nturton;	state Exp;
branches;
next	;

4.1.10.1
date	2001.03.16.19.42.11;	author kbracey;	state Exp;
branches;
next	4.1.10.2;

4.1.10.2
date	2004.07.02.12.44.28;	author bavison;	state Exp;
branches;
next	4.1.10.3;

4.1.10.3
date	2012.06.04.23.36.13;	author jlee;	state Exp;
branches;
next	;
commitid	lqDFJl0aX8rOLr7w;


desc
@@


4.1
log
@Initial revision
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;
; 		Copyright 1996 Acorn Network Computing
;
;  This material is the confidential trade secret and proprietary
;  information of Acorn Network Computing. It may not be reproduced,
;  used, sold, or transferred to any third party without the prior
;  written consent of Acorn Network Computing. All rights reserved.
;
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; Sets border colour
;
colour_off   * &40000000
colour_red   * &400000ff
colour_blue  * &40ff0000
colour_green * &4000ff00

        	MACRO
$label  	SetColour $colour
$label
 [ debug
		Push	"r0-r1"
		MOV	r0, #&3500000
		LDR	r1, =colour_$colour
		STR	r1, [r0]
		Pull	"r0-r1"
 ]
        	MEND

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; Calls buffer manager service routine
;
                MACRO
$label          CallBuffMan     $cc

$label          Push    "r12,lr"		; save our workspace ptr
                ADR$cc   r12, BuffManWkSpace    ; buffman workspace and entry
                MOV$cc   lr, pc                 ; return address
                ASSERT  BuffManService = BuffManWkSpace+4
                LDM$cc.IA r12, {r12, pc}        ; load buffman wkspace and entry
                Pull    "r12,lr"                ; restore our workspace ptr

                MEND

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                END
@


4.1.10.1
log
@First pass at HAL-type stuff. Will now do an arbitrary number of serial ports.
Actually authored by DEllis.

Version 0.25, 4.8.2.1. Tagged as 'DualSerial-0_25-4_8_2_1'
@
text
@a66 21

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; Calls HAL routine
;
                MACRO
$label          CallHAL         $call
 [ nohal_debug
                SWI     XOS_WriteS
                =       "bleugh no HAL!!", 10, 13, 0
                ALIGN
 |
$label          Push    "r12"
                LDR     r0, PortNumber
                MOV     lr, pc
                LDR     pc, $call
                Pull    "r12"
 ]
                MEND
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

@


4.1.10.2
log
@Changes from Kevin: support for clearing the interrupt when it has been
serviced using HAL_IRQClear.

Version 0.25, 4.8.2.8. Tagged as 'DualSerial-0_25-4_8_2_8'
@
text
@d73 1
a73 1
$label          CallHAL         $call, $noport
a79 1
 [ "$noport" = ""
a80 1
 ]
@


4.1.10.3
log
@Rewrite module to add support for acting as a client of SerialSupport
Detail:
  In order to act as a client of SerialSupport, DualSerial needs to support the set of device calls that SerialSupport uses to talk to the serial driver.
  This set of device calls operates at a lower level than the IOCtl interface which DualSerial already supports.
  Therefore simply adding the new device call interface ontop of DualSerial (or modifying SerialSupport to add IOCtl support) would have been a risky venture, due to the many complexities hidden in the Serial module sources.
  So to reduce the amount of risk inherent in the change, I've instead taken the Serial module, stripped out 6551 support, rewritten the 710 interface to use HAL calls, and then bolted the IOCtl interface on top.
  This should ensure the SerialSupport/OS_SerialOp interface is identical to that provided by the Serial module, and only the simpler to understand DualSerial/IOCtl interface is the one likely to contain any bugs.
  File changes:
  - Docs/serial.htm - Added a copy of the IOCtl interface docs, from the Ursula branch
  - s/common, s/errors, s/init, s/macros, s/main - New implementation of the module, based around modified Serial sources
  - s/serialhal - The business end of the module, based around s/Serial710 in the Serial sources
  - s/ioctl - New file containing reimplemented IOCtl interface
  - s/devicecall, s/hardware, s/interrupts, s/standalone - Deleted redundant files from old implementation
  - Makefile - Trimmed somewhat redundant comment
  - resources/UK/messages - Added new error messages
Admin:
  Tested in OMAP3 & Tungsten ROMs


Version 0.25, 4.8.2.11. Tagged as 'DualSerial-0_25-4_8_2_11'
@
text
@a14 2
; > Macros
; 
d16 1
a16 1
;               Copyright 1996 Acorn Network Computing
a24 1
; Define macros used by the serial device driver continually.
d26 20
a45 22

                MACRO
$label          DebugFrame $condition, $reg, $size
              [ debug$condition
$label          Push    "r0-r2"
                MOV     r0, $reg
                MOV     r1, #0
00
                LDR     r2, [r0, r1]
                Debuga  ,"frame contents at offset", r1
                Debug   ," =>", r2
                ADD     r1, r1, #4
                TEQ     r1, #$size
                BNE     %00
                Pull    "r0-r2"
              ]
                MEND

                MACRO
$label          ErrorTable $errorname, $base
$label          DCD     (ErrorBlock_$errorname)-$base
                MEND
d56 1
a56 1
$label          Push    "r12,lr"                ; save our workspace ptr
d74 5
d86 1
d90 1
@


4.1.4.1
log
@Rightio, we'll try for a real log this time...

Files deleted due to CVSs incompetency in replacing them with newer
differently named ones. Next, you'll see the new files arrive, with
a more descriptive log of what & why.
@
text
@@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@
