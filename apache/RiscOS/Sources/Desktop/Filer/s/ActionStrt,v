head	4.4;
access;
symbols
	Filer-2_43:4.4
	Filer-2_42:4.4
	Filer-2_41:4.4
	Filer-2_40:4.4
	Filer-2_39:4.4
	Filer-2_38:4.4
	Filer-2_37:4.4
	Filer-2_36:4.4
	Filer-2_35:4.4
	Filer-2_34:4.4
	Filer-2_33:4.4
	Filer-2_32:4.4
	Filer-2_31:4.4
	Filer-2_30:4.4
	Filer-2_29:4.4
	Filer-2_28:4.4
	Filer-2_27:4.4
	Filer-2_26:4.4
	Filer-2_25:4.3
	Filer-2_24:4.3
	Filer-2_23:4.3
	Filer-2_22:4.3
	Filer-2_21:4.3
	Filer-2_20:4.3
	Filer-2_19:4.3
	Filer-2_18:4.3
	Filer-2_17:4.3
	Filer-2_16:4.3
	Filer-2_15:4.3
	Filer-2_14:4.3
	Filer-2_13:4.3
	Filer-2_12:4.3
	Filer-2_11:4.3
	Filer-2_10:4.3
	Filer-2_09:4.3
	RO_5_07:4.3
	Filer-2_08:4.3
	Filer-2_07:4.3
	Filer-2_06:4.3
	Filer-2_05:4.3
	Filer-2_04:4.3
	Filer-2_03:4.3
	Filer-2_02:4.3
	Filer-2_01:4.3
	Filer-2_00:4.2
	Filer-1_99:4.2
	Filer-1_98:4.2
	Filer-1_97:4.2
	Ursula_merge:4.1.4.2
	Filer-1_96:4.2
	Filer-1_95:4.1.4.2
	nturton_Filer-1_85:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.2
	Ursula_RiscPC:4.1.4.2.0.2
	rthornb_UrsulaBuild-19Aug1998:4.1.4.2
	UrsulaBuild_FinalSoftload:4.1.4.2
	rthornb_UrsulaBuild-12Aug1998:4.1.4.2
	aglover_UrsulaBuild-05Aug1998:4.1.4.2
	rthornb_UrsulaBuild-29Jul1998:4.1.4.2
	rthornb_UrsulaBuild-22Jul1998:4.1.4.2
	rleggett_Filer-1_94:4.1.4.2
	rthornb_UrsulaBuild-15Jul1998:4.1.4.2
	rthornb_UrsulaBuild-07Jul1998:4.1.4.2
	rthornb_UrsulaBuild-17Jun1998:4.1.4.2
	rthornb_UrsulaBuild-03Jun1998:4.1.4.2
	rthornb_UrsulaBuild-27May1998:4.1.4.2
	rleggett_Filer-1_93:4.1.4.2
	rthornb_UrsulaBuild-21May1998:4.1.4.2
	rthornb_UrsulaBuild_01May1998:4.1.4.2
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.4
date	2010.10.23.18.02.28;	author rsprowson;	state Exp;
branches;
next	4.3;

4.3
date	2001.03.16.17.09.21;	author sbrodie;	state Exp;
branches;
next	4.2;

4.2
date	99.08.17.11.56.13;	author sbrodie;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.29.19;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.29.19;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.27.00;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	97.09.12.09.17.24;	author rleggett;	state Exp;
branches;
next	4.1.4.2;

4.1.4.2
date	97.09.24.13.26.27;	author rleggett;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.15.52;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.15.43;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.4
log
@Fix for 'set type' writeable icon being out of step with the disc.
Adjust clicking would recreate the menu immediately after the operation but before the next wimp poll when the directory gets recached, so the first entry in the cache is manually fixed up so the recreated menu is right (the files all get refreshed later anyway).
Collapsed switch 'Fix003', after 21 years of testing it's safe to assume it's good.
Reinstated ExtractCMOSOptions conditional on not OptionsAreInRAM so that combination still assembles.
Optimise MUL/ADD into MLA where possible, and set 'S' flag on ALU operations when followed by TEQ#0.
Tested with & without filer action running, fixes ticket 254.

Version 2.26. Tagged as 'Filer-2_26'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
 [ actionwind
        LTORG
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; Action Window Handling
; ======================
; -----------------------------------------------------------------------------
;
; StartActionWindow
;
; Entry -
;[ version >= 113
; r0    Minimum memory to attempt to start task with
;]
; Exit
; r0    Task handle or 0 if dead at birth
;

ActionWindowCommand     DCB "*"
ActionWindowModuleName  DCB "Filer_Action",0
        ALIGN

StartActionWindow Entry "r1-r6"
      [ version >= 113

        ; Check the memory is enough to do the operation
        MOV     r6, r0
        MOV     r0, #-1
        MOV     r1, #-1
        SWI     XWimp_SlotSize
        EXIT    VS
        CMP     r2, r6
        MOVLT   r0, #0
        EXIT    LT

        ; Check the Filer_Action module is present
        MOV     r0, #ModHandReason_LookupName
        ADR     r1, ActionWindowModuleName
        SWI     XOS_Module
        BVC     %FT10
        LDR     r1, [r0, #0]    ; error number
        LDR     r2, =ErrorNumber_RMNotFound
        TEQ     r1, r2
        MOVEQ   r0, #0          ; Emulate dead task if module not found
        CLRV    EQ
        EXIT
10
      ]

        ADR     r0, ActionWindowCommand
        SWI     XWimp_StartTask
        EXIT

      [ :LNOT: OptionsAreInRAM
ExtractCMOSOptions Entry "r3"
        BL      ReadCMOSBits
        MOV     r2, #0
        TST     r3, #confirm_cmos_bit
        ORRNE   r2, r2, #Action_OptionConfirm
        TST     r3, #verbose_cmos_bit
        ORRNE   r2, r2, #Action_OptionVerbose
        TST     r3, #force_cmos_bit
        ORRNE   r2, r2, #Action_OptionForce
        TST     r3, #newer_cmos_bit
        ORRNE   r2, r2, #Action_OptionNewer
        EXIT
      ]
      
SendSelectedFiles Entry "r1-r5"
10      CMP     r5, #Nowt
        EXIT    EQ
        LDR     r1, sel_leafname
        SWI     XFilerAction_SendSelectedFile
        EXIT    VS
        BL      GetSelection
        B       %BT10


; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; SendWasSelectedFiles

SendWasSelectedFiles Entry "r1-r5"
10      CMP     r5, #Nowt
        EXIT    EQ
        LDR     r1, sel_leafname
        SWI     XFilerAction_SendSelectedFile
        EXIT    VS
        BL      GetWasSelection
        B       %BT10


       LTORG
 ]


        END
@


4.3
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 2.01. Tagged as 'Filer-2_01'
@
text
@d68 15
a82 16

; ExtractCMOSOptions - no longer needed. Options stored in fileraction_options
; word within module workspace.
;ExtractCMOSOptions Entry "r3"
;        BL      ReadCMOSBits
;        MOV     r2, #0
;        TST     r3, #confirm_cmos_bit
;        ORRNE   r2, r2, #Action_OptionConfirm
;        TST     r3, #verbose_cmos_bit
;        ORRNE   r2, r2, #Action_OptionVerbose
;        TST     r3, #force_cmos_bit
;        ORRNE   r2, r2, #Action_OptionForce
;        TST     r3, #newer_cmos_bit
;        ORRNE   r2, r2, #Action_OptionNewer
;        EXIT

@


4.2
log
@Merged Ursula branch.
Moved to srccommit.

Version 1.96. Tagged as 'Filer-1_96'
@
text
@d37 1
a37 1
StartActionWindow ENTRY "r1-r6"
d71 1
a71 1
;ExtractCMOSOptions ENTRY "r3"
d84 1
a84 1
SendSelectedFiles ENTRY "r1-r5"
d98 1
a98 1
SendWasSelectedFiles ENTRY "r1-r5"
d106 1
a106 1
 
d110 2
a111 2
 
 
@


4.1
log
@Initial revision
@
text
@d68 15
a82 12
ExtractCMOSOptions ENTRY "r3"
        BL      ReadCMOSBits
        MOV     r2, #0
        TST     r3, #confirm_cmos_bit
        ORRNE   r2, r2, #Action_OptionConfirm
        TST     r3, #verbose_cmos_bit
        ORRNE   r2, r2, #Action_OptionVerbose
        TST     r3, #force_cmos_bit
        ORRNE   r2, r2, #Action_OptionForce
        TST     r3, #newer_cmos_bit
        ORRNE   r2, r2, #Action_OptionNewer
        EXIT
d93 16
a108 1
        LTORG
d110 2
@


4.1.4.1
log
@Added code to enable files to be copied to icon bar device icons
@
text
@d90 1
a90 17

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; SendWasSelectedFiles

SendWasSelectedFiles ENTRY "r1-r5"
10      CMP     r5, #Nowt
        EXIT    EQ
        LDR     r1, sel_leafname
        SWI     XFilerAction_SendSelectedFile
        EXIT    VS
        BL      GetWasSelection
        B       %BT10
 

crrml  DCB 10
       LTORG
a91 2
 
 
@


4.1.4.2
log
@Add new options to Options menu, plus fixed bugs
@
text
@d68 12
a79 15

; ExtractCMOSOptions - no longer needed. Options stored in fileraction_options
; word within module workspace.
;ExtractCMOSOptions ENTRY "r3"
;        BL      ReadCMOSBits
;        MOV     r2, #0
;        TST     r3, #confirm_cmos_bit
;        ORRNE   r2, r2, #Action_OptionConfirm
;        TST     r3, #verbose_cmos_bit
;        ORRNE   r2, r2, #Action_OptionVerbose
;        TST     r3, #force_cmos_bit
;        ORRNE   r2, r2, #Action_OptionForce
;        TST     r3, #newer_cmos_bit
;        ORRNE   r2, r2, #Action_OptionNewer
;        EXIT
d105 1
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
