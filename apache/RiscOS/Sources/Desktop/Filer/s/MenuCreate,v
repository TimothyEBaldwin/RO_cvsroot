head	4.12;
access;
symbols
	Filer-2_43:4.12
	Filer-2_42:4.12
	Filer-2_41:4.12
	Filer-2_40:4.12
	Filer-2_39:4.12
	Filer-2_38:4.12
	Filer-2_37:4.12
	Filer-2_36:4.12
	Filer-2_35:4.12
	Filer-2_34:4.12
	Filer-2_33:4.11
	Filer-2_32:4.11
	Filer-2_31:4.11
	Filer-2_30:4.11
	Filer-2_29:4.11
	Filer-2_28:4.11
	Filer-2_27:4.11
	Filer-2_26:4.11
	Filer-2_25:4.11
	Filer-2_24:4.11
	Filer-2_23:4.10
	Filer-2_22:4.10
	Filer-2_21:4.9
	Filer-2_20:4.8
	Filer-2_19:4.8
	Filer-2_18:4.8
	Filer-2_17:4.8
	Filer-2_16:4.8
	Filer-2_15:4.7
	Filer-2_14:4.7
	Filer-2_13:4.7
	Filer-2_12:4.7
	Filer-2_11:4.6
	Filer-2_10:4.6
	Filer-2_09:4.6
	RO_5_07:4.6
	Filer-2_08:4.6
	Filer-2_07:4.6
	Filer-2_06:4.6
	Filer-2_05:4.5
	Filer-2_04:4.5
	Filer-2_03:4.5
	Filer-2_02:4.5
	Filer-2_01:4.5
	Filer-2_00:4.4
	Filer-1_99:4.3
	Filer-1_98:4.3
	Filer-1_97:4.3
	Ursula_merge:4.1.4.5
	Filer-1_96:4.2
	Filer-1_95:4.1.4.5
	nturton_Filer-1_85:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.5
	Ursula_RiscPC:4.1.4.5.0.2
	rthornb_UrsulaBuild-19Aug1998:4.1.4.5
	UrsulaBuild_FinalSoftload:4.1.4.5
	rthornb_UrsulaBuild-12Aug1998:4.1.4.5
	aglover_UrsulaBuild-05Aug1998:4.1.4.5
	rthornb_UrsulaBuild-29Jul1998:4.1.4.5
	rthornb_UrsulaBuild-22Jul1998:4.1.4.5
	rleggett_Filer-1_94:4.1.4.5
	rthornb_UrsulaBuild-15Jul1998:4.1.4.5
	rthornb_UrsulaBuild-07Jul1998:4.1.4.5
	rthornb_UrsulaBuild-17Jun1998:4.1.4.5
	rthornb_UrsulaBuild-03Jun1998:4.1.4.4
	rthornb_UrsulaBuild-27May1998:4.1.4.4
	rleggett_Filer-1_93:4.1.4.4
	rthornb_UrsulaBuild-21May1998:4.1.4.4
	rthornb_UrsulaBuild_01May1998:4.1.4.4
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.12
date	2013.11.24.12.33.02;	author rsprowson;	state Exp;
branches;
next	4.11;
commitid	qgjIfJ3IKLI7Owex;

4.11
date	2010.03.07.08.26.14;	author rsprowson;	state Exp;
branches;
next	4.10;

4.10
date	2010.01.07.21.52.56;	author rool;	state Exp;
branches;
next	4.9;

4.9
date	2010.01.07.21.43.30;	author rool;	state Exp;
branches;
next	4.8;

4.8
date	2007.11.05.18.45.11;	author srevill;	state Exp;
branches;
next	4.7;

4.7
date	2007.09.18.13.23.30;	author srevill;	state Exp;
branches;
next	4.6;

4.6
date	2003.01.09.15.58.11;	author bavison;	state Exp;
branches;
next	4.5;

4.5
date	2001.03.16.17.09.22;	author sbrodie;	state Exp;
branches;
next	4.4;

4.4
date	2000.11.14.11.07.39;	author sbrodie;	state Exp;
branches;
next	4.3;

4.3
date	2000.04.20.16.21.12;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	99.08.17.11.56.31;	author sbrodie;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.29.23;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.29.23;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.27.20;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	97.08.27.09.08.57;	author rleggett;	state Exp;
branches;
next	4.1.4.2;

4.1.4.2
date	97.09.24.13.26.36;	author rleggett;	state Exp;
branches;
next	4.1.4.3;

4.1.4.3
date	97.10.21.09.38.25;	author rleggett;	state Exp;
branches;
next	4.1.4.4;

4.1.4.4
date	98.01.07.10.27.52;	author rleggett;	state Exp;
branches;
next	4.1.4.5;

4.1.4.5
date	98.06.10.09.45.13;	author rleggett;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.16.33;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.16.02;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.12
log
@Add support for sorting dir contents numerically as well as alphabetically
New option to the display menu "Numerical sort" modifies the existing 4 sort methods (name, size, type, date) to sort by interpreting any numbers as cardinals. This modifier only really has effect on "Sort by name" since the other three already sort numerically.
This means for example a dir containing "File9,File10,File11" will appear in that order, whereas sorting by name alone would show "File10,File11,File9".

SelStuff0.s/SelStuff.s/Gets.s: Removed. Single function placed into SelStuff.
ModHdr.s/OpenDir.s/Commands.s/DebugFlags.s: Decoding of -NumericalSort switch, switched out undocumented 'Query' flags.
DecodeMenu.s/MenuCreate.s: Handle menu entry, simplify rename code a little.
HelpSrc.s/Messages: Extra help text.
SortDir.s: Pass option flag to Territory_Collate.
WkspEtc.s: Corrected definition of db_sm_type and db_sm_size.

Version 2.34. Tagged as 'Filer-2_34'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;                        Menu handling routines
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

rom_menustart ; Note - must be defined bottom up

; Display control submenu
; =======================

m_display                       Menu    "MT0T"
mo_display_large                Item    "MT00"
mo_display_small                Item    "MT01"
mo_display_fullinfo             Item    "MT02",,"-"
mo_display_sortname             Item    "MT03"
mo_display_sorttype             Item    "MT04"
mo_display_sortsize             Item    "MT05"
mo_display_sortdate             Item    "MT06",,"-"
mo_display_sortorder            Item    "MT07"
mo_display_sortnumeric          Item    "MT08"

; Options control submenu
; =======================

 [ OptionsAreInRAM
m_options                       Menu    "MT4T"
mo_options_confirm              Item    "MT40"
mo_options_confirmdeletes       Item    "MT44",,"-"
mo_options_verbose              Item    "MT41"
mo_options_force                Item    "MT42"
mo_options_newer                Item    "MT43"
mo_options_faster               Item    "MT45"
 |
m_options                       Menu    "MT4T"
mo_options_confirm              Item    "MT40"
mo_options_verbose              Item    "MT41"
mo_options_force                Item    "MT42"
mo_options_newer                Item    "MT43"
 ]

; Writeable leafname submenu (for Copy/Rename)
; ==========================

m_writeable_filename            Menu    "MT11T"
mo_writeable_filename           Item    "MT110",,"W"


; Writeable leafname submenu (for CDir - leaves loophole for RuneMeisters)
; ==========================

;m_writeable_cdirname            Menu    "MT5T"
;mo_writeable_cdirname           Item    "MT50",,"W"

; Writeable filetype submenu
; ==========================

m_writeable_filetype            Menu    "MT18T"
mo_writeable_filetype           Item    "MT180",,"W"


 [ version >= 155

; Writeable findname submenu
; ==========================

m_writeable_findname            Menu    "MT17T"
mo_writeable_findname           Item    "MT170",,"W"

 ]

; Access submenu
; ==============

m_file_access                   Menu    "MT13T"
mo_file_access_locked           Item    "MT130"
mo_file_access_unlocked         Item    "MT131",,"-"
mo_file_access_publicread       Item    "MT132"
mo_file_access_nopublicread     Item    "MT133",,"-"
mo_file_access_other            Item    "MT134",,"N"


; File operations submenu
; =======================

m_file                          Menu    "MT1T"
mo_file_copy                    Item    "MT10",,"N"
mo_file_rename                  Item    "MT11",m_writeable_filename
mo_file_delete                  Item    "MT12"
mo_file_access                  Item    "MT13",m_file_access,">"
mo_file_count                   Item    "MT14"
mo_file_help                    Item    "MT15"
mo_file_info                    Item    "MT16",,"N"
 [ version >= 155
mo_file_find                    Item    "MT17",m_writeable_findname
 |
mo_file_find                    Item    "MT17",m_writeable_filename
 ]
mo_file_settype                 Item    "MT18",m_writeable_filetype
mo_file_stamp                   Item    "MT19"


; Main Filer menu
; ================

; Need to put max length names in for indirect objects so we can suss width

m_main                          Menu    "MTT"
mo_main_display                 Item    "MT0",m_display
mo_main_filexxx                 Item    "MT1",m_file,">"
mo_main_selectall               Item    "MT2"
mo_main_clearsel                Item    "MT3"
mo_main_options                 Item    "MT4",m_options
mo_main_newdir                  Item    "MT5",,"N"
;mo_main_newdir                  Item    "MT5",m_writeable_cdirname
 [ SetDirectoryComesFirst
  [ AddSetDirectory
mo_main_setdir                  Item    "MT7"
  ]
mo_main_openparent              Item    "MT6"
 |
mo_main_openparent              Item    "MT6"
  [ AddSetDirectory
mo_main_setdir                  Item    "MT7"
  ]
 ]
mo_main_refresh                 Item    "MT8"
        DCB     0               ; Indicates end of menu list

; Validation strings (these must be international too).
ms_filetype_validation          DCB     "MTFiletype_Validation", 0
ms_filename_validation_cdir     DCB     "MTDirname_Validation", 0
ms_filename_validation_norm     DCB     "MTFilename_Validation", 0
 [ version >= 155
ms_filename_validation_find     DCB     "MTFindname_Validation", 0
 ]

        ALIGN

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; CopyMenus
; =========

; Copy menu structures into ram, relocating as we go

CopyMenus Entry "r0-r11"

 [ debugmenu
        DLINE   "CopyMenus"
 ]

        ; Prepare some values for messagetrans operations.
        ADR     r0, messagetrans_struct
        MOV     r4, #0
        MOV     r5, #0
        MOV     r6, #0
        MOV     r7, #0

        ; Point at writeable leafname
        ADRL    r1, ms_writeable_leafname
        STR     r1, m_writeable_filename + m_headersize + mi_icondata + ii_buffer

        ; Get validation string
        ADR     r1, ms_filename_validation_norm
        MOV     r2, #0
        SWI     XMessageTrans_Lookup
        EXIT    VS
        STR     r2, m_writeable_filename + m_headersize + mi_icondata + ii_validation

        ; Store length
        MOV     r1, #?ms_writeable_leafname
        STR     r1, m_writeable_filename + m_headersize + mi_icondata + ii_length

        ; Point at writeable cdirname
      ;[ version >= 138
      ;  ADRL    r1, ms_writeable_dirname
      ;|
      ;  ADRL    r1, ms_writeable_leafname
      ;]
      ;  STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_buffer

        ; Get validation string
        ;ADR     r1, ms_filename_validation_cdir
        ;MOV     r2, #0
        ;SWI     XMessageTrans_Lookup
        ;EXIT    VS
        ;STR     r2, m_writeable_cdirname + m_headersize + mi_icondata + ii_validation

        ; Store length
      ;[ version >= 138
      ;  MOV     r1, #?ms_writeable_dirname
      ;|
      ;  MOV     r1, #?ms_writeable_leafname
      ;]
      ;  STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_length

        ; Point at writeable filetype
        ADR     r1, ms_writeable_filetype
        STR     r1, m_writeable_filetype + m_headersize + mi_icondata + ii_buffer

        ; Get validation string
        ADRL    r1, ms_filetype_validation
        MOV     r2, #0
        SWI     XMessageTrans_Lookup
        EXIT    VS
        STR     r2, m_writeable_filetype + m_headersize + mi_icondata + ii_validation

        ; Store length
        MOV     r1, #?ms_writeable_filetype
        STR     r1, m_writeable_filetype + m_headersize + mi_icondata + ii_length

      [ version >= 155
        ; Point at writeable findname
        ADRL    r1, ms_writeable_findname
        STR     r1, m_writeable_findname + m_headersize + mi_icondata + ii_buffer

        ; Get validation string
        ADR     r1, ms_filename_validation_find
        MOV     r2, #0
        SWI     XMessageTrans_Lookup
        EXIT    VS
        STR     r2, m_writeable_findname + m_headersize + mi_icondata + ii_validation

        ; Store length
        MOV     r1, #?ms_writeable_findname
        STR     r1, m_writeable_findname + m_headersize + mi_icondata + ii_length
      ]

        ; Pull in the menus from the messages file
        ADRL    r1, rom_menustart
        ADR     r2, ram_menustart
        LDR     r3, =ram_menuend - ram_menustart
        SWI     XMessageTrans_MakeMenus

        ; Fill in File 'TenLongxxx' in the relevant main menu item
        ADRL    r1, ms_main_filexxx
        STR     r1, m_main + m_headersize + mi_size*mo_main_filexxx + mi_icondata + ii_buffer

        ; Fill in the magic sub menu numbers for menu warning messages
        MOV     r2, #menuwindow_copysave
        STR     r2, csavesubmenu
csavesubmenu * m_file+m_headersize+mi_size*mo_file_copy+mi_submenu

        MOV     r2, #menuwindow_newdir
        STR     r2, newdirsubmenu
newdirsubmenu * m_main+m_headersize+mi_size*mo_main_newdir+mi_submenu

        MOV     r2, #menuwindow_infobox
        STR     r2, infoboxsubmenu
infoboxsubmenu * m_file+m_headersize+mi_size*mo_file_info+mi_submenu

        MOV     r3, #menuwindow_setaccess
        STR     r3, accesssubmenu
accesssubmenu * m_file_access + m_headersize + mi_size*mo_file_access_other + mi_submenu

      [ version >= 155
        ; Zero the Find string
        ADRL    r1, ms_writeable_findname
        MOV     r0, #0
        STR     r0, [r1]
      ]

        EXIT

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; In    r4 -> dirviewer block
;
; Out   r0 = menu_selchar:
;               -       No selected files
;               S       Many (>1) selected files
;               F       A file is selected
;               D       A directory is selected
;               A       An application is selected
;       r3 -> selected leafname or nul string if not exactly one leaf selected
;       r6 = indication of how many files are selected:
;               0       None
;               1       One
;               42      Many
;       sel_whandle set up
; InitSelection has been performed, hence:
;       These have been set up:
;               sel_dir
;               sel_dirname
;               sel_filenumber
;               sel_fileblock
;               sel_leafname
;               sel_filetype
;       NE: r5 = Nowt if nothing doing
;       EQ: selection set up:
;               r2 -> (first) selected leafname
;               r4 -> (first) selected dirviewer block
;               r5 -> (first) selected fileinfo block
;
InitForMenuCreation     Entry

 [ debugmenu
        DREG    r4,"InitForMenuCreation, dirviewer="
 ]

        ; Set sel_whandle
        LDR     r0, [r4, #d_handle]
        STR     r0, sel_whandle

        ; Find out what's selected
        BL      InitSelection

        ; If nothing selected...
        MOVNE   r6, #0
        BNE     %FT05

        ; Something is selected, is there something else?
        BL      GetSelection

        ; If there's something else, then > 1 object is selected....
        MOVNE   r6, #1                  ; [one selection]
        MOVEQ   r6, #42                 ; [lots of selections]

        ; Restart the selection process
        BL      InitSelection

05      ; r6 now set up as number of selected files indicator
        ; Construct r0 and r3 from this...


        MOV     r0, #"-"                ; No selections (set default of no selections)

        CMP     r6, #1                  ; How many selections?
        MOVGT   r0, #"S"                ; Many selections
        ADRNEL  r3, anull               ; Neither gives a selected item name
        EXIT    NE

        ; One object selected, check which type it is.

        LDREQB  r14, [r5, #df_type]

        CMP     r14, #dft_file
        MOVEQ   r0, #"F"

        CMP     r14, #dft_dir
      [ version >= 143
        TEQNE   r14, #dft_partition
      ]
        MOVEQ   r0, #"D"

        CMP     r14, #dft_applic
        MOVEQ   r0, #"A"

        LDR     r3, sel_leafname

        EXIT

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; EncodeSelectionFileType
;
; Encodes sel_filetype into ms_writeable_filetype

EncodeSelectionFileType Entry   "r0-r3"

 [ debugmenu
        DLINE   "EncodeSelectionFileType"
 ]

        ADR     r1, ms_writeable_filetype

        LDR     r2, sel_filetype
        CMP     r2, #&1000              ; Dated file? VClear
        BHS     %FT05                   ; [no. empty string]

        MOVLO   r0, #FSControl_ReadFileType
        SWILO   XOS_FSControl
        BVS     %FT05

        STMIA   r1!, {r2, r3}

        ; Strip trailing spaces off the string
        ADR     r2, ms_writeable_filetype

        ; Loop over spaces to beginning of string
03      CMP     r2, r1                  ; Paranoia. Someone may return a
        BEQ     %FT05                   ; string comprised of just spaces!
        LDRB    r14, [r1, #-1]!
        CMP     r14, #space
        BEQ     %BT03
        ADD     r1, r1, #1              ; r1 -> end of string (space or CtrlCh)

05      ; Nul terminate at r1
        MOV     r14, #0
        STRB    r14, [r1]

        EXIT

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; RecodeAndRecreateMenu and EncodeAndCreateMenu
;
; In    r4 -> dirviewer block
;
; Recode doesn't set the writeable text fields, but does everything
; else the same as Encode. Recode is for reopening menus after an
; upcall modifying file.


menu_text_1_prefix      DCB     "MT1", 0
menu_text_1t_prefix     DCB     "MT1T", 0
type_number_string      DCB     "(fff)", 0
hex_digits              DCB     "0123456789abcdef"
                        ALIGN

RecodeAndRecreateMenu Entry "r1-r7"

 [ debugmenu
        DREG    r4,"RecodeAndRecreateMenu, dirviewer="
        ADR     lr, ms_writeable_dirname
        DSTRING lr,"dirname: "
 ]

        BL      InitForMenuCreation

        STRB    r0, menu_selchar

        B       %FT10

EncodeAndCreateMenu ALTENTRY

 [ debugmenu
        DREG r4, "EncodeAndCreateMenu, dirviewer="
        ADR     lr, ms_writeable_dirname
        DSTRING lr,"dirname: "
 ]
        BL      InitForMenuCreation

        STRB    r0, menu_selchar

        ; Copy the first selected object's name into the relevant fields.
        ADRL    r1, ms_writeable_leafname
        BL      strcpy
        LDR     r1, csavebox_text
        BL      strcpy
      [ version >= 138
        ADRL    r1, ms_writeable_dirname
        MOV     r2,#0
        STRB    r2,[r1]
      ]

 [ debugmenu
 DSTRING r2,"copied leafname ",cc
 DLINE " to writeable buffer"
 DREG r6,"menu r6 is ",,Integer
 ]

        ; Encode FileType field
        CMP     r6, #0                  ; No selection?
        BLNE    EncodeSelectionFileType


10      ; Encode rest of menu, excluding writeable fields.

 [ debugmenu
        ADR     lr, ms_writeable_dirname
        DSTRING lr,"dirname before main encoding: "
 ]

        ; Construct the relevant token for the selection main menu entry
        ; MT1F
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
        ADR     r2, menu_text_1_prefix
        BL      strcpy_advance
        STRB    r0, [r1], #1
        MOV     r0, #0
        STRB    r0, [r1]

        ; Lookup and substitute "File 'fred'"
        ADR     r0, messagetrans_struct
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
        Push    "r4-r7"                 ; Preseve the important registers
        ADRL    r2, ms_main_filexxx
        MOV     r4, r3
        MOV     r3, #?ms_main_filexxx
        MOV     r5, #0
        MOV     r6, #0
        MOV     r7, #0
        SWI     XMessageTrans_Lookup
        Pull    "r4-r7",VS
        EXIT    VS

        ; Construct the token for the title of the file submenu
        ; MT1TF
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
        ADR     r2, menu_text_1t_prefix
        BL      strcpy_advance
        LDRB    r2, menu_selchar
        STRB    r2, [r1], #1
        MOV     r2, #0
        STRB    r2, [r1]

        ; Lookup and don't fill in the file submenu title
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
        ADRL    r2, m_file + m_title
        MOV     r3, #12
        MOV     r4, #0
        SWI     XMessageTrans_Lookup
        Pull    "r4-r7"
        EXIT    VS

20 ; Encode main menu

        ADRL    r1, m_main
        BL      EncodeMenu

        LDR     r14, [r4, #d_nfiles]
        TEQ     r14, #0                 ; No entry if no files to select
        MOVEQ   r2, #mo_main_selectall
        BLEQ    ShadeMenu

        CMP     r6, #0
        MOVEQ   r2, #mo_main_filexxx    ; No submenu if no selected object
        BLEQ    ShadeMenu
        MOVEQ   r2, #mo_main_clearsel   ; Can't clear selection if none exists
        BLEQ    ShadeMenu

        LDR     r2, [r4, #d_filesystem] ; Can't do this if not owner
        TST     r2, #fod_readonly
        MOVNE   r2, #mo_main_newdir
        BLNE    ShadeMenu

        Push    "r1, r3"                ; Can't do this if no parent
        LDR     r1, [r4, #d_dirnamestore] ; r1 -> dirname
        BL      strlen
        BL      TryLeafStrip
        Pull    "r1, r3"
        MOVEQ   r2, #mo_main_openparent
        BLEQ    ShadeMenu


; Encode display submenu

        ADR     r1, m_display
        BL      EncodeMenu

        LDRB    r2, [r4, #d_viewmode]
        AND     r2, r2, #db_displaymode
        BL      TickMenu                ; 0..3

        LDRB    r2, [r4, #d_viewmode]
        AND     r2, r2, #db_sortmode    ; (0..3)<<2
        MOV     r2, r2, LSR #dbb_sortmode
        ADD     r2, r2, #mo_display_sortname ; 0..3 -> 4..7
        BL      TickMenu

        LDRB    r2, [r4, #d_viewmode]
        TST     r2, #db_sortorder
        MOVNE   r2, #mo_display_sortorder
        BLNE    TickMenu

        LDRB    r2, [r4, #d_viewmode]
        TST     r2, #db_sortnumeric
        MOVNE   r2, #mo_display_sortnumeric
        BLNE    TickMenu

; Encode options submenu

        ADR     r1, m_options
        BL      EncodeMenu

 [ OptionsAreInRAM
        LDRB     r3, fileraction_options
        TST     r3, #Action_OptionConfirm
        MOVNE   r2, #mo_options_confirm
        BLNE    TickMenu
        TST     r3, #Action_OptionVerbose
        MOVNE   r2, #mo_options_verbose
        BLNE    TickMenu
        TST     r3, #Action_OptionForce
        MOVNE   r2, #mo_options_force
        BLNE    TickMenu
        TST     r3, #Action_OptionNewer
        MOVNE   r2, #mo_options_newer
        BLNE    TickMenu
        TST     r3, #Action_OptionConfirmDeletes
        MOVNE   r2, #mo_options_confirmdeletes
        BLNE    TickMenu
        TST     r3, #Action_OptionFaster
        MOVNE   r2, #mo_options_faster
        BLNE    TickMenu
 ]

 [ :LNOT:OptionsAreInRAM
        BL      ReadCMOSBits            ; Read current state to r3
        TST     r3, #confirm_cmos_bit   ; 0 -> no confirm
        MOVNE   r2, #mo_options_confirm
        BLNE    TickMenu

        TST     r3, #verbose_cmos_bit   ; 0 -> no verbose
        MOVNE   r2, #mo_options_verbose
        BLNE    TickMenu

        TST     r3, #force_cmos_bit     ; 0 -> don't force
        MOVNE   r2, #mo_options_force
        BLNE    TickMenu

        TST     r3, #newer_cmos_bit     ; 0 -> look, but don't look newer
        MOVNE   r2, #mo_options_newer
        BLNE    TickMenu
 ]


display_cmos_bits * 2_00000011
sorting_cmos_bits * 2_00001100

 [ :LNOT:OptionsAreInRAM
force_cmos_bit    * 2_00010000
confirm_cmos_bit  * 2_00100000
verbose_cmos_bit  * 2_01000000
newer_cmos_bit    * 2_10000000
 ]

; Encode file submenu

        ADRL    r1, m_file
        BL      EncodeMenu

        CMP     r6, #0
        BLEQ    ShadeWholeMenu
        BEQ     %FT60

        LDR     r2, [r4, #d_filesystem] ; Can't do these if not owner
        TST     r2, #fod_readonly
        MOVNE   r2, #mo_file_delete
        BLNE    ShadeMenu
        MOVNE   r2, #mo_file_rename
        BLNE    ShadeMenu
        MOVNE   r2, #mo_file_access
        BLNE    ShadeMenu
        MOVNE   r2, #mo_file_settype
        BLNE    ShadeMenu
        MOVNE   r2, #mo_file_stamp
        BLNE    ShadeMenu

 ; encode the infobox information Only if there is only one object selection
        CMP     r6, #1
        BNE     %FT40

        LDR     r0, sel_leafname
        LDR     r2, sel_filetype
    [ {TRUE}
        Push    "r3"
        LDR     r3, sel_fileblock
        BL      FiletypeToSpritename
        Pull    "r3"
    |
        BL      FiletypeToSpritename
    ]
        LDR     r14, infobox_ptr
        LDR     r1, [r14, #w_icons+(i_size*0)+i_data+ii_buffer]
        BL      strcpy
        LDR    r14, infobox_ptr
        LDR     r1, [r14, #w_icons+(i_size*2)+i_data+ii_buffer]
        LDR     r2, sel_filetype
        TEQ     r2, #filetype_application
        TEQNE   r2, #filetype_directory
        TEQNE   r2, #filetype_undated
        BNE     %FT36

        ; Copy from the file submenu title the word Directory or Application
        ADRL    r2, m_file + m_title
        BL      strcpy
        B       %FT37
36
        MOV     r0, #FSControl_ReadFileType
        SWI     XOS_FSControl
        ; shouldn't return an error

        ; copy the string into the indirect area
        SUB     sp, sp, #12
        STR     r2, [sp, #0]
        STR     r3, [sp, #4]
        MOV     r2, #0
        STR     r2, [sp, #8]
        MOV     r2, sp
        BL      strcpy
        ADD     sp, sp, #12
        LDRB    r2, [r1]

        ; add "(fff)"
        ADRL    r2, type_number_string
        BL      strcat

        ; Point r1 at the first f
        BL      strlen
        ADD     r1, r1, r3
        SUB     r1, r1, #4

        ; Fill in the hex digits
        ADRL    r3, hex_digits
        LDR     r2, sel_filetype
        AND     r0, r2, #&f00
        LDRB    r0, [r3, r0, ROR #8]
        STRB    r0, [r1], #1
        AND     r0, r2, #&f0
        LDRB    r0, [r3, r0, ROR #4]
        STRB    r0, [r1], #1
        AND     r0, r2, #&f
        LDRB    r0, [r3, r0]
        STRB    r0, [r1], #1
37
        ; construct type string
        LDR     r0, sel_fileblock
        LDR     r0, [r0, #df_length]
        LDR    r14, infobox_ptr
        LDR     r1, [r14, #w_icons+(i_size*4)+i_data+ii_buffer]
        LDR     r2, [r14, #w_icons+(i_size*4)+i_data+ii_length]
        SWI     XOS_ConvertCardinal4
        ; Ignore any error returned

        ; Encode the access
        LDR     r1, infobox_ptr
        ADD     r1, r1, #w_icons+(i_size*8)+i_data+ii_buffer

        ; Get the access
        LDR     r0, sel_fileblock
        LDR     r0, [r0, #df_attr]

        ; Set the owner bits of the string
        TST     r0, #locked_attribute
        MOVNE   r2, #"L"
        STRNEB  r2, [r1], #1
        TST     r0, #write_attribute
        MOVNE   r2, #"W"
        STRNEB  r2, [r1], #1
        TST     r0, #read_attribute
        MOVNE   r2, #"R"
        STRNEB  r2, [r1], #1

        MOV     r2, #"/"
        STRB    r2, [r1], #1
        TST     r0, #public_write_attribute
        MOVNE   r2, #"w"
        STRNEB  r2, [r1], #1
        TST     r0, #public_read_attribute
        MOVNE   r2, #"r"
        STRNEB  r2, [r1], #1

38      ; Terminate the string
        MOV     r2, #0
        STRB    r2, [r1], #1

        ; Fill in the leaf name
        LDR    r14, infobox_ptr
        LDR     r1, [r14, #w_icons+(i_size*5)+i_data + ii_buffer]
        LDR     r2, sel_leafname
        LDR     r3, [r14, #w_icons+(i_size*5)+i_data + ii_length]
	SUB	r3, r3, #1	; space for terminator
        BL      strncpy

        LDR    r14, infobox_ptr

        ; Fill in the date/load and exec address
        LDR     r0, sel_filetype
        TEQ     r0, #filetype_undated
        BEQ     %FT39

        ; Object is dated

        ; Undelete Date: text and date field
        LDR     r1, [r14, #w_icons+(i_size*6)+i_flags]
        BIC     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*6)+i_flags]
        LDR     r1, [r14, #w_icons+(i_size*7)+i_flags]
        BIC     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*7)+i_flags]

        ; Delete load/exec field
        LDR     r1, [r14, #w_icons+(i_size*10)+i_flags]
        ORR     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*10)+i_flags]

        ; Encode date
        LDR     r0, sel_fileblock
        SUB     sp, sp, #8
        LDR     r1, [r0, #df_exec]
        STR     r1, [sp, #0]
        LDR     r1, [r0, #df_load]
        STR     r1, [sp, #4]
        MOV     r0, sp
        LDR     r1, [r14, #w_icons+(i_size*7)+i_data]
        LDR     r2, [r14, #w_icons+(i_size*7)+i_data+8]
        ADRL    r3, mydateformat
        SWI     XOS_ConvertDateAndTime
        ADD     sp, sp, #8

        ADRL    r1, m_file
        B       %FT40

39      ; Object is undated

        ; Delete Date: text and date field
        LDR     r1, [r14, #w_icons+(i_size*6)+i_flags]
        ORR     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*6)+i_flags]
        LDR     r1, [r14, #w_icons+(i_size*7)+i_flags]
        ORR     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*7)+i_flags]

        ; Undelete load/exec field
        LDR     r1, [r14, #w_icons+(i_size*10)+i_flags]
        BIC     r1, r1, #is_deleted
        STR     r1, [r14, #w_icons+(i_size*10)+i_flags]

        ; Encode load and exec
        LDR     r1, [r14, #w_icons+(i_size*10)+i_data+ii_buffer]
        LDR     r2, [r14, #w_icons+(i_size*10)+i_data+ii_length]

        LDR     r3, sel_fileblock
        LDR     r0, [r3, #df_load]
        SWI     XOS_ConvertHex8
        BVS     %FT90

        MOV     r0, #space
        STRB    r0, [r1]
        ADD     r1, r1, #4
        SUB     r2, r2, #4

        LDR     r0, [r3, #df_exec]
        SWI     XOS_ConvertHex8
        BVS     %FT90

        ADRL    r1, m_file
40

        RSBS    r14, r6, #1             ; Can't do these if 1 < number of selected objects
        MOVLT   r2, #mo_file_copy
        BLLT    ShadeMenu
        MOVLT   r2, #mo_file_rename
        BLLT    ShadeMenu               ; >>>a186<<< ALWAYS set lastitem!
        MOVLT   r2, #mo_file_info
        BLLT    ShadeMenu

        LDR     r14, [r5, #df_helptype] ; If application, may have help entry
 [ debugsel
 DREG r14, "!Help type is "
 ]

        ; Disable help if > 1 selected item or no help available
        CMPGE   r14, #0
        MOVGE   r2, #"H"
        STRGEB  r2, menu_selchar
        MOVLT   r2, #mo_file_help
        BLLT    ShadeMenu

60      ; Encode access submenu dbox
        ADRL    r1, m_file_access
        BL      EncodeMenu

        CMP     r6, #0                  ; Shade whole menu if not selected items
        BLEQ    ShadeWholeMenu
        BEQ     %FT90

        LDR     r2, [r4, #d_filesystem]
        TST     r2, #fod_readonly
        BLNE    ShadeWholeMenu
        BNE     %FT90

        ; Tick things only if only one file selected
        CMP     r6, #1
        BNE     %FT90
        LDRB    r14, [r5, #df_type]
        CMP     r14, #dft_file
      [ version >= 143
        CMPNE   r14, #dft_partition
      ]
        BNE     %FT90

        LDR     r3, [r5, #df_attr]

        ; Publicly readable?
        TST     r3, #public_read_attribute :OR: public_write_attribute
        MOVEQ   r2, #mo_file_access_nopublicread
        BLEQ    TickMenu
        TST     r3, #public_read_attribute
        MOVNE   r2, #mo_file_access_publicread
        BLNE    TickMenu

        ; Locked entirely/not at all?
        ANDS    r3, r3, #write_attribute :OR: locked_attribute :OR: public_write_attribute
        TEQ     r3, #locked_attribute
        MOVEQ   r2, #mo_file_access_locked
        BLEQ    TickMenu
        AND     r3, r3, #write_attribute :OR: locked_attribute
        TEQ     r3, #write_attribute
        MOVEQ   r2, #mo_file_access_unlocked
        BLEQ    TickMenu

90 ; Create the menu tree

        LDRVC   r2, absmousex
        LDRVC   r3, absmousey

        SUBVC   r2, r2, #64             ; **jdl fix for style guide
;        SUBVC   r2, r2, #12*charx       ; rather subjective value follows:
;        ADDVC   r3, r3, #chary/2        ; +1/2*chary always

 [ debugmenu
        ADR     lr, ms_writeable_dirname
        DSTRING lr,"dirname before Wimp_CreateMenu: "
 ]

        ADRVCL  r1, m_main
        SWIVC   XWimp_CreateMenu

 [ debugmenu
        ADR     lr, ms_writeable_dirname
        DSTRING lr,"dirname after Wimp_CreateMenu: "
 ]

        EXIT

        END
@


4.11
log
@Correct sprite name clamping while looking for sm!app
A previous fix in Filer-2_10 had changed the concatenation to be clamped at 10 letters so it doesn't overflow the buffer for long app names. However, having failed to find 'sm!app' it then just tried adding 2 to the string pointer therefore looking for a 10 letter sprite '!app'.
This is different behaviour to before Filer-2_10, which would have overrun thebuffer but at least looked for a full 12 letter name.
Optimised strncat a bit.
Put unused source file in the attic.
Trimmed some bug fix switches dating back to 1989.

Version 2.24. Tagged as 'Filer-2_24'
@
text
@d33 1
d572 5
@


4.10
log
@  Add the ability to sort Filer objects in reverse order
Detail:
  It's been possible to sort Filer objects using various criteria for a long
  time but sorting objects in reverse order was not possible. This change aims
  to remedy that omission.
  The option 'Reverse sort' has been added to the 'Display' submenu of the
  Filer menu, allowing the sort order of individual directory viewers to be
  changed dynamically.
  The switch -ReverseSort has been added to the command Filer_OpenDir to allow
  it to open directories with the sort order reversed.
  The switch -ReverseSort has been added to the Filer_Layout command so that
  reverse sort order can be set as default for new directory viewers. The
  Filer_Layout command is also written to the FlrSetup file in Choices:Boot.
  Tasks by the Filer configure plug-in (which has been also updated to allow
  -ReverseSort).
Admin:
  Tested on Iyonix RO5.14


Version 2.22. Tagged as 'Filer-2_22'
@
text
@a642 1
 [ Fix001
a644 1
 ]
@


4.9
log
@  Make doubleclick-and-hold configurable
Detail:
  Added the command Filer_DClickHold to the Filer.
  It allows you to specify how long the second click of a doubleclick must be
  held down for before it is seen as a doubleclick-and-hold.
  The delay is specified in centiseconds, setting the delay to zero turns
  doubleclick-and-hold off.
Admin:
  Tested on Iyonix RO5.14
  Submitted by Fred Graute, mid-December 2009

Version 2.21. Tagged as 'Filer-2_21'
@
text
@d31 2
a32 1
mo_display_sortdate             Item    "MT06"
d561 1
a561 1
; ***   AND     r2, r2, #db_sortmode    ; (0..3)<<2
d566 5
@


4.8
log
@  Fixed main menu in filer.
Detail:
  The RO3 style guide states a main menu should be opened at x-64,y.
  Instead the filer was opening it's menu at x-192,y+16.
  This has now been fixed.
Admin:
  Tested on RiscPC RO402.
Notes:
  Changes by James Lampard.

Version 2.16. Tagged as 'Filer-2_16'
@
text
@d624 1
a624 1
        ADR     r1, m_file
d672 1
a672 1
        ADR     r2, m_file + m_title
d798 1
a798 1
        ADR     r1, m_file
d834 1
a834 1
        ADR     r1, m_file
d858 1
a858 1
        ADR     r1, m_file_access
@


4.7
log
@  Added a refresh item to the filer main menu.
Detail:
  When viewing directories on some network filing systems it is possible
  for the directory contents to change without the client knowing, and
  therefore the filer window becomes out of date. This refresh option
  can be used by the user to bring the window up to date without having
  to close and reopen it.
  It matches the same option provided on later versions of RISC OS 4.
Admin:
  Tested on Iyonix RISC OS 5.11
Notes:
  Changed by Alex Waugh.

Version 2.12. Tagged as 'Filer-2_12'
@
text
@d905 3
a907 2
        SUBVC   r2, r2, #12*charx       ; rather subjective value follows:
        ADDVC   r3, r3, #chary/2        ; +1/2*chary always
@


4.6
log
@  The following were present in RISC OS 5.00/5.01:
  * "Directory" string removed from "New directory" dialogue box template.
    Unlike the version shipped in 5.00 and 5.01, this template file doesn't
    have its "Recurse" option button in the "Access details" dialogue box
    deselected.
  * When "New directory" dialogue box is opened, contents of the writable
    icon is now set to a null string, rather than the uninternationalised
    "Directory" that was used previously.
  * Uses OS_HeapSort32 instead of OS_HeapSort when the RMA is high.
  The following are new since then:
  * Fixed rubber dragboxes to use exclusive maximum coordinates, stops you
    dragging the box off the left hand side of the window.
  * Enabled SetDirectory option. Merged in 4.02's SetDirectoryComesFirst
    option, changed token in Messages file to read "Set work directory"
    instead of "Set directory" to match 4.02, and added the missing token
    MH?7? for interactive help.

Version 2.06. Tagged as 'Filer-2_06'
@
text
@d137 1
@


4.5
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 2.01. Tagged as 'Filer-2_01'
@
text
@d126 6
d133 1
a133 1
 [ AddSetDirectory
d135 1
a136 1

@


4.4
log
@  Defence against unreadable information added.
Detail:
  This should stop random tags being looked up when file information
    cannot be read for the item over which the Menu button has been
    clicked.
Admin:
  Not tested.

Version 2.00. Tagged as 'Filer-2_00'
@
text
@d150 1
a150 1
CopyMenus ENTRY "r0-r11"
d299 1
a299 1
InitForMenuCreation     ENTRY
d362 1
a362 1
EncodeSelectionFileType ENTRY   "r0-r3"
d413 1
a413 1
RecodeAndRecreateMenu ENTRY "r1-r7"
@


4.3
log
@Made 32-bit compatible. Quite a complex job, and only limited testing so far.

Version 1.97. Tagged as 'Filer-1_97'
@
text
@d330 2
a332 2

        MOVLT   r0, #"-"                ; No selections
@


4.2
log
@Merged Ursula branch.
Moved to srccommit.

Version 1.96. Tagged as 'Filer-1_96'
@
text
@d51 1
a51 1
 
d395 1
a395 1
        EXITS
d603 1
a603 1
 
@


4.1
log
@Initial revision
@
text
@d36 1
d39 1
d43 9
a51 2


d62 2
a63 2
m_writeable_cdirname            Menu    "MT5T"
mo_writeable_cdirname           Item    "MT50",,"W"
d124 2
a125 1
mo_main_newdir                  Item    "MT5",m_writeable_cdirname
d179 6
a184 6
      [ version >= 138
        ADRL    r1, ms_writeable_dirname
      |
        ADRL    r1, ms_writeable_leafname
      ]
        STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_buffer
d187 5
a191 5
        ADR     r1, ms_filename_validation_cdir
        MOV     r2, #0
        SWI     XMessageTrans_Lookup
        EXIT    VS
        STR     r2, m_writeable_cdirname + m_headersize + mi_icondata + ii_validation
d194 6
a199 6
      [ version >= 138
        MOV     r1, #?ms_writeable_dirname
      |
        MOV     r1, #?ms_writeable_leafname
      ]
        STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_length
d247 5
d255 1
d469 2
a470 1
        ADR     r1, dirnamebuffer
d479 2
a480 1
        ADR     r1, dirnamebuffer
d494 2
a495 1
        ADR     r1, dirnamebuffer
d504 2
a505 1
        ADR     r1, dirnamebuffer
d563 23
a586 1

d595 1
a595 1
        TST     r3, #force_cmos_bit   ; 0 -> don't force
d599 1
a599 1
        TST     r3, #newer_cmos_bit   ; 0 -> look, but don't look newer
d602 2
d607 2
d613 1
a613 1

d645 6
d652 1
@


4.1.4.1
log
@Long filename support and SaveAs style new directory creation
@
text
@d53 2
a54 2
;m_writeable_cdirname            Menu    "MT5T"
;mo_writeable_cdirname           Item    "MT50",,"W"
d115 1
a115 2
mo_main_newdir                  Item    "MT5",,"N"
;mo_main_newdir                  Item    "MT5",m_writeable_cdirname
d169 6
a174 6
      ;[ version >= 138
      ;  ADRL    r1, ms_writeable_dirname
      ;|
      ;  ADRL    r1, ms_writeable_leafname
      ;]
      ;  STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_buffer
d177 5
a181 5
        ;ADR     r1, ms_filename_validation_cdir
        ;MOV     r2, #0
        ;SWI     XMessageTrans_Lookup
        ;EXIT    VS
        ;STR     r2, m_writeable_cdirname + m_headersize + mi_icondata + ii_validation
d184 6
a189 6
      ;[ version >= 138
      ;  MOV     r1, #?ms_writeable_dirname
      ;|
      ;  MOV     r1, #?ms_writeable_leafname
      ;]
      ;  STR     r1, m_writeable_cdirname + m_headersize + mi_icondata + ii_length
a236 5

        MOV     r2, #menuwindow_newdir
        STR     r2, newdirsubmenu
newdirsubmenu * m_main+m_headersize+mi_size*mo_main_newdir+mi_submenu

a239 1

@


4.1.4.2
log
@Add new options to Options menu, plus fixed bugs
@
text
@a35 1
 [ OptionsAreInRAM
a37 1
mo_options_confirmdeletes       Item    "MT44",,"-"
d41 2
a42 9
mo_options_faster               Item    "MT45"
 |
m_options                       Menu    "MT4T"
mo_options_confirm              Item    "MT40"
mo_options_verbose              Item    "MT41"
mo_options_force                Item    "MT42"
mo_options_newer                Item    "MT43"
 ]
 
d550 1
a550 21
 [ OptionsAreInRAM
        LDR     r3, fileraction_options
        TST     r3, #Action_OptionConfirm
        MOVNE   r2, #mo_options_confirm
        BLNE    TickMenu
        TST     r3, #Action_OptionVerbose
        MOVNE   r2, #mo_options_verbose
        BLNE    TickMenu
        TST     r3, #Action_OptionForce
        MOVNE   r2, #mo_options_force
        BLNE    TickMenu
        TST     r3, #Action_OptionNewer
        MOVNE   r2, #mo_options_newer
        BLNE    TickMenu
        TST     r3, #Action_OptionConfirmDeletes
        MOVNE   r2, #mo_options_confirmdeletes
        BLNE    TickMenu
        TST     r3, #Action_OptionFaster
        MOVNE   r2, #mo_options_faster
        BLNE    TickMenu
 ]
a551 2
 [ :LNOT:OptionsAreInRAM
        BL      ReadCMOSBits            ; Read current state to r3
d560 1
a560 1
        TST     r3, #force_cmos_bit     ; 0 -> don't force
d564 1
a564 1
        TST     r3, #newer_cmos_bit     ; 0 -> look, but don't look newer
a566 2
 ]
 
a569 2

 [ :LNOT:OptionsAreInRAM
d574 1
a574 1
 ]
@


4.1.4.3
log
@Fixed bug with system font in Filer windows, plus redraw of highlighted icons.
@
text
@d469 1
a469 2
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
d478 1
a478 2
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
d492 1
a492 2
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
d501 1
a501 2
        ;ADR     r1, dirnamebuffer
        LDR     r1, dirnamebuffer
@


4.1.4.4
log
@A *Filer_Layout command now replaces CMOS setting of the display options.
Fixed bug which meant dirviews weren't sorted if they had >256 entries.
Increased dirnamebuffer to 2K to cope with long pathname renames.
@
text
@d564 1
a564 1
        LDRB     r3, fileraction_options
@


4.1.4.5
log
@Fixed bug which displayed wrong icon in file info window for DEADDEAD files.
@
text
@a644 3
    [ {TRUE}
        Push    "r3"
        LDR     r3, sel_fileblock
a645 4
        Pull    "r3"
    |
        BL      FiletypeToSpritename
    ]
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
