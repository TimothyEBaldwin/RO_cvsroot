head	4.3;
access;
symbols
	Filer-2_43:4.3
	Filer-2_42:4.3
	Filer-2_41:4.3
	Filer-2_40:4.3
	Filer-2_39:4.3
	Filer-2_38:4.3
	Filer-2_37:4.3
	Filer-2_36:4.3
	Filer-2_35:4.3
	Filer-2_34:4.3
	Filer-2_33:4.3
	Filer-2_32:4.3
	Filer-2_31:4.3
	Filer-2_30:4.3
	Filer-2_29:4.3
	Filer-2_28:4.3
	Filer-2_27:4.3
	Filer-2_26:4.3
	Filer-2_25:4.3
	Filer-2_24:4.3
	Filer-2_23:4.3
	Filer-2_22:4.3
	Filer-2_21:4.3
	Filer-2_20:4.3
	Filer-2_19:4.3
	Filer-2_18:4.3
	Filer-2_17:4.3
	Filer-2_16:4.3
	Filer-2_15:4.3
	Filer-2_14:4.3
	Filer-2_13:4.3
	Filer-2_12:4.3
	Filer-2_11:4.3
	Filer-2_10:4.3
	Filer-2_09:4.3
	RO_5_07:4.3
	Filer-2_08:4.3
	Filer-2_07:4.3
	Filer-2_06:4.3
	Filer-2_05:4.3
	Filer-2_04:4.2
	Filer-2_03:4.2
	Filer-2_02:4.2
	Filer-2_01:4.2
	Filer-2_00:4.1
	Filer-1_99:4.1
	Filer-1_98:4.1
	Filer-1_97:4.1
	Ursula_merge:4.1
	Filer-1_96:4.1
	Filer-1_95:4.1
	nturton_Filer-1_85:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rleggett_Filer-1_94:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rleggett_Filer-1_93:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.3
date	2002.11.12.20.43.55;	author rsprowson;	state Exp;
branches;
next	4.2;

4.2
date	2001.03.16.17.09.24;	author sbrodie;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.29.32;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.29.32;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.27.43;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.17.22;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.16.26;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.3
log
@Picked up bug fix from ROL,in 2.04 you could select a file in one viewer
and then adjust select a group in another viewer without the first
file becoming unselected.
Added test so you're less likely to lose the "rename" writeable icon
when someone's updating filer windows.Now,only if the window being
reopened also has the writeable in it will you lose it.
Adjust dragging dirs to the icon bar will now close the parent (was
only files and apps before).
Create dir and Copy as templates tweaked for 3d borders in UK only as
the German ones are very out of date anyway.

Version 2.05. Tagged as 'Filer-2_05'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; SendDataOpenMessage
; ===================

;       r1 -> full dirname
;       r2 -> leafname
;       r3 = file type
;       r4 = who to send it to (task handle, window handle or 0)
;       r5 = icon handle (only needed if r4 = window handle)

SendDataOpenMessage     Entry   "r0,r7"
        MOV     r0, #Message_DataOpen
        MOV     r7, #0
        BL      SendMessageCommon
        STRVS   r0,[sp,#0]              ; overwrite r0 on the stack so the error finds its way back to the caller

        EXIT

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; SendMessage
; ===========

; In    r0 = message action
;       r1 -> full dirname
;       r2 -> leafname
;       r3 = file type
;       r4 = who to send it to (task handle, window handle or 0)
;       r5 = icon handle (only needed if r4 = window handle)

SendMessage     Entry   "r7"
        MOV     r7, #-1
        BL      SendMessageCommon
        EXIT


; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;
; SendMessageCommon
; =================

; In    r0 = message action
;       r1 -> full dirname
;       r2 -> leafname
;       r3 = file type
;       r4 = who to send it to (task handle, window handle or 0)
;       r5 = icon handle (only needed if r4 = window handle)
;       r7 = Value for R1+36 field
;       If version > 140
;          r8,r9 Two words to place after the path name.
; Used to send DataOpen/DataLoad messages from Filer; both have same data fmt

 [ disallow_longpaths
maximum_pathlength      *       200
        MakeErrorBlock  Filer_BadPath
 ]

SendMessageCommon Entry "r1-r9"

 [ disallow_longpaths
        BL      strlen_excludingspaces
        CMP     r3, #maximum_pathlength
        BLE     %FT10
        ADR     r0, ErrorBlock_Filer_BadPath
        BL      LookupError
        EXIT
10      LDR     r3, [sp, #4*2]
 ]

        SUB     sp, sp, #256            ; make temp frame
        ADD     r1, sp, #ms_yourref
        MOV     r2, r0
        MOV     r0, #0                  ; yourref = 0 -> start of sequence
        MOV     r8, r3                  ; get filetype in suitable register
        LDR     r3, windowhandle
        LDR     r4, iconhandle
        LDR     r5, absmousex
        LDR     r6, absmousey
 [ debugtask
 DREG r2, "SendMessage: action ",cc,Integer
 DREG r3, " window ",cc,Integer
 DREG r4, ", icon ",cc
 DREG r5, ", mx ",cc,Integer
 DREG r6, ", my ",cc,Integer
 DREG r8, ", file type "
 ]
        STMIA   r1!, {r0, r2-r8}        ; yourref/action/w/i/x/y/
 ASSERT ms_action               = ms_yourref + 4
 ASSERT msDataTransfer_window   = ms_yourref + 8
 ASSERT msDataTransfer_icon     = ms_yourref + 12
 ASSERT msDataTransfer_x        = ms_yourref + 16
 ASSERT msDataTransfer_y        = ms_yourref + 20
 ASSERT msDataTransfer_filesize = ms_yourref + 24
 ASSERT msDataTransfer_filetype = ms_yourref + 28
 ASSERT msDataTransfer_filename = ms_yourref + 32

        LDR     r2, [sp, #4*0 + 256]    ; r1in = dirname
 [ debugtask
 DSTRING r2, "dirname ",cc
 ]
        BL      strcpy_excludingspaces  ; stop on spaces so Neil can send wally
                                        ; dirnames at top level

        LDR     r2, [sp, #4*1 + 256]    ; r2in = leafname
 [ debugtask
 DSTRING r2, ", leafname "
 ]
        BL      AppendLeafnameToDirname

        BL      strlen
        ADD     r1, r1, r3

        ADD     r1, r1, #3+1            ; round up to word size (remember null)
        BIC     r1, r1, #3
      [ version >= 140
        LDR     r0,[sp,#4*7 + 256]      ; Get entry r8
        STR     r0,[r1],#4
        LDR     r0,[sp,#4*8 + 256]      ; Get entry r9
        STR     r0,[r1],#4
      ]
        SUB     r1, r1, sp
        STR     r1, [sp, #ms_size]

        MOV     r0, #User_Message_Recorded
        MOV     r1, sp
        LDR     r2, [sp, #4*3 + 256]    ; r4in = who to send it to
        LDR     r3, [sp, #4*4 + 256]    ; r5in = icon handle
 [ debugtask
 DREG r2,"Sending recorded message from Filer to thandle/whandle ",,Word
 ADD r14, r1, #msDataTransfer_filename ; a la doc'n
 DSTRING r14, "Full filename is "
 LDR r14, [r1, #msDataTransfer_filetype]
 DREG r14, "Filetype "
 DREG r0,  "Event type "
 LDR r14, [r1, #ms_action]
 DREG r14, "Action "
 LDR r14, [r1, #ms_size]
 DREG r14, "Message size "
 ]
        SWI     XWimp_SendMessage
 [ debugtask
 BVC %FT00
 DLINE "***Error from SendMessage"
00
 DLINE "message sent"
 ]
 [ version >= 138
        CLRV
 ]
        ADD     sp, sp, #256            ; free temp frame
        EXIT

        END
@


4.2
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 2.01. Tagged as 'Filer-2_01'
@
text
@d30 2
@


4.1
log
@Initial revision
@
text
@d26 1
a26 1
SendDataOpenMessage     ENTRY   "r0,r7"
d44 1
a44 1
SendMessage     ENTRY   "r7"
d71 1
a71 1
SendMessageCommon ENTRY "r1-r9"
d127 1
a127 1
        BIC     r1, r1, #3 
d132 1
a132 1
        STR     r0,[r1],#4    
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
