head	4.7;
access;
symbols
	Filer-2_43:4.7
	Filer-2_42:4.7
	Filer-2_41:4.7
	Filer-2_40:4.7
	Filer-2_39:4.7
	Filer-2_38:4.7
	Filer-2_37:4.7
	Filer-2_36:4.7
	Filer-2_35:4.7
	Filer-2_34:4.7
	Filer-2_33:4.7
	Filer-2_32:4.7
	Filer-2_31:4.7
	Filer-2_30:4.7
	Filer-2_29:4.7
	Filer-2_28:4.7
	Filer-2_27:4.7
	Filer-2_26:4.7
	Filer-2_25:4.6
	Filer-2_24:4.6
	Filer-2_23:4.5
	Filer-2_22:4.5
	Filer-2_21:4.5
	Filer-2_20:4.5
	Filer-2_19:4.5
	Filer-2_18:4.5
	Filer-2_17:4.5
	Filer-2_16:4.5
	Filer-2_15:4.5
	Filer-2_14:4.5
	Filer-2_13:4.5
	Filer-2_12:4.5
	Filer-2_11:4.5
	Filer-2_10:4.5
	Filer-2_09:4.5
	RO_5_07:4.5
	Filer-2_08:4.5
	Filer-2_07:4.4
	Filer-2_06:4.4
	Filer-2_05:4.3
	Filer-2_04:4.3
	Filer-2_03:4.3
	Filer-2_02:4.3
	Filer-2_01:4.3
	Filer-2_00:4.2
	Filer-1_99:4.2
	Filer-1_98:4.2
	Filer-1_97:4.2
	Ursula_merge:4.1.4.8
	Filer-1_96:4.2
	Filer-1_95:4.1.4.8
	nturton_Filer-1_85:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.8
	Ursula_RiscPC:4.1.4.8.0.2
	rthornb_UrsulaBuild-19Aug1998:4.1.4.8
	UrsulaBuild_FinalSoftload:4.1.4.8
	rthornb_UrsulaBuild-12Aug1998:4.1.4.8
	aglover_UrsulaBuild-05Aug1998:4.1.4.8
	rthornb_UrsulaBuild-29Jul1998:4.1.4.8
	rthornb_UrsulaBuild-22Jul1998:4.1.4.8
	rleggett_Filer-1_94:4.1.4.8
	rthornb_UrsulaBuild-15Jul1998:4.1.4.7
	rthornb_UrsulaBuild-07Jul1998:4.1.4.7
	rthornb_UrsulaBuild-17Jun1998:4.1.4.7
	rthornb_UrsulaBuild-03Jun1998:4.1.4.6
	rthornb_UrsulaBuild-27May1998:4.1.4.6
	rleggett_Filer-1_93:4.1.4.6
	rthornb_UrsulaBuild-21May1998:4.1.4.5
	rthornb_UrsulaBuild_01May1998:4.1.4.5
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.7
date	2010.10.23.18.02.28;	author rsprowson;	state Exp;
branches;
next	4.6;

4.6
date	2010.03.07.08.26.14;	author rsprowson;	state Exp;
branches;
next	4.5;

4.5
date	2003.02.04.14.30.59;	author bavison;	state Exp;
branches;
next	4.4;

4.4
date	2003.01.09.15.58.11;	author bavison;	state Exp;
branches;
next	4.3;

4.3
date	2001.03.16.17.09.23;	author sbrodie;	state Exp;
branches;
next	4.2;

4.2
date	99.08.17.11.56.39;	author sbrodie;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.29.27;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.29.27;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.27.30;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	97.08.27.09.09.06;	author rleggett;	state Exp;
branches;
next	4.1.4.2;

4.1.4.2
date	97.09.12.09.17.32;	author rleggett;	state Exp;
branches;
next	4.1.4.3;

4.1.4.3
date	97.09.24.13.26.41;	author rleggett;	state Exp;
branches;
next	4.1.4.4;

4.1.4.4
date	98.04.15.11.27.44;	author rleggett;	state Exp;
branches;
next	4.1.4.5;

4.1.4.5
date	98.04.27.10.26.15;	author rleggett;	state Exp;
branches;
next	4.1.4.6;

4.1.4.6
date	98.05.26.11.21.34;	author rleggett;	state Exp;
branches;
next	4.1.4.7;

4.1.4.7
date	98.06.10.09.45.18;	author rleggett;	state Exp;
branches;
next	4.1.4.8;

4.1.4.8
date	98.07.22.09.51.19;	author rleggett;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.16.51;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.16.12;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.7
log
@Fix for 'set type' writeable icon being out of step with the disc.
Adjust clicking would recreate the menu immediately after the operation but before the next wimp poll when the directory gets recached, so the first entry in the cache is manually fixed up so the recreated menu is right (the files all get refreshed later anyway).
Collapsed switch 'Fix003', after 21 years of testing it's safe to assume it's good.
Reinstated ExtractCMOSOptions conditional on not OptionsAreInRAM so that combination still assembles.
Optimise MUL/ADD into MLA where possible, and set 'S' flag on ALU operations when followed by TEQ#0.
Tested with & without filer action running, fixes ticket 254.

Version 2.26. Tagged as 'Filer-2_26'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;

; !Help support
        GBLL    interactive_help
interactive_help        SETL    {TRUE}

; Don't be paranoid at all after an upcall modified file
        GBLL    less_upcall_paranoia
less_upcall_paranoia      SETL    {TRUE}

; stamp option
        GBLL    stamp_option
stamp_option    SETL    {TRUE}

; disallow recursive copies
        GBLL    disallow_recursive_copies
disallow_recursive_copies       SETL    {TRUE}

; disallow very long path names
        GBLL    disallow_longpaths
disallow_longpaths      SETL    {TRUE}

; Opendir/Closedir request order
        GBLL    opendir_request_order
opendir_request_order   SETL    {TRUE}

; action window handling
        GBLL    actionwind
actionwind      SETL    {TRUE}

; Handling of *filer_opendir with position and displaymode
        GBLL    openat
openat  SETL    {TRUE}

; Centralise handling of directory viewer wrapping
        GBLL    centralwrap
centralwrap     SETL    {TRUE}

; Correct handling of dvr_rhsgap
        GBLL    bug1596
bug1596 SETL    {TRUE}

; Drag to Icon bar Data_Opens applications and files
        GBLL    dragtobar
dragtobar       SETL    {TRUE}

; Default directory window width of four columns?
                 GBLL fourcolumnwidth
fourcolumnwidth  SETL {TRUE}

; Message_FilerSelection with extra pointer information?
                         GBLL NewMessageFilerSelection
NewMessageFilerSelection SETL {TRUE}

; Shift-EXTend-close on a directory viewer leaves child open, and
; opens parent
        GBLL    shfextclose
shfextclose     SETL    {TRUE}

; Allow set type on files
        GBLL    settype
settype SETL    {TRUE}

; Dragging a sprite rather than an outline
        GBLL    DragASprite
DragASprite     SETL    {TRUE}

; Use open directory icons for open directories,
        GBLL    ShowOpenDirs
ShowOpenDirs    SETL    {TRUE}

; Add "Set directory" menu item
        GBLL    AddSetDirectory
AddSetDirectory SETL    {TRUE}

; If "Set directory" comes before "Open parent"
        GBLL    SetDirectoryComesFirst
SetDirectoryComesFirst SETL    {TRUE}

; Change the 16bit filename offset into a 32 bit one
        GBLL    not_16bit_offsets
not_16bit_offsets SETL    {TRUE}

        GBLL    includeresources
  [ :DEF: standalone
includeresources SETL   standalone
  |
includeresources SETL   {FALSE}
  ]

; Support for TinyDirs
                GBLL    hastiny
hastiny         SETL    {FALSE}

; This is NOT implemented properly and is just a quick hack for GBartram 
                GBLL    fonthack
fonthack        SETL    {FALSE}

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Ursula flags

; Using Ursula wimp?
        GBLL    ursulawimp
ursulawimp      SETL    {TRUE}

; Autoscrolling windows?
        GBLL    autoscroll
autoscroll      SETL    ursulawimp

; MenuClearsSelection
; If set, then if a click with Menu on a file in a different viewer will remove
; the selection in any other viewer and select the new file.
                    GBLL    MenuClearsSelection
MenuClearsSelection SETL    {TRUE}

; OptionsAreInRAM
; If set, use RAM instead of CMOS to store options
                    GBLL    OptionsAreInRAM
OptionsAreInRAM     SETL    {TRUE}

; AltRenaming - do Alt + Click renaming of files
; Don't trust this - some AltRenaming stuff isn't conditional on it.
                    GBLL    AltRenaming
AltRenaming         SETL    {TRUE}

; Ursula DragASprite
                  GBLL ursuladragasprite
ursuladragasprite SETL {TRUE}

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Retain or clear selections after file actions

        GBLL    retainsel
retainsel SETL  {TRUE}

        GBLL    clearsel_copymove
        GBLL    clearsel_file_access
        GBLL    clearsel_file_copy
        GBLL    clearsel_file_count
        GBLL    clearsel_file_delete
        GBLL    clearsel_file_help
        GBLL    clearsel_file_find
        GBLL    clearsel_file_rename
        GBLL    clearsel_file_stamp
        GBLL    clearsel_file_settype
        GBLL    clearsel_newdir

clearsel_copymove       SETL (:LNOT: retainsel) :LOR: {TRUE}
clearsel_file_access    SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_copy      SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_count     SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_delete    SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_help      SETL (:LNOT: retainsel) :LOR: {TRUE}
clearsel_file_find      SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_rename    SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_stamp     SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_file_settype   SETL (:LNOT: retainsel) :LOR: {FALSE}
clearsel_newdir         SETL (:LNOT: retainsel) :LOR: {FALSE}

; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Emit and incompatibility warnings

        [ ursulawimp
        ! 0, ""
        ! 0, "WARNING - This version only suitable for use with Ursula WIMP or later"
        |
        ! 0, ""
        ! 0, "WARNING - Why aren't you using the Ursula WIMP?"
        ]

        [ includeresources
        ! 0, ""
        ! 0, "WARNING - Filer includes own resources, please turn off."
        ]
        ! 0, ""
        
        END
@


4.6
log
@Correct sprite name clamping while looking for sm!app
A previous fix in Filer-2_10 had changed the concatenation to be clamped at 10 letters so it doesn't overflow the buffer for long app names. However, having failed to find 'sm!app' it then just tried adding 2 to the string pointer therefore looking for a 10 letter sprite '!app'.
This is different behaviour to before Filer-2_10, which would have overrun thebuffer but at least looked for a full 12 letter name.
Optimised strncat a bit.
Put unused source file in the attic.
Trimmed some bug fix switches dating back to 1989.

Version 2.24. Tagged as 'Filer-2_24'
@
text
@d15 1
a59 12
; Using Ursula wimp?
        GBLL    ursulawimp
ursulawimp      SETL    {TRUE}

; Autoscrolling windows?
        GBLL    autoscroll
autoscroll      SETL    ursulawimp

; Ursula DragASprite
                  GBLL ursuladragasprite
ursuladragasprite SETL {TRUE}

a67 12

    [ ursulawimp
      ! 0, ""
      ! 0, "WARNING - this version only suitable for use with Ursula WIMP or later"
      ! 0, ""
    |
      ! 0, ""
      ! 0, "WARNING - Why aren't you using the ursula WIMP?"
      ! 0, ""
    ]


a69 1

d73 1
d97 49
a148 2


a172 33

; Ensure ClearAllSelections called with correct r2

        GBLL    Fix003
Fix003  SETL    {TRUE}

        GBLL    includeresources
  [ :DEF: standalone
includeresources SETL   standalone
  |
includeresources SETL   {FALSE}
  ]

      [ includeresources
        !       0,"******* WARNING ******* FILER INCLUDES OWN RESOURCES, PLEASE TURN OFF."
      ]


; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++



                GBLL    hastiny
hastiny         SETL    False


; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Other implementation flags

                GBLL    fonthack        ; This is NOT implemented properly
fonthack        SETL    False           ; and is just a quick hack for GBartram


d174 1
a174 21
; Ursula flags

; MenuClearsSelection
; If set, then if a click with Menu on a file in a different viewer will remove
; the selection in any other viewer and select the new file.

                    GBLL    MenuClearsSelection
MenuClearsSelection SETL    True

; OptionsAreInRAM
; If set, use RAM instead of CMOS to store options

                    GBLL    OptionsAreInRAM
OptionsAreInRAM     SETL    True

; AltRenaming - do Alt + Click renaming of files
; Don't trust this - some AltRenaming stuff isn't conditional on it.

                    GBLL    AltRenaming
AltRenaming         SETL    True

d176 14
@


4.5
log
@  Misc bugfixes.
Detail:
  * Mered in RISCOS Ltd's fix for directory displays with more than 65536
    bytes of leafnames.
  * Tries to use Wimp_TextOp 4 to do ellipsis truncation. As a result, it
    can now cope properly with:
    + multibyte UTF-8 characters in leafnames (previously this caused
      problems even if not truncated)
    + WimpSymbol character substitution in leafnames
    + alphabets without an ellipsis character
    + fonts without an ellipsis character
  * Sprite icons in 'Copy as' and 'New directory' dialogue boxes are no
    longer filled.
Admin:
  Tested on Tungsten.

Version 2.08. Tagged as 'Filer-2_08'
@
text
@a22 4
; *Filer_Run
        GBLL    filer_run
filer_run       SETL    {TRUE}

a54 1

a99 12

; Grey out 'access =>' when not owner

        GBLL    Fix001
Fix001  SETL    {TRUE}


; Blame Wimp for naff errors

        GBLL    Fix002
Fix002  SETL    {TRUE}

d111 1
@


4.4
log
@  The following were present in RISC OS 5.00/5.01:
  * "Directory" string removed from "New directory" dialogue box template.
    Unlike the version shipped in 5.00 and 5.01, this template file doesn't
    have its "Recurse" option button in the "Access details" dialogue box
    deselected.
  * When "New directory" dialogue box is opened, contents of the writable
    icon is now set to a null string, rather than the uninternationalised
    "Directory" that was used previously.
  * Uses OS_HeapSort32 instead of OS_HeapSort when the RMA is high.
  The following are new since then:
  * Fixed rubber dragboxes to use exclusive maximum coordinates, stops you
    dragging the box off the left hand side of the window.
  * Enabled SetDirectory option. Merged in 4.02's SetDirectoryComesFirst
    option, changed token in Messages file to read "Set work directory"
    instead of "Set directory" to match 4.02, and added the missing token
    MH?7? for interactive help.

Version 2.06. Tagged as 'Filer-2_06'
@
text
@d132 4
@


4.3
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 2.01. Tagged as 'Filer-2_01'
@
text
@d127 4
a130 1
AddSetDirectory SETL    {FALSE}
@


4.2
log
@Merged Ursula branch.
Moved to srccommit.

Version 1.96. Tagged as 'Filer-1_96'
@
text
@d84 1
a84 1
     
d94 1
a94 1
      
d130 1
a130 1
retainsel SETL  {TRUE}      
d162 1
a162 1
Fix003  SETL    {TRUE}       
d165 3
d169 2
a170 1
        
@


4.1
log
@Initial revision
@
text
@d59 1
a60 1

d64 32
d185 24
@


4.1.4.1
log
@Long filename support and SaveAs style new directory creation
@
text
@a153 1

@


4.1.4.2
log
@Added code to enable files to be copied to icon bar device icons
@
text
@a154 9
; +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Ursula flags

; If set, then if a click with Menu on a file in a different viewer will remove
; the selection in any other viewer and select the new file.

                   GBLL    menuclearselection
menuclearselection SETL    True

@


4.1.4.3
log
@Add new options to Options menu, plus fixed bugs
@
text
@d161 2
a162 6
                    GBLL    MenuClearsSelection
MenuClearsSelection SETL    True


                    GBLL    OptionsAreInRAM
OptionsAreInRAM     SETL    True
@


4.1.4.4
log
@Changed font width calculation code.
@
text
@a157 1
; MenuClearsSelection
a163 2
; OptionsAreInRAM
; If set, use RAM instead of CMOS to store options
a166 7

; AltRenaming - do Alt + Click renaming of files
; Don't trust this - some AltRenaming stuff isn't conditional on it.

                    GBLL    AltRenaming
AltRenaming         SETL    True

@


4.1.4.5
log
@Autoscrolling windows added.
Now reads icon bar tool widths so window title isn't obscured by iconise tool.
@
text
@a63 17
        GBLL    ursulawimp
ursulawimp      SETL    {TRUE}

        GBLL    autoscroll
autoscroll      SETL    ursulawimp
    
    [ ursulawimp
      ! 0, ""
      ! 0, "WARNING - this version only suitable for use with Ursula WIMP or later"
      ! 0, ""
    |
      ! 0, ""
      ! 0, "WARNING - Why aren't you using the ursula WIMP?"
      ! 0, ""
    ]
      

@


4.1.4.6
log
@New viewers are now opened at default width of four colums, where possible.
Addition to Message_FilerOpenDir to allow the forced update of all dir viewers
bu the FilrSetup application.
Bug fix: Adjust clicks on New directory OK icon now keep the menu structure up.
Bug fix: Adjust drags from Filer windows close the initiating dir viewer.
@
text
@d59 1
a60 1
; Drag to Icon bar Data_Opens applications and files
a63 1
; Using Ursula wimp?
a66 1
; Autoscrolling windows?
a68 4

; Default directory window width of four columns?
                 GBLL fourcolumnwidth
fourcolumnwidth  SETL {TRUE}
@


4.1.4.7
log
@Fixed bug which displayed wrong icon in file info window for DEADDEAD files.
@
text
@d75 1
a75 2

     
@


4.1.4.8
log
@Message_FilerSelection enhanced to provide x and y co-ordinates of pointer.
Fixed redraw bug associated with very tall dirviewers.
@
text
@a71 4
; Ursula DragASprite
                  GBLL ursuladragasprite
ursuladragasprite SETL {TRUE}

a74 4

; Message_FilerSelection with extra pointer information?
                         GBLL NewMessageFilerSelection
NewMessageFilerSelection SETL {TRUE}
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
