head	4.11;
access;
symbols
	Filter-0_28:4.11
	Filter-0_27:4.11
	Filter-0_26:4.10
	Filter-0_25:4.10
	RO_5_07:4.9
	Filter-0_24:4.9
	dellis_autobuild_BaseSW:4.8
	sbrodie_sedwards_16Mar2000:4.8
	Filter-0_23:4.8
	dcotton_autobuild_BaseSW:4.9
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2.2.2
	Ursula_RiscPC:4.2.2.2.0.2
	Filter-0_22:4.7
	Ursula_merge:4.2.2.2
	Filter-0_21:4.6
	rthornb_UrsulaBuild-19Aug1998:4.2.2.2
	UrsulaBuild_FinalSoftload:4.2.2.2
	rthornb_UrsulaBuild-12Aug1998:4.2.2.2
	aglover_UrsulaBuild-05Aug1998:4.2.2.2
	rthornb_UrsulaBuild-29Jul1998:4.2.2.2
	rthornb_UrsulaBuild-22Jul1998:4.2.2.2
	rthornb_UrsulaBuild-15Jul1998:4.2.2.2
	rthornb_UrsulaBuild-07Jul1998:4.2.2.2
	rthornb_UrsulaBuild-17Jun1998:4.2.2.2
	rthornb_UrsulaBuild-03Jun1998:4.2.2.2
	rthornb_UrsulaBuild-27May1998:4.2.2.2
	rthornb_UrsulaBuild-21May1998:4.2.2.2
	rthornb_UrsulaBuild_01May1998:4.2.2.2
	afrost_NC2_Generic:4.1.7.3
	bavison_FilterMgr_020:4.2.2.2
	sbrodie_FilterMgr_019:4.5
	sbrodie_FilterMgr_018:4.3
	FilterMgr_017:4.2
	Spinner_B20_2:4.1.7.3
	Spinner_19_3:4.1.7.3
	Spinner_B18:4.1.7.3
	Spinner_B17:4.1.7.3
	Spinner_B15:4.1.7.3
	Spinner_B14:4.1.7.3
	Spinner_B13:4.1.7.3
	Spinner_B12:4.1.7.3
	Spinner_B10:4.1.7.3
	Daytona:4.2.0.4
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	Spin_merge_7May97:4.1.7.1
	ARTtmp_bp:4.1.7.3
	Spinner_B7:4.1.7.3
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.3
	Spin_3Apr97:4.1.7.3
	ARTtmp:4.1.7.3.0.2
	Spin_merge:4.1.7.3
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.11
date	2012.01.12.21.14.10;	author rsprowson;	state Exp;
branches;
next	4.10;
commitid	ZzLhhv8NuC56CVOv;

4.10
date	2012.01.09.09.35.39;	author rsprowson;	state Exp;
branches;
next	4.9;
commitid	3HojTHJtT6ToQtOv;

4.9
date	2001.03.16.17.07.49;	author sbrodie;	state Exp;
branches;
next	4.8;

4.8
date	99.12.02.16.07.25;	author sbrodie;	state Exp;
branches;
next	4.7;

4.7
date	98.10.19.16.26.13;	author kbracey;	state Exp;
branches;
next	4.6;

4.6
date	98.10.05.15.41.21;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	98.03.06.11.42.24;	author sbrodie;	state Exp;
branches;
next	4.4;

4.4
date	98.03.05.19.25.37;	author sbrodie;	state Exp;
branches;
next	4.3;

4.3
date	98.01.30.10.31.53;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.05.07.14.56.01;	author kbracey;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.29.47;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.2.2.1
date	98.03.05.17.22.10;	author bavison;	state Exp;
branches;
next	4.2.2.2;

4.2.2.2
date	98.04.06.09.21.34;	author bavison;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.29.47;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.28.47;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.19.24;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.17.39;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.03.12.14.53.45;	author kbracey;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.03.14.10.18.13;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.11
log
@Make international help (or lack of) choice based on switch passed in rather than the bitfield definition in Hdr:ModHand.
Makes help work on RISC OS 3.10 again.

Version 0.27. Tagged as 'Filter-0_27'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; > s.Front

;;-----------------------------------------------------------------------------
;;
;; Change list
;;            0.01   16-Nov-1990  Started.
;;            0.02   23-May-1991  Added task=0 for all tasks.
;;            0.03   29-May-1991  Fixed bug, find_filter didn't return errors
;;            0.07   16-Apr-1992  Respond to Service_WimpRegisterFilters, fixes RP-1637.
;;                                * Deregistration ensures that only the low 16 bits of the task handle
;;                                  match since only these are saved in the filter block.  Fixes RP-2404
;;                                * Delay registering with wimp until first filter registered.  This
;;                                  avoids unnecessary degradation in WimpPoll performance
;;            0.08   22-Apr-1992  Broadcasts two new service calls, one when installed, one when removed.
;;
;;-----------------------------------------------------------------------------
;; Wish list
;;-----------------------------------------------------------------------------

        AREA    |FilterManager$$Code|, CODE, READONLY, PIC

Module_BaseAddr

        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:ModHand
        GET     Hdr:Machine.<Machine>
        GET     Hdr:APCS.<APCS>
        GET     Hdr:Services
        GET     Hdr:VduExt
        GET     Hdr:FSNumbers
        GET     Hdr:NewErrors
        GET     Hdr:Variables
        GET     Hdr:Proc
        GET     Hdr:Sprite
        GET     Hdr:Wimp
        GET     Hdr:WimpSpace
        GET     Hdr:Messages
        GET     Hdr:FilerAct
        GET     Hdr:MsgTrans
        GET     Hdr:MsgMenus
        GET     Hdr:ResourceFS
        GET     Hdr:ColourTran
        GET     Hdr:Hourglass
        GET     Hdr:NdrDebug
        GET     Hdr:Switcher

        GET     VersionASM

        GBLL    hostvdu
        GBLL    debugxx
        GBLL    debugregister

    [ :LNOT: :DEF: standalone
        GBLL    standalone
standalone      SETL {FALSE}            ; Build-in Messages file and i/f to ResourceFS
    ]
    [ :LNOT: :DEF: international_help
        GBLL    international_help
international_help SETL {TRUE}          ; Default to RISC OS 3.60+ internationalisation
    ]

debug           SETL {FALSE}            ; ONLY FALSE IF NO DEBUGGING
hostvdu         SETL {TRUE}             ; True to send debug to tube

debugxx         SETL {FALSE}            ; General debugging.
debugregister   SETL {FALSE}            ; Register/de-register

wsptr           RN      R12

; ----------------------------------------------------------------------------------------------------------------------
;      Filter block structure
                ^       0
next_ptr        #       4       ;       Pointer to next in chain                (-1 if none)
prev_ptr        #       4       ;       Pointer to previous entry in chain      (-1 if none)
f_task          #       4       ;       Task ID for which the filter is to be called.
f_mask          #       4       ;       Event mask.
f_address       #       4       ;       Address to call.
f_R12           #       4       ;       Value in R12 when calling.
f_name          #       4       ;       Pointer to filter name.
f_block_size      *      (@@-next_ptr)

        ASSERT  next_ptr=0
; ----------------------------------------------------------------------------------------------------------------------
;       Workspace layout

workspace       RN      R12
                ^       0,workspace
wsorigin        #       0

callbackpending #       4               ; non-zero if callback is pending
pre_filters     #       4
post_filters    #       4
rect_filters    #       4
copy_filters	#	4
post_rect_filters #	4
post_icon_filters #	4
convert_buffer  #       20
message_block   #       16
flags           #       4
filter_text     #       4
task_text       #       4
mask_text       #       4
all_text        #       4
fake_postrect	#	4		; do we want to fake the post-rectangle filter? (Wimp < 3.86)
get_handle_from_r10 #   4               ; do we get the window handle from r10 or the stack
                                        ; for get-rectangle filters? (from r10 for Wimp > 3.99)

f_messagesopen  *       (1:SHL:0)

max_running_work   *       (@@-wsorigin)


        LNK     s.ModHead

@


4.10
log
@Rework the 32 bitting to allow a 26 bit version to be made
Some of the changes were one way only, the use of some RETURN[V[C|S]] macros allows 26 bit version to be created.

Version 0.25. Tagged as 'Filter-0_25'
@
text
@d73 4
@


4.9
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 0.24. Tagged as 'Filter-0_24'
@
text
@d71 1
a71 1
standalone      SETL false              ; Build-in Messages file and i/f to ResourceFS
d74 2
a75 2
debug           SETL false              ; ONLY FALSE IF NO DEBUGGING
hostvdu         SETL true               ; True to send debug to tube
d77 2
a78 2
debugxx         SETL false              ; General debugging.
debugregister   SETL false              ; Register/de-register
a82 9
        MACRO
$label  ALIGNHASH  $o,$m
      [ ((@@-$o):AND:($m-1))<>0
$label  #          $m-((@@-$o):AND:($m-1))
      |
$label  #          0
      ]
        MEND
; ----------------------------------------------------------------------------------------------------------------------
@


4.8
log
@  32-bit compatible module.
Detail:
  Doesn't include the faking of post-rectangle filters if not building
    for 26 bit systems any more.
  Assumes that the Wimp doesn't care what the flags are on exit from
    a filter.
Admin:
  Built.

Version 0.23. Tagged as 'Filter-0_23'
@
text
@d34 2
a67 1
	GBLL	standalone
d69 4
a78 1
standalone	SETL false		; Build-in Messages file and i/f to ResourceFS
@


4.7
log
@Removed inclusion of Hdr:CMOS

Version 0.22. Tagged as 'Filter-0_22'
@
text
@d40 2
@


4.6
log
@Spinner and Ursula branches merged.
Changed to use srccommit.
Ancient [ Version < x conditionals removed.

Version 0.21. Tagged as 'Filter-0_21'
@
text
@a50 1
        GET     Hdr:CMOS
@


4.5
log
@Fix to build combined CmdHelp+Messages file for standalone build.
@
text
@d60 1
a60 1
        GET     Version
@


4.4
log
@Folded in changes from separate version 0.18 on the Ursula branch,
re-inserting the standalone build capability and the bug-fix for
de-registering PostIcon filters.
@
text
@d73 1
a73 1
standalone	SETL false
@


4.3
log
@standalone option added
@
text
@d120 3
a122 2
fake_postrect	#	4		; do we want to fake the post-rectangle
    					; filter?
@


4.2
log
@ARTtmp branch folded in
@
text
@d65 1
d73 1
@


4.2.2.1
log
@Improved layout of filters table (and re-worded headings).
Fixed bug which was causing *Filters help/syntax lookup to fail.
GetRectangle filter handler now obtains window handle from R10 rather than the
stack, providing current Wimp is version 3.99 or later.
@
text
@d118 2
a119 3
fake_postrect	#	4		; do we want to fake the post-rectangle filter? (Wimp < 3.86)
get_handle_from_r10 #   4               ; do we get the window handle from r10 or the stack
                                        ; for get-rectangle filters? (from r10 for Wimp > 3.99)
@


4.2.2.2
log
@Incorporated Filter_DeRegisterPostIconFilter bugfix and standalone capability
from trunk.
Added Ursula service call table.
@
text
@a64 1
	GBLL	standalone
a71 1
standalone	SETL false		; Build-in Messages file and i/f to ResourceFS
@


4.1
log
@Initial revision
@
text
@d107 4
d118 2
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@Updated in line with version 0.15. To wit:

1) Allow for task names being ctrl-terminated
2) Reference Messages file via FilterManager$Path, if set
3) Fix corruption of errors returned from Filter_RegisterXXX
4) Support for rectangle and copy filters (for Replay 3)
5) Support for post-rectangle filters (for Redraw Manager)
@
text
@a106 3
rect_filters    #       4
copy_filters	#	4
post_rect_filters #	4
a113 2
fake_postrect	#	4		; do we want to fake the post-rectangle
    					; filter?
@


4.1.7.3
log
@Support for Post-icon filters added.
@
text
@a109 1
post_icon_filters #	4
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
