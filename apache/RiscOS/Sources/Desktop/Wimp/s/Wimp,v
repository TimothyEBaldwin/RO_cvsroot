head	4.16;
access;
symbols
	Wimp-5_62:4.16
	Wimp-5_61:4.16
	Wimp-5_60:4.16
	Wimp-5_59:4.16
	Wimp-5_58:4.16
	Wimp-5_57:4.16
	Wimp-5_56:4.16
	Wimp-5_55:4.16
	Wimp-5_54:4.16
	Wimp-5_53:4.15
	Wimp-5_52:4.15
	Wimp-5_51:4.15
	Wimp-5_50:4.15
	Wimp-5_49:4.15
	Wimp-5_48:4.15
	Wimp-5_47-file1ad:4.15
	Wimp-5_47:4.15
	Wimp-5_46:4.15
	Wimp-5_45:4.15
	Wimp-5_44:4.15
	Wimp-5_43:4.15
	Wimp-5_42:4.15
	Wimp-5_41:4.15
	Wimp-5_40:4.15
	Wimp-5_39:4.15
	Wimp-5_38:4.15
	Wimp-5_37:4.15
	Wimp-5_36:4.15
	Wimp-5_35:4.15
	Wimp-5_34:4.15
	Wimp-5_33:4.15
	Wimp-5_32:4.15
	Wimp-5_31:4.15
	Wimp-5_30:4.15
	Wimp-530-pre4:4.15
	Wimp-5_30-pre3:4.15
	Wimp-5_30-pre2:4.15
	Wimp-5_30-pre1:4.15
	Wimp-5_29:4.15
	Wimp-5_28:4.15
	Wimp-5_27:4.15
	Wimp-5_26:4.15
	Wimp-5_25:4.15
	Wimp-5_24:4.15
	Wimp-5_23:4.15
	Wimp-5_22:4.15
	Wimp-5_21:4.15
	Wimp-5_20:4.15
	Wimp-5_19:4.14
	Wimp-5_18:4.14
	Wimp-5_17:4.14
	Wimp-5_16:4.14
	Wimp-5_15:4.14
	Wimp-5_14:4.13
	Wimp-5_13:4.12
	Wimp-5_12:4.11
	Wimp-5_11:4.11
	Wimp-5_10:4.11
	Wimp-5_09:4.11
	Wimp-5_08:4.10
	Wimp-5_07:4.10
	Wimp-5_06:4.10
	Wimp-5_05:4.9
	Wimp-5_04:4.9
	Wimp-5_03:4.9
	Wimp-5_02:4.9
	Wimp-5_01:4.9
	Wimp-4_66-4_77_2_1:4.8.2.1
	bavison_Threads_dev:4.8.0.2
	bavison_Threads_dev_bp:4.8
	Wimp-5_00:4.9
	Wimp-4_100:4.9
	Wimp-4_99:4.9
	Wimp-4_98:4.9
	Wimp-4_97:4.9
	Wimp-4_96:4.9
	Wimp-4_95:4.9
	Wimp-4_94:4.9
	RO_5_07:4.9
	Wimp-4_93:4.9
	Wimp-4_92:4.9
	Wimp-4_91:4.9
	Wimp-4_90:4.9
	Wimp-4_89:4.9
	Wimp-4_88:4.9
	Wimp-4_87:4.9
	Wimp-4_86:4.9
	Wimp-4_85:4.9
	Wimp-4_84:4.9
	Wimp-4_83:4.9
	Wimp-4_82:4.9
	Wimp-4_81:4.9
	Wimp-4_80:4.9
	Wimp-4_79:4.9
	Wimp-4_78:4.9
	Wimp-4_77:4.8
	Wimp-4_76:4.8
	Wimp-4_75:4.8
	Wimp-4_74:4.8
	Wimp-4_73:4.8
	Wimp-4_72:4.8
	Wimp-4_71:4.8
	Wimp-4_70:4.8
	Wimp-4_69:4.8
	Wimp-4_68:4.8
	Wimp-4_67:4.8
	Wimp-4_66:4.8
	Wimp-4_65:4.8
	Wimp-4_64:4.8
	Wimp-4_63:4.8
	Wimp-4_62:4.8
	Wimp-4_61:4.8
	Wimp-4_60:4.8
	Wimp-4_59:4.8
	Wimp-4_58:4.8
	Wimp-4_36-4_46_2_6:4.7
	Wimp-4_57:4.8
	Alpnet_approved:4.7
	Wimp-4_36-4_46_2_5:4.7
	Wimp-4_56:4.7
	dellis_autobuild_BaseSW:4.7
	Wimp-4_36-4_46_2_4:4.7
	Wimp-4_36-4_46_2_3:4.7
	Wimp-4_55:4.7
	Wimp-4_54:4.7
	Wimp-4_36-4_46_2_2:4.7
	Wimp-4_53:4.7
	Wimp-4_36-4_46_2_1:4.7
	Bethany:4.7.0.2
	Wimp-4_52:4.7
	Wimp-4_51:4.7
	Wimp-4_50:4.7
	Wimp-4_49:4.7
	Wimp-4_48:4.7
	Wimp-4_47:4.7
	Wimp-4_46:4.7
	Wimp-4_45:4.7
	Wimp-4_44:4.7
	Wimp-4_43:4.7
	Wimp-4_42:4.7
	sbrodie_sedwards_16Mar2000:4.7
	Wimp-4_41:4.7
	Wimp-4_40:4.7
	Wimp-4_39:4.7
	Wimp-4_38:4.7
	Wimp-4_37:4.7
	Wimp-4_36:4.7
	Wimp-4_35:4.7
	Wimp-4_34:4.7
	Wimp-4_33:4.7
	Wimp-4_32:4.7
	Wimp-4_31:4.7
	dcotton_autobuild_BaseSW:4.8
	Wimp-4_30:4.7
	Wimp-4_29:4.7
	Wimp-4_28:4.7
	Wimp-4_27:4.7
	Wimp-4_26:4.7
	Wimp-4_25:4.7
	Wimp-4_24:4.7
	Wimp-4_23:4.7
	Wimp-4_22:4.7
	Wimp-4_21:4.7
	Wimp-4_20:4.7
	Wimp-4_19:4.7
	Wimp-4_18:4.7
	Wimp-4_17:4.7
	Wimp-4_16:4.7
	Wimp-4_15:4.7
	Wimp-4_14:4.7
	Wimp-4_13:4.7
	Wimp-4_12:4.7
	mstphens_UrsulaRiscPCBuild_20Nov98:4.4.2.1
	bavison_Wimp-4_11:4.7
	Ursula_RiscPC:4.4.2.1.0.2
	Wimp-4_11:4.7
	Wimp-4_10:4.7
	Wimp-4_09:4.7
	Wimp-4_08:4.6
	Wimp-4_07:4.6
	Wimp-4_06:4.6
	Wimp-4_05:4.6
	Wimp-4_04:4.6
	bavison_Wimp-4_03_noshrinkables:4.6
	Wimp-4_03:4.6
	Wimp-4_02:4.6
	Ursula_merge:4.4.2.2
	bavison_Wimp-4_01:4.6
	Wimp-4_01:4.6
	nicke_Wimp_3_96M:4.1.7.3
	bavison_Wimp-4_00_TRUNK:4.5
	bavison_Wimp-4_00:4.4.2.2
	nicke_Wimp_3_96:4.1.7.3
	mjrobert_Wimp_3_98:4.4
	rthornb_UrsulaBuild-19Aug1998:4.4.2.1
	UrsulaBuild_FinalSoftload:4.4.2.1
	bavison_Wimp-3_99t:4.4.2.1
	rthornb_UrsulaBuild-12Aug1998:4.4.2.1
	bavison_Wimp-3_99s:4.4.2.1
	aglover_UrsulaBuild-05Aug1998:4.4.2.1
	bavison_Wimp-3_99r:4.4.2.1
	rthornb_UrsulaBuild-29Jul1998:4.4.2.1
	bavison_Wimp-3_99q:4.4.2.1
	jfarrell_NCWimp_3_96:4.1.7.3
	rthornb_UrsulaBuild-22Jul1998:4.4.2.1
	bavison_Wimp-3_99p:4.4.2.1
	rthornb_UrsulaBuild-15Jul1998:4.4.2.1
	bavison_Wimp-3_99o:4.4.2.1
	bavison_Wimp-3_99n:4.4.2.1
	rthornb_UrsulaBuild-07Jul1998:4.4.2.1
	bavison_Wimp-3_99m:4.4.2.1
	rthornb_UrsulaBuild-17Jun1998:4.4.2.1
	rthornb_UrsulaBuild-03Jun1998:4.4.2.1
	bavison_Wimp-3_99l:4.4.2.1
	rthornb_UrsulaBuild-27May1998:4.4.2.1
	rthornb_UrsulaBuild-21May1998:4.4.2.1
	bavison_Wimp-3_99k:4.4.2.1
	bavison_Wimp-3_99j:4.4.2.1
	bavison_Wimp-3_99i:4.4.2.1
	bavison_Wimp-3_99h:4.4.2.1
	rthornb_UrsulaBuild_01May1998:4.4.2.1
	bavison_Wimp_399g:4.4.2.1
	bavison_Wimp_399f:4.4.2.1
	afrost_NC2_Generic:4.1.7.3
	bavison_Wimp_399e:4.4.2.1
	bavison_Wimp_399d:4.4.2.1
	bavison_Wimp_399c:4.4.2.1
	Wimp_3_98:4.4
	kbracey_AW97:4.4
	Spinner_B20_2:4.1.7.3
	Spinner_19_3:4.1.7.3
	Spinner_B18:4.1.7.2
	Spinner_B17:4.1.7.2
	Spinner_B15:4.1.7.2
	Spinner_B14:4.1.7.2
	Spinner_B13:4.1.7.2
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.4.0.4
	Daytona_bp:4.4
	Ursula:4.4.0.2
	Ursula_bp:4.4
	Wimp_3_91:4.4
	Spin_merge_7May97:4.1.7.1
	ARTtmp_bp:4.1.7.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1.2.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.3
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.16
date	2016.05.28.18.52.53;	author jlee;	state Exp;
branches;
next	4.15;
commitid	TTWlrzl5OHkYsh8z;

4.15
date	2013.03.28.08.07.32;	author rsprowson;	state Exp;
branches;
next	4.14;
commitid	6IoKYZf9tBXk5xJw;

4.14
date	2012.06.23.09.22.25;	author rsprowson;	state Exp;
branches;
next	4.13;
commitid	EU9dc3pmPjF0rO9w;

4.13
date	2012.01.27.21.12.29;	author rsprowson;	state Exp;
branches;
next	4.12;
commitid	SVSK1WYyfHjp7RQv;

4.12
date	2011.08.04.20.33.30;	author jlee;	state Exp;
branches;
next	4.11;
commitid	gzFhtZcn753Zyeuv;

4.11
date	2010.11.26.18.47.52;	author jlee;	state Exp;
branches;
next	4.10;

4.10
date	2009.06.11.20.57.38;	author bavison;	state Exp;
branches;
next	4.9;

4.9
date	2002.10.30.17.43.54;	author bavison;	state Exp;
branches;
next	4.8;

4.8
date	2000.10.20.12.44.26;	author bavison;	state Exp;
branches
	4.8.2.1;
next	4.7;

4.7
date	98.10.23.15.48.22;	author bavison;	state Exp;
branches;
next	4.6;

4.6
date	98.09.30.09.06.28;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	98.09.18.16.14.08;	author bavison;	state Exp;
branches;
next	4.4;

4.4
date	97.05.07.14.15.29;	author kbracey;	state Exp;
branches
	4.4.2.1;
next	4.3;

4.3
date	97.01.30.15.55.48;	author nturton;	state Exp;
branches;
next	4.2;

4.2
date	97.01.21.16.15.21;	author nturton;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.30.48;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.8.2.1
date	2007.10.07.02.17.29;	author bavison;	state Exp;
branches;
next	;
commitid	NSavcPvbNd36pBAs;

4.4.2.1
date	98.03.26.19.31.34;	author bavison;	state Exp;
branches;
next	4.4.2.2;

4.4.2.2
date	98.09.18.14.14.24;	author bavison;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.30.48;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.33.00;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.24.39;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.22.11;	author nturton;	state Exp;
branches
	4.1.7.1.2.1;
next	4.1.7.2;

4.1.7.2
date	97.06.11.10.04.44;	author scormie;	state Exp;
branches;
next	4.1.7.3;

4.1.7.3
date	97.07.25.13.27.28;	author jcoxhead;	state Exp;
branches;
next	;

4.1.7.1.2.1
date	97.04.28.16.49.54;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.16
log
@Remove redundant GET
Detail:
  s/Wimp - IO header doesn't appear to be necessary for build, so don't get it
Admin:
  Tested with PlingSystem build (new "26" machine type aims to be machine-independent, so doesn't define $GetIO)
  Untested at runtime


Version 5.54. Tagged as 'Wimp-5_54'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; > s.Wimp

;;-----------------------------------------------------------------------------
;; Title:    A1 Wimp System
;; Author:   Neil Raine
;;-----------------------------------------------------------------------------

        AREA    |Asm$$Code|, CODE, READONLY

Module_BaseAddr

        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:Machine.<Machine>
        GET     Hdr:CMOS
        GET     Hdr:PublicWS               ; for SvcTable
        GET     Hdr:ModHand
        GET     Hdr:Proc
        GET     Hdr:EnvNumbers
        GET     Hdr:Services
        GET     Hdr:UpCall
        GET     Hdr:VduExt
        GET     Hdr:FSNumbers
        GET     Hdr:HighFSI
        GET     Hdr:HostFS
        GET     Hdr:NDRDebug
        GET     Hdr:Font
        GET     Hdr:Wimp
        GET     Hdr:Messages
        GET     Hdr:NewErrors
        GET     Hdr:Sprite
        GET     Hdr:Variables
        GET     Hdr:FileTypes
        GET     Hdr:Hourglass
        GET     Hdr:ResourceFS
        GET     Hdr:Portable
        GET     Hdr:MsgTrans
        GET     hdr:ColourTran
        GET     hdr:FPEmulator
        GET     hdr:Territory
        GET     hdr:Switcher
        GET     hdr:PDriver
        GET     hdr:ScrBlank
        GET     hdr:OsWords
        GET     hdr:Countries
        GET     hdr:Internatio
        GET     hdr:VFPSupport
        GET     hdr:OSRSI6

        GET     VersionASM

        GET     hdr.WIMPMacros
        GET     hdr.IconHigh

	GBLL	true
	GBLL	false
true	SETL	{TRUE}
false	SETL	{FALSE}

        GBLS    LoadWimpOptions
      [ Options = ""
LoadWimpOptions SETS "GET Options.s.<System>"
      |
LoadWimpOptions SETS "GET Options.s.$Options"
      ]

	GET	Options.s.!Default
        $LoadWimpOptions
	GET     Hdr:ImageSize.<ImageSize>
	GET	Options.s.!Common
	GET	Options.s.!Debug
        GET     Wimp01.s
        GET     Memory.s
        GET     Wimp02.s
        GET     Watchdog.s
      [ ThreeDPatch
        GET     Tiling3D.s
      |
        GET     Tiling.s
      ]
        GET     Wimp03.s
        GET     Wimp04.s
        GET     Wimp05.s
        GET     Wimp06.s
        GET     Iconbar.s
        GET     Wimp07.s
        GET     ProgErrs.s
        GET     Wimp08.s
        GET     Wimp09.s
        GET     Wimp10.s
        GET     NewSWIs.s
        GET     AutoScroll.s
      [ debug
        GET     Trace.s
      ]

        END
@


4.15
log
@Add support for wide translation tables for window tool furniture
With the introduction of 16bpp/32bpp modes it became possible to request tables from ColourTrans which used > 1 byte per colour, but the Wimp wasn't using this extension. Therefore tool sprites designed in 8bpp or less would be quantised horribly when plotted in a 16bpp or 32bpp mode.
The Wimp now requests and plots with a wide table, and to avoid thrashing ColourTrans so much with the prevalence of individually paletted icon sprites, keeps the table seperately to the icon sprites ones. At worst (in 32bpp) this uses an extra 256x4 bytes of RAM.
Trace.s: Split out the tracing routines from Wimp10 as it was getting a bit big.
Tiling.s: Namespace change for the icons versus tools distinction. Removed some unnecessary PC+8/PC+12 confused NOPs.
Tiling3D.s: Namespace change for the icons versus tools distinction.
Wimp01.s: New set of variables to track the tool translation tables separately. Various jiggling to keep ADRs in range.
Wimp02.s: Namespace change. Remove some double handling in Wimp_SetColourMapping.
Wimp04.s: Namespace change. Made factor rationalisation common to both the icon and tool grinding code. Removed dual use of cachespritedata for both icons and tools. The tintfunc moves to Wimp10. Service_InvalidateCache confusion resolved by adding a new flag to remember that the tools need regenerating rather than just marking the tool list as missing (which subsequently got restored in Tool_SpriteOp without actually doing any palette work.
Wimp10.s: Label tools_area renamed as it was immensely confusing to have that (which was actually holding the RMA allocation of the tool_list) and tool_area (which contains the sprite area) hanging around. Changed references to use tools-only cachetolspritedata routine. Added 'wide' flags to sprite op and colour trans calls. Tool_SpriteOp changed to actually regenerate the colour tables when they're known invalid (previously the tools list pointer was merely restored and no colour tables used). Trace functions extracted. Resolved confusion as to what recache_tools_trans and recache_tools_trans2 should be doing.

Tested with 4bpp "NewLook" sprites in 4bpp/8bpp/16bpp/32bpp and 8bpp smooth greyscaled "Steel" tool sprites in same modes.
Also ran a task window doing repeated Service_InvalidateCache calls while monitoring the RMA for leaks.
Generally navigated around some directories to ensure that inverse icons (during double click) and filer windows (with individually paletted sprites) were being rendered.

Version 5.20. Tagged as 'Wimp-5_20'
@
text
@a29 1
        $GetIO
@


4.14
log
@Preset Wimp$IconTheme on initialisation to UserIF if not already set
Therefore, when in ROM, the ROM theme can be inferred. When a different theme is selected by the user in the boot sequence, that is respected.
Restore a lost error message for *ICONSPRITES when the file doesn't exist even after trying all the 11/22/23 suffix and prefixes. This seems to have been lost post RISC OS 3.10 when Sprites22 support was added, but it is an error for the file given to not exist at all (cf. *TOOLSPRITES).
Typos in docs ammended.

Version 5.15. Tagged as 'Wimp-5_15'
@
text
@d109 3
@


4.13
log
@Get of international module header.
Retagged as Wimp-5_14.
@
text
@d49 1
@


4.12
log
@Make compatible with zero page relocation
Detail:
  s/Wimp, s/Wimp01, s/Wimp02, s/Wimp07, s/Wimp08 - Try using OS_ReadSysInfo 6 to get IRQsema & DomainId locations before falling back on legacy values. Store the pointers in module workspace for speedy access.
Admin:
  Tested on rev A2 BB-xM


Version 5.13. Tagged as 'Wimp-5_13'
@
text
@d61 1
@


4.11
log
@Make the Wimp automatically switch VFP contexts
Detail:
  s/Wimp, s/Wimp01, s/Wimp02, s/Wimp03, s/Wimp07 - The Wimp now uses the VFPSupport module to switch VFP contexts when performing task switches.
  Each task begins with the null context active (i.e. no VFP/NEON access). When paging out a task the ID of the active context is saved in the Wimp's per-task workspace. This context is then restored when the task is about to be resumed.
  Context save/restore is performed while the right task's memory is paged in, so it's safe to use with contexts located in application space.
Admin:
  Tested with Iyonix & Beagle ROM builds.


Version 5.09. Tagged as 'Wimp-5_09'
@
text
@d62 1
@


4.10
log
@  GET file pathnames changed
Detail:
  Uses suffixed file extensions for compatiblity with both objasm and asasm.
Admin:
  Supplied by Peter Naulls, tested at ROOL

Version 5.05. Not tagged
@
text
@d61 1
@


4.9
log
@  Merged in RISC OS 4.02 changes (including ROM patches). Also som bugfixes.
Detail:
  RISC OS 4 changes:
  * Font blending for desktop font (based on NC code, but now configurable)
  * 3-D window/menu/iconbar borders
  * Textured menu backgrounds
  * Loss of rubout box in unfilled text+sprite icons
  * *WimpVisualFlags controls various aspects of cosmetic changes above
  * Iconise button "slot" glyph slightly shorter (but only adopted in the RO400
    Resource directory)
  * Command window has front-window flag set
  * Byte at +39 of the window block has gained two new flag bits:
      bit 2 set => this window must never be given a 3D border
      bit 3 set => this window must always be given a 3D border
      (note that ResEd erroneously created windows with both bits set,
      this case is treated as though both bits were clear)
  * Another two colour specifiers on the end of C validation string command
    for icons controls the foreground and background colours to be used when
    the icon is selected
  * Pointer shape is correctly reprogrammed by the creation of icon
    underneath it
  * Full stops in writable icons are treated the same as spaces from the
    point of view of cursor navigation
  * spritesize routine returns a size of 0 if the sprite didn't exist
    (probably fixes some rendering problems)
  * Adjust-click on back icon brings window to front
  My changes:
  * DeleteRight turned on
  * Icon bar title background is set to default in all resource sets (avoids
    translation table recalc)
  * Error box title now cream across all resource sets
  * RISC OS 4 changes made 32-bit compatible / high addresses safe
  * Undocumented FullIconClipping option disabled
  * Command help made consistent for internationalised and non-
    internationalised builds
  * WimpVisualFlags defaults made sensible
  * Menu side width affected by ThreeD option at *run* time not assemble time
  * Right-clicking on menus with writable items no longer data aborts
  * Auto-opened menus are now at RHS of current icon (matches RISC OS 3.1)
  * Colour menus were knackered unless menu tiling was enabled
  * Fixed a bug whereby adding messages to a task that wanted all messages
    actually caused it to lose all other messages. The RISC OS 4 fix for
    this didn't work
  * Fixed bug introduced in version 4.76: tasks that wanted no messages got
    all of them
  * Autoscrolling is updated every 8 cs rather than every 12 cs
  * Added menu texture to pre-RISC OS 4 sprites files
Admin:
  Tested on Tungsten.

Version 4.78. Tagged as 'Wimp-4_78'
@
text
@d84 4
a87 4
        GET     s.Wimp01
        GET     s.Memory
        GET     s.Wimp02
        GET     s.Watchdog
d89 1
a89 1
        GET     s.Tiling3D
d91 1
a91 1
        GET     s.Tiling
d93 12
a104 12
        GET     s.Wimp03
        GET     s.Wimp04
        GET     s.Wimp05
        GET     s.Wimp06
        GET     s.Iconbar
        GET     s.Wimp07
        GET     s.ProgErrs
        GET     s.Wimp08
        GET     s.Wimp09
        GET     s.Wimp10
        GET     s.NewSWIs
        GET     s.AutoScroll
@


4.8
log
@  Shock horror - a new feature for the Wimp! And some housekeeping too.
Detail:
  * Added new functionality for menu trees: submenus can now be opened by
    clicking on their parent menu item. This is particularly aimed at
    touchscreen devices, and is configurable via the new *Configure keyword
    WimpClickSubmenu.
  * Change to the menu inactivity timeout behaviour after auto-opening of
    submenus (either by hovering over the parent menu item or by the new
    click-to-open functionality): although all hover operations are still
    ignored for this period, any click operations *will* now be obeyed.
  * Corrected numerous misleading comments in the menu handling code.
  * Added some suspiciously absent ALIGNs in the *Configure keyword handlers.
  * Uses new ASCII case-forcing macros so there are now fewer warnings
    printed during assembly (and it should run faster now too).
  * Added an AREA directive so that objasm's -ABS switch is no longer needed.
  * Standardised ErrMem token across all Messages files that use English.
Admin:
  Tested on a desktop machine.
  Requires HdrSrc 1.06.

Version 4.57. Tagged as 'Wimp-4_57'
@
text
@d88 3
d92 1
@


4.8.2.1
log
@  Added Dan Ellis's multithreading support, on a development branch for now.
Detail:
  This breaks the equivalence between tasks and AMB slots, allowing many
  threads of execution to share the same AMB slot, where an application's
  heap is usually located. In API terms, it is presented as an extension to
  Wimp_StartTask, see Docs/Multithreading for more information. It is the
  caller's responsibility to create a new stack chunk for the new thread if
  required. Note that BASIC's variable storage model is fundamentally
  unsuited for multithreading.
Admin:
  This was developed in 2001 and was not committed at the time due to lack
  of testing and peer review. It is now being added as a branch from a
  contemporary trunk Wimp. Hopefully somebody will be interested enough to
  merge the branch into a recent version!

Version 4.66, 4.77.2.1. Tagged as 'Wimp-4_66-4_77_2_1'
@
text
@a60 1
	GET	hdr:TaskWindow
@


4.7
log
@Adapted assembly process so that the choice of Options file (previously based
purely on the "System" variable) can be overridden by passing "OPTIONS=foo" as
an argument to either MkRom, or to amu/amu_machine directly, or indirectly,
by specifying it in the components file for a build. To accomplish this, it
was necessary to switch from using aasm to objasm - hence the large number of
source files affected in this commit.

Version 4.09. Tagged as 'Wimp-4_09'
@
text
@d22 2
@


4.6
log
@Spinner branch merged.
Changed to use srccommit.
All conditionals on "Version" removed.

Version 4.01. Tagged as 'Wimp-4_01'
@
text
@a64 2
	LEADR	Module_LoadAddr

d70 7
d78 1
a78 1
	GET	Options.s.<System>
@


4.5
log
@Ursula branch Wimp merged back onto trunk.
@
text
@d27 2
d60 1
a60 1
        GET     Version
d63 1
@


4.4
log
@ARTtmp branch folded in
@
text
@d54 3
d71 1
d90 1
@


4.4.2.1
log
@New features:
Dragboxes can now be clipped by and/or fixed to a given window's work area
SWI Wimp_AutoScroll implemented
Ursula icon highlighting scheme redesigned

Bugfixes:
Wimp_Extend 11 now performs the same check on R1 as the main SWI handling code
Message blocks now updated if in a dynamic area
Screenblanker now turned off when error box is displayed
ptr_double now turned off when a drag starts
@
text
@a53 2
        GET     hdr:ScrBlank
        GET     hdr:OsWords
a67 1
	GET     Hdr:ImageSize.<ImageSize>
a85 1
        GET     s.AutoScroll
@


4.4.2.2
log
@Re-inserted the fixed low-res autoscroll pointers (they disappeared in the
final softload ROM).
Fixed half-specified font-colour validation-string-command bug.
Partial UTF-8 support included, but switched out, since UTF-8 won't be any
theoretical future Ursula build.

Finally...
Cranked version number up to 4.00, to signify the end of Ursula development.
@
text
@a55 1
        GET     hdr:Countries
@


4.3
log
@New Wimp imported
@
text
@d59 11
a69 1
        GET     s.Options
@


4.2
log
@Version RO_3_70 taken
@
text
@a21 14

;whether to delegate task memory management to AMBControl
        GBLL    UseAMBControl
UseAMBControl SETL {TRUE}

;SWI code for AMBControl (X version) - could be a module, could be in kernel
AMBControl_SWI * &20070

        GBLL    StrongARM
StrongARM SETL {TRUE}

        GBLL    SAnaffsilicon           ;fudges for naff prototype StrongARM silicon
SAnaffsilicon   SETL    {TRUE} :LAND: StrongARM

a71 1
        GET     s.W08_oldway
@


4.1
log
@Initial revision
@
text
@d22 14
d86 1
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@When building for NCs, use IconHigh in error boxes, use different button
border colours, use replacement Templates file.
@
text
@a26 2
        GET     Hdr:Machine.<Machine>
        $GetIO
@


4.1.7.3
log
@   When turning the pointer off before Wimp_Report, save the state and
set it back to that state afterwards.
   Allow Wimp_GetPointerInfo, Wimp_GetWindowInfo, Wimp_GetWindowState outside
a task: needed to make IconHigh work in a ReportError box which has itself been
invoked from outside a task.
@
text
@a59 1
        GET     hdr.IconHigh
@


4.1.7.1.2.1
log
@Added support for multiple options files (RO310, RO350, RO360, RO370, RCA,
Ursula).
Removed run-time MedusaOS checks.
Enabled correct build for RISC OS 3.1 machines.
Ensured that "freepoolinuse" is cleared before OS_ChangeDynamicArea
is intercepted.
Increased maxrects to 256.
Gave copy filter window handle in R10 (if ChildWindows).
Corrected a few border problems when no toolsprites.
Made toolsprites press in immediately - in particular close and toggle can
now be highlighted.
BounceClose flag no affects all of back,close,iconise and toggle.
Made "L" validation string parsing check manually for presence of a number,
to prevent error from OS_ReadUnsigned trashing MessageTrans' error buffers.
Allow error box buttons to stretch to fit text.
Fixed bug: floating point registers were not being saved unless on a portable.
Integrated some of the Wimp_TransferBlock fixes into Wimp08 from Wimp08s.
@
text
@d59 1
a59 11
	LEADR	Module_LoadAddr

	GBLL	true
	GBLL	false
true	SETL	{TRUE}
false	SETL	{FALSE}

	GET	Options.s.!Default
	GET	Options.s.<System>
	GET	Options.s.!Common
	GET	Options.s.!Debug
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@a21 14

;whether to delegate task memory management to AMBControl
        GBLL    UseAMBControl
UseAMBControl SETL {TRUE}

;SWI code for AMBControl (X version) - could be a module, could be in kernel
AMBControl_SWI * &20070

        GBLL    StrongARM
StrongARM SETL {TRUE}

        GBLL    SAnaffsilicon           ;fudges for naff prototype StrongARM silicon
SAnaffsilicon   SETL    {TRUE} :LAND: StrongARM

a71 1
        GET     s.W08_oldway
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
