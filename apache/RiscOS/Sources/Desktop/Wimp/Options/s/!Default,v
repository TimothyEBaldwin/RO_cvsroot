head	1.25;
access;
symbols
	Wimp-5_62:1.25
	Wimp-5_61:1.25
	Wimp-5_60:1.25
	Wimp-5_59:1.25
	Wimp-5_58:1.25
	Wimp-5_57:1.25
	Wimp-5_56:1.25
	Wimp-5_55:1.25
	Wimp-5_54:1.25
	Wimp-5_53:1.25
	Wimp-5_52:1.25
	Wimp-5_51:1.25
	Wimp-5_50:1.25
	Wimp-5_49:1.24
	Wimp-5_48:1.24
	Wimp-5_47-file1ad:1.24
	Wimp-5_47:1.24
	Wimp-5_46:1.24
	Wimp-5_45:1.24
	Wimp-5_44:1.24
	Wimp-5_43:1.24
	Wimp-5_42:1.24
	Wimp-5_41:1.24
	Wimp-5_40:1.23
	Wimp-5_39:1.23
	Wimp-5_38:1.23
	Wimp-5_37:1.23
	Wimp-5_36:1.23
	Wimp-5_35:1.23
	Wimp-5_34:1.23
	Wimp-5_33:1.22
	Wimp-5_32:1.22
	Wimp-5_31:1.22
	Wimp-5_30:1.22
	Wimp-530-pre4:1.21
	Wimp-5_30-pre3:1.21
	Wimp-5_30-pre2:1.21
	Wimp-5_30-pre1:1.21
	Wimp-5_29:1.20
	Wimp-5_28:1.20
	Wimp-5_27:1.20
	Wimp-5_26:1.20
	Wimp-5_25:1.20
	Wimp-5_24:1.19
	Wimp-5_23:1.18
	Wimp-5_22:1.18
	Wimp-5_21:1.17
	Wimp-5_20:1.17
	Wimp-5_19:1.17
	Wimp-5_18:1.17
	Wimp-5_17:1.17
	Wimp-5_16:1.17
	Wimp-5_15:1.17
	Wimp-5_14:1.17
	Wimp-5_13:1.17
	Wimp-5_12:1.17
	Wimp-5_11:1.17
	Wimp-5_10:1.17
	Wimp-5_09:1.17
	Wimp-5_08:1.17
	Wimp-5_07:1.17
	Wimp-5_06:1.17
	Wimp-5_05:1.17
	Wimp-5_04:1.17
	Wimp-5_03:1.17
	Wimp-5_02:1.17
	Wimp-5_01:1.17
	Wimp-4_66-4_77_2_1:1.13.2.1
	bavison_Threads_dev:1.13.0.2
	bavison_Threads_dev_bp:1.13
	Wimp-5_00:1.17
	Wimp-4_100:1.17
	Wimp-4_99:1.17
	Wimp-4_98:1.17
	Wimp-4_97:1.17
	Wimp-4_96:1.17
	Wimp-4_95:1.17
	Wimp-4_94:1.17
	RO_5_07:1.16
	Wimp-4_93:1.16
	Wimp-4_92:1.16
	Wimp-4_91:1.16
	Wimp-4_90:1.16
	Wimp-4_89:1.16
	Wimp-4_88:1.16
	Wimp-4_87:1.16
	Wimp-4_86:1.16
	Wimp-4_85:1.16
	Wimp-4_84:1.16
	Wimp-4_83:1.16
	Wimp-4_82:1.16
	Wimp-4_81:1.16
	Wimp-4_80:1.16
	Wimp-4_79:1.16
	Wimp-4_78:1.16
	Wimp-4_77:1.15
	Wimp-4_76:1.15
	Wimp-4_75:1.14
	Wimp-4_74:1.14
	Wimp-4_73:1.14
	Wimp-4_72:1.14
	Wimp-4_71:1.14
	Wimp-4_70:1.14
	Wimp-4_69:1.14
	Wimp-4_68:1.13
	Wimp-4_67:1.13
	Wimp-4_66:1.13
	Wimp-4_65:1.13
	Wimp-4_64:1.13
	Wimp-4_63:1.13
	Wimp-4_62:1.13
	Wimp-4_61:1.13
	Wimp-4_60:1.13
	Wimp-4_59:1.13
	Wimp-4_58:1.13
	Wimp-4_36-4_46_2_6:1.11
	Wimp-4_57:1.13
	Alpnet_approved:1.11
	Wimp-4_36-4_46_2_5:1.11
	Wimp-4_56:1.12
	dellis_autobuild_BaseSW:1.12
	Wimp-4_36-4_46_2_4:1.11
	Wimp-4_36-4_46_2_3:1.11
	Wimp-4_55:1.12
	Wimp-4_54:1.12
	Wimp-4_36-4_46_2_2:1.11
	Wimp-4_53:1.12
	Wimp-4_36-4_46_2_1:1.11
	Bethany:1.11.0.2
	Wimp-4_52:1.12
	Wimp-4_51:1.12
	Wimp-4_50:1.12
	Wimp-4_49:1.12
	Wimp-4_48:1.12
	Wimp-4_47:1.12
	Wimp-4_46:1.11
	Wimp-4_45:1.11
	Wimp-4_44:1.11
	Wimp-4_43:1.11
	Wimp-4_42:1.11
	sbrodie_sedwards_16Mar2000:1.11
	Wimp-4_41:1.11
	Wimp-4_40:1.11
	Wimp-4_39:1.11
	Wimp-4_38:1.11
	Wimp-4_37:1.11
	Wimp-4_36:1.11
	Wimp-4_35:1.11
	Wimp-4_34:1.11
	Wimp-4_33:1.11
	Wimp-4_32:1.11
	Wimp-4_31:1.10
	dcotton_autobuild_BaseSW:1.14
	Wimp-4_30:1.10
	Wimp-4_29:1.10
	Wimp-4_28:1.10
	Wimp-4_27:1.10
	Wimp-4_26:1.10
	Wimp-4_25:1.10
	Wimp-4_24:1.10
	Wimp-4_23:1.10
	Wimp-4_22:1.9
	Wimp-4_21:1.9
	Wimp-4_20:1.9
	Wimp-4_19:1.8
	Wimp-4_18:1.8
	Wimp-4_17:1.8
	Wimp-4_16:1.8
	Wimp-4_15:1.8
	Wimp-4_14:1.8
	Wimp-4_13:1.8
	Wimp-4_12:1.8
	mstphens_UrsulaRiscPCBuild_20Nov98:1.3.2.13
	bavison_Wimp-4_11:1.8
	Ursula_RiscPC:1.3.2.13.0.2
	Wimp-4_11:1.8
	Wimp-4_10:1.7
	Wimp-4_09:1.7
	Wimp-4_08:1.6
	Wimp-4_07:1.6
	Wimp-4_06:1.6
	Wimp-4_05:1.5
	Wimp-4_04:1.5
	bavison_Wimp-4_03_noshrinkables:1.5
	Wimp-4_03:1.5
	Wimp-4_02:1.5
	Ursula_merge:1.3.2.13
	bavison_Wimp-4_01:1.5
	Wimp-4_01:1.5
	bavison_Wimp-4_00_TRUNK:1.4
	bavison_Wimp-4_00:1.3.2.13
	mjrobert_Wimp_3_98:1.3.2.3
	rthornb_UrsulaBuild-19Aug1998:1.3.2.13
	UrsulaBuild_FinalSoftload:1.3.2.13
	bavison_Wimp-3_99t:1.3.2.13
	rthornb_UrsulaBuild-12Aug1998:1.3.2.13
	bavison_Wimp-3_99s:1.3.2.13
	aglover_UrsulaBuild-05Aug1998:1.3.2.13
	bavison_Wimp-3_99r:1.3.2.13
	rthornb_UrsulaBuild-29Jul1998:1.3.2.13
	bavison_Wimp-3_99q:1.3.2.13
	rthornb_UrsulaBuild-22Jul1998:1.3.2.12
	bavison_Wimp-3_99p:1.3.2.12
	rthornb_UrsulaBuild-15Jul1998:1.3.2.12
	bavison_Wimp-3_99o:1.3.2.12
	bavison_Wimp-3_99n:1.3.2.11
	rthornb_UrsulaBuild-07Jul1998:1.3.2.10
	bavison_Wimp-3_99m:1.3.2.10
	rthornb_UrsulaBuild-17Jun1998:1.3.2.10
	rthornb_UrsulaBuild-03Jun1998:1.3.2.10
	bavison_Wimp-3_99l:1.3.2.10
	rthornb_UrsulaBuild-27May1998:1.3.2.10
	rthornb_UrsulaBuild-21May1998:1.3.2.10
	bavison_Wimp-3_99k:1.3.2.10
	bavison_Wimp-3_99j:1.3.2.10
	bavison_Wimp-3_99i:1.3.2.9
	bavison_Wimp-3_99h:1.3.2.9
	rthornb_UrsulaBuild_01May1998:1.3.2.8
	bavison_Wimp_399g:1.3.2.8
	bavison_Wimp_399f:1.3.2.8
	bavison_Wimp_399e:1.3.2.8
	bavison_Wimp_399d:1.3.2.7
	bavison_Wimp_399c:1.3.2.6
	Wimp_3_98:1.3.2.3
	kbracey_AW97:1.3.2.1
	Daytona:1.3.0.4
	Daytona_bp:1.3
	Ursula:1.3.0.2
	Ursula_bp:1.3
	Wimp_3_91:1.3
	ARTtmp_bp:1.1
	ARTtmp_merge:1.1.2.1
	ARTtmp:1.1.0.2;
locks; strict;
comment	@# @;


1.25
date	2015.10.10.12.14.22;	author jlee;	state Exp;
branches;
next	1.24;
commitid	hTZlaaPZyibzGyEy;

1.24
date	2014.04.19.09.39.19;	author rsprowson;	state Exp;
branches;
next	1.23;
commitid	wEWgncfqw43A9hxx;

1.23
date	2013.11.30.01.22.04;	author jlee;	state Exp;
branches;
next	1.22;
commitid	NHBF77CIMgF0Uefx;

1.22
date	2013.06.01.17.06.18;	author rsprowson;	state Exp;
branches;
next	1.21;
commitid	cfrGRVe6q9kCYVRw;

1.21
date	2013.06.01.16.05.15;	author rsprowson;	state Exp;
branches;
next	1.20;
commitid	vUA7bZz16PeFCVRw;

1.20
date	2013.05.06.11.54.45;	author rsprowson;	state Exp;
branches;
next	1.19;
commitid	dyQdYmrTRpty5zOw;

1.19
date	2013.05.03.21.08.11;	author rsprowson;	state Exp;
branches;
next	1.18;
commitid	QS59VqQdUOQmfeOw;

1.18
date	2013.04.10.20.48.42;	author rsprowson;	state Exp;
branches;
next	1.17;
commitid	oyotsfYRPfGzSgLw;

1.17
date	2005.04.26.13.10.40;	author kbracey;	state Exp;
branches;
next	1.16;

1.16
date	2002.10.30.17.43.42;	author bavison;	state Exp;
branches;
next	1.15;

1.15
date	2002.10.23.17.12.27;	author bavison;	state Exp;
branches;
next	1.14;

1.14
date	2001.09.14.21.27.14;	author bavison;	state Exp;
branches;
next	1.13;

1.13
date	2000.10.20.12.44.25;	author bavison;	state Exp;
branches
	1.13.2.1;
next	1.12;

1.12
date	2000.04.25.12.24.00;	author kbracey;	state Exp;
branches;
next	1.11;

1.11
date	99.10.07.13.28.08;	author bavison;	state Exp;
branches;
next	1.10;

1.10
date	99.08.03.18.45.45;	author bavison;	state Exp;
branches;
next	1.9;

1.9
date	99.04.29.14.33.34;	author kbracey;	state Exp;
branches;
next	1.8;

1.8
date	98.11.09.12.49.00;	author bavison;	state Exp;
branches;
next	1.7;

1.7
date	98.10.23.15.48.10;	author bavison;	state Exp;
branches;
next	1.6;

1.6
date	98.10.20.16.20.11;	author bavison;	state Exp;
branches;
next	1.5;

1.5
date	98.09.30.09.05.19;	author kbracey;	state Exp;
branches;
next	1.4;

1.4
date	98.09.18.16.13.17;	author bavison;	state Exp;
branches;
next	1.3;

1.3
date	97.05.07.17.01.24;	author kbracey;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	97.05.07.14.14.45;	author kbracey;	state Exp;
branches;
next	1.1;

1.1
date	97.04.28.16.49.09;	author kbracey;	state dead;
branches
	1.1.2.1;
next	;

1.13.2.1
date	2007.10.07.02.17.28;	author bavison;	state Exp;
branches;
next	;
commitid	NSavcPvbNd36pBAs;

1.3.2.1
date	97.07.07.11.24.40;	author bavison;	state Exp;
branches;
next	1.3.2.2;

1.3.2.2
date	97.10.21.14.01.23;	author mstphens;	state Exp;
branches;
next	1.3.2.3;

1.3.2.3
date	98.02.02.16.27.12;	author kbracey;	state Exp;
branches;
next	1.3.2.4;

1.3.2.4
date	98.03.10.16.11.10;	author bavison;	state Exp;
branches;
next	1.3.2.5;

1.3.2.5
date	98.03.26.19.31.24;	author bavison;	state Exp;
branches;
next	1.3.2.6;

1.3.2.6
date	98.04.03.19.38.26;	author bavison;	state Exp;
branches;
next	1.3.2.7;

1.3.2.7
date	98.04.07.17.53.36;	author bavison;	state Exp;
branches;
next	1.3.2.8;

1.3.2.8
date	98.04.17.16.53.59;	author bavison;	state Exp;
branches;
next	1.3.2.9;

1.3.2.9
date	98.05.08.11.43.20;	author bavison;	state Exp;
branches;
next	1.3.2.10;

1.3.2.10
date	98.05.18.15.51.03;	author bavison;	state Exp;
branches;
next	1.3.2.11;

1.3.2.11
date	98.07.13.14.10.35;	author bavison;	state Exp;
branches;
next	1.3.2.12;

1.3.2.12
date	98.07.14.16.33.41;	author bavison;	state Exp;
branches;
next	1.3.2.13;

1.3.2.13
date	98.07.28.17.10.57;	author bavison;	state Exp;
branches;
next	;

1.1.2.1
date	97.04.28.16.49.10;	author kbracey;	state Exp;
branches;
next	;


desc
@@


1.25
log
@Reinstate Wimp_ClaimFreeMemory
Detail:
  This restores support for Wimp_ClaimFreeMemory, via having the Wimp manage a small-ish (4MB) DA that is used to satisfy Wimp_ClaimFreeMemory requests. The Wimp will only ever grow the DA, but the DA is shrinkable, so the system should shrink it as necessary should the free pool run too low.
  Options/s/!Default, Options/s/32, Options/s/Ursula - Add DynamicAreaWCF option to control support for the Wimp_ClaimFreeMemory DA. Enable the option for any builds of the module destined for RISC OS 5.
  Options/s/!Debug - New debug option for Wimp_ClaimFreeMemory debugging (mainly DynamicAreaWCF code path)
  Wimp/s/Wimp01 - Add calls to create/destroy DA on startup/shutdown
  Wimp/s/Wimp08s - DA create/destroy implementation. DA is only used if the free pool is a PMP or the Wimp expects kernel free pool locking but the kernel doesn't support it. Modify Wimp_ClaimFreeMemory to use the DA if it's present.
Admin:
  Tested on Raspberry Pi
  Restores compatibility with software which relies on Wimp_ClaimFreeMemory, e.g. GDraw module (cause of "No free memory" errors reported by many)
  Note that Wimp_ClaimFreeMemory is still considered deprecated and support may be removed in future OS versions.


Version 5.50. Tagged as 'Wimp-5_50'
@
text
@; Copyright 1997 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;
; Default settings for system specific options. This file is read before the system options files,
; and sets the default values for these options, if not set in the system options file.
;

        GBLS    module_postfix                                  ; something to appear after the module version

        Option  sixteenmeg,             false                   ; if true, assume app space ends at 16 meg.
        Option  Stork,                  true                    ; try saving power by calling Portable_Idle

        Option  Medusa,                 true                    ; support Medusa Memory management
        Option  LongCommandLines,       true                    ; Kernel allows paths > 256
        Option  international_help,     true                    ; Kernel looks up help in the Messages file
        Option  BounceClose,            false                   ; debounce close icon
        Option  windowsprite,           true                    ; use tile_1 for colour 1 work areas
        Option  outlinefont,            true                    ; replace VDU 5 rendering of text with outline font
        Option  UseDynamicArea,         true                    ; use a dynamic area on medusa for the sprite pool
        Option  ChildWindows,           true                    ; support for nested child windows
        Option  PlotSpritesFromPalette, true                    ; Use palette entries, not translation table
                                                                ; (this means funny paletted sprites plot
                                                                ; better in 16bpp+ modes)
        Option  STB,                    false                   ; Running on an STB/NC-like device
        Option  NCErrorBox,             false
        Option  NoCommandPrompt,        false                   ; Don't show "Press SPACE..." when closing command
                                                                ; window
        Option  DontCheckModeOnInit,    false                   ; Don't validate the configured Wimp mode in module
                                                                ; init, do it on startup
        Option  ShrinkableAreas,        false:LAND:Medusa       ; Support shrinkable dynamic areas
        Option  BlendedFonts,           false                   ; Blend fonts directly with window backgrounds
        Option  KeyboardMenus,          false                   ; Allow keyboard control of menus
        Option  DeleteRight,            true                    ; Delete key deletes right
        Option  DisableShiftF12,        false                   ; Disable Shift-F12 iconbar toggling
        Option  NCMenus,                false                   ; Use NC menu style
        Option  Twitter,                false                   ; Anti-twitter on redraws
        Option  TwitterOnlyMenus,       false:LAND:Twitter      ; Anti-twitter only menus
        Option  RegisterWIMPSymbolFont, true                    ; Register WIMPSymbol font
        Option  NKmessages1,            false                   ; message queue optimisation (using lastpointer)
        Option  NKmessages2,            true                    ; message queue optimisation
                                                                ; (remove multiple memory change messages)
        Option  UseAMBControl,          true                    ; delegate task memory management to OS_AMBControl
        Option  UseLeaveOS,             false                   ; is SWI OS_LeaveOS available on this kernel?
        Option  AcceptLoosePointers,    true                    ; Sloppy "any -ve will do" checks (for 64M memory map only)
        Option  FPE4,                   true                    ; assume FPE 4.00 or later present
        Option  TrueIcon1,              true                    ; true colour support, phase 1
        Option  TrueIcon2,              true :LAND: TrueIcon1   ; true colour support, phase 2
        Option  TrueIcon3,              true :LAND: TrueIcon2   ; true colour support, phase 3 (windows)
                                                                ; Icon bar pops to front when pointer
        Option  PoppingIconBar,         true:LAND::LNOT:DisableShiftF12 ; at bottom of screen
        Option  OldStyleIconBar,        true                    ; Shift F12 behaviour like RISC OS <= 3.7
        Option  IconiseButton,          false                   ; Windows given iconise button
        Option  ChocolateScreen,        false                   ; Clean cached screen after redraw loops
        Option  KernelLocksFreePool,    false                   ; use OS_Memory 10 to lock Free Pool for Wimp_ClaimFreeMemory
        Option  StretchErrorButtons,    true                    ; Stretch buttons in error box to fit text
        Option  StretchErrorText,       true                    ; Stretch error box to contain long error messages neatly
        Option  AutoHourglass,          false                   ; Hourglass automatically on between Wimp_Polls
        Option  UrsulaHighlighting,     false                   ; Uses icon highlighting algorithm to suit Ursula new-look
        Option  ForegroundWindows,      false                   ; Layering of windows within each stack
        Option  SpritePriority,         false                   ; Allow configurable sprite pool priority
        Option  Autoscr,                false                   ; Add Wimp_AutoScroll and dragbox-within-window facilities
        Option  StickyEdges,            false                   ; Allow windows to "stick" when dragged over edge of screen
        Option  MultiClose,             false                   ; Allow Ctrl-Alt clicks on close/iconise buttons
        Option  Euro,                   true                    ; Don't map fancy fonts' char 128 to tick - used for Euro
        Option  PushBothBars,           false                   ; Push in both scrollbars on adjust-drags
	Option  DoubleHeightVDU4,	false                   ; Wimp_SetMode selects modes with double height VDU 4 output
	Option  ForceTwitter,           false :LAND: Twitter    ; Twitter needs-help windows & ignore interlace ModeFlags bit
	Option  HideIconBar,            false                   ; icon bar is behind Wimp back window until brought to front
        Option  UTF8,                   false                   ; support for UTF-8 alphabet (Unicode)
        Option  CnP,                    true                    ; support for RISC OS selection model and Cut-and-Paste in writeable icons
        Option  ClickSubmenus,          true                    ; submenus opened by clicking on their parent items (configurable)

        Option  RO4,                    false                   ; RISC OS 4 extensions
        Option  Sprites11,              true                    ; sprite selection scheme that allows use of Sprites11 files
        Option  SpritesA,               true                    ; look for alpha iconsprite files if OS supports the format
        Option  ToolTables,             true                    ; look for precalculated tool translation tables
        Option  CanTileManually,        true                    ; retain manual tiling code incase SpriteOp 65 missing
        Option  DynamicAreaWCF,         false                   ; similar to FreePoolWCF == false, enables use of dynamic area for WCF in Wimp08s

        Option  RegisterMessages,       false
        Option  RegisterTools2D,        false
        Option  RegisterTools3D,        false
        Option  RegisterSprites,        false
        Option  RegisterSprites22,      false
        Option  RegisterTemplates,      false

        GBLA    DefaultNextSlot
DefaultNextSlot SETA 640*1024

        END
@


1.24
log
@Fix for missing window backgrounds/scroll bars when tiled sprite op not supported
For the backgrounds, the code was switched with 'standalone' however the Wimp actively wipes SA_FLAGS in its makefile so the standalone switch is always false during the install phase of a disc build. Also, the standalone switch is used to include resources which are ordinarily handled by the boot sequence prefixing the WindowManager$Path rather than using ResourceFS.
For the scroll bars, the decision to plot manually was being made by looking at the V flag on return from Tool_SpriteOp, except that that function uses EntryS/EXITS so the caller can't see the return flags.
Added new switch CanTileManually, removed 0 use tilewithspriteops switch.
Changed single use of NoFontBodge switch to use preferred 'outlinefont'.
Tested on RISC OS 4.02.

Version 5.41. Tagged as 'Wimp-5_41'
@
text
@d90 1
@


1.23
log
@Add support for *iconspriting of alpha-masked sprites. Fix icon shading/inverting to work with true colour sprites.
Detail:
  Options/s/!Default, s/NewSWIs, s/Wimp01:

  Updated ROM sprite find code, *IconSprites and Wimp_Extend 13 to understand a new spritefile suffix.
  If the Wimp detects that RISC OS Select style alpha masked sprites are supported, and we're not using the mode 23 sprites, then the code will enable support for alpha masked sprites of the form !SpritesA1, !SpritesA2, !SpritesA, etc. Alpha-masked sprites are only looked for when looking for square pixel sprites or just before looking for the default sprites. This means the full search pattern for (e.g.) a !Sprites21 mode would be as follows:

  !Sprites21  (original mode)
  !SpritesA2  (next squarer mode, alpha sprites)
  !Sprites22  (next squarer mode)
  !SpritesA   (default alpha sprites)
  !Sprites    (default sprites)

  Like with !Sprites11 support, this feature can be toggled off via the SpritesA option if necessary.

  s/Wimp01, s/Wimp04:

  Updated icon plotting code (wimp_SpriteOp_putsprite and calculateinverse) to allow true colour sprites/icons to be rendered shaded/inverted.
  For this to work the Wimp needs a version of SpriteExtend which supports colour mapping (specifically it checks for the relevant ROOL version number).
  The colour mapping function which is used to build the translation tables used for shading/inverting palettised sprites is too slow to be sensibly used on a per-pixel basis, so the first time a shaded/inverted true colour sprite is requested the Wimp will generate a set of lookup tables which can be used by a much simpler colour mapping routine.
  To keep memory usage down these lookup tables only use 4K colours each; however the quality isn't always that great and so this may need revising in future.

Admin:
  Tested on BB-xM


Version 5.34. Tagged as 'Wimp-5_34'
@
text
@a82 1
        Option  NoFontBodge,            false                   ; don't use outline fonts
d89 1
@


1.22
log
@Add flexible scheme to allow non-grey/opaque toolsprites
The Wimp can now accept toolsprite sets which have precalculated (non default) colour translation tables supplied by the designer.
This allows the link between window template colour and displayed tool colour to be reestablished when the tools aren't grey (previously, the Ursula Wimp would only tint greys).
For full design details see Doc/ToolTables.
An example test set, TestO/TTTTest is provided. This is the 'Newlook' set but with a splotch in the corner of each sprite which is then replaced by the hex of the Wimp colour being requested.
Detail:
 Wimp01.s: New workspace requirements
 Wimp04.s: Pull out the RGB to greyscale function so it can be used elsewhere
 Wimp10.s: New tool table support code

Fixes ticket #323.
Also introduces a disc variant (with the extra EX0 EY0 resolution) of the 'Steel' theme, thus making it generally available.

Version 5.30. Tagged as 'Wimp-5_30'
@
text
@d88 1
@


1.21
log
@Fix for corrupt register in pushfontstring with password-style substitution
When CnP=TRUE but UTF8=FALSE the code path through pushfontstring for icons using the 'D' validation string would use R11 as a temporary without having preserved it (the UTF8 case preserves it because it uses R11 as a bitmask of substitutes).
Changed to always preserve R11, the routine is so huge one extra pushed register isn't going to slow it down measurably.
Adjusted options files now this combination is safe.

Tagged as Wimp-5_30-pre1.
@
text
@d88 1
@


1.20
log
@Refinements to disc based targets especially
Previous attempt to disable Sprites11 support for 3.10 and 3.50 hadn't spotted it was reenabled in the common options, also the Sprites11 switch was also tied up in Wimp$IconTheme support.
Title bars would flicker when picked up when using a tool sprite set with no 'p' pushed equivalents on RISC OS 4.0x due to screen cache.
Makefile now installs a default set of tools & sprites when target is ThemeDefs.
CLI limit reduced to 256 pre Ursula to save RAM.

Options/!Common:
  Promote Sprites11 switch into !Default
  Remove fixrmatools
Options/!Default:
  Sprites11 true by default
  LongCommandLines true by default, false on targets pre Ursula
  Remove ServiceCallTable (harmless to have it in all cases)
NewSWIs.s:
  Enable Wimp_Extend 13 all the time
Wimp01.s:
  Reduce RMA use by vital 1.5k for non long command line case
  Change sense of Sprites11 switch to adopt all its previous functionality, but not look for '11' suffix when the switch is false
  Adopt ServiceCallTable switch permanently
Wimp02.s:
  Comments ammended
Wimp07.s:
  Range of ADR
Wimp10.s:
  Change sense of Sprites11 switch to adopt all its previous functionality, but not look for '11' suffix when the switch is false
  Adopt :LNOT: fixrmatools switch permanently
  Supress title bar sprite plotting when none of the sprites exist

Version 5.25. Tagged as 'Wimp-5_25'
@
text
@d81 1
a81 1
        Option  UTF8,                   true                    ; support for UTF-8 alphabet (Unicode)
@


1.19
log
@Slacken pointer checks
The pointer comparison checking required when running in a system with > 64M memory was tightened up from Wimp-4_75 to Wimp-4_76, but to allow the module to target pre RISC OS 5 systems an option to relax those checks is required.
Each check has been revisited and where appropriate demarked with a "AcceptLoosePointer" macro, which just remaps the pointer into the stricter form and carries on. In the strict checking case, the macro reduces to nothing.

Detail:
Add AcceptLoosePointers switch.
Retire singular use of StrongARM switch (calling XOS_SynchroniseCodeAreas is harmless pre StrongARM anyway).
Rename Ursula_RPC options to RO400.
Put duplicate documentation in the attic.
Allow -2 or -1 as the iconbar handle in Wimp_ResizeIcon (ticket #203).
Tighten up the list terminator check in the DebugMemory switch of Memory.s

Tested on RISC OS 3.10 (emulated), 3.50, 3.60, 3.70, 4.02.

Version 5.24. Tagged as 'Wimp-5_24'
@
text
@d26 1
a26 1
        Option  ServiceCallTable,       true                    ; Add Ursula kernel Service Call table
d87 1
@


1.18
log
@Build fixes for variants pre RISC OS 5
Minor fixups as part of univeral !Boot work.
Options no longer ASSERT on International_Help (which is a definition exported by the kernel, rather than a build switch), and instead define a switch which is true for > 3.50.
Non UTF8 supporting case has simple substitutes for Wimp_TextOp.
Legacy_DomainId and LegacyIRQsema no longer cause NULL pointer dereference.
MOVeQ => MOVEQ to placate ObjAsm.

Ursula_RPC version built and used briefly on RISC OS 4.02 host. No other run time testing.

Version 5.22. Tagged as 'Wimp-5_22'
@
text
@d56 1
a56 1
        Option  StrongARM,              true
@


1.17
log
@Icon bar Shift F12 behaviour changed back to RISC OS 3.7 style, which made
far more sense than the bizarre "simplified" scheme some Ursula spec review
cooked up.

Version 4.94. Tagged as 'Wimp-4_94'
@
text
@d27 1
@


1.16
log
@  Merged in RISC OS 4.02 changes (including ROM patches). Also som bugfixes.
Detail:
  RISC OS 4 changes:
  * Font blending for desktop font (based on NC code, but now configurable)
  * 3-D window/menu/iconbar borders
  * Textured menu backgrounds
  * Loss of rubout box in unfilled text+sprite icons
  * *WimpVisualFlags controls various aspects of cosmetic changes above
  * Iconise button "slot" glyph slightly shorter (but only adopted in the RO400
    Resource directory)
  * Command window has front-window flag set
  * Byte at +39 of the window block has gained two new flag bits:
      bit 2 set => this window must never be given a 3D border
      bit 3 set => this window must always be given a 3D border
      (note that ResEd erroneously created windows with both bits set,
      this case is treated as though both bits were clear)
  * Another two colour specifiers on the end of C validation string command
    for icons controls the foreground and background colours to be used when
    the icon is selected
  * Pointer shape is correctly reprogrammed by the creation of icon
    underneath it
  * Full stops in writable icons are treated the same as spaces from the
    point of view of cursor navigation
  * spritesize routine returns a size of 0 if the sprite didn't exist
    (probably fixes some rendering problems)
  * Adjust-click on back icon brings window to front
  My changes:
  * DeleteRight turned on
  * Icon bar title background is set to default in all resource sets (avoids
    translation table recalc)
  * Error box title now cream across all resource sets
  * RISC OS 4 changes made 32-bit compatible / high addresses safe
  * Undocumented FullIconClipping option disabled
  * Command help made consistent for internationalised and non-
    internationalised builds
  * WimpVisualFlags defaults made sensible
  * Menu side width affected by ThreeD option at *run* time not assemble time
  * Right-clicking on menus with writable items no longer data aborts
  * Auto-opened menus are now at RHS of current icon (matches RISC OS 3.1)
  * Colour menus were knackered unless menu tiling was enabled
  * Fixed a bug whereby adding messages to a task that wanted all messages
    actually caused it to lose all other messages. The RISC OS 4 fix for
    this didn't work
  * Fixed bug introduced in version 4.76: tasks that wanted no messages got
    all of them
  * Autoscrolling is updated every 8 cs rather than every 12 cs
  * Added menu texture to pre-RISC OS 4 sprites files
Admin:
  Tested on Tungsten.

Version 4.78. Tagged as 'Wimp-4_78'
@
text
@d62 1
a62 1
        Option  OldStyleIconBar,        false                   ; Shift F12 behaviour like RISC OS <= 3.7
@


1.15
log
@  Given a good thrashing.
Detail:
  All pointers passed to the Wimp (mode selectors, menus, sprite areas,
  palettes, pollwords, validation strings, message lists, routines etc etc)
  in any of its APIs can now be anywhere within the 32-bit address range.
  In general, whenever "<= 0" was accepted as a null condition, the value
  must now be either 0 or -1. It should also be tolerant of system memory
  areas (supervisor stack and RMA) being in the top half of memory.
  Also:
  * Default next slot now a build option - Ursula builds (eg Tungsten) use
    1024K instead of 640K
  * Ursula builds no longer have a build variant in the help string
  * Autosenses ROM location
  * CR-LFs in *Configure messages replaced with LF-CRs
  * Added Iyonix resources (currently based on Morris4)
  * Morris4 sprites files have gained file_lxa, small_lxa, file_unf,
    small_unf and lo!help sprites
  * Ursula sprites files have gained lo!help sprites
  * *WimpSlot can take memory sizes in megabytes or gigabytes
Admin:
  Tested on a "traditional" memory-mapped Tungsten.

Version 4.76. Tagged as 'Wimp-4_76'
@
text
@d44 1
a44 1
        Option  DeleteRight,            false                   ; Delete key deletes right
d84 2
@


1.14
log
@  Commit of my Wimp changes that have trickled in over the last four months.
Detail:
  * The pointer passed to Wimp_CommandWindow can now be top-bit-set.
  * Bugfix to Wimp_CommandWindow: if the current task was uninitialised,
    or initialised as a non-multitasking task, then although entering the
    CommandWindow would restore escape condition generation to the way it
    was before entering the desktop, exiting the CommandWindow did not
    reset escape condition generation to the default desktop state (which is
    for escape condition generation to be disabled).
  * Escape condition generation is disabled for the duration of SWI
    Wimp_ReportError (instead of setting the default escape key for the
    duration). The previous state is restored on exit.
  * Added a minimal environment for the service call
    Service_ErrorButtonPressed, so that claimants can call OS_Exit without
    leaving the global Wimp error box in an undefined state.
  * In the Wimp_Poll loop, if there are no events to deliver to any tasks
    (not even null events), then rather than sitting in a SVC mode loop,
    the Wimp now triggers transient callbacks. This is particularly
    important in order not to halt all activity in the Internet stack.
    The option LeaveOS can be set to make the Wimp use the as-yet
    unimplemented SWI OS_LeaveOS for this purpose; this is currently unset
    for all builds.
  * By (persistent) request, reinstated the old iconbar popping code,
    though it is currently a build switch that is turned off for all builds.
Admin:
  Tested on a Risc PC.

Version 4.69. Tagged as 'Wimp-4_69'
@
text
@d92 3
@


1.13
log
@  Shock horror - a new feature for the Wimp! And some housekeeping too.
Detail:
  * Added new functionality for menu trees: submenus can now be opened by
    clicking on their parent menu item. This is particularly aimed at
    touchscreen devices, and is configurable via the new *Configure keyword
    WimpClickSubmenu.
  * Change to the menu inactivity timeout behaviour after auto-opening of
    submenus (either by hovering over the parent menu item or by the new
    click-to-open functionality): although all hover operations are still
    ignored for this period, any click operations *will* now be obeyed.
  * Corrected numerous misleading comments in the menu handling code.
  * Added some suspiciously absent ALIGNs in the *Configure keyword handlers.
  * Uses new ASCII case-forcing macros so there are now fewer warnings
    printed during assembly (and it should run faster now too).
  * Added an AREA directive so that objasm's -ABS switch is no longer needed.
  * Standardised ErrMem token across all Messages files that use English.
Admin:
  Tested on a desktop machine.
  Requires HdrSrc 1.06.

Version 4.57. Tagged as 'Wimp-4_57'
@
text
@d54 1
d62 1
@


1.13.2.1
log
@  Added Dan Ellis's multithreading support, on a development branch for now.
Detail:
  This breaks the equivalence between tasks and AMB slots, allowing many
  threads of execution to share the same AMB slot, where an application's
  heap is usually located. In API terms, it is presented as an extension to
  Wimp_StartTask, see Docs/Multithreading for more information. It is the
  caller's responsibility to create a new stack chunk for the new thread if
  required. Note that BASIC's variable storage model is fundamentally
  unsuited for multithreading.
Admin:
  This was developed in 2001 and was not committed at the time due to lack
  of testing and peer review. It is now being added as a branch from a
  contemporary trunk Wimp. Hopefully somebody will be interested enough to
  merge the branch into a recent version!

Version 4.66, 4.77.2.1. Tagged as 'Wimp-4_66-4_77_2_1'
@
text
@a88 1
        Option  Threads,                false
@


1.12
log
@  Made 32-bit compatible.
Detail:
  Lots of little changes throughout a lot of source.
Admin:
  Appears to work - not stress tested with things like lots of tasks, big
  transfers, and all the other things that tend to go wrong.

Version 4.47. Tagged as 'Wimp-4_47'
@
text
@d81 1
@


1.11
log
@Switched Euro option on for all builds, at Kevin's request.

(This stops system font character 128 being reprogrammed to a tick, and also
stops the desktop font being switched to WimpSymbol when character 128 is
encountered.)

Version 4.32. Tagged as 'Wimp-4_32'
@
text
@d80 1
@


1.10
log
@Now calls recalcmodevars on Service_ModeChanging instead of Service_ModeChange
(this was clashing with the Interlace module at one point during STB
development, and had the potential to trip us up again in the future).

No longer produces build errors if some resources are absent.

Corrected token in Japan messages file to use valid UTF-8 character.

Service call table now included by default.

Version 4.23. Tagged as 'Wimp-4_23'
@
text
@d73 1
a73 1
        Option  Euro,                   false                   ; Don't map fancy fonts' char 128 to tick - used for Euro
@


1.9
log
@TrueIcon2 and TrueIcon3 turned on by default.

Version 4.20. Tagged as 'Wimp-4_20'
@
text
@d26 1
a26 1
        Option  ServiceCallTable,       false                   ; Add Ursula kernel Service Call table
@


1.8
log
@Optimisation to new WimpSymbol substitution code: in icons containing fonts
  other than the desktop font, the substitution table is only calculated
  when a symbol character is encountered.
Embryonic cut-n-paste support introduced (currently in desktop builds only):
  * workspace is allocated and initialised;
  * extended Wimp_GetCaretPosition implemented;
  * pushfontstring adapted to allow insertion of arbitrary control sequences in
    font strings (to allow selected text to be plotted in inverted colours).
Inverted, unfilled text icons now work properly again in <256-colour modes.
Reworked NC error box code: see Doc.IconHigh.

Version 4.11. Tagged as 'Wimp-4_11'
@
text
@d57 2
a58 2
        Option  TrueIcon2,              false :LAND: TrueIcon1  ; true colour support, phase 2
        Option  TrueIcon3,              false :LAND: TrueIcon2  ; true colour support, phase 3 (windows)
@


1.7
log
@Adapted assembly process so that the choice of Options file (previously based
purely on the "System" variable) can be overridden by passing "OPTIONS=foo" as
an argument to either MkRom, or to amu/amu_machine directly, or indirectly,
by specifying it in the components file for a build. To accomplish this, it
was necessary to switch from using aasm to objasm - hence the large number of
source files affected in this commit.

Version 4.09. Tagged as 'Wimp-4_09'
@
text
@a49 1
        Option  PreservePointerOnError, false                   ; Preserve mouse pointer state over errors
d79 1
@


1.6
log
@UTF-8 support from previous version switched in; additional alphabet-
conditional support added as follows:
* Correctly converts character index returned from Font_FindCaret into byte
  index into raw string.
* Left-arrow, right-arrow, delete-left and delete-right now act as far as
  the next character boundary, instead of to the next byte.
* Menu item text justification works again (it relies on overwriting spaces
  with hard space characters, which are two-byte characters in UTF-8).
* General key handling code has been rewritten. The Wimp now has three
  internal key input buffers - one each for taking keyboard-generated,
  task-generated, and function-key-generated strings. Each input buffer is
  processed in chunks of one character, rather than one byte; malformed
  UTF-8 characters are rejected, so tasks don't have to worry about them
  (simplifying their character-handling code). There is also a key output
  buffer, to ensure that (UTF-8) sequences of Key_Pressed events are not
  broken up.
* As a result of the above, multiple calls to Wimp_ProcessKey are now
  possible between calls to Wimp_Poll. Previously, this resulted in bytes
  getting jumbled up - making it useless for input of UTF-8 characters.
* Multi-byte characters are inserted into writeable icons in one go, so you
  don't see a brief flicker of the "malformed character" symbol while the
  initial bytes are being inserted.
* Multi-byte characters that don't entirely fit in a writeable icon buffer
  are not inserted at all.
* A new validation string command ("U") can limit the contents of a
  writeable by number of characters, instead of bytes. This will hide the
  character sizes from the user interface.
* Allowable characters (validation string command "A") now works on Unicode
  characters and character ranges.
* Various other minor bugs are fixed (Wimp_ProcessKey 13 can activate a
  writeable menu item, Shift-arrow keys are always consistent in firing off
  Key_Pressed events, etc.)
* Password icons supported: one symbol is displayed for each character
  (instead of for each byte); the display character (validation string
  command "D") can be any UTF-8 character; correctly displays the caret
  after set-caret-by-index calls, even though characters in the processed
  string are different width to those in the raw string, in password icons.

Other changes:
* The border around NC-style error boxes is resized when the error window
  is grown or shrunk.
* Messages, CmdHelp and Template files made consistent across resource
  directories, including support for all Ursula features.
* ShrinkableAreas turned back on in System=RCA builds.
* User interface features of desktop OS builds standardised.

Version 4.06. Tagged as 'Wimp-4_06'
@
text
@d79 1
@


1.5
log
@Spinner branch merged.
Changed to use srccommit.
All conditionals on "Version" removed.

Version 4.01. Tagged as 'Wimp-4_01'
@
text
@d36 1
a36 1
        Option  BuildForNC,             false
d66 1
a66 1
        Option  StretchErrorText,       false                   ; Stretch error box to contain long error messages neatly
@


1.4
log
@Ursula branch Wimp merged back onto trunk.
@
text
@d36 1
d50 1
@


1.3
log
@Corrected setting of WatchdogTimer option to false.
Made options files specify any text wanted after the module version number.
Auto-fronting iconbar now returns to previous position rather than back, so
it interacts with Shift+F12 better.
@
text
@d20 1
a20 1
	GBLS	module_postfix					; something to appear after the module version
d22 2
a23 2
	Option	sixteenmeg, 		false			; if true, assume app space ends at 16 meg.
	Option	Stork,			true			; try saving power by calling Portable_Idle
d25 52
a76 34
	Option	Medusa,			true			; support Medusa Memory management
	Option	BounceClose,		false			; debounce close icon
	Option	windowsprite,		true			; use tile_1 for colour 1 work areas
	Option	outlinefont,		true			; replace VDU 5 rendering of text with outline font
	Option	UseDynamicArea,		true    		; use a dynamic area on medusa for the sprite pool
	Option	ChildWindows,		true			; support for nested child windows
	Option	PlotSpritesFromPalette, true			; Use palette entries, not translation table
                                            			; (this means funny paletted sprites plot
                                            			; better in 16bpp+ modes)
	Option	STB,			false			; Running on an STB/NC-like device
	Option	NoCommandPrompt, 	false			; Don't show "Press SPACE..." when closing command
								; window
	Option	DontCheckModeOnInit, 	false			; Don't validate the configured Wimp mode in module
								; init, do it on startup
	Option	ShrinkableAreas, 	false:LAND:Medusa 	; Support shrinkable dynamic areas
	Option	BlendedFonts,		false			; Blend fonts directly with window backgrounds
	Option	KeyboardMenus,		false			; Allow keyboard control of menus
	Option	DeleteRight,		false			; Delete key deletes right
	Option	DisableShiftF12,	false			; Disable Shift-F12 iconbar toggling
	Option	NCMenus,		false			; Use NC menu style
	Option	Twitter,		false			; Anti-twitter on redraws
	Option	TwitterOnlyMenus,	false:LAND:Twitter 	; Anti-twitter only menus
	Option	RegisterWIMPSymbolFont,	true			; Register WIMPSymbol font
	Option	NKmessages1,		false			; message queue optimisation (using lastpointer)
	Option	NKmessages2,		true			; message queue optimisation
								; (remove multiple memory change messages)
	Option	UseAMBControl,		true			; delegate task memory management to OS_AMBControl
	Option	StrongARM,		true
	Option	FPE4,			true			; assume FPE 4.00 or later present
								; Icon bar pops to front when pointer
	Option	PoppingIconBar,		true:LAND::LNOT:DisableShiftF12	; at bottom of screen
	Option	IconiseButton,		false			; Windows given iconise button
	Option	ChocolateScreen,	false			; Clean cached screen after redraw loops
	Option	StretchErrorButtons,	true			; Stretch buttons in error box to fit text
d78 6
a83 6
	Option	RegisterMessages,	false
	Option	RegisterTools2D,	false
	Option	RegisterTools3D,	false
	Option	RegisterSprites,	false
	Option	RegisterSprites22,	false
	Option	RegisterTemplates,	false
@


1.3.2.1
log
@Hourglass depth now incremented by 1 between calls to Wimp_Poll; effect is
to automatically display hourglass whenever applications hog the CPU,
irrespective of whether they already display the hourglass themselves or not.
Hourglass is automatically smashed before any Command Windows are displayed
so that output-generating single-tasking programs are not forced to show the
hourglass due to the behaviour described above.
@
text
@a58 1
	Option	AutoHourglass,		false			; Hourglass automatically on between Wimp_Polls
@


1.3.2.2
log
@ - corrected comments re Wimp08 versus Wimp08s
 - tidied up Wimp08s
 - Added optional use of kernel lock for Wimp_ClaimFreeMemory, controlled
   by KernelLocksFreePool in Options (currently true for Ursula only)
 - restricted max size of Wimp Sprite Pool dynamic area to 16M (controlled
   by WimpSpritePoolMaxSize in s.Memory) to avoid wasted address space on
   large memory machines
@
text
@d20 1
a20 1
        GBLS    module_postfix                                  ; something to appear after the module version
d22 2
a23 2
        Option  sixteenmeg,             false                   ; if true, assume app space ends at 16 meg.
        Option  Stork,                  true                    ; try saving power by calling Portable_Idle
d25 35
a59 36
        Option  Medusa,                 true                    ; support Medusa Memory management
        Option  BounceClose,            false                   ; debounce close icon
        Option  windowsprite,           true                    ; use tile_1 for colour 1 work areas
        Option  outlinefont,            true                    ; replace VDU 5 rendering of text with outline font
        Option  UseDynamicArea,         true                    ; use a dynamic area on medusa for the sprite pool
        Option  ChildWindows,           true                    ; support for nested child windows
        Option  PlotSpritesFromPalette, true                    ; Use palette entries, not translation table
                                                                ; (this means funny paletted sprites plot
                                                                ; better in 16bpp+ modes)
        Option  STB,                    false                   ; Running on an STB/NC-like device
        Option  NoCommandPrompt,        false                   ; Don't show "Press SPACE..." when closing command
                                                                ; window
        Option  DontCheckModeOnInit,    false                   ; Don't validate the configured Wimp mode in module
                                                                ; init, do it on startup
        Option  ShrinkableAreas,        false:LAND:Medusa       ; Support shrinkable dynamic areas
        Option  BlendedFonts,           false                   ; Blend fonts directly with window backgrounds
        Option  KeyboardMenus,          false                   ; Allow keyboard control of menus
        Option  DeleteRight,            false                   ; Delete key deletes right
        Option  DisableShiftF12,        false                   ; Disable Shift-F12 iconbar toggling
        Option  NCMenus,                false                   ; Use NC menu style
        Option  Twitter,                false                   ; Anti-twitter on redraws
        Option  TwitterOnlyMenus,       false:LAND:Twitter      ; Anti-twitter only menus
        Option  RegisterWIMPSymbolFont, true                    ; Register WIMPSymbol font
        Option  NKmessages1,            false                   ; message queue optimisation (using lastpointer)
        Option  NKmessages2,            true                    ; message queue optimisation
                                                                ; (remove multiple memory change messages)
        Option  UseAMBControl,          true                    ; delegate task memory management to OS_AMBControl
        Option  StrongARM,              true
        Option  FPE4,                   true                    ; assume FPE 4.00 or later present
                                                                ; Icon bar pops to front when pointer
        Option  PoppingIconBar,         true:LAND::LNOT:DisableShiftF12 ; at bottom of screen
        Option  IconiseButton,          false                   ; Windows given iconise button
        Option  ChocolateScreen,        false                   ; Clean cached screen after redraw loops
        Option  KernelLocksFreePool,    false                   ; use OS_Memory 10 to lock Free Pool for Wimp_ClaimFreeMemory
        Option  StretchErrorButtons,    true                    ; Stretch buttons in error box to fit text
        Option  AutoHourglass,          false                   ; Hourglass automatically on between Wimp_Polls
d61 6
a66 6
        Option  RegisterMessages,       false
        Option  RegisterTools2D,        false
        Option  RegisterTools3D,        false
        Option  RegisterSprites,        false
        Option  RegisterSprites22,      false
        Option  RegisterTemplates,      false
@


1.3.2.3
log
@Fixed occasional lock-ups when error boxes displayed.
Added ALIGN directive before watchdog callback label.
Added option to select double-height VDU 4 modes.
Added German resources.
Added necessary options for parallel-port debugging via the PDebugM module.
@
text
@a60 1
	Option  DoubleHeightVDU4,	false			; Wimp_SetMode selects modes with double height VDU 4 output
@


1.3.2.4
log
@Main new features in Ursula build so far
(some are also available in other builds):

* New icon highlighting scheme - hue rotated 180 degrees, photographic negative,
  darkened 25% - suits Ursula icons better.
* Release-button window tools compile-time switch turned on.
* Any "TASK" word cleared on exit from Wimp_OpenWindow, Wimp_GetWindowState,
  Wimp_ForceRedraw and Wimp_CloseDown.
* Child windows are no longer allowed to be opened inside the icon bar.
* Message_IconizeAt generation optimised, and no longer calls non-X SWIs.
* Message_IconsChanged implemented, and switched out on speed grounds.
* Wimp_ReadSysInfo 15 removed, replaced with (new) Wimp_Extend 11.
* Backwindows are now segregated from normal windows. A new category,
  foreground windows, are added, and stay above all other windows. (The error
  box template is updated to make it a foreground window.)
* ROM sprites override RAM sprites (and duplicate RAM sprites are deleted
  during the building of the sprite lookup list, preceding the first sprite
  plot after a sprite pool update).
* Wimp_ReadSysInfo 16 added, to return sprite area pointers in order of
  priority (Wimp_BaseOfSprites retains the ROM/RAM distinction).
* Error box code altered:
  + symbolic names used for offsets into tempworkspace
  + error button text buffer enlarged
  + stretched error buttons now shrink back for next use
  + int_flush_opens called at appropriate points to ensure buttons are seen to
    slab in, and to reduce flicker when redisplaying error box at a different
    width (also fixes some redraw bugs)
  + Cancel button given the R6 type border when it will be activated by Return
    (and is therefore moved to the extreme right in such cases)
  + Escape now always selects the second-right button (unless there's only one
    button!) - this also fixes a bug when there's a single user-defined button
  + keypresses in "xxx may have gone wrong" error boxes are now correctly
    interpreted - previously the buttons available in the underlying box were
    being used to determine the effect of keys
  + maximum number of buttons increased from 4 to 8, and the machine no longer
    crashes when the maximum is exceeded
  + window stretches horizontally to keep error message to 7 lines or less
* Bugfix: opening or creating a window with a minimum x visible area coordinate
  of -1 was leading to any of smearing/flickering/recursive drawing. (This was
  actually due to a failure to recognise which windows' positions had been
  updated.)
* Features merged in from spinner branch Wimp:
  + support for UpCall_MediaSearchEndMessage added
  + control-termination allowed in upcalls (used to require null-termination)
  + escape character switched to default during error box display, then
    switched back again afterwards
* GetRectangle filters are now called with (internal) window handle in R10.
* Autohourglass is deactivated whenever WrchV is invoked. (Also optimised.)
* Action button bugfixes:
  + action buttons now deselect if the pointer is dragged off and a window tool
    is the pressed before all the buttons have been released
  + action buttons now slab in following a long (autorepeating) press on a
    scroll arrow window tool
@
text
@a59 1
        Option  StretchErrorText,       false                   ; Stretch error box to contain long error messages neatly
a60 3
        Option  UrsulaHighlighting,     false                   ; Uses icon highlighting algorithm to suit Ursula new-look
        Option  ForegroundWindows,      false                   ; Layering of windows within each stack
        Option  SpritePriority,         false                   ; Allow configurable sprite pool priority
@


1.3.2.5
log
@New features:
Dragboxes can now be clipped by and/or fixed to a given window's work area
SWI Wimp_AutoScroll implemented
Ursula icon highlighting scheme redesigned

Bugfixes:
Wimp_Extend 11 now performs the same check on R1 as the main SWI handling code
Message blocks now updated if in a dynamic area
Screenblanker now turned off when error box is displayed
ptr_double now turned off when a drag starts
@
text
@a64 1
        Option  Autoscr,                false                   ; Add Wimp_AutoScroll and dragbox-within-window facilities
@


1.3.2.6
log
@Iconise button removed from child windows
Icon bar now jumps to the back of the stack as soon as a window is opened above
it (excluding menus, dialogue boxes and foregroud windows). This is to avoid
the ambiguous situation when the icon bar can be part-way down the window stack.
Improved co-odination between auto-fronting and Shift-F12 behaviour.
Stopped scroll offset overflow during icon bar scroll.
Numerous features made configurable:
  WimpIconBarSpeed
  WimpIconBarAcceleration
  WimpSpritePrecedence
  WimpIconiseButton
  WimpStickyEdges (although not actually implemented yet)
  WimpAutoFrontIconBar
  WimpAutoFrontDelay
  WimpAutoScrollDelay
To make room for these in CMOS, Wimp<Drag|DoubleClick><Delay|Move> and
Wimp<AutoMenu|MenuDrag>Delay options are now stored in a more compressed form
in CMOS - but the *Configure interface is unaltered.
@
text
@a65 1
        Option  StickyEdges,            false                   ; Allow windows to "stick" when dragged over edge of screen
@


1.3.2.7
log
@Added Ursula Service Call table
Flushes cached screen after dragbox updates
Fixed window stack behaviour so background windows interact conventionally again
  (fixes a number of window positioning bugs)
Disabled Shift-Select-close for child windows
@
text
@a25 1
        Option  ServiceCallTable,       false                   ; Add Ursula kernel Service Call table
@


1.3.2.8
log
@Redraw of dragboxes when being resized/translated optimised to reduce flicker.

Autoscroll update period extended to 12cs to reduce flicker.

Added Wimp_ReadSysInfo 17 to return configured drag-and-drop scroll startup
delay (in cs) because the CMOS storage isn't easy to read.

Identified and bracketed changes from 3.9x responsible for 24-bit icon colours.

defaultfontcolours now works correctly again.

Introduced new icon colour code. This holds icon colours in 24 bits internally
throughout, rather than treating 24-bit colour specifiers as a special case.
This results in the following bugfixes/improvements:
 * 3D faces and moat colours, and slabbed-in action button backgrounds, can
   all be specified in 24-bits
 * fading of icons is now consistent across icon types, and utilises the
   colour range of >16 colour modes
 * 3D borders now get faded along with the rest of the icon
 * action buttons can now contain sprites (background is correct, and sprite
   is not inverted)
 * various cases where anti-aliasing didn't blend in to the background
   correctly are now fixed
 * conventional and 24-bit specifiers now behave equivalently to each other -
   the same colour specified either way behaves the same when faded, used as
   an EOR colour etc. (greys are now always dithered in 1-bpp modes, even if
   specified in 24-bit)
 * behaviour is now the same whether the Wimp font is the system font or a
   fancy font (amazingly, this wasn't always the case)
 * except for 3D icons, if the icon background matches the work area
   background, it is unaffected by fading - so for example, group boxes can now
   be faded correctly

Switched out AutoHourglass (Mike was concerned about the speed hit).

Corrected *Help syntax strings for On/Off configuration options.
@
text
@a54 2
        Option  TrueIcon1,              true                    ; true colour support, phase 1
        Option  TrueIcon2,              false :LAND: TrueIcon1  ; true colour support, phase 2
@


1.3.2.9
log
@The title bar, and the back, close and iconise buttons, are no longer redrawn
when a window is resized in just the vertical direction.

All window colours can now be specified in 24-bit colour.

Where a sprite is used to plot the back, close, title, iconise, toggle-size,
adjust-size or scroll arrow icons, the sprite is now plotted using a distorted
translation table, to give the sprites the appearance of being coloured
according to the window colours.

The 3D toolsprite set now has solid titlebar sprites.

The icon bar template now uses the standard title bar colours (this optimises
redraw because of the new border tinting code).

When the toggle-size icon or title bar are to be plotted using solid sprites,
the background is no longer filled in just prior to the event (although this
will still be performed if the relevant sprite is masked). This is to reduce
flicker. Similarly, the erroneous rectangle outlines plotted behind scrollbars
have been removed.

New "TASK"-form Wimp_ForceRedraw reason codes:
  R2 = 0 => redraw whole window border (includes line borders).
  R2 = 8 => redraw iconise button.
@
text
@a56 1
        Option  TrueIcon3,              false :LAND: TrueIcon2  ; true colour support, phase 3 (windows)
@


1.3.2.10
log
@Added a couple of extra compile-time options for use in specialied
applications; both are switched out in all standard builds.

ForceTwitter: used in combination with Twitter flag, this causes
   antitwittering to be employed irrespective of ModeFlags bit 8,
   and also irrespective of whether a window is auto-redraw or not.

HideIconBar: ensures that the icon bar is behind the backwindow, unless
   it has been brought to the front (by either method). In conjunction with
   a modified Pinboard, this can produce a quick-and-dirty iconbar-less
   machine.
@
text
@d71 1
a71 3
	Option  DoubleHeightVDU4,	false                   ; Wimp_SetMode selects modes with double height VDU 4 output
	Option  ForceTwitter,           false :LAND: Twitter    ; Twitter needs-help windows & ignore interlace ModeFlags bit
	Option  HideIconBar,            false                   ; icon bar is behind Wimp back window until brought to front
@


1.3.2.11
log
@Window status flag bit 17 "window is fully visible" is now correctly set for
nested windows.
If the lowest window (eg most recently iconised window) is a hotkey window,
the Wimp used to hang if a keypress was not claimed by any task. Now fixed.
Hotkey events can now be delivered to nested windows.
Ctrl-Alt-Close now closes all windows, at the same nesting level, provided
that they have close buttons.
Ctr-Alt-Iconise now iconises all top-level windows that have close buttons.
Low-res versions of autoscroll pointers fixed: they had been in 256 greys!
@
text
@a70 1
        Option  MultiClose,             false                   ; Allow Ctrl-Alt clicks on close/iconise buttons
@


1.3.2.12
log
@Redraw of unfilled, font-specified icons now fixed; this caused antialising
errors, for example in CC applications' banner windows.

No longer maps anti-aliased system font character 128 to WimpSymbol tick;
this leaves character 128 free for use by Euro currency glyph.

Fixed Data Aborts in Wimp_SpriteOps 54, 57 and 58, and in *WimpKillSprite for
a sprite name found only in the ROM sprite pool.

Eureka window titles should now be redrawn correctly, without impacting the
redraw of Wimp-drawn titlebars, provided the ROM toolsprites are used. Note
that the toolsprite spritefile has regained sprite masks, but the colours
"behind" the mask are different to those in the last masked toolsprite file.
@
text
@a71 1
        Option  Euro,                   false                   ; Don't map fancy fonts' char 128 to tick - used for Euro
@


1.3.2.13
log
@Corrected active point for autoscrolling pointers (was wrong in low-res modes).

Certain user-drawn dragbox routines (eg via DragASprite) don't pass the object
bounding box as the box; this was conflicting with one of the redraw
optimisations, and causing smearing when the underlying object was redrawn.
Relevant optimisation optioned out.

If a window stack-change causes the iconise button to appear or disappear,
this is now caught, and the window border is redrawn immediately.

Toggling of child windows now works - the return coordinates are linked to
the parent in the same way as the current ones. Note that this is unlikely to
be useful for anything other than alignment 0/0/0/0/0/0 children.

Return codes for the "Quit" and "Continue" buttons in "xxx may have gone wrong"
error boxes can now be specified.

Both scrollbars push in for adjust-drags.
@
text
@a72 1
        Option  PushBothBars,           false                   ; Push in both scrollbars on adjust-drags
@


1.2
log
@ARTtmp branch folded in
@
text
@d20 2
@


1.1
log
@file !Default was initially added on branch ARTtmp.
@
text
@d1 65
@


1.1.2.1
log
@Added support for multiple options files (RO310, RO350, RO360, RO370, RCA,
Ursula).
Removed run-time MedusaOS checks.
Enabled correct build for RISC OS 3.1 machines.
Ensured that "freepoolinuse" is cleared before OS_ChangeDynamicArea
is intercepted.
Increased maxrects to 256.
Gave copy filter window handle in R10 (if ChildWindows).
Corrected a few border problems when no toolsprites.
Made toolsprites press in immediately - in particular close and toggle can
now be highlighted.
BounceClose flag no affects all of back,close,iconise and toggle.
Made "L" validation string parsing check manually for presence of a number,
to prevent error from OS_ReadUnsigned trashing MessageTrans' error buffers.
Allow error box buttons to stretch to fit text.
Fixed bug: floating point registers were not being saved unless on a portable.
Integrated some of the Wimp_TransferBlock fixes into Wimp08 from Wimp08s.
@
text
@a0 64
; Copyright 1997 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;
; Default settings for system specific options. This file is read before the system options files,
; and sets the default values for these options, if not set in the system options file.
;

	Option	sixteenmeg, 		false			; if true, assume app space ends at 16 meg.
	Option	Stork,			true			; try saving power by calling Portable_Idle

	Option	Medusa,			true			; support Medusa Memory management
	Option	BounceClose,		false			; debounce close icon
	Option	windowsprite,		true			; use tile_1 for colour 1 work areas
	Option	outlinefont,		true			; replace VDU 5 rendering of text with outline font
	Option	UseDynamicArea,		true    		; use a dynamic area on medusa for the sprite pool
	Option	ChildWindows,		true			; support for nested child windows
	Option	PlotSpritesFromPalette, true			; Use palette entries, not translation table
                                            			; (this means funny paletted sprites plot
                                            			; better in 16bpp+ modes)
	Option	NoCommandPrompt, 	false			; Don't show "Press SPACE..." when closing command
								; window
	Option	DontCheckModeOnInit, 	false			; Don't validate the configured Wimp mode in module
								; init, do it on startup
	Option	ShrinkableAreas, 	false:LAND:Medusa 	; Support shrinkable dynamic areas
	Option	BlendedFonts,		false			; Blend fonts directly with window backgrounds
	Option	KeyboardMenus,		false			; Allow keyboard control of menus
	Option	DeleteRight,		false			; Delete key deletes right
	Option	DisableShiftF12,	false			; Disable Shift-F12 iconbar toggling
	Option	NCMenus,		false			; Use NC menu style
	Option	Twitter,		false			; Anti-twitter on redraws
	Option	TwitterOnlyMenus,	false:LAND:Twitter 	; Anti-twitter only menus
	Option	RegisterWIMPSymbolFont,	true			; Register WIMPSymbol font
	Option	NKmessages1,		false			; message queue optimisation (using lastpointer)
	Option	NKmessages2,		true			; message queue optimisation
								; (remove multiple memory change messages)
	Option	UseAMBControl,		true			; delegate task memory management to OS_AMBControl
	Option	StrongARM,		true
	Option	FPE4,			true			; assume FPE 4.00 or later present
								; Icon bar pops to front when pointer
	Option	PoppingIconBar,		true:LAND::LNOT:DisableShiftF12	; at bottom of screen
	Option	IconiseButton,		false			; Windows given iconise button
	Option	ChocolateScreen,	false			; Clean cached screen after redraw loops
	Option	StretchErrorButtons,	true			; Stretch buttons in error box to fit text

	Option	RegisterMessages,	false
	Option	RegisterTools2D,	false
	Option	RegisterTools3D,	false
	Option	RegisterSprites,	false
	Option	RegisterSprites22,	false
	Option	RegisterTemplates,	false

        END
@
