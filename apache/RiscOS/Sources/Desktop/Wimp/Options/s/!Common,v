head	1.13;
access;
symbols
	Wimp-5_62:1.13
	Wimp-5_61:1.13
	Wimp-5_60:1.13
	Wimp-5_59:1.13
	Wimp-5_58:1.13
	Wimp-5_57:1.13
	Wimp-5_56:1.13
	Wimp-5_55:1.13
	Wimp-5_54:1.13
	Wimp-5_53:1.13
	Wimp-5_52:1.13
	Wimp-5_51:1.13
	Wimp-5_50:1.13
	Wimp-5_49:1.13
	Wimp-5_48:1.13
	Wimp-5_47-file1ad:1.13
	Wimp-5_47:1.13
	Wimp-5_46:1.13
	Wimp-5_45:1.13
	Wimp-5_44:1.13
	Wimp-5_43:1.13
	Wimp-5_42:1.12
	Wimp-5_41:1.12
	Wimp-5_40:1.11
	Wimp-5_39:1.11
	Wimp-5_38:1.11
	Wimp-5_37:1.11
	Wimp-5_36:1.11
	Wimp-5_35:1.11
	Wimp-5_34:1.11
	Wimp-5_33:1.11
	Wimp-5_32:1.11
	Wimp-5_31:1.11
	Wimp-5_30:1.11
	Wimp-530-pre4:1.11
	Wimp-5_30-pre3:1.11
	Wimp-5_30-pre2:1.11
	Wimp-5_30-pre1:1.11
	Wimp-5_29:1.11
	Wimp-5_28:1.11
	Wimp-5_27:1.11
	Wimp-5_26:1.11
	Wimp-5_25:1.11
	Wimp-5_24:1.10
	Wimp-5_23:1.10
	Wimp-5_22:1.10
	Wimp-5_21:1.10
	Wimp-5_20:1.10
	Wimp-5_19:1.10
	Wimp-5_18:1.10
	Wimp-5_17:1.10
	Wimp-5_16:1.10
	Wimp-5_15:1.10
	Wimp-5_14:1.10
	Wimp-5_13:1.10
	Wimp-5_12:1.10
	Wimp-5_11:1.10
	Wimp-5_10:1.10
	Wimp-5_09:1.10
	Wimp-5_08:1.10
	Wimp-5_07:1.10
	Wimp-5_06:1.10
	Wimp-5_05:1.10
	Wimp-5_04:1.10
	Wimp-5_03:1.10
	Wimp-5_02:1.10
	Wimp-5_01:1.10
	Wimp-4_66-4_77_2_1:1.7
	bavison_Threads_dev:1.7.0.2
	bavison_Threads_dev_bp:1.7
	Wimp-5_00:1.10
	Wimp-4_100:1.10
	Wimp-4_99:1.10
	Wimp-4_98:1.10
	Wimp-4_97:1.10
	Wimp-4_96:1.10
	Wimp-4_95:1.10
	Wimp-4_94:1.10
	RO_5_07:1.10
	Wimp-4_93:1.10
	Wimp-4_92:1.10
	Wimp-4_91:1.10
	Wimp-4_90:1.10
	Wimp-4_89:1.10
	Wimp-4_88:1.10
	Wimp-4_87:1.10
	Wimp-4_86:1.9
	Wimp-4_85:1.9
	Wimp-4_84:1.9
	Wimp-4_83:1.8
	Wimp-4_82:1.8
	Wimp-4_81:1.8
	Wimp-4_80:1.8
	Wimp-4_79:1.8
	Wimp-4_78:1.8
	Wimp-4_77:1.7
	Wimp-4_76:1.7
	Wimp-4_75:1.7
	Wimp-4_74:1.7
	Wimp-4_73:1.7
	Wimp-4_72:1.7
	Wimp-4_71:1.7
	Wimp-4_70:1.7
	Wimp-4_69:1.7
	Wimp-4_68:1.7
	Wimp-4_67:1.7
	Wimp-4_66:1.7
	Wimp-4_65:1.7
	Wimp-4_64:1.7
	Wimp-4_63:1.6
	Wimp-4_62:1.6
	Wimp-4_61:1.6
	Wimp-4_60:1.6
	Wimp-4_59:1.6
	Wimp-4_58:1.6
	Wimp-4_36-4_46_2_6:1.6
	Wimp-4_57:1.6
	Alpnet_approved:1.6
	Wimp-4_36-4_46_2_5:1.6
	Wimp-4_56:1.6
	dellis_autobuild_BaseSW:1.6
	Wimp-4_36-4_46_2_4:1.6
	Wimp-4_36-4_46_2_3:1.6
	Wimp-4_55:1.6
	Wimp-4_54:1.6
	Wimp-4_36-4_46_2_2:1.6
	Wimp-4_53:1.6
	Wimp-4_36-4_46_2_1:1.6
	Bethany:1.6.0.2
	Wimp-4_52:1.6
	Wimp-4_51:1.6
	Wimp-4_50:1.6
	Wimp-4_49:1.6
	Wimp-4_48:1.6
	Wimp-4_47:1.6
	Wimp-4_46:1.6
	Wimp-4_45:1.6
	Wimp-4_44:1.6
	Wimp-4_43:1.6
	Wimp-4_42:1.6
	sbrodie_sedwards_16Mar2000:1.6
	Wimp-4_41:1.6
	Wimp-4_40:1.6
	Wimp-4_39:1.6
	Wimp-4_38:1.6
	Wimp-4_37:1.6
	Wimp-4_36:1.6
	Wimp-4_35:1.6
	Wimp-4_34:1.6
	Wimp-4_33:1.6
	Wimp-4_32:1.6
	Wimp-4_31:1.6
	dcotton_autobuild_BaseSW:1.7
	Wimp-4_30:1.6
	Wimp-4_29:1.6
	Wimp-4_28:1.6
	Wimp-4_27:1.6
	Wimp-4_26:1.6
	Wimp-4_25:1.6
	Wimp-4_24:1.6
	Wimp-4_23:1.6
	Wimp-4_22:1.6
	Wimp-4_21:1.6
	Wimp-4_20:1.6
	Wimp-4_19:1.6
	Wimp-4_18:1.6
	Wimp-4_17:1.6
	Wimp-4_16:1.6
	Wimp-4_15:1.6
	Wimp-4_14:1.6
	Wimp-4_13:1.6
	Wimp-4_12:1.6
	mstphens_UrsulaRiscPCBuild_20Nov98:1.3.2.6
	bavison_Wimp-4_11:1.6
	Ursula_RiscPC:1.3.2.6.0.2
	Wimp-4_11:1.6
	Wimp-4_10:1.6
	Wimp-4_09:1.6
	Wimp-4_08:1.5
	Wimp-4_07:1.5
	Wimp-4_06:1.5
	Wimp-4_05:1.4
	Wimp-4_04:1.4
	bavison_Wimp-4_03_noshrinkables:1.4
	Wimp-4_03:1.4
	Wimp-4_02:1.4
	Ursula_merge:1.3.2.7
	bavison_Wimp-4_01:1.4
	Wimp-4_01:1.4
	bavison_Wimp-4_00_TRUNK:1.4
	bavison_Wimp-4_00:1.3.2.7
	mjrobert_Wimp_3_98:1.3.2.1
	rthornb_UrsulaBuild-19Aug1998:1.3.2.6
	UrsulaBuild_FinalSoftload:1.3.2.6
	bavison_Wimp-3_99t:1.3.2.6
	rthornb_UrsulaBuild-12Aug1998:1.3.2.6
	bavison_Wimp-3_99s:1.3.2.6
	aglover_UrsulaBuild-05Aug1998:1.3.2.6
	bavison_Wimp-3_99r:1.3.2.6
	rthornb_UrsulaBuild-29Jul1998:1.3.2.6
	bavison_Wimp-3_99q:1.3.2.6
	rthornb_UrsulaBuild-22Jul1998:1.3.2.6
	bavison_Wimp-3_99p:1.3.2.6
	rthornb_UrsulaBuild-15Jul1998:1.3.2.6
	bavison_Wimp-3_99o:1.3.2.6
	bavison_Wimp-3_99n:1.3.2.6
	rthornb_UrsulaBuild-07Jul1998:1.3.2.6
	bavison_Wimp-3_99m:1.3.2.6
	rthornb_UrsulaBuild-17Jun1998:1.3.2.6
	rthornb_UrsulaBuild-03Jun1998:1.3.2.6
	bavison_Wimp-3_99l:1.3.2.6
	rthornb_UrsulaBuild-27May1998:1.3.2.6
	rthornb_UrsulaBuild-21May1998:1.3.2.6
	bavison_Wimp-3_99k:1.3.2.6
	bavison_Wimp-3_99j:1.3.2.6
	bavison_Wimp-3_99i:1.3.2.6
	bavison_Wimp-3_99h:1.3.2.5
	rthornb_UrsulaBuild_01May1998:1.3.2.4
	bavison_Wimp_399g:1.3.2.4
	bavison_Wimp_399f:1.3.2.4
	bavison_Wimp_399e:1.3.2.3
	bavison_Wimp_399d:1.3.2.2
	bavison_Wimp_399c:1.3.2.2
	Wimp_3_98:1.3.2.1
	kbracey_AW97:1.3.2.1
	Daytona:1.3.0.4
	Daytona_bp:1.3
	Ursula:1.3.0.2
	Ursula_bp:1.3
	Wimp_3_91:1.3
	ARTtmp_bp:1.1
	ARTtmp_merge:1.1.2.1
	ARTtmp:1.1.0.2;
locks; strict;
comment	@# @;


1.13
date	2014.07.20.08.02.09;	author rsprowson;	state Exp;
branches;
next	1.12;
commitid	dYAocC6tl2fSE5Jx;

1.12
date	2014.04.19.09.39.19;	author rsprowson;	state Exp;
branches;
next	1.11;
commitid	wEWgncfqw43A9hxx;

1.11
date	2013.05.06.11.54.44;	author rsprowson;	state Exp;
branches;
next	1.10;
commitid	dyQdYmrTRpty5zOw;

1.10
date	2003.01.24.19.14.21;	author bavison;	state Exp;
branches;
next	1.9;

1.9
date	2002.12.20.19.48.17;	author bavison;	state Exp;
branches;
next	1.8;

1.8
date	2002.10.30.17.43.41;	author bavison;	state Exp;
branches;
next	1.7;

1.7
date	2001.03.16.17.04.38;	author sbrodie;	state Exp;
branches;
next	1.6;

1.6
date	98.10.23.15.48.09;	author bavison;	state Exp;
branches;
next	1.5;

1.5
date	98.10.20.16.20.05;	author bavison;	state Exp;
branches;
next	1.4;

1.4
date	98.09.18.16.13.15;	author bavison;	state Exp;
branches;
next	1.3;

1.3
date	97.05.07.17.01.23;	author kbracey;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	97.05.07.14.14.43;	author kbracey;	state Exp;
branches;
next	1.1;

1.1
date	97.04.28.16.49.05;	author kbracey;	state dead;
branches
	1.1.2.1;
next	;

1.3.2.1
date	97.10.16.14.01.07;	author kbracey;	state Exp;
branches;
next	1.3.2.2;

1.3.2.2
date	98.03.10.16.11.06;	author bavison;	state Exp;
branches;
next	1.3.2.3;

1.3.2.3
date	98.04.17.16.53.58;	author bavison;	state Exp;
branches;
next	1.3.2.4;

1.3.2.4
date	98.04.21.16.57.30;	author bavison;	state Exp;
branches;
next	1.3.2.5;

1.3.2.5
date	98.05.08.11.43.19;	author bavison;	state Exp;
branches;
next	1.3.2.6;

1.3.2.6
date	98.05.13.09.56.14;	author bavison;	state Exp;
branches;
next	1.3.2.7;

1.3.2.7
date	98.09.18.14.14.12;	author bavison;	state Exp;
branches;
next	;

1.1.2.1
date	97.04.28.16.49.06;	author kbracey;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Add definitions of button types 11/14/15
Button type 11 was added in 1988 so is about time it had a symbol to refer to it in the sources. Added & used said symbols.
Removed 'DoubleIcon' switch, prototype button type 12.
Built binary identical module, not tested.

Version 5.43. Not tagged
@
text
@; Copyright 1997 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;
; Options common to all systems. Hopefully all these options are uncontentious - they are either
; prototype or debugging options, or options that are unlikely to be changed for a particular
; build. If a new project needs to change one of these options, you will need to move the option
; out of this file and into the !Default file.
;
; Note that this file is read _after_ the system options file.
;

;------------------------------------------------------------------------------
;
; The following variables control prototype features - it is strongly
; suggested that these are only used in control environments and are set to
; false for release versions of the Window Manager.
;

;
; "redrawlast"  makes the redraw event lowest priority (except for null) a la Windows,
;               but requires alot more work to make it work sensibly as it a horrible
;               hack to see what would happen.
;
;               See "PrivateDoc.RedrawLast" for some further thoughts.
;
	Option	redrawlast,		false

;------------------------------------------------------------------------------

    [ :LNOT: :DEF: standalone
	Option	standalone,		false		; include messages / templates
    ]

	Option	fastborders,		:LNOT:TrueIcon3	; use PutSpriteAtUserCoords for border plotting
        Option  colourmoreborder,       false :LAND: TrueIcon3 ; colour all tools except scroll wells
	Option	slabinout,		false		; slab in selected 'slab out' icons.
	Option	fixslabalignment,	true		; Fix redraw of non-aligned 3D icons
	Option	PokeBorder,		false		; controls border colour on portables
	Option	ErrorServiceCall,	true		; send service call for Wimp_ReportError
	Option	NewErrorSystem,		true		; enable watchdog and so forth
	Option	Bits30and23,		false		; use bits 30 and 23 of error number
	Option	WatchdogTimer,		false		; use timer interupt for watchdog
	Option	AllowMatrix,		false
	Option	FreePoolWCF,		true
	Option	SnapShot,		false
	Option	UseClipX0,		false		; use clipx0 rather than call kernel
	Option	Swapping,		false		; Swap tasks out to disk.
	Option	StickyMenus,		false
	Option	hvblip,			true		; allow blips on scroll bars
	Option	mousecache,		false		; cache mouse position
	Option	togglebits,		true		; shift toggle thingy
	Option	AutoScroll,		false		; automatically add scroll bars in low res.
	Option	Mode22,			false:LAND:AutoScroll	; cater for low res modes
	Option	RealDarwin,		false		; use bitmapped darwin font
	Option	NoDarwin,		true		; don't even alias it.
        Option  TrueIcon1,              true            ; true colour support, phase 1
        Option  SwitchingToSprite,      true            ; update vdu variables when switching to sprite
        Option  StartTaskPostFilter,    true            ; always call the post filter on exit from Wimp_StartTask

        Option  BlendedFonts,           BlendedFonts :LOR: (true :LAND: RO4) ; Blend fonts directly with window backgrounds
        Option  ThreeDPatch,            true :LAND: RO4         ; implement 3DPatch (now most of the new features)
        Option  No3DChildWindows,       true :LAND: RO4         ; child windows do not have 3D borders
        Option  OldStyleColourMenus,    true :LAND: RO4         ; should the left and right parts of the colour menus be filled
        Option  MinimumMenuHeight,      false :LAND: RO4        ; make all menu items at least 44 high
        Option  TrueSelectionColours,   true :LAND: RO4         ; allow specification of alternate selection colours
        Option  DotsAsWordSeparators,   true :LAND: RO4         ; when moving the caret on writable icons treat '.' the same as space
        Option  FullIconClipping,       false :LAND: RO4        ; always clip the whole of icons to their bounding boxes rather than letting sprites overlap

        Option  SpacesInFilenames,      true            ; when hard space is allowed but space is not, convert

        END

@


1.12
log
@Fix for missing window backgrounds/scroll bars when tiled sprite op not supported
For the backgrounds, the code was switched with 'standalone' however the Wimp actively wipes SA_FLAGS in its makefile so the standalone switch is always false during the install phase of a disc build. Also, the standalone switch is used to include resources which are ordinarily handled by the boot sequence prefixing the WindowManager$Path rather than using ResourceFS.
For the scroll bars, the decision to plot manually was being made by looking at the V flag on return from Tool_SpriteOp, except that that function uses EntryS/EXITS so the caller can't see the return flags.
Added new switch CanTileManually, removed 0 use tilewithspriteops switch.
Changed single use of NoFontBodge switch to use preferred 'outlinefont'.
Tested on RISC OS 4.02.

Version 5.41. Tagged as 'Wimp-5_41'
@
text
@a45 1
	Option	DoubleIcon,		false		; allow double-clicking on icon bar
@


1.11
log
@Refinements to disc based targets especially
Previous attempt to disable Sprites11 support for 3.10 and 3.50 hadn't spotted it was reenabled in the common options, also the Sprites11 switch was also tied up in Wimp$IconTheme support.
Title bars would flicker when picked up when using a tool sprite set with no 'p' pushed equivalents on RISC OS 4.0x due to screen cache.
Makefile now installs a default set of tools & sprites when target is ThemeDefs.
CLI limit reduced to 256 pre Ursula to save RAM.

Options/!Common:
  Promote Sprites11 switch into !Default
  Remove fixrmatools
Options/!Default:
  Sprites11 true by default
  LongCommandLines true by default, false on targets pre Ursula
  Remove ServiceCallTable (harmless to have it in all cases)
NewSWIs.s:
  Enable Wimp_Extend 13 all the time
Wimp01.s:
  Reduce RMA use by vital 1.5k for non long command line case
  Change sense of Sprites11 switch to adopt all its previous functionality, but not look for '11' suffix when the switch is false
  Adopt ServiceCallTable switch permanently
Wimp02.s:
  Comments ammended
Wimp07.s:
  Range of ADR
Wimp10.s:
  Change sense of Sprites11 switch to adopt all its previous functionality, but not look for '11' suffix when the switch is false
  Adopt :LNOT: fixrmatools switch permanently
  Supress title bar sprite plotting when none of the sprites exist

Version 5.25. Tagged as 'Wimp-5_25'
@
text
@a50 1
	Option	tilewithspriteops,	false
@


1.10
log
@Added automatic translation of spaces to hard spaces in writeable icons
that forbid the former but allow the latter. This effectively allows spaces
in filenames.

Version 4.87. Tagged as 'Wimp-4_87'
@
text
@a48 1
	Option	fixrmatools,		false
a82 1
        Option  Sprites11,              true            ; new sprite selection scheme that allows use of Sprites11 files
@


1.9
log
@  Bugfixing, Sprites11 support and stretchy command windows.
Detail:
  * Bugfix: the contents of the pollword returned in the poll block by
    a PollWordNonZero event, where the pollword was flagged as high
    priority, was rotated by 8 bits due to a internal top-bit-set
    workaround. This no longer happens. (This was causing OmniClient never
    to complete initialisation on my machine.)
  * Extended the alternate resolution icon scheme for RAM/ROM sprites and
    toolsprites to be multi-pass, enabling the use of extra sprite sets for
    weird modes (most notably EX0 EY0 ones). After '23' or '0' suffixes
    (the latter still only applies to toolsprites), the suffix for the
    equivalent polychromatic resolution is tried. After rectangular
    suffixes, the next larger squarer suffix is tried. After '11', '22' is
    tried. Failing all of these, a match is attempted with no suffix.
  * The command window is now scaled and centred to match the current screen
    mode - up to a maximum size of 1280 x 1024 OS units.
  * Fixed the *WimpVisualFlags help strings (again).
  * Fixed 'task2' debugging to know about the structure of the SVC stack on
    32-bit machines.
  * Added support for generation of GPA files.
Admin:
  Tested on Tungsten.

Version 4.84. Tagged as 'Wimp-4_84'
@
text
@d85 1
@


1.8
log
@  Merged in RISC OS 4.02 changes (including ROM patches). Also som bugfixes.
Detail:
  RISC OS 4 changes:
  * Font blending for desktop font (based on NC code, but now configurable)
  * 3-D window/menu/iconbar borders
  * Textured menu backgrounds
  * Loss of rubout box in unfilled text+sprite icons
  * *WimpVisualFlags controls various aspects of cosmetic changes above
  * Iconise button "slot" glyph slightly shorter (but only adopted in the RO400
    Resource directory)
  * Command window has front-window flag set
  * Byte at +39 of the window block has gained two new flag bits:
      bit 2 set => this window must never be given a 3D border
      bit 3 set => this window must always be given a 3D border
      (note that ResEd erroneously created windows with both bits set,
      this case is treated as though both bits were clear)
  * Another two colour specifiers on the end of C validation string command
    for icons controls the foreground and background colours to be used when
    the icon is selected
  * Pointer shape is correctly reprogrammed by the creation of icon
    underneath it
  * Full stops in writable icons are treated the same as spaces from the
    point of view of cursor navigation
  * spritesize routine returns a size of 0 if the sprite didn't exist
    (probably fixes some rendering problems)
  * Adjust-click on back icon brings window to front
  My changes:
  * DeleteRight turned on
  * Icon bar title background is set to default in all resource sets (avoids
    translation table recalc)
  * Error box title now cream across all resource sets
  * RISC OS 4 changes made 32-bit compatible / high addresses safe
  * Undocumented FullIconClipping option disabled
  * Command help made consistent for internationalised and non-
    internationalised builds
  * WimpVisualFlags defaults made sensible
  * Menu side width affected by ThreeD option at *run* time not assemble time
  * Right-clicking on menus with writable items no longer data aborts
  * Auto-opened menus are now at RHS of current icon (matches RISC OS 3.1)
  * Colour menus were knackered unless menu tiling was enabled
  * Fixed a bug whereby adding messages to a task that wanted all messages
    actually caused it to lose all other messages. The RISC OS 4 fix for
    this didn't work
  * Fixed bug introduced in version 4.76: tasks that wanted no messages got
    all of them
  * Autoscrolling is updated every 8 cs rather than every 12 cs
  * Added menu texture to pre-RISC OS 4 sprites files
Admin:
  Tested on Tungsten.

Version 4.78. Tagged as 'Wimp-4_78'
@
text
@d82 3
a84 2
        Option  FullIconClipping,       false :LAND: RO4        ; always clip the whole of icons to their bounding boxes rather than
                                                                ; letting sprites overlap
@


1.7
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 4.64. Tagged as 'Wimp-4_64'
@
text
@d75 10
@


1.6
log
@Adapted assembly process so that the choice of Options file (previously based
purely on the "System" variable) can be overridden by passing "OPTIONS=foo" as
an argument to either MkRom, or to amu/amu_machine directly, or indirectly,
by specifying it in the components file for a build. To accomplish this, it
was necessary to switch from using aasm to objasm - hence the large number of
source files affected in this commit.

Version 4.09. Tagged as 'Wimp-4_09'
@
text
@d42 3
a46 1
	Option	standalone,		false		; include messages / templates
@


1.5
log
@UTF-8 support from previous version switched in; additional alphabet-
conditional support added as follows:
* Correctly converts character index returned from Font_FindCaret into byte
  index into raw string.
* Left-arrow, right-arrow, delete-left and delete-right now act as far as
  the next character boundary, instead of to the next byte.
* Menu item text justification works again (it relies on overwriting spaces
  with hard space characters, which are two-byte characters in UTF-8).
* General key handling code has been rewritten. The Wimp now has three
  internal key input buffers - one each for taking keyboard-generated,
  task-generated, and function-key-generated strings. Each input buffer is
  processed in chunks of one character, rather than one byte; malformed
  UTF-8 characters are rejected, so tasks don't have to worry about them
  (simplifying their character-handling code). There is also a key output
  buffer, to ensure that (UTF-8) sequences of Key_Pressed events are not
  broken up.
* As a result of the above, multiple calls to Wimp_ProcessKey are now
  possible between calls to Wimp_Poll. Previously, this resulted in bytes
  getting jumbled up - making it useless for input of UTF-8 characters.
* Multi-byte characters are inserted into writeable icons in one go, so you
  don't see a brief flicker of the "malformed character" symbol while the
  initial bytes are being inserted.
* Multi-byte characters that don't entirely fit in a writeable icon buffer
  are not inserted at all.
* A new validation string command ("U") can limit the contents of a
  writeable by number of characters, instead of bytes. This will hide the
  character sizes from the user interface.
* Allowable characters (validation string command "A") now works on Unicode
  characters and character ranges.
* Various other minor bugs are fixed (Wimp_ProcessKey 13 can activate a
  writeable menu item, Shift-arrow keys are always consistent in firing off
  Key_Pressed events, etc.)
* Password icons supported: one symbol is displayed for each character
  (instead of for each byte); the display character (validation string
  command "D") can be any UTF-8 character; correctly displays the caret
  after set-caret-by-index calls, even though characters in the processed
  string are different width to those in the raw string, in password icons.

Other changes:
* The border around NC-style error boxes is resized when the error window
  is grown or shrunk.
* Messages, CmdHelp and Template files made consistent across resource
  directories, including support for all Ursula features.
* ShrinkableAreas turned back on in System=RCA builds.
* User interface features of desktop OS builds standardised.

Version 4.06. Tagged as 'Wimp-4_06'
@
text
@a71 1
        Option  UTF8,                   true            ; support for UTF-8 alphabet (Unicode)
@


1.4
log
@Ursula branch Wimp merged back onto trunk.
@
text
@d72 1
a72 1
        Option  UTF8,                   false           ; support for UTF-8 alphabet (Unicode)
@


1.3
log
@Corrected setting of WatchdogTimer option to false.
Made options files specify any text wanted after the module version number.
Auto-fronting iconbar now returns to previous position rather than back, so
it interacts with Shift+F12 better.
@
text
@a43 2
	Option	BounceClose,		false		; debounce close icon, sadly fails for anything that
							; then does a get pointer info to check which mouse button
d45 2
a46 1
	Option	fastborders,		true		; use PutSpriteAtUserCoords for border plotting
d69 4
@


1.3.2.1
log
@Made the Wimp always call the postfilter when returning from Wimp_StartTask,
rather than only if the child didn't Wimp_Poll. Also ensured that nothing
untowards happens if the filter tries to claim this apparent "null event".
@
text
@a69 2
        Option  StartTaskPostFilter,    true            ; always call the post filter on exit
                                                        ; from Wimp_StartTask
@


1.3.2.2
log
@Main new features in Ursula build so far
(some are also available in other builds):

* New icon highlighting scheme - hue rotated 180 degrees, photographic negative,
  darkened 25% - suits Ursula icons better.
* Release-button window tools compile-time switch turned on.
* Any "TASK" word cleared on exit from Wimp_OpenWindow, Wimp_GetWindowState,
  Wimp_ForceRedraw and Wimp_CloseDown.
* Child windows are no longer allowed to be opened inside the icon bar.
* Message_IconizeAt generation optimised, and no longer calls non-X SWIs.
* Message_IconsChanged implemented, and switched out on speed grounds.
* Wimp_ReadSysInfo 15 removed, replaced with (new) Wimp_Extend 11.
* Backwindows are now segregated from normal windows. A new category,
  foreground windows, are added, and stay above all other windows. (The error
  box template is updated to make it a foreground window.)
* ROM sprites override RAM sprites (and duplicate RAM sprites are deleted
  during the building of the sprite lookup list, preceding the first sprite
  plot after a sprite pool update).
* Wimp_ReadSysInfo 16 added, to return sprite area pointers in order of
  priority (Wimp_BaseOfSprites retains the ROM/RAM distinction).
* Error box code altered:
  + symbolic names used for offsets into tempworkspace
  + error button text buffer enlarged
  + stretched error buttons now shrink back for next use
  + int_flush_opens called at appropriate points to ensure buttons are seen to
    slab in, and to reduce flicker when redisplaying error box at a different
    width (also fixes some redraw bugs)
  + Cancel button given the R6 type border when it will be activated by Return
    (and is therefore moved to the extreme right in such cases)
  + Escape now always selects the second-right button (unless there's only one
    button!) - this also fixes a bug when there's a single user-defined button
  + keypresses in "xxx may have gone wrong" error boxes are now correctly
    interpreted - previously the buttons available in the underlying box were
    being used to determine the effect of keys
  + maximum number of buttons increased from 4 to 8, and the machine no longer
    crashes when the maximum is exceeded
  + window stretches horizontally to keep error message to 7 lines or less
* Bugfix: opening or creating a window with a minimum x visible area coordinate
  of -1 was leading to any of smearing/flickering/recursive drawing. (This was
  actually due to a failure to recognise which windows' positions had been
  updated.)
* Features merged in from spinner branch Wimp:
  + support for UpCall_MediaSearchEndMessage added
  + control-termination allowed in upcalls (used to require null-termination)
  + escape character switched to default during error box display, then
    switched back again afterwards
* GetRectangle filters are now called with (internal) window handle in R10.
* Autohourglass is deactivated whenever WrchV is invoked. (Also optimised.)
* Action button bugfixes:
  + action buttons now deselect if the pointer is dragged off and a window tool
    is the pressed before all the buttons have been released
  + action buttons now slab in following a long (autorepeating) press on a
    scroll arrow window tool
@
text
@d44 2
@


1.3.2.3
log
@Redraw of dragboxes when being resized/translated optimised to reduce flicker.

Autoscroll update period extended to 12cs to reduce flicker.

Added Wimp_ReadSysInfo 17 to return configured drag-and-drop scroll startup
delay (in cs) because the CMOS storage isn't easy to read.

Identified and bracketed changes from 3.9x responsible for 24-bit icon colours.

defaultfontcolours now works correctly again.

Introduced new icon colour code. This holds icon colours in 24 bits internally
throughout, rather than treating 24-bit colour specifiers as a special case.
This results in the following bugfixes/improvements:
 * 3D faces and moat colours, and slabbed-in action button backgrounds, can
   all be specified in 24-bits
 * fading of icons is now consistent across icon types, and utilises the
   colour range of >16 colour modes
 * 3D borders now get faded along with the rest of the icon
 * action buttons can now contain sprites (background is correct, and sprite
   is not inverted)
 * various cases where anti-aliasing didn't blend in to the background
   correctly are now fixed
 * conventional and 24-bit specifiers now behave equivalently to each other -
   the same colour specified either way behaves the same when faded, used as
   an EOR colour etc. (greys are now always dithered in 1-bpp modes, even if
   specified in 24-bit)
 * behaviour is now the same whether the Wimp font is the system font or a
   fancy font (amazingly, this wasn't always the case)
 * except for 3D icons, if the icon background matches the work area
   background, it is unaffected by fading - so for example, group boxes can now
   be faded correctly

Switched out AutoHourglass (Mike was concerned about the speed hit).

Corrected *Help syntax strings for On/Off configuration options.
@
text
@a67 1
        Option  TrueIcon1,              true            ; true colour support, phase 1
@


1.3.2.4
log
@Bugfixes:

Re-opening a menu structure containing a dialogue box (especially one
containing the caret) was causing data aborts under some OSes/builds.

The minimum title bar length is now the same for windows without line borders,
even if the vertical scroll bar is also absent. This prevents cases when the
title bar shrunk so far that a graphics clipping error occurred.

Wimp_DragBox was looking in R0 for its flags, rather than R3, as specified!

If the pointer was to the right of the central zone, vertical autoscrolling
was working too slowly.

On Service_SwitchingOutputToSprite, the Wimp now re-assesses its idea of the
screen limits. This prevents Wimp_PlotIcon plots outside the current screen
bounds from being optimised out.
@
text
@a68 1
        Option  SwitchingToSprite,      true            ; update vdu variables when switching to sprite
@


1.3.2.5
log
@The title bar, and the back, close and iconise buttons, are no longer redrawn
when a window is resized in just the vertical direction.

All window colours can now be specified in 24-bit colour.

Where a sprite is used to plot the back, close, title, iconise, toggle-size,
adjust-size or scroll arrow icons, the sprite is now plotted using a distorted
translation table, to give the sprites the appearance of being coloured
according to the window colours.

The 3D toolsprite set now has solid titlebar sprites.

The icon bar template now uses the standard title bar colours (this optimises
redraw because of the new border tinting code).

When the toggle-size icon or title bar are to be plotted using solid sprites,
the background is no longer filled in just prior to the event (although this
will still be performed if the relevant sprite is masked). This is to reduce
flicker. Similarly, the erroneous rectangle outlines plotted behind scrollbars
have been removed.

New "TASK"-form Wimp_ForceRedraw reason codes:
  R2 = 0 => redraw whole window border (includes line borders).
  R2 = 8 => redraw iconise button.
@
text
@d45 1
a45 2
	Option	fastborders,		:LNOT:TrueIcon3	; use PutSpriteAtUserCoords for border plotting
        Option  colourmoreborder,       true :LAND: TrueIcon3 ; colour all tools except scroll wells
@


1.3.2.6
log
@Public opinion appears to be generally against the "colourmoreborder"
compile-time option, so it's now switched off.
@
text
@d46 1
a46 1
        Option  colourmoreborder,       false :LAND: TrueIcon3 ; colour all tools except scroll wells
@


1.3.2.7
log
@Re-inserted the fixed low-res autoscroll pointers (they disappeared in the
final softload ROM).
Fixed half-specified font-colour validation-string-command bug.
Partial UTF-8 support included, but switched out, since UTF-8 won't be any
theoretical future Ursula build.

Finally...
Cranked version number up to 4.00, to signify the end of Ursula development.
@
text
@d71 2
a72 2
        Option  StartTaskPostFilter,    true            ; always call the post filter on exit from Wimp_StartTask
        Option  UTF8,                   false           ; support for UTF-8 alphabet (Unicode)
@


1.2
log
@ARTtmp branch folded in
@
text
@d56 1
a56 1
	Option	WatchdogTimer,		true		; use timer interupt for watchdog
@


1.1
log
@file !Common was initially added on branch ARTtmp.
@
text
@d15 58
@


1.1.2.1
log
@Added support for multiple options files (RO310, RO350, RO360, RO370, RCA,
Ursula).
Removed run-time MedusaOS checks.
Enabled correct build for RISC OS 3.1 machines.
Ensured that "freepoolinuse" is cleared before OS_ChangeDynamicArea
is intercepted.
Increased maxrects to 256.
Gave copy filter window handle in R10 (if ChildWindows).
Corrected a few border problems when no toolsprites.
Made toolsprites press in immediately - in particular close and toggle can
now be highlighted.
BounceClose flag no affects all of back,close,iconise and toggle.
Made "L" validation string parsing check manually for presence of a number,
to prevent error from OS_ReadUnsigned trashing MessageTrans' error buffers.
Allow error box buttons to stretch to fit text.
Fixed bug: floating point registers were not being saved unless on a portable.
Integrated some of the Wimp_TransferBlock fixes into Wimp08 from Wimp08s.
@
text
@a0 72
; Copyright 1997 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;
; Options common to all systems. Hopefully all these options are uncontentious - they are either
; prototype or debugging options, or options that are unlikely to be changed for a particular
; build. If a new project needs to change one of these options, you will need to move the option
; out of this file and into the !Default file.
;
; Note that this file is read _after_ the system options file.
;

;------------------------------------------------------------------------------
;
; The following variables control prototype features - it is strongly
; suggested that these are only used in control environments and are set to
; false for release versions of the Window Manager.
;

;
; "redrawlast"  makes the redraw event lowest priority (except for null) a la Windows,
;               but requires alot more work to make it work sensibly as it a horrible
;               hack to see what would happen.
;
;               See "PrivateDoc.RedrawLast" for some further thoughts.
;
	Option	redrawlast,		false

;------------------------------------------------------------------------------


	Option	DoubleIcon,		false		; allow double-clicking on icon bar
	Option	BounceClose,		false		; debounce close icon, sadly fails for anything that
							; then does a get pointer info to check which mouse button
	Option	standalone,		false		; include messages / templates
	Option	fastborders,		true		; use PutSpriteAtUserCoords for border plotting
	Option	fixrmatools,		false
	Option	slabinout,		false		; slab in selected 'slab out' icons.
	Option	fixslabalignment,	true		; Fix redraw of non-aligned 3D icons
	Option	tilewithspriteops,	false
	Option	PokeBorder,		false		; controls border colour on portables
	Option	ErrorServiceCall,	true		; send service call for Wimp_ReportError
	Option	NewErrorSystem,		true		; enable watchdog and so forth
	Option	Bits30and23,		false		; use bits 30 and 23 of error number
	Option	WatchdogTimer,		true		; use timer interupt for watchdog
	Option	AllowMatrix,		false
	Option	FreePoolWCF,		true
	Option	SnapShot,		false
	Option	UseClipX0,		false		; use clipx0 rather than call kernel
	Option	Swapping,		false		; Swap tasks out to disk.
	Option	StickyMenus,		false
	Option	hvblip,			true		; allow blips on scroll bars
	Option	mousecache,		false		; cache mouse position
	Option	togglebits,		true		; shift toggle thingy
	Option	AutoScroll,		false		; automatically add scroll bars in low res.
	Option	Mode22,			false:LAND:AutoScroll	; cater for low res modes
	Option	RealDarwin,		false		; use bitmapped darwin font
	Option	NoDarwin,		true		; don't even alias it.

        END

@
