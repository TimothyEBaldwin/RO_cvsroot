head	4.6;
access;
symbols
	Pinboard-1_04:4.6
	Pinboard-1_03:4.6
	Pinboard-1_02:4.6
	Pinboard-1_01:4.6
	Pinboard-1_00:4.6
	Pinboard-0_99:4.6
	Pinboard-0_98:4.6
	Pinboard-0_97:4.6
	Pinboard-0_96:4.6
	Pinboard-0_95:4.6
	Pinboard-0_94:4.5
	Pinboard-0_93:4.5
	Pinboard-0_92:4.4
	Pinboard-0_91:4.4
	Pinboard-0_90:4.4
	Pinboard-0_89:4.4
	Pinboard-0_88:4.4
	Pinboard-0_87:4.4
	Pinboard-0_86:4.4
	Pinboard-0_85:4.4
	Pinboard-0_84:4.4
	Pinboard-0_83:4.4
	Pinboard-0_82:4.3
	RO_5_07:4.3
	Pinboard-0_81:4.3
	Pinboard-0_80:4.3
	Pinboard-0_79:4.3
	Pinboard-0_78:4.3
	Pinboard-0_77:4.3
	Pinboard-0_76:4.3
	Ursula_merge:4.1.4.5
	Pinboard-0_75:4.2
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.4
	Ursula_RiscPC:4.1.4.4.0.2
	rleggett_Pinboard-0_75d:4.1.4.5
	rthornb_UrsulaBuild-19Aug1998:4.1.4.4
	UrsulaBuild_FinalSoftload:4.1.4.4
	rthornb_UrsulaBuild-12Aug1998:4.1.4.4
	aglover_UrsulaBuild-05Aug1998:4.1.4.4
	rthornb_UrsulaBuild-29Jul1998:4.1.4.4
	rthornb_UrsulaBuild-22Jul1998:4.1.4.4
	rleggett_Pinboard-0_75c:4.1.4.4
	rleggett_Pinboard-0_75b:4.1.4.4
	rleggett_Pinboard-0_75:4.1.4.4
	rthornb_UrsulaBuild-15Jul1998:4.1.4.4
	rthornb_UrsulaBuild-07Jul1998:4.1.4.4
	rthornb_UrsulaBuild-17Jun1998:4.1.4.4
	rthornb_UrsulaBuild-03Jun1998:4.1.4.4
	rthornb_UrsulaBuild-27May1998:4.1.4.4
	rthornb_UrsulaBuild-21May1998:4.1.4.4
	rleggett_Pinboard-0_74:4.1.4.4
	rthornb_UrsulaBuild_01May1998:4.1.4.4
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.6
date	2012.08.23.19.59.07;	author rsprowson;	state Exp;
branches;
next	4.5;
commitid	rztFpV1VBvCVZHhw;

4.5
date	2011.09.24.07.23.44;	author rsprowson;	state Exp;
branches;
next	4.4;
commitid	U6nT8u4TlrjayIAv;

4.4
date	2006.03.14.18.45.07;	author srevill;	state Exp;
branches;
next	4.3;

4.3
date	2001.03.16.17.07.03;	author sbrodie;	state Exp;
branches;
next	4.2;

4.2
date	99.08.17.19.05.18;	author sbrodie;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.29.59;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.29.59;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.29.47;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	97.06.13.08.40.26;	author rleggett;	state Exp;
branches;
next	4.1.4.2;

4.1.4.2
date	97.10.21.09.56.57;	author rleggett;	state Exp;
branches;
next	4.1.4.3;

4.1.4.3
date	98.01.07.10.28.34;	author rleggett;	state Exp;
branches;
next	4.1.4.4;

4.1.4.4
date	98.03.27.09.36.30;	author rleggett;	state Exp;
branches;
next	4.1.4.5;

4.1.4.5
date	98.09.18.10.18.10;	author rleggett;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.20.52;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.18.45;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.6
log
@Fix for patchy tiled backdrops on changing to non EX1/EY1 mode
Pinboard keeps a note of the mode (from OS_Byte 135) that the backdrop sprite tile was last cached in, to avoid having to recache it all the time. However, the comparison fails when the mode specifier block (ie. when OS_Byte 135 is not reporting a numeric screen mode) is static since although the mode might have changed Pinboard would not think it had and hence not recache the sprite.
The result is a patchy desktop, for example changing from EX1/EY1 to EX0/EY0 would leave a quadrant arrangement of 1 redrawn patch and 3 not redrawn.
Backdrop.s:
Line 151 onwards, when a mode specifier is used, build a magic mode word combining EX EY and BPP (the 3 parameters the cache sprite function cares about), as a stronger check.
Tail.s:
Line 130 onwards, calculate the iconbar height properly (previously used 134 pixels for EY0 modes, 1 too high, leading to a thin strip of background colour above the iconbar.
Other changes
 - Use sprite area offset names from Hdr:Sprites rather than magic numbers
 - Use OS_Byte reasons from Hdr:OsBytes
 - Use "file.s" style names in LNK commands
 - Move BadOptions/NotASprite error blocks to avoid range error when assembling debug versions
 - true and false for objasm {TRUE} and {FALSE}

Version 0.95. Tagged as 'Pinboard-0_95'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;


; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; IconizedReopen
;
; Reopen an iconized window
;
; In : r1 = window
;      r2 = icon

IconizedReopen  ROUT
        MOV     r6,r2
        BL      find_iconized
        BL      reopen_window

        ;LDR     r0, Window_Icons
        ;SUB     r0, r0, #1
        ;STR     r0, Window_Icons
        ;LDR     r0, Windows_Selected
        ;SUB     r0, r0, #1
        ;STR     r0, Windows_Selected

        Pull    "PC"

IconizedClose
        MOV     r6,r2
        BL      find_iconized
        BL      delete_window
        Pull    "PC"

; ----------------------------------------------------------------------------------------------------------------------
; Find iconized.
;         r6 = Icon number.
; On Exit:
;         r7 - Pointer to block or 0 if not found.
;
find_iconized
        Push    "LR"


        LDR     r7,iconized_ptr
01      CMP     r7,#0
        Pull    "PC",EQ
        LDR     r14,[r7,#w_icon_handle]
        CMP     r14,r6
        LDRNE   r7,[r7,#w_next_ptr]
        BNE     %BT01

        Pull    "PC"

; Find iconized icon by window handle.
;         r5 = Window handle.
; On Exit:
;         r7 - Pointer to block or 0 if not found.
;
find_window
        Push    "LR"

        LDR     r7,iconized_ptr
01      CMP     r7,#0
        Pull    "PC",EQ
        LDR     r14,[r7,#w_window_handle]
        CMP     r14,r5
        LDRNE   r7,[r7,#w_next_ptr]
        BNE     %BT01

        Pull    "PC"
; ----------------------------------------------------------------------------------------------------------------------
; Find iconized icon by task handle.
;         r5 = Task handle.
; On Exit:
;         r7 - Pointer to block or 0 if not found.
;
find_task
        Push    "LR"

        LDR     r7,iconized_ptr
01      CMP     r7,#0
        Pull    "PC",EQ
        LDR     r14,[r7,#w_task]
        CMP     r14,r5
        LDRNE   r7,[r7,#w_next_ptr]
        BNE     %BT01

        Pull    "PC"

; ----------------------------------------------------------------------------------------------------------------------
; pre quit - reopen all iconized windows.
;            delete backdrop sprite.
ReopenWindows

        Push     "LR"

01      LDR      r7,iconized_ptr
        CMP      r7,#0
        BEQ      %FT02
        BL       reopen_window   ; Shifts the list for us.
        B        %BT01
02

        Pull    "PC"


; ----------------------------------------------------------------------------------------------------------------------
; Delete an icon, don't reopen windo.
;
delete_window
        Push    "LR"

        [ {FALSE}
        ADR      r1,dataarea
        ADD      r0,r7,#w_window_handle
        LDMIA    r0,{r2,r3,r4,r5,r6,r8,r9,r10}
        MOV      r10,#-1
        STMIA    r1,{r2,r3,r4,r5,r6,r8,r9,r10}

        MOV      r0,#3
        LDR      r2,[r7,#w_task]
        Debug    ic,"Task is ",r2
        SWI      XWimp_SendMessage
        ]
        B       delete_window_entry

reopen_window
        Push    "LR"

; ----------------------------------------------------------------------------------------------------------------------
; Click on iconized window.

iconized_click
; Reopen the window

        ADR      r1,dataarea
        ADD      r0,r7,#w_window_handle
        LDMIA    r0,{r2,r3,r4,r5,r6,r8,r9,r10}
        MOV      r10,#-1
        STMIA    r1,{r2,r3,r4,r5,r6,r8,r9,r10}
 
        MOV      r0,#2
        LDR      r2,[r7,#w_task]
        Debug    ic,"Task is ",r2
        SWI      XWimp_SendMessage

; Entry point to delete the icon.
delete_window_entry                     ; Must preserve r5 from here down.


; Now delete the icon

        ADRL    r1, dataarea+100        ; If this is a result of an Iconize message we must not

        LDR     r0, [r7, #w_icon_id]

        STR     r0, [r1]
        LDR     r2, [r7,#w_icon_handle]
        STR     r2, [r1,#4]
        SWI     XWimp_GetIconState
        Pull    "pc",VS

        LDR     r3, [r1, #24]           ; Load icon flags into r3

        LDR     r4, [r1]                ; r4 is window handle of icon

        ; If on iconbar, subtract one from Iconbar_Icons
        CMP     r4, #-2
        LDREQ   r4, Iconbar_Icons
        SUBEQ   r4, r4, #1
        STREQ   r4, Iconbar_Icons
        BEQ     %FT03

        ; If not on the iconbar, then check if selected and update Windows_Selected
        LDR     r4, Windows_Selected
        TST     r3, #is_selected        ; Selected?
        SUBNE   r4, r4, #1
        STR     r4, Windows_Selected

        ; subtract one from number of window icons on pinboard
03      LDR     r4, Window_Icons
        SUB     r4, r4, #1
        STR     r4, Window_Icons

        ; Delete the icon
        SWIVC   XWimp_DeleteIcon

        LDR     r0, [r7, #w_icon_id]

        ADD     r1,r1,#8
        LDMIA   r1,{r1-r4}
        SWI     XWimp_ForceRedraw
        Pull    "pc",VS

; Remove it from the list.

        LDR     r0,[r7,#w_prev_ptr]
        LDR     r1,[r7,#w_next_ptr]
        Debug   ic,"prev ptr is",r0
        CMP     r0,#0
        STREQ   r1,iconized_ptr
        STRNE   r1,[r0,#w_next_ptr]

        CMP     r1,#0
        STRNE   r0,[r1,#w_prev_ptr]

; And free memory.

        MOV     r0, #ModHandReason_Free
        MOV     r2, r7
        SWI     XOS_Module

        Pull    "PC"

        LNK     Save.s
@


4.5
log
@Collapse dead switches.
Same binary as 0.92, not tagged.
@
text
@d147 10
a156 10
       ADR      r1,dataarea
       ADD      r0,r7,#w_window_handle
       LDMIA    r0,{r2,r3,r4,r5,r6,r8,r9,r10}
       MOV      r10,#-1
       STMIA    r1,{r2,r3,r4,r5,r6,r8,r9,r10}

       MOV      r0,#2
       LDR      r2,[r7,#w_task]
       Debug    ic,"Task is ",r2
       SWI      XWimp_SendMessage
@


4.4
log
@  Different way of doing escape-aborts-drag implementation
Detail:
  Although the previous check-in works, it uses EventV to trap escape key
  press events. This mechanism doesn't stop them from being passed on to
  whoever has input focus (e.g. a task window).

  The new way to do things is to grab input focus when a drag starts and
  to restore it (if possible) when the drag f we abort the drag (and restore focus). All other keys
  are passed on to the Wimp.

  The side-effect is that any window which has focus will temporarily lose
  focus for the duration of a Pinboard drag op I think we can
  live with that.
Admin:
  Tested on Iyonix and works fine. Now, if only the Filer did this, too...

Version 0.83. Tagged as 'Pinboard-0_83'
@
text
@a14 140
 [ Version < 69
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Iconized_DragEnd
;
; User has dragged a window icon accross the backdrop.
;
; In: r1 -> Wimp event structure

Iconized_DragEnd ROUT

        SWI     XDragASprite_Stop

        ADR     r1, dataarea           ; What icon is pointer over?
        SWI     XWimp_GetPointerInfo
        Pull    "PC",VS

        LDR     r0,backdrop_handle     ; Check drag was on backdrop
        LDR     r5,[r1,#12]
        CMP     r5,r0
        Pull    "PC",NE

        LDR     r6,drag_icon
        BL      find_iconized          ; find structure for icon we have dragged
        CMP     r7,#0
        Pull    "PC",EQ
        MOV     r11,r7

        STR     r5,[r1,#12]            ; store window handle at r1+12
        STR     r6,[r1,#16]            ; store icon handle   at r1+16
        LDMIA   r1!,{r5-r7}            ; Load r5 (x), r6 (y), r7 (buttons)   Also r1 = r1 + 12
        SWI     XWimp_GetIconState     ; Get Icon state
        ADDVC   r1,r1,#8               ; Get bounding box
        MOVVC   r10,r1
        LDMVCIA r1,{r1-r4}             ; load minx, miny, maxx, maxy from result of GetIconState
        LDRVC   r0,backdrop_handle
        SWIVC   XWimp_ForceRedraw      ; Force redraw of old area

        ADRVC   r0,drag_start
        LDMVCIA r0,{r8-r9}             ; load x and y co-ordinate of start of drag
        SUBVC   r5,r5,r8
        SUBVC   r6,r6,r9               ; Get relative movment.

        ADDVC   r1,r1,r5               ; Adjust bounding box.
        ADDVC   r3,r3,r5
        ADDVC   r2,r2,r6
        ADDVC   r4,r4,r6
        STMVCIA r10,{r1-r4}
        LDMVCIA r10,{r3-r6}
;        BLVC    lock_to_grid
;        STMVCIA r10,{r3-r6}

        SUBVC   r1,r10,#8              ; get window handle
        LDRVC   r0,[r1],#4
        STRVC   r0,[r1]

        Push    R1
        LDMVCIA R1,{R1-R5}
        LDRVC   R1,[R11,#w_icon_handle]
        SWIVC   XWimp_ResizeIcon
        MOVVC   R0,R1
        Pull    R1

        LDRVC   r2,backdrop_handle
        MOVVC   r3,r0
        MOVVC   r4,#0
        MOVVC   r5,#0
        STMVCIA r1,{r2-r5}
        SWIVC   XWimp_SetIconState

        Pull    "PC"
 ]

 [ Version < 69
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Iconized_Drag

Iconized_Drag    ROUT

        ADR     r7,drag_start
        STMIA   r7,{r10,r11}            ; x,y of drag start
        MOV     r6,r2
        STR     r6,drag_icon
        BL      find_iconized

        LDR     r5,backdrop_handle
        ADR     r1,dataarea
        STR     r5,[r1]
        STR     r6,[r1,#4]
        SWI     XWimp_GetIconState
        ADD     r1,r1,#8
        LDMIA   r1,{r3-r6}

        MOV     r14,#DragType_Iconized
        STR     r14,DragType

        BL      Claim_Focus

        Push    "r0-r2"
        MOV     r0,#ReadCMOS
        MOV     r1,#FileSwitchCMOS
        SWI     XOS_Byte
        MOVVS   r14,#0
        ANDVC   r14,r2,#DragASpriteCMOSBit
        Pull    "r0-r2"

        CMP     r14,#0
        BEQ     %FT10
; Do DragASprite
        Push    "r3-r6"
        MOV     R0,#DS_HJustify_Centre :OR: DS_VJustify_Top :OR: DS_BoundTo_Screen :OR: DS_Bound_Pointer :OR: DS_DropShadow_Present
        MOV     r1,#1
        ADD     r2,r7,#w_sprite_name
        MOV     r3,sp
        SWI     XDragASprite_Start
        ADD     sp,sp,#4*4
        Pull    "PC"
10
        ADR     r1, dataarea
        LDR     r0,backdrop_handle

; R3,R4,R5,R6 = bounding coordinates (offset from icon bar window position)
; Create drag box

        MOV     r2, #5
        STMIA   r1!, {r0,r2,r3,r4,r5,r6}
        SUB     r6, r6, r4
        SUB     r5, r5, r3
        ADR     r0, bounding_box
        LDMIA   r0, {r7,r8,r9,r10}
        SUB     r7, r7, r5 ,LSR #1
        SUB     r8, r8, r6 ,LSR #1
        ADD     r9, r9, r5, LSR #1  ; half x size.
        ADD     r10,r10,r6, LSR #1  ; half y size.
        LDR     r8, icon_bar_height
        STMIA   r1!, {r7,r8,r9,r10}
        ADR     r1, dataarea
        SWI     XWimp_DragBox

        Pull    "PC"
 ]
d224 1
a224 1
       Pull     "PC"
@


4.3
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.71 or later.
  Requires BuildSys 3.06 or later.
  Requires Env 0.65 or later.

Version 0.76. Tagged as 'Pinboard-0_76'
@
text
@d110 2
@


4.2
log
@Ursula branch merged.
Added inclusion of Machine header for new CMOS header
Moved to srccommit.
Templates contain hardwired version/date information which is a long
  way out of date.  This has not been fixed in this checkin.

Version 0.75. Tagged as 'Pinboard-0_75'
@
text
@d167 1
a167 1
        
d174 1
a174 1
        
d284 1
a284 1
       
d295 1
a295 1
       
d301 1
a301 1
 
d305 1
a305 1
 
d322 1
a322 1
        
d324 1
a324 1
        LDR     r4, Windows_Selected 
d338 1
a338 1
 
d364 1
a364 1
        LNK     s.Save
@


4.1
log
@Initial revision
@
text
@d15 7
d24 1
d27 1
a27 1
        ADR     r1, dataarea
d30 2
a31 1
        LDR     r0,backdrop_handle
d37 1
a37 1
        BL      find_iconized
d42 4
a45 7
        STR     r5,[r1,#12]
        STR     r6,[r1,#16]
        LDMIA   r1!,{r5-r7}            ; r5 - x r6 - y r7 - b +point to window handle.
        SWI     XWimp_GetIconState     ; Get bounding box
        [ :LNOT: UseResize
        SWIVC   XWimp_DeleteIcon       ; Delete Icon.
        ]
d48 1
a48 1
        LDMVCIA r1,{r1-r4}
d50 1
a50 1
        SWIVC   XWimp_ForceRedraw
d53 1
a53 1
        LDMVCIA r0,{r8-r9}
a69 1
        [ UseResize
a75 4
        |
        SWIVC   XWimp_CreateIcon
        STRVC   r0,[r11,#w_icon_handle]
        ]
d85 5
d152 2
d155 2
d158 4
d167 8
d284 1
a284 1

d295 1
a295 1

d301 1
d303 3
a305 8
 [ iconise_to_iconbar
        LDR     r4, Pinboard_options
        TST     r4, #PinboardOption_IconiseToIconBar
        MOVNE   r0, #-2
        LDREQ   r0, backdrop_handle
 |
        LDR     r0, backdrop_handle
 ]
d310 25
a335 1
        Pull    "pc",VS
d337 2
a338 7
 [ iconise_to_iconbar
        TST     r4, #PinboardOption_IconiseToIconBar
        MOVNE   r0, #-2
        LDREQ   r0,backdrop_handle
 |
        LDR     r0, backdrop_handle
 ]
@


4.1.4.1
log
@Added option to iconise windows to a corner
@
text
@d147 1
a147 1
; In : r1 = window, r2 = icon
d262 1
a262 1
       
d273 1
a273 1
       
a278 1
 
d280 1
a280 5

 [ Version >= 67
        LDR     r0, [r7, #w_icon_id]
 |
   [ iconise_to_iconbar
d285 1
a285 1
   |
a286 1
   ]
a287 1
 
d295 1
a295 4
 [ Version >= 67
        LDR     r0, [r7, #w_icon_id]
 |
   [ iconise_to_iconbar
d299 1
a299 1
   |
a300 1
   ]
a301 1
 
@


4.1.4.2
log
@Windows, as well as files, can be selected, plus new menu structure and options
@
text
@a0 21
; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
 [ Version < 69
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Iconized_DragEnd
;
; User has dragged a window icon accross the backdrop.
;
; In: r1 -> Wimp event structure
a16 1

d19 1
a19 1
        ADR     r1, dataarea           ; What icon is pointer over?
d22 1
a22 2

        LDR     r0,backdrop_handle     ; Check drag was on backdrop
d28 1
a28 1
        BL      find_iconized          ; find structure for icon we have dragged
d33 7
a39 4
        STR     r5,[r1,#12]            ; store window handle at r1+12
        STR     r6,[r1,#16]            ; store icon handle   at r1+16
        LDMIA   r1!,{r5-r7}            ; Load r5 (x), r6 (y), r7 (buttons)   Also r1 = r1 + 12
        SWI     XWimp_GetIconState     ; Get Icon state
d42 1
a42 1
        LDMVCIA r1,{r1-r4}             ; load minx, miny, maxx, maxy from result of GetIconState
d44 1
a44 1
        SWIVC   XWimp_ForceRedraw      ; Force redraw of old area
d47 1
a47 1
        LDMVCIA r0,{r8-r9}             ; load x and y co-ordinate of start of drag
d64 1
d71 4
a83 5
 ]

 [ Version < 69
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; Iconized_Drag
a145 2
 ]

d147 1
a147 7
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
; IconizedReopen
;
; Reopen an iconized window
;
; In : r1 = window
;      r2 = icon
a152 8
        
        LDR     r0, Window_Icons
        SUB     r0, r0, #1
        STR     r0, Window_Icons
        LDR     r0, Windows_Selected
        SUB     r0, r0, #1
        STR     r0, Windows_Selected
        
@


4.1.4.3
log
@Removed Info option on TinyDirs menu.
Updated interactive help messages.
Shift+Click on close icon now ALWAYS iconises the window underneath the icon
(old behaviour), while a click on iconise button iconises according to the
IconiseTo corner.
@
text
@d304 1
d306 10
d324 1
d326 9
@


4.1.4.4
log
@Bug fixes.
Turned off defaultbackdrop and UseECFforLCD. Only needed on A4.
Updated service call handling to use new Ursula tables.
@
text
@d168 6
a173 6
        ;LDR     r0, Window_Icons
        ;SUB     r0, r0, #1
        ;STR     r0, Window_Icons
        ;LDR     r0, Windows_Selected
        ;SUB     r0, r0, #1
        ;STR     r0, Windows_Selected
d310 1
a311 17

        LDR     r3, [r1, #24]           ; Load icon flags into r3

        LDR     r4, [r1]                ; If on icon bar, it can't have been selected
        CMP     r4, #-2
        BEQ     %FT03
        
        LDR     r4, Windows_Selected    ; Number of window icons currently selected
        TST     r3, #is_selected
        SUBNE   r4, r4, #1              ; if this icon is selected, subtract one from number
        STR     r4, Windows_Selected
03
        LDR     r4, Window_Icons
        SUB     r4, r4, #1              ; subtract one from number of window icons on pinboard
        STR     r4, Window_Icons

        SWIVC   XWimp_DeleteIcon
@


4.1.4.5
log
@When the only window icons are on the iconbar, grey out the 'Select all'
menu item.
File 'Status' added giving Pinboard status after RPC2 cancellation.
@
text
@d314 1
a314 3
        LDR     r4, [r1]                ; r4 is window handle of icon

        ; If on iconbar, subtract one from Iconbar_Icons
a315 3
        LDREQ   r4, Iconbar_Icons
        SUBEQ   r4, r4, #1
        STREQ   r4, Iconbar_Icons
d318 3
a320 4
        ; If not on the iconbar, then check if selected and update Windows_Selected
        LDR     r4, Windows_Selected 
        TST     r3, #is_selected        ; Selected?
        SUBNE   r4, r4, #1
d322 3
a324 4

        ; subtract one from number of window icons on pinboard
03      LDR     r4, Window_Icons
        SUB     r4, r4, #1
a326 1
        ; Delete the icon
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
