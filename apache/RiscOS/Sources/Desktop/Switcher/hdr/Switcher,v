head	4.4;
access;
symbols
	Switcher-1_51:4.4
	Switcher-1_50:4.4
	Switcher-1_49:4.4
	Switcher-1_48:4.4
	Switcher-1_47:4.4
	Switcher-1_46:4.4
	Switcher-1_45:4.4
	Switcher-1_44:4.4
	Switcher-1_43:4.4
	Switcher-1_42:4.4
	Switcher-1_41:4.4
	Switcher-1_40:4.4
	Switcher-1_39:4.4
	Switcher-1_38:4.4
	Switcher-1_37:4.4
	Switcher-1_36:4.3
	Switcher-1_35:4.2
	Switcher-1_34:4.2
	Switcher-1_33:4.2
	Switcher-1_32:4.2
	Switcher-1_31:4.2
	Switcher-1_30:4.2
	Switcher-1_29:4.2
	Switcher-1_28:4.2
	Switcher-1_27:4.2
	RO_5_07:4.2
	Switcher-1_26:4.2
	Switcher-1_25a:4.2
	Switcher-1_25:4.2
	Switcher-1_24:4.2
	Switcher-1_23:4.2
	Switcher-1_22:4.2
	Switcher-1_21:4.2
	Switcher-1_20:4.2
	Switcher-1_19:4.2
	Switcher-1_18:4.2
	Switcher-1_17:4.2
	Switcher-1_16:4.2
	Switcher-1_15:4.2
	dellis_autobuild_BaseSW:4.2
	Switcher-1_14:4.2
	Switcher-1_13:4.2
	sbrodie_sedwards_16Mar2000:4.2
	Switcher-1_12:4.2
	Switcher-1_11:4.2
	dcotton_autobuild_BaseSW:4.2
	Switcher-1_10:4.2
	Switcher-1_09:4.1
	Switcher-1_08:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.1
	Ursula_RiscPC:4.1.4.1.0.2
	Switcher-1_07:4.1
	Switcher-1_06:4.1
	Switcher-1_05:4.1
	Ursula_merge:4.1.4.1
	bavison_Switcher-1_12:4.1.4.1
	wturner_switcher-1_11:4.1.4.1
	bavison_Switcher-1_10:4.1.4.1
	nicke_Switcher_0_95:4.1.7.1
	rthornb_UrsulaBuild-19Aug1998:4.1.4.1
	UrsulaBuild_FinalSoftload:4.1.4.1
	rthornb_UrsulaBuild-12Aug1998:4.1.4.1
	aglover_UrsulaBuild-05Aug1998:4.1.4.1
	rthornb_UrsulaBuild-29Jul1998:4.1.4.1
	rthornb_UrsulaBuild-22Jul1998:4.1.4.1
	rthornb_UrsulaBuild-15Jul1998:4.1.4.1
	hsimons_BOCA-1_2-Release:4.1.7.1
	rthornb_UrsulaBuild-07Jul1998:4.1.4.1
	rthornb_UrsulaBuild-17Jun1998:4.1.4.1
	rthornb_UrsulaBuild-03Jun1998:4.1.4.1
	rthornb_UrsulaBuild-27May1998:4.1.4.1
	rthornb_UrsulaBuild-21May1998:4.1.4.1
	rthornb_UrsulaBuild_01May1998:4.1.4.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.4
date	2012.07.29.11.21.40;	author rsprowson;	state Exp;
branches;
next	4.3;
commitid	p2X3MLyQIY0fWrew;

4.3
date	2012.07.28.21.45.13;	author rsprowson;	state Exp;
branches;
next	4.2;
commitid	VU30pn9JTzh8qnew;

4.2
date	99.09.06.16.29.40;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.30.10;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.30.10;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.30.23;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	98.03.19.11.07.25;	author rleggett;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.21.36;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.19.25;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.4
log
@Add support for 'PostDesk' shutdown scripts
Useful for small clearup activities on each shutdown. As we're trying to shut down the range of things looked for is very small compared with the PreDesk directory: no sprites, no apps (or directories), no utilities, no BASIC, no modules. Keep it simple and fast!
* If Choices:Boot.PostDesk is present, any obey files within it are obey'd
* Swap false/true to {FALSE} and {TRUE}
* TaskManager_Shutdown flag bit 7 can skip the shutdown scripts
* Simplified evaluation of Boot$OSVersion
* Changed pre RISC OS 3.50 reset to actually do a reset rather than just reenter the desktop
* Shared a few constant strings

Version 1.37. Tagged as 'Switcher-1_37'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
        SUBT    Exported Task Manager constants

OldOpt  SETA    {OPT}
        OPT     OptNoList+OptNoP1List

; ***********************************
; ***    C h a n g e   L i s t    ***
; ***********************************

; Date       Name  Description
; ----       ----  -----------
; 17-Jan-92  DDV   File created
; 17-Jan-92  DDV   Added TaskManager_Shutdown SWI and control bits
; 29-Jan-92  DDV   Added shutdownbit_SendShutdowMessage
; 29-Jan-92  DDV   Added shutdownbit_RejectMediaSearch
; 17-May-94  AMcC  Changed to using the preferred SWI base and name symbols

SWIClass        SETS    SwitcherSWI_Name

        ^       SwitcherSWI_Base

        AddSWI  TaskNameFromHandle      
        AddSWI  EnumerateTasks
        AddSWI  Shutdown                        ; Switcher 0.60 onwards
        AddSWI  StartTask                       ; Switcher 1.10 onwards
            
; Flags for Shutdown SWI

shutdownbit_ExitToCommandPrompt * 1:SHL:0         
shutdownbit_NoPreQuit           * 1:SHL:1
shutdownbit_ModifyStateCMOS     * 1:SHL:2
shutdownbit_SendShutdownMessage * 1:SHL:3       ; Switcher 0.62 onwards
shutdownbit_RejectMediaSearch   * 1:SHL:4
shutdownbit_ExitAndRestart      * 1:SHL:5       ; Switcher 1.36 onwards
shutdownbit_ExitAndPowerOff     * 1:SHL:6
shutdownbit_NoPostDeskScripts   * 1:SHL:7       ; Switcher 1.37 onwards

        OPT     OldOpt

        END
@


4.3
log
@Add flag bits 5 and 6 to TaskManager_Shutdown
* Two new error messages for invalid shutdown flag combinations
* Removed shutdown_swi poll(byte)word support, when ProvideStartTask is switched out the code now uses misc_pollbyte
* New flag soft_poweroff to save having to keep calling OS_ReadSysInfo
* Use definitions from HighFSI, OsWords, OsBytes, Variables
* Proginfo icon numbers defined
* Permanently enabled TrueMemorySize switched code
* Add a note that the error base is bogus for this module

Version 1.36. Tagged as 'Switcher-1_36'
@
text
@d39 1
a39 1
        AddSWI  StartTask
d50 1
a50 1
shutdownbit_NoPostDeskScripts   * 1:SHL:7
@


4.2
log
@Ursula branch merged.
Doesn't attempt to use OS_DynamicArea 6 and 7 unless the symbol
OSD6and7Kernel has been defined - so when someone adds these to the trunk
Kernel, define that symbol in Hdr:RISCOS.

Version 1.10. Tagged as 'Switcher-1_10'
@
text
@d43 1
a43 1
shutdownbit_NoRestartDialogue   * 1:SHL:0         
d48 3
@


4.1
log
@Initial revision
@
text
@d39 1
@


4.1.4.1
log
@Forgot to update Hdr file!
@
text
@a38 1
        AddSWI  StartTask
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
