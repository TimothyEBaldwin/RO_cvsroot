head	1.28;
access;
symbols
	DHCP-0_27:1.28
	DHCP-0_26:1.27
	DHCP-0_25:1.26
	DHCP-0_24:1.25
	DHCP-0_23:1.24
	DHCP-0_22:1.23
	RO_5_07:1.22
	DHCP-0_21:1.22
	DHCP-0_20:1.21
	DHCP-0_19:1.20
	DHCP-0_18:1.19
	dellis_autobuild_BaseSW:1.18
	DHCP-0_17:1.18
	DHCP-0_16:1.17
	DHCP-0_15:1.16
	sbrodie_sedwards_16Mar2000:1.15
	DHCP-0_14:1.15
	DHCP-0_13:1.14
	DHCP-0_12:1.13
	dcotton_autobuild_BaseSW:1.20
	DHCP-0_11:1.12
	DHCP-0_10:1.11
	DHCP-0_09:1.10
	DHCP-0_08:1.9
	DHCP-0_07:1.8
	DHCP-0_06:1.7
	DHCP-0_05:1.6
	DHCP-0_04:1.5
	DHCP-0_03:1.4
	DHCP-0_02:1.3
	DHCP-0_01:1.2
	DHCP-0_00:1.1.1.1
	TRUNK:1.1.1;
locks; strict;
comment	@# @;


1.28
date	2016.04.14.20.08.35;	author jlee;	state Exp;
branches;
next	1.27;
commitid	XmFMgZG8adpEiD2z;

1.27
date	2013.12.23.22.33.21;	author rsprowson;	state Exp;
branches;
next	1.26;
commitid	wMV7VeIO1sikcjix;

1.26
date	2013.09.05.19.23.02;	author rsprowson;	state Exp;
branches;
next	1.25;
commitid	U4CSaZZlAOLfEh4x;

1.25
date	2013.09.04.07.10.35;	author rsprowson;	state Exp;
branches;
next	1.24;
commitid	Mw18urjsIckYC54x;

1.24
date	2012.07.20.11.12.19;	author rgriffin;	state Exp;
branches;
next	1.23;
commitid	Me55MBo8gjiOaidw;

1.23
date	2012.07.19.10.27.40;	author rgriffin;	state Exp;
branches;
next	1.22;
commitid	MFH9W84jn7sEX9dw;

1.22
date	2004.08.05.11.24.20;	author kbracey;	state Exp;
branches;
next	1.21;

1.21
date	2002.12.05.11.53.37;	author rsprowson;	state Exp;
branches;
next	1.20;

1.20
date	2000.11.15.14.09.19;	author sbrodie;	state Exp;
branches;
next	1.19;

1.19
date	2000.10.17.14.18.54;	author sbrodie;	state Exp;
branches;
next	1.18;

1.18
date	2000.08.08.16.18.43;	author sbrodie;	state Exp;
branches;
next	1.17;

1.17
date	2000.04.27.09.49.28;	author sbrodie;	state Exp;
branches;
next	1.16;

1.16
date	2000.04.26.14.48.59;	author sbrodie;	state Exp;
branches;
next	1.15;

1.15
date	2000.01.14.12.45.41;	author sbrodie;	state Exp;
branches;
next	1.14;

1.14
date	99.11.29.12.54.50;	author sbrodie;	state Exp;
branches;
next	1.13;

1.13
date	99.11.08.21.13.57;	author nbingham;	state Exp;
branches;
next	1.12;

1.12
date	99.08.11.11.58.03;	author sbrodie;	state Exp;
branches;
next	1.11;

1.11
date	99.07.09.09.27.19;	author kbracey;	state Exp;
branches;
next	1.10;

1.10
date	99.07.01.11.28.51;	author kbracey;	state Exp;
branches;
next	1.9;

1.9
date	99.06.29.09.34.19;	author kbracey;	state Exp;
branches;
next	1.8;

1.8
date	99.06.28.14.04.01;	author kbracey;	state Exp;
branches;
next	1.7;

1.7
date	99.06.25.14.01.07;	author kbracey;	state Exp;
branches;
next	1.6;

1.6
date	99.06.25.13.24.44;	author sbrodie;	state Exp;
branches;
next	1.5;

1.5
date	99.06.11.15.45.49;	author sbrodie;	state Exp;
branches;
next	1.4;

1.4
date	99.06.10.12.08.55;	author sbrodie;	state Exp;
branches;
next	1.3;

1.3
date	99.04.01.12.18.51;	author sbrodie;	state Exp;
branches;
next	1.2;

1.2
date	99.03.30.12.41.13;	author sbrodie;	state Exp;
branches;
next	1.1;

1.1
date	99.03.26.16.10.09;	author sbrodie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.03.26.16.10.09;	author sbrodie;	state Exp;
branches;
next	;


desc
@@


1.28
log
@Don't pass silly error numbers to MsgTrans
Detail:
  c/module - Don't pass silly error numbers to MessageTrans_ErrorLookup - the kernel will now fault them
Admin:
  Tested on Raspberry Pi 3


Version 0.27. Tagged as 'DHCP-0_27'
@
text
@/* (0.27)
 *
 * This file is automatically maintained by srccommit, do not edit manually.
 * Last processed by srccommit version: 1.1.
 *
 */
#define Module_MajorVersion_CMHG        0.27
#define Module_MinorVersion_CMHG        
#define Module_Date_CMHG                14 Apr 2016

#define Module_MajorVersion             "0.27"
#define Module_Version                  27
#define Module_MinorVersion             ""
#define Module_Date                     "14 Apr 2016"

#define Module_ApplicationDate          "14-Apr-16"

#define Module_ComponentName            "DHCP"
#define Module_ComponentPath            "castle/RiscOS/Sources/Networking/DHCP"

#define Module_FullVersion              "0.27"
#define Module_HelpVersion              "0.27 (14 Apr 2016)"
#define Module_LibraryVersionInfo       "0:27"
@


1.27
log
@Suggest a hostname to the DHCP server; tweak timing
As well as providing the (optional) vendor class id string, we now also suggest an (optional) hostname if one is set in Inet$HostName. This may get overridden as the hostname is one of the parameters requested from the DHCP server, but if not the server might as well have something to call us.
Change to the discover/initreboot timing. The recent change to the total timeout was wasting time by sending packets at t=0,4,8,16,32... but as the total timeout was set to 20s it only sent 3 packets then did nothing for 8s. Now, the packets are sent at t=0,2.5,5,10 with 2.5s slack at the end for a reply,
Replaced a couple of DCI protocol constants with defines.
Tested against MS Windows Server 2012 Standard, and a 3COM router, both collect DHCP addresses OK and inspection of the allocated address table shows the name of the RISC OS client.

Version 0.26. Tagged as 'DHCP-0_26'
@
text
@d1 1
a1 1
/* (0.26)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.26
d9 1
a9 1
#define Module_Date_CMHG                23 Dec 2013
d11 2
a12 2
#define Module_MajorVersion             "0.26"
#define Module_Version                  26
d14 1
a14 1
#define Module_Date                     "23 Dec 2013"
d16 1
a16 1
#define Module_ApplicationDate          "23-Dec-13"
d21 3
a23 3
#define Module_FullVersion              "0.26"
#define Module_HelpVersion              "0.26 (23 Dec 2013)"
#define Module_LibraryVersionInfo       "0:26"
@


1.26
log
@Internationalised

Version 0.25. Tagged as 'DHCP-0_25'
@
text
@d1 1
a1 1
/* (0.25)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.25
d9 1
a9 1
#define Module_Date_CMHG                05 Sep 2013
d11 2
a12 2
#define Module_MajorVersion             "0.25"
#define Module_Version                  25
d14 1
a14 1
#define Module_Date                     "05 Sep 2013"
d16 1
a16 1
#define Module_ApplicationDate          "05-Sep-13"
d21 3
a23 3
#define Module_FullVersion              "0.25"
#define Module_HelpVersion              "0.25 (05 Sep 2013)"
#define Module_LibraryVersionInfo       "0:25"
@


1.25
log
@Makefile recreated from fragments
Renamed dhcpextern.h to DHCP.h so the shared makefiles can export it without needing a different source and target filename.

Version 0.24. Tagged as 'DHCP-0_24'
@
text
@d1 1
a1 1
/* (0.24)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.24
d9 1
a9 1
#define Module_Date_CMHG                04 Sep 2013
d11 2
a12 2
#define Module_MajorVersion             "0.24"
#define Module_Version                  24
d14 1
a14 1
#define Module_Date                     "04 Sep 2013"
d16 1
a16 1
#define Module_ApplicationDate          "04-Sep-13"
d21 3
a23 3
#define Module_FullVersion              "0.24"
#define Module_HelpVersion              "0.24 (04 Sep 2013)"
#define Module_LibraryVersionInfo       "0:24"
@


1.24
log
@Fixed data abort on RPi when setting private IP address.
Delete existing address from interface before setting a private one.

Version 0.23. Tagged as 'DHCP-0_23'
@
text
@d1 1
a1 1
/* (0.23)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.23
d9 1
a9 1
#define Module_Date_CMHG                20 Jul 2012
d11 2
a12 2
#define Module_MajorVersion             "0.23"
#define Module_Version                  23
d14 1
a14 1
#define Module_Date                     "20 Jul 2012"
d16 1
a16 1
#define Module_ApplicationDate          "20-Jul-12"
d21 3
a23 3
#define Module_FullVersion              "0.23"
#define Module_HelpVersion              "0.23 (20 Jul 2012)"
#define Module_LibraryVersionInfo       "0:23"
@


1.23
log
@Added -p switch to DHCPExecute command, that causes DHCP to assign
a private IP address in the event of DHCP discovery timing out.
Changed DHCP discovery timeout from 10 minutes to 20 seconds.

Version 0.22. Tagged as 'DHCP-0_22'
@
text
@d1 1
a1 1
/* (0.22)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.22
d9 1
a9 1
#define Module_Date_CMHG                19 Jul 2012
d11 2
a12 2
#define Module_MajorVersion             "0.22"
#define Module_Version                  22
d14 1
a14 1
#define Module_Date                     "19 Jul 2012"
d16 1
a16 1
#define Module_ApplicationDate          "19-Jul-12"
d21 3
a23 3
#define Module_FullVersion              "0.22"
#define Module_HelpVersion              "0.22 (19 Jul 2012)"
#define Module_LibraryVersionInfo       "0:22"
@


1.22
log
@If a replacement driver is loaded, the new Driver Information Block address
is noted. Previously, subsequent request packets tended to have incorrect
MAC addresses read from a stale pointer.

Version 0.21. Tagged as 'DHCP-0_21'
@
text
@d1 1
a1 1
/* (0.21)
d4 1
a4 1
 * Last processed by srccommit version: 1.68.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.21
d9 1
a9 1
#define Module_Date_CMHG                05 Aug 2004
d11 2
a12 2
#define Module_MajorVersion             "0.21"
#define Module_Version                  21
d14 1
a14 1
#define Module_Date                     "05 Aug 2004"
d16 1
a16 1
#define Module_ApplicationDate          "05-Aug-04"
d19 1
a19 1
#define Module_ComponentPath            "RiscOS/Sources/Networking/DHCP"
d21 3
a23 3
#define Module_FullVersion              "0.21"
#define Module_HelpVersion              "0.21 (05 Aug 2004)"
#define Module_LibraryVersionInfo       "0:21"
@


1.21
log
@Addition of help text for syntax of DHCPexecute.
DHCPexecute now enables the escape key when called (then restores
the old escape state on exit).This had caused a problem since the
boot sequence disabled escape and booting could not continue if a
DHCP negotiation did not succeed.

Version 0.20. Tagged as 'DHCP-0_20'
@
text
@d1 1
a1 1
/* (0.20)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.20
d9 1
a9 1
#define Module_Date_CMHG                05 Dec 2002
d11 2
a12 2
#define Module_MajorVersion             "0.20"
#define Module_Version                  20
d14 1
a14 1
#define Module_Date                     "05 Dec 2002"
d16 1
a16 1
#define Module_ApplicationDate          "05-Dec-02"
d21 3
a23 3
#define Module_FullVersion              "0.20"
#define Module_HelpVersion              "0.20 (05 Dec 2002)"
#define Module_LibraryVersionInfo       "0:20"
@


1.20
log
@  Fix to initialisation behaviour.
Detail:
  The previous fix that was done to cope with the Internet module being in
    the podule space broke the case where both the Internet and DHCP modules
    were exclusively in ROM because the DHCP module saw the init service
    call from the ROM Internet after it has initialised and didn't realise
    that it was simply a delayed arrival of service call and not actually
    a re-initialisation.  This used to cause DHCP attempts to apparently
    hang.  The root cause was that the DHCP module abandonned its initial
    socket (because it thought a new Internet had arrived) and then found
    it was unable to rebind to the DHCP port because the other socket did
    still exist after all.
Admin:
  Discovered on Ursula build; fixed in Ursula build.
  Important that projects take this version in preference to version 0.17
    or version 0.18.

Version 0.19. Tagged as 'DHCP-0_19'
@
text
@d1 1
a1 1
/* (0.19)
d4 1
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.19
d9 1
a9 1
#define Module_Date_CMHG                15 Nov 2000
d11 2
a12 2
#define Module_MajorVersion             "0.19"
#define Module_Version                  19
d14 1
a14 1
#define Module_Date                     "15 Nov 2000"
d16 1
a16 2
#define Module_ApplicationDate2         "15-Nov-00"
#define Module_ApplicationDate4         "15-Nov-2000"
d21 3
a23 2
#define Module_FullVersion              "0.19"
#define Module_HelpVersion              "0.19 (15 Nov 2000)"
@


1.19
log
@  Added build options for supporting broken Microsoft server software.
Detail:
  A new build option is present which, when defined in the Components file
    for a product, allows support for Microsoft's broken DHCP server to
    be included.  To use this, put options in the components file to set
    OPTIONS to be -DMINIMUM_OPTIONS_LENGTH=4 (the minimum allowed value is
    4.  The DHCP standard mandates this value should be no lower than 64).
    Microsoft server requires it to be 4 because it sends packets that are
    too short.
Admin:
  Not tested.
  Built.

Version 0.18. Tagged as 'DHCP-0_18'
@
text
@d1 1
a1 1
/* (0.18)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.18
d8 1
a8 1
#define Module_Date_CMHG                17 Oct 2000
d10 2
a11 2
#define Module_MajorVersion             "0.18"
#define Module_Version                  18
d13 1
a13 1
#define Module_Date                     "17 Oct 2000"
d15 2
a16 2
#define Module_ApplicationDate2         "17-Oct-00"
#define Module_ApplicationDate4         "17-Oct-2000"
d18 5
a22 2
#define Module_FullVersion              "0.18"
#define Module_HelpVersion              "0.18 (17 Oct 2000)"
@


1.18
log
@  Traps Service_DCIProtocolStatus.
Detail:
  Module will shutdown when it sees Internet dying, and reinitialise
    when it sees Internet starting up again.
Admin:
  Needed for STB-400 to workaround weird initialisation order?

Version 0.17. Tagged as 'DHCP-0_17'
@
text
@d1 1
a1 1
/* (0.17)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.17
d8 1
a8 1
#define Module_Date_CMHG                08 Aug 2000
d10 2
a11 2
#define Module_MajorVersion             "0.17"
#define Module_Version                  17
d13 1
a13 1
#define Module_Date                     "08 Aug 2000"
d15 2
a16 2
#define Module_ApplicationDate2         "08-Aug-00"
#define Module_ApplicationDate4         "08-Aug-2000"
d18 2
a19 1
#define Module_FullVersion              "0.17"
@


1.17
log
@  Tells Internet module not to delete and reassign interface addresses
    when the address hasn't changed.
Detail:
  Previously, after a RENEWING or REBINDING state has been resolved by
    the reception of a DHCPACK, the Internet module was shown the packet
    in order to enable it to extract the information it wanted and to
    send it round in a service call for all other modules in the system
    to look at.  This no longer happens, as it causes the Internet module
    to lose the IGMP memberships for the interface, causing multicast
    data, including video streams on STBs, to stop.
Admin:
  Tested on STB-400 and desktop machine.

Version 0.16. Tagged as 'DHCP-0_16'
@
text
@d1 1
a1 1
/* (0.16)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.16
d8 1
a8 1
#define Module_Date_CMHG                27 Apr 2000
d10 2
a11 2
#define Module_MajorVersion             "0.16"
#define Module_Version                  16
d13 1
a13 1
#define Module_Date                     "27 Apr 2000"
d15 4
a18 1
#define Module_FullVersion              "0.16"
@


1.16
log
@  New -w option to *DHCPExecute
Detail:
  The -w option is similar to the -block option, except that it waits
    for the interface to appear if it is not already registered with
    the Internet module.  This means that the Internet Startup file
    no longer has to trigger callbacks after loading drivers in order
    to ensure that they are initialised enough for DHCP to start
    using them.
Admin:
  Tested softload on Risc PC.

Version 0.15. Tagged as 'DHCP-0_15'
@
text
@d1 1
a1 1
/* (0.15)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.15
d8 1
a8 1
#define Module_Date_CMHG                26 Apr 2000
d10 2
a11 2
#define Module_MajorVersion             "0.15"
#define Module_Version                  15
d13 1
a13 1
#define Module_Date                     "26 Apr 2000"
d15 1
a15 1
#define Module_FullVersion              "0.15"
@


1.15
log
@  Initial delays are vastly reduced when the DHCP process is invoked
    via *DHCPExecute.
Detail:
  Without this change, it takes an age for desktop machines to boot.
  Particularly my test machine with its three interfaces, each one having
    a random delay of up to 10 seconds before anything actually happens.
Admin:
  Tested in Risc PC.  Does not affect STB builds.

Version 0.14. Tagged as 'DHCP-0_14'
@
text
@d1 1
a1 1
/* (0.14)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.14
d8 1
a8 1
#define Module_Date_CMHG                14 Jan 2000
d10 2
a11 2
#define Module_MajorVersion             "0.14"
#define Module_Version                  14
d13 1
a13 1
#define Module_Date                     "14 Jan 2000"
d15 1
a15 1
#define Module_FullVersion              "0.14"
@


1.14
log
@  usermode_donothing code removed, imported from AsmUtils instead.
Detail:
  Code no longer in DHCP sources.
Admin:
  Requires Asmutils 0.02 or later.

Version 0.13. Tagged as 'DHCP-0_13'
@
text
@d1 1
a1 1
/* (0.13)
d6 1
a6 1
#define Module_MajorVersion_CMHG        0.13
d8 1
a8 1
#define Module_Date_CMHG                29 Nov 1999
d10 2
a11 2
#define Module_MajorVersion             "0.13"
#define Module_Version                  13
d13 1
a13 1
#define Module_Date                     "29 Nov 1999"
d15 1
a15 1
#define Module_FullVersion              "0.13"
@


1.13
log
@  Updated build rules.
  Modified !MkInstall.
Detail:
  Added install: target to allow for disc builds and podule rom builds.
  Updated !MkInstall to do install rather than install_rom
Admin:
  Tested using !MkInstall and podule rom image for FastNC ethernet card.

Version 0.12. Tagged as 'DHCP-0_12'
@
text
@d1 1
a1 1
/* (0.12)
d6 3
a8 3
#define Module_MajorVersion_CMHG     	0.12
#define Module_MinorVersion_CMHG	
#define Module_Date_CMHG      		08 Nov 1999
d10 4
a13 4
#define Module_MajorVersion     	"0.12"
#define Module_Version                  12
#define Module_MinorVersion		""
#define Module_Date      		"08 Nov 1999"
d15 1
a15 1
#define Module_FullVersion              "0.12"
@


1.12
log
@  Added options to *DHCPExecute.
Detail:
  *DHCPExecute now accepts two command-line options:
     -b (or -block)   Block until interface is bound
     -e               Set Inet$Error to any error
  Whilst in blocking mode, the module is idling with usermode_donothing
    and checking the Escape state, so you can press Escape to interrupt
    the process, although the module will still be attempting to bind
    the interface in the background.
  Ideally, InetSetup would be updated to know about the DHCP case and after
    ensuring the module, issue "DHCPExecute -e -b <interface>"
Admin:
  Tested in Risc PC - only affects Risc PC builds.
  Requires Library 0.28 or later (RiscOS/Library  Tag: Library-0_28)

Version 0.11. Tagged as 'DHCP-0_11'
@
text
@d1 1
a1 1
/* (0.11)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.11
d8 1
a8 1
#define Module_Date_CMHG      		11 Aug 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.11"
#define Module_Version                  11
d13 1
a13 1
#define Module_Date      		"11 Aug 1999"
d15 1
a15 1
#define Module_FullVersion              "0.11"
@


1.11
log
@* Ignores DHCPACKS from incorrect servers.
* DHCP_GetOption and associated internal calls support sub-options and
  extended options.
* Random time intervals more uniformly spread.
* Time reports in *DHCPInfo were incorrect when real-time clock had changed
  since module initialisation.
* Server priority option supported.
* CMHG file optimised - syntax not duplicated.

Version 0.10. Tagged as 'DHCP-0_10'
@
text
@d1 1
a1 1
/* (0.10)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.10
d8 1
a8 1
#define Module_Date_CMHG      		09 Jul 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.10"
#define Module_Version                  10
d13 1
a13 1
#define Module_Date      		"09 Jul 1999"
d15 1
a15 1
#define Module_FullVersion              "0.10"
@


1.10
log
@If our lease expires, call sockets_trigger_internet_dhcp() to tell the
Internet module that we're going to restart at the DHCP INIT state.
Don't show lease times if we don't have a lease.
Random delay after lease expiry now 0-10 seconds, instead of 0-5.

Version 0.09. Tagged as 'DHCP-0_09'
@
text
@d1 1
a1 1
/* (0.09)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.09
d8 1
a8 1
#define Module_Date_CMHG      		01 Jul 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.09"
#define Module_Version                  9
d13 1
a13 1
#define Module_Date      		"01 Jul 1999"
d15 1
a15 1
#define Module_FullVersion              "0.09"
@


1.9
log
@Improved randomisation further from 0.07 - now we seed on all bytes of the
hardware address, not just the first four :)
Transaction IDs now totally random.

Version 0.08. Tagged as 'DHCP-0_08'
@
text
@d1 1
a1 1
/* (0.08)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.08
d8 1
a8 1
#define Module_Date_CMHG      		29 Jun 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.08"
#define Module_Version                  8
d13 1
a13 1
#define Module_Date      		"29 Jun 1999"
d15 1
a15 1
#define Module_FullVersion              "0.08"
@


1.8
log
@* Added initial delay in INIT-REBOOT state to match INIT state.
* Stopped extra DHCPREQUESTs being generated by ioctl calls in REBOOTING state.
* Don't reject BOOTP packets just because they don't have a cookie. Treat
  those without the correct cookie as containing no options.
* Reject BOOTP packets < 300 bytes, as per RFC 1542.
* Treat BOOTP responses in a more considered fashion - old versions would go
  nuts as soon as they saw any non-DHCP response. BOOTP replies now treated as
  (not very good) offers. BOOTP responses with correct address also accepted
  in REBINDING state.
* Decline DHCPACKs with no server identifier.
* Add server to blacklist if its offer ended up being DHCPDECLINEd for any
  reason.
* Add server to blacklist if we timeout requests.
* Initial boot delay now better randomised (seeded on MAC address), and in the
  range 1-10 seconds, as per RFC 2131.
* Corrected REBOOTING and REQUESTING back-off timers - first retransmission
  was too slow.
* DHCPREQUEST packets now have secs filled in correctly in REBOOTING state.
* Voting rules extended - prefer DHCP servers to BOOTP servers and prefer
  servers providing vendor options to those who don't.

Version 0.07. Tagged as 'DHCP-0_07'
@
text
@d1 1
a1 1
/* (0.07)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.07
d8 1
a8 1
#define Module_Date_CMHG      		28 Jun 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.07"
#define Module_Version                  7
d13 1
a13 1
#define Module_Date      		"28 Jun 1999"
d15 1
a15 1
#define Module_FullVersion              "0.07"
@


1.7
log
@Fixed some RFC 2131 violations in the "secs" field output:
    DHCPDECLINE and DHCPRELEASE now set secs to 0.
    DHCPREQUESTs now have the same secs value as the last DHCPDISCOVER.

Version 0.06. Tagged as 'DHCP-0_06'
@
text
@d1 1
a1 1
/* (0.06)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.06
d8 1
a8 1
#define Module_Date_CMHG      		25 Jun 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.06"
#define Module_Version                  6
d13 1
a13 1
#define Module_Date      		"25 Jun 1999"
d15 1
a15 1
#define Module_FullVersion              "0.06"
@


1.6
log
@  Support for DHCPINFORM
  Dynamic leasing behaviour brought in line with DHCP specification
Detail:
  New *-command *DHCPExecute to enable CLI launching of DHCP interface
    control.
  Output of *DHCPInfo tidied up and irrevelant timer info is suppressed.
  The algorithm for deciding which offer to accept (where multiple offers
    are received) has been significantly enhanced (and moved to voting.c)
    If a previous offer from a server has been DHCPNAK'd by something else
    then the server offering the dodgy IP address is blacklisted and will
    no longer be preferred to a server which isn't blacklisted.
  DHCP module will request and prefer offers of an existing IP address
    configuration wherever possible.
  DHCP module will initialise an interface into the INITREBOOT/REBOOTING
    states if it is asked to take control of an interface which has
    already been configured externally.
  IP lease length suggestions are no longer sent in appropriate messages.
    The server is trusted to choose an appropriate value.
  The DHCP module is more careful to insert appropriate options into each
    message.  It is no longer in breach of RFC2131 in this respect.
  Timer values for renew and rebind times are now inferred automatically
    where necessary (server doesn't have to send them) and are now correct.
  DHCPRELEASE and DHCPDECLINE now include a textual message indicating the
    reason for the message's generation.
  Where allowed, outgoing messages contain a client class identifier to
    enable the server to vary configuration information depending on the
    client hardware/software type.  Currently, this information is the
    output of OS_Byte 0.
  In the SWI interface for examining DHCP packets, a pointer to a specific
    packet to examine may be supplied instead of an interface identifier
    (depending on a flag bit)
  New SWI DHCP_Inform for sending DHCPINFORM messages to arbitrary servers
    in order to enable retrieval of configuration information when the IP
    address has been established via other means (eg. from NVRAM).
  DHCP module is now capable of deleting IP addresses from interfaces.
  DHCP module will cede control of an interface if something else changes
    the interface's address and send a message to the server indicating
    that the lease is being relinquished.
  DHCP will trap the Internet (5.26 and later) module's panic service call
    when a duplicate IP address is detected on the network, and resolve
    the situation (send the server DHCPDECLINE and deconfigure the interface
    and restart address discovery) if it was controlling that interface.
  Transaction ID generation improved (uses interface MAC address to
    reduce chance of duplication with other hosts)
  MAC address discovery code added.
  DHCP module attempts to unicast packets wherever possible.
  Retry delays adjusted to conform more closely to spec (RFC2131)
  Possible hole in state table that IPConfig triggered which caused several
    DHCPDISCOVER messages to be sent in succession very quickly has been
    closed.
  Co-operates with Internet 5.26 to ensure that callers of the Internet
    module's BOOTP ioctl are returned sensible error values so that they
    no longer need to probe the DHCP module independently to discover
    whether an interface has been configured successfully or not.
Admin:
  Requires Internet 5.26
  Requires TCPIPLibs 5.19

Version 0.05. Tagged as 'DHCP-0_05'
@
text
@d1 1
a1 1
/* (0.05)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.05
d10 2
a11 2
#define Module_MajorVersion     	"0.05"
#define Module_Version                  5
d15 1
a15 1
#define Module_FullVersion              "0.05"
@


1.5
log
@  BOOTP server interaction policy change and fix.
Detail:
  If a BOOTP response is received in reply to a DHCPDISCOVER message,
    the DHCP module will no longer ignore it or try to palm it off to
    the Internet module, but will accept it as a valid response (ie.
    as if it were a DHCPACK with an infinite lease offer).
Admin:
  Tested in MPT Ethernet ROM.

Version 0.04. Tagged as 'DHCP-0_04'
@
text
@d1 1
a1 1
/* (0.04)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.04
d8 1
a8 1
#define Module_Date_CMHG      		11 Jun 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.04"
#define Module_Version                  4
d13 1
a13 1
#define Module_Date      		"11 Jun 1999"
d15 1
a15 1
#define Module_FullVersion              "0.04"
@


1.4
log
@  DHCP module behaviour when presented with a BOOTP response to one of
    its requests has been fixed.
Detail:
  If the DHCP module received a response from the BOOTP server rather
    than a DHCP server, it would discard the packet silently.  Since
    the Internet module only uses its own hooks into the UDP packet
    delivery code if no socket is bound to the BOOTP/DHCP port, the
    Internet module didn't see the response either.  This case is now
    trapped and delivered to the Internet module like a DHCPACK message
    would usually be (via sockets_transmit), except that we then forget
    about the interface to avoid having to deal with it any more.
  Fixed Makefile to use Do to call awk so that we can use the C library
    redirection and hence avoid getting lots of CRs in the header file
    which is exported to RiscOS.Export.C.h.DHCP
  Debug output on sockets_transmit altered to avoid dereferencing a
    NULL pointer when noting the DHCP message type of the packet being
    passed to the Internet module.
Admin:

Version 0.03. Tagged as 'DHCP-0_03'
@
text
@d1 1
a1 1
/* (0.03)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.03
d8 1
a8 1
#define Module_Date_CMHG      		10 Jun 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.03"
#define Module_Version                  3
d13 1
a13 1
#define Module_Date      		"10 Jun 1999"
d15 1
a15 1
#define Module_FullVersion              "0.03"
@


1.3
log
@  Error message text corrected.
  Policy change: T2 timeouts increased substantially.
  "SWI value out of range for module DHCP" errors on DHCP_SetOption fixed.
Detail:
  Sub-error 3 is "Option not added" not "Option not present".
  The timeouts for giving up on retries of DHCPDISCOVER and
    DHCPREQUEST messages have been substantially increased for
    the benefit of IPConfig.
  The SWI dispatcher was missing a "break" statement which
    caused Unknown DHCP SWI errors to occur on any call to
    SWI DHCP_SetOption.
  Sleep states (idling on calls that have come indirectly from tools
    such as IPConfig) are awoken more regularly.
Admin:
  Tested in STB22 NEC and on desktop machine.

Version 0.02. Tagged as 'DHCP-0_02'
@
text
@d1 1
a1 1
/* (0.02)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.02
d8 1
a8 1
#define Module_Date_CMHG      		01 Apr 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.02"
#define Module_Version                  2
d13 1
a13 1
#define Module_Date      		"01 Apr 1999"
d15 1
a15 1
#define Module_FullVersion              "0.02"
@


1.2
log
@  Integration with IPConfig completed.
  Header export added.
Detail:
  Blocking added to enable IPConfig to work correctly.
  Header file exported containing states and SWI identifiers.
  Brings loopback interface up so that it can bind to the DHCP client
    port (failure to have any AF_INET interfaces configured causes
    the bind() call to fail, even when INADDR_ANY is specified)
  Failure to read ARP cache now treated as a go-ahead to accept the
    IP address rather than a rejection.
  Keeps a copy of Internet BOOTP requests so that the options can
    be copied across to the DHCPDISCOVER if required.
Admin:
  Header export required by Internet 5.21 and IPConfig 0.15
  Requires Internet 5.21.
  Requires TCPIPLibs 5.11.
  Requires IPConfig 0.15.
  Add module after all other expansion card networking modules and
    any attempt to BOOTP will be transparently upgraded to DHCP.


Version 0.01. Tagged as 'DHCP-0_01'
@
text
@d1 1
a1 1
/* (0.01)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.01
d8 1
a8 1
#define Module_Date_CMHG      		30 Mar 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.01"
#define Module_Version                  1
d13 1
a13 1
#define Module_Date      		"30 Mar 1999"
d15 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/* (0.00)
d6 1
a6 1
#define Module_MajorVersion_CMHG     	0.00
d8 1
a8 1
#define Module_Date_CMHG      		26 Mar 1999
d10 2
a11 2
#define Module_MajorVersion     	"0.00"
#define Module_Version                  0
d13 1
a13 1
#define Module_Date      		"26 Mar 1999"
@


1.1.1.1
log
@  Fully functional DHCP client.
Detail:
  Implements the Dynamic Host Configuration Protocol (RFC2131 and RFC2132)
  This module usurps the Internet module's implementation of BOOTP in order
    to use the superior DHCP protocol.
Admin:
  Requires Internet 5.20 or later.
    (RiscOS/Sources/Networking/AUN/Internet  tag: Internet-5_20)
  Requires TCPIPLibs 5.09 or later.
    (RiscOS/Sources/Libs/TCPIPLibs  tag: TCPIPLibs-5_09)
  

Tagged as DHCP-0_00

@
text
@@
