head	4.24;
access;
symbols
	Alarm-2_93:4.24
	Alarm-2_92:4.23
	Alarm-2_91:4.22
	Alarm-2_90:4.21
	Alarm-2_89:4.20
	Alarm-2_88:4.19
	Alarm-2_87:4.18
	Alarm-2_86:4.17
	Alarm-2_86-pre2:4.16
	Alarm-2_86-pre1:4.16
	Alarm-2_85:4.16
	Alarm-2_84:4.15
	Alarm-2_83:4.14
	Alarm-2_82:4.13
	Alarm-2_81:4.12
	Alarm-2_80:4.11
	Alarm-2_79:4.10
	Alarm-2_78:4.9
	Alarm-2_77:4.7
	Alarm-2_76:4.6
	Alarm-2_75:4.5
	RO_5_07:4.4
	Alarm-2_74:4.4
	Alarm-2_73:4.3
	Alarm-2_72:4.2
	Alarm-2_71:4.1;
locks; strict;
comment	@# @;


4.24
date	2018.03.17.09.45.13;	author rool;	state Exp;
branches;
next	4.23;
commitid	U9rBVMccWhpMhNuA;

4.23
date	2017.12.02.10.03.12;	author rool;	state Exp;
branches;
next	4.22;
commitid	wQeYkqaDJUHcLihA;

4.22
date	2017.03.05.11.00.42;	author rool;	state Exp;
branches;
next	4.21;
commitid	xlVROnQcErYZOlIz;

4.21
date	2016.05.08.16.37.55;	author jlee;	state Exp;
branches;
next	4.20;
commitid	Ir78BOslHs3ymH5z;

4.20
date	2015.11.22.11.43.34;	author rool;	state Exp;
branches;
next	4.19;
commitid	qn4vxV8cCyym85Ky;

4.19
date	2015.06.02.19.30.09;	author rsprowson;	state Exp;
branches;
next	4.18;
commitid	EoUYIhqifyEchTny;

4.18
date	2015.02.03.23.01.01;	author rsprowson;	state Exp;
branches;
next	4.17;
commitid	ovf4fA1hFouHgC8y;

4.17
date	2012.06.17.15.55.03;	author rsprowson;	state Exp;
branches;
next	4.16;
commitid	BsnCfxXkEymKN49w;

4.16
date	2012.06.17.15.43.21;	author rsprowson;	state Exp;
branches;
next	4.15;
commitid	uAPjjXyPkGoJJ49w;

4.15
date	2012.05.31.07.30.21;	author rsprowson;	state Exp;
branches;
next	4.14;
commitid	8zoARW0qjretyQ6w;

4.14
date	2012.03.20.22.25.52;	author rsprowson;	state Exp;
branches;
next	4.13;
commitid	WFiM5sVqD4HbPFXv;

4.13
date	2012.03.05.08.21.47;	author rsprowson;	state Exp;
branches;
next	4.12;
commitid	mTp5oaDcII0vDFVv;

4.12
date	2011.12.07.22.47.25;	author rsprowson;	state Exp;
branches;
next	4.11;
commitid	mXKHta4EeLOPhjKv;

4.11
date	2011.09.18.08.49.46;	author rsprowson;	state Exp;
branches;
next	4.10;
commitid	2tdTBj7oP9TTdXzv;

4.10
date	2009.06.11.22.55.14;	author bavison;	state Exp;
branches;
next	4.9;

4.9
date	2009.06.10.17.43.38;	author bavison;	state Exp;
branches;
next	4.8;

4.8
date	2009.05.31.18.26.03;	author pnaulls;	state Exp;
branches;
next	4.7;

4.7
date	2008.09.10.15.41.59;	author srevill;	state Exp;
branches;
next	4.6;

4.6
date	2008.02.22.15.27.56;	author srevill;	state Exp;
branches;
next	4.5;

4.5
date	2007.01.22.17.01.24;	author srevill;	state Exp;
branches;
next	4.4;

4.4
date	2003.07.24.10.55.23;	author rsprowson;	state Exp;
branches;
next	4.3;

4.3
date	2002.11.14.22.56.25;	author rsprowson;	state Exp;
branches;
next	4.2;

4.2
date	2000.11.30.09.02.25;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	2000.05.12.14.21.19;	author sbrodie;	state Exp;
branches;
next	;


desc
@@


4.24
log
@Ordering of the set alarm dialogue fields
Detail:
  The alarm setting dialogue read as "Thu June 2010 30 12 13" which is rather unnatural for en-gb territory, reorder it to say "Thu 30 Jun 2010 at 12 13".
  Currently, there's no API to read the preferred ordering from the territory, however the templates would need translating per territory any way so can re-order the icons as required too.
Admin:
  From User Guide feedback.

Version 2.93. Tagged as 'Alarm-2_93'
@
text
@;
; This file is automatically maintained by srccommit, do not edit manually.
; Last processed by srccommit version: 1.1.
;
                        GBLS    Module_MajorVersion
                        GBLA    Module_Version
                        GBLS    Module_MinorVersion
                        GBLS    Module_Date
                        GBLS    Module_FullVersion
                        GBLS    Module_ApplicationDate
                        GBLS    Module_HelpVersion
                        GBLS    Module_ComponentName
                        GBLS    Module_ComponentPath
Module_MajorVersion     SETS    "2.93"
Module_Version          SETA    293
Module_MinorVersion     SETS    ""
Module_Date             SETS    "17 Mar 2018"
Module_ApplicationDate  SETS    "17-Mar-18"
Module_ComponentName    SETS    "Alarm"
Module_ComponentPath    SETS    "castle/RiscOS/Sources/Apps/Alarm"
Module_FullVersion      SETS    "2.93"
Module_HelpVersion      SETS    "2.93 (17 Mar 2018)"
                        END
@


4.23
log
@Fix for 1 pixel offset error when Y sub-pixel anti-aliasing turned on
Detail:
  Due to eigen factor rounding the Y offset calculation ended up 1 pixel too low when worked out in OS units.
  Switch to millipoints instead, including for plotting, so the sub-pixel Y offset isn't truncated.
Admin:
  Based on a submission from Colin Granville, with edits.

Version 2.92. Tagged as 'Alarm-2_92'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.92"
Module_Version          SETA    292
d17 2
a18 2
Module_Date             SETS    "02 Dec 2017"
Module_ApplicationDate  SETS    "02-Dec-17"
d21 2
a22 2
Module_FullVersion      SETS    "2.92"
Module_HelpVersion      SETS    "2.92 (02 Dec 2017)"
@


4.22
log
@Rename Mon-Fri back to working week
Detail:
  Alarm uses Territory_ReadCalendarInformation to determine the span of the working week, so should not hard wire the western working week days.
Admin:
  Found during review of Alarm's User Guide chapter.

Version 2.91. Tagged as 'Alarm-2_91'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.91"
Module_Version          SETA    291
d17 2
a18 2
Module_Date             SETS    "05 Mar 2017"
Module_ApplicationDate  SETS    "05-Mar-17"
d21 2
a22 2
Module_FullVersion      SETS    "2.91"
Module_HelpVersion      SETS    "2.91 (05 Mar 2017)"
@


4.21
log
@Avoid unnecessary remainder calculations
Detail:
  s/Browser - Avoid unnecessary remainder calculations in DivRem macro
Admin:
  Tested on Cortex-A15


Version 2.90. Tagged as 'Alarm-2_90'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.90"
Module_Version          SETA    290
d17 2
a18 2
Module_Date             SETS    "08 May 2016"
Module_ApplicationDate  SETS    "08-May-16"
d21 2
a22 2
Module_FullVersion      SETS    "2.90"
Module_HelpVersion      SETS    "2.90 (08 May 2016)"
@


4.20
log
@Clearer dialogues and a bug fix
Detail:
  Icons in 'setup' and 'alarm' dialogue regrouped to be clearer for the user, and rephrased UK resources to say "recurring alarm" rather than a repeating one.
  Fix bug with rollover in the alarm set from December to January.
Admin:
  Submission from Alan Robertson.

Version 2.89. Tagged as 'Alarm-2_89'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.89"
Module_Version          SETA    289
d17 2
a18 2
Module_Date             SETS    "22 Nov 2015"
Module_ApplicationDate  SETS    "22-Nov-15"
d21 2
a22 2
Module_FullVersion      SETS    "2.89"
Module_HelpVersion      SETS    "2.89 (22 Nov 2015)"
@


4.19
log
@Preserve DST bit when saving !Alarm settings
Alarm was reading the DST flag on startup, and saving that value whenever its own settings were saved, not accounting for the fact that they may have changed in between (eg. by reconfiguring the machine).
Delete that logic, just preserve the DST bit across the 1 place the CMOS is written.
Fix for ticket #409.

Version 2.88. Tagged as 'Alarm-2_88'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.88"
Module_Version          SETA    288
d17 2
a18 2
Module_Date             SETS    "02 Jun 2015"
Module_ApplicationDate  SETS    "02-Jun-15"
d21 2
a22 2
Module_FullVersion      SETS    "2.88"
Module_HelpVersion      SETS    "2.88 (02 Jun 2015)"
@


4.18
log
@Correction to interactive help
The \A token includes a to, so don't say "to to".

Version 2.87. Tagged as 'Alarm-2_87'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.87"
Module_Version          SETA    287
d17 2
a18 2
Module_Date             SETS    "03 Feb 2015"
Module_ApplicationDate  SETS    "03-Feb-15"
d21 2
a22 2
Module_FullVersion      SETS    "2.87"
Module_HelpVersion      SETS    "2.87 (03 Feb 2015)"
@


4.17
log
@Assorted refactoring/tidy up
Corrected endianness of error messages from FNerr_box
Minor template tweaks in system font.
Added support for EX/EY0 analogue clock which is actually readable, was defaulting to blocky EX/EY2 before.
When Wimp_TextOp is unavailable the system font is used as a fallback.
Gave icons variable names rather than lots of magic numbers in the code.
Refactored use of nested windows, since the supporting routines only actually apply to 3 windows
 - a_wind% The alarm window always has the caret
 - setup% The setup window now has an invisible caret
 - warning% Never has the input focus anyway so the set/cancel buttons
can simply be placed in the dialogue as normal and the style guide keypresses caught with the normal key handler.
Now runs on RISC OS 3.10 again as a side effect.
Checked the messages file for redundant help, removing those which are now in the configure plugin.
Binary 15kB smaller!

Version 2.86. Tagged as 'Alarm-2_86'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.86"
Module_Version          SETA    286
d17 2
a18 2
Module_Date             SETS    "17 Jun 2012"
Module_ApplicationDate  SETS    "17-Jun-12"
d21 2
a22 2
Module_FullVersion      SETS    "2.86"
Module_HelpVersion      SETS    "2.86 (17 Jun 2012)"
@


4.16
log
@Minor style guide fixes.
Warning on quitting -> save button should be a default action button.
Removed RISC OS 2 Wimp support: use of territory manager
and ResourceFS (neither of which are in RISC OS 2) make the run time
check for old WindowManager versions futile. For reference, RISC OS 3.10
came with WindowManager 3.16 in ROM.
Fix wrong help lookup on text labels in the setup dialogue due to icon block offset typo.

Version 2.85. Tagged as 'Alarm-2_85'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.85"
Module_Version          SETA    285
d21 2
a22 2
Module_FullVersion      SETS    "2.85"
Module_HelpVersion      SETS    "2.85 (17 Jun 2012)"
@


4.15
log
@Divide up source file into smaller pieces
Correction to !Help
Tested briefly, still runs and alarms still go off.

Version 2.84. Tagged as 'Alarm-2_84'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.84"
Module_Version          SETA    284
d17 2
a18 2
Module_Date             SETS    "31 May 2012"
Module_ApplicationDate  SETS    "31-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "2.84"
Module_HelpVersion      SETS    "2.84 (31 May 2012)"
@


4.14
log
@Missing then stopped Alarm$Free being created.
Subject to crunch and squish the IF got lost on one line followed by ineffective ELSE on another.

Version 2.83. Tagged as 'Alarm-2_83'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.83"
Module_Version          SETA    283
d17 2
a18 2
Module_Date             SETS    "20 Mar 2012"
Module_ApplicationDate  SETS    "20-Mar-12"
d21 2
a22 2
Module_FullVersion      SETS    "2.83"
Module_HelpVersion      SETS    "2.83 (20 Mar 2012)"
@


4.13
log
@Changed to generate alarm browser redraw code with ObjAsm not BASIC assembler tool.
It's not clear why this merits being written in assembler, but it can at least use normal tools.

Version 2.82. Tagged as 'Alarm-2_82'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.82"
Module_Version          SETA    282
d17 2
a18 2
Module_Date             SETS    "05 Mar 2012"
Module_ApplicationDate  SETS    "05-Mar-12"
d21 2
a22 2
Module_FullVersion      SETS    "2.82"
Module_HelpVersion      SETS    "2.82 (05 Mar 2012)"
@


4.12
log
@Fix fatal error when probing for TimeSetup plugin when no BootResources, wasn't using *X*OS_File.
Simplified PROCinit_timediff and PROCtime_diff.
Was reading from Choices$Write, made the compare of current filename with default filename case insensitive.
Loading of Alarm:Code wasn't flushing the I cache.
No longer reassembles the Alarm$Free variable when not needed.
OptSav removed from messages file, simply placed in the code as its location is fixed in the boot sequence.
Choices dialogue now says "DST starts/ends on" not "BST starts/ends on".
Turned off the close icons on those windows that don't merit them, removed the code that did that.
A number of things got broken in the template changes from 2.79
 * The UK translation of the 'alarm' dialogue had the wrong icon numbers, so the repeating alarm buttons didn't do the right thing
 * The set clock title erroneously said "Set alarm"
 * The cunning alignment of icons in the 'alarm' dialogue was lost so with 3D borders turned off some of the repeating alarm icons were still partly visible
 * Some of the up/down arrow pairs were spaced out differently within one window
which were corrected in the Germany copy and propagated back to UK.

Version 2.81. Tagged as 'Alarm-2_81'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.81"
Module_Version          SETA    281
d17 2
a18 2
Module_Date             SETS    "07 Dec 2011"
Module_ApplicationDate  SETS    "07-Dec-11"
d21 2
a22 2
Module_FullVersion      SETS    "2.81"
Module_HelpVersion      SETS    "2.81 (07 Dec 2011)"
@


4.11
log
@Remove private tokenisation scheme.
Dating back to the early 90's !Alarm has tried tokenising its help messages to save space using a tick mark '`'. However, post RISC OS 3.70 all help tokens get tokenised at ROM time, but this results in tokenised tokenised tokens which therefore don't get expanded.
Also now uses centralised Awk script for substituting '_Version'.
Fixes ticket #231.

Version 2.80. Tagged as 'Alarm-2_80'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.80"
Module_Version          SETA    280
d17 2
a18 2
Module_Date             SETS    "18 Sep 2011"
Module_ApplicationDate  SETS    "18-Sep-11"
d21 2
a22 2
Module_FullVersion      SETS    "2.80"
Module_HelpVersion      SETS    "2.80 (18 Sep 2011)"
@


4.10
log
@  New templates
Detail:
  UK templates updated, Germany templates added
Admin:
  Changes by Detlef Thielsch

Version 2.79. Tagged as 'Alarm-2_79'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.79"
Module_Version          SETA    279
d17 2
a18 2
Module_Date             SETS    "11 Jun 2009"
Module_ApplicationDate  SETS    "11-Jun-09"
d21 2
a22 2
Module_FullVersion      SETS    "2.79"
Module_HelpVersion      SETS    "2.79 (11 Jun 2009)"
@


4.9
log
@  Fix for dates of 1900 or earlier
Detail:
  Reportedly Alarm will crash if you try to enter a time in 1900 - the
  previous limit. I can't reproduce this on RISC OS 5, so perhaps it's a
  ROL fork bug? Nevertheless, the workaround, to set the limit to 1901
  instead, is harmless.
Admin:
  Change suggested by Detlef Thielsch

Version 2.78. Tagged as 'Alarm-2_78'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.78"
Module_Version          SETA    278
d17 2
a18 2
Module_Date             SETS    "10 Jun 2009"
Module_ApplicationDate  SETS    "10-Jun-09"
d21 2
a22 2
Module_FullVersion      SETS    "2.78"
Module_HelpVersion      SETS    "2.78 (10 Jun 2009)"
@


4.8
log
@Normalise include paths
Detail:
 Assembler GETs as per other changes
Admin:
 Part of changes to all C modules in Apps

Version 2.77. Not tagged
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.77"
Module_Version          SETA    277
d17 2
a18 2
Module_Date             SETS    "31 May 2009"
Module_ApplicationDate  SETS    "31-May-09"
d21 2
a22 2
Module_FullVersion      SETS    "2.77"
Module_HelpVersion      SETS    "2.77 (31 May 2009)"
@


4.7
log
@  Minor fixes to Alarm.
Detail:
  Fix bug in FNoffscreen (should be OS_ReadMoveVariable 12 into Y%)

  Added divider sprite to dialogue windows, this helps hide the different
  background tiling caused by nesting windows.

  Set alarm window, icon 27 the 'every x number' was not big enough for three
  digits even though it can go up to 255. It has now been made bigger.

  The Y size of the font is now only read on mode/font change, reading it on
  every display can cause the text to sometimes jump.
Admin:
  Tested on RiscPC RO402, RiscPC RO606
Notes:
  Changes by James Lampard.

Version 2.77. Tagged as 'Alarm-2_77'
@
text
@d17 2
a18 2
Module_Date             SETS    "10 Sep 2008"
Module_ApplicationDate  SETS    "10-Sep-08"
d22 1
a22 1
Module_HelpVersion      SETS    "2.77 (10 Sep 2008)"
@


4.6
log
@  Many changes and improvements to Alarm.
Detail:
  Style guide issues:
  * Fixed window menus to open at x-64,y instead of x-64,y+32
  * Pressing return in dialogue boxes causes the default button to be pressed
  * Changed 'Setup...' to 'Choices...' on iconbar menu.
  * Dialogue windows now have a Cancel button rather than a wimp close box.
 
  Set Alarm window changes:
  * Window redesigned.
  * Old behaviour (which was broken in 2.75) of clicking on the "Repeating
  * Alarm" icon expanding the window, has been reinstated.
  * Year, date, hour and minute icons are now directly editable.
  * New icons show the difference between the current time and the alarm you
    are setting.
 
  Fixed broken messages file, added a warning to hopefully stop it happening
  again.
 
  When the 'code' file isn't present, an error is generated; unfortunately
  this was translated via MsgTrans (the problem being the messages file
  hadn't been opened yet). This has now been fixed.
 
  Iconbar icon now uses desktop font, and has a fixed position on the
  iconbar.
 
  The Alarm$Options settings are saved in <Choices$Write>.Boot.Predesk.Alarm,
  so the user defined format is preserved over resets.
 
  Extensions to the user definede format:
    ~AH Analogue hours display.
    ~AM Analogue minutes display.
    ~AS Analogue seconds display.
    ~IN Alternating ':'/'.' indicator previously used by HH:MM format.
 
    You can now include system variables in the string. Alarm provides
    <Alarm$Free> which is the current free memory in the computer.
 
  Error changes:
  * Message_DataOpen is acknowledged straight away. Which prevents the
    situation of an error occuring, the OS running another copy of Alarm
    and then generating the same error again.
  * Errors 108D4 and 108D5 are ignored, as recommended on PRM3-64
  * Error windows now use the extensions provided by RO3.5
 
  Choosing "Set clock..." from the iconbar menu, will run the !TimeSetup
  configure plug-in if available.
 
Admin:
  Tested on RiscPC RO402, RiscPC RO606, Underemulation on RO311 + universal
  boot & nested window manager.
Notes:
  Changes by James Lampard.

Version 2.76. Tagged as 'Alarm-2_76'
@
text
@d3 1
a3 1
; Last processed by srccommit version: 1.2.
d14 2
a15 2
Module_MajorVersion     SETS    "2.76"
Module_Version          SETA    276
d17 2
a18 2
Module_Date             SETS    "22 Feb 2008"
Module_ApplicationDate  SETS    "22-Feb-08"
d21 2
a22 2
Module_FullVersion      SETS    "2.76"
Module_HelpVersion      SETS    "2.76 (22 Feb 2008)"
@


4.5
log
@  Minor tweaks to build and install correctly.
Detail:
  Some changes were required in order for this component to build and install
  correctly. These changes are required for the ROOL 'Disc' build.
Admin:
  Tested in Iyonix 'Disc' build using ROOL 'BuildEnv' build environment

Version 2.75. Tagged as 'Alarm-2_75'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.75"
Module_Version          SETA    275
d17 2
a18 2
Module_Date             SETS    "22 Jan 2007"
Module_ApplicationDate  SETS    "22-Jan-07"
d20 3
a22 3
Module_ComponentPath    SETS    "RiscOS/Sources/Apps/Alarm"
Module_FullVersion      SETS    "2.75"
Module_HelpVersion      SETS    "2.75 (22 Jan 2007)"
@


4.4
log
@Change to use objasm not aasm

Version 2.74. Tagged as 'Alarm-2_74'
@
text
@d3 1
a3 1
; Last processed by srccommit version: 1.68.
d14 2
a15 2
Module_MajorVersion     SETS    "2.74"
Module_Version          SETA    274
d17 2
a18 2
Module_Date             SETS    "24 Jul 2003"
Module_ApplicationDate  SETS    "24-Jul-03"
d21 2
a22 2
Module_FullVersion      SETS    "2.74"
Module_HelpVersion      SETS    "2.74 (24 Jul 2003)"
@


4.3
log
@Given appdate of the form dd-mmm-yy inserted to the messages file at
buildtime.
Changed to save to choices$write.
Saveas template stolen from edit.
Wordwrapped some messages in the template to help with alternate fonts.
Resynced set time and create alarm templates.
Stretched a few label boxes so the text actually fits!

Version 2.73. Tagged as 'Alarm-2_73'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "2.73"
Module_Version          SETA    273
d17 2
a18 2
Module_Date             SETS    "14 Nov 2002"
Module_ApplicationDate  SETS    "14-Nov-02"
d21 2
a22 2
Module_FullVersion      SETS    "2.73"
Module_HelpVersion      SETS    "2.73 (14 Nov 2002)"
@


4.2
log
@* 32-bit compatible.
* Fixed clean rule.

Version 2.72. Tagged as 'Alarm-2_72'
@
text
@d3 1
d10 1
a10 2
                        GBLS    Module_ApplicationDate2
                        GBLS    Module_ApplicationDate4
d14 2
a15 2
Module_MajorVersion     SETS    "2.72"
Module_Version          SETA    272
d17 2
a18 3
Module_Date             SETS    "30 Nov 2000"
Module_ApplicationDate2 SETS    "30-Nov-00"
Module_ApplicationDate4 SETS    "30-Nov-2000"
d21 2
a22 2
Module_FullVersion      SETS    "2.72"
Module_HelpVersion      SETS    "2.72 (30 Nov 2000)"
@


4.1
log
@  Moved to srccommit.
  Merged Ursula branch.
  32-bit compatible.
Admin:
  Tested in Ursula build.

Version 2.71. Tagged as 'Alarm-2_71'
@
text
@d9 7
a15 2
Module_MajorVersion     SETS    "2.71"
Module_Version          SETA    271
d17 7
a23 2
Module_Date             SETS    "12 May 2000"
Module_FullVersion      SETS    "2.71"
@

