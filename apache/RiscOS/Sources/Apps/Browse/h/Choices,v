head	1.24;
access;
symbols
	Browse-2_16:1.24
	Browse-2_15:1.24
	Browse-2_14:1.24
	Browse-2_13:1.24
	Browse-2_12:1.24
	Browse-2_11:1.23
	Browse-2_10:1.23
	Browse-2_09:1.23
	ahodgkin_208_i4_2:1.23
	ahodgkin_208_i4:1.22
	ahodgkin_208_i3:1.22
	ahodgkin_208_i2:1.22
	ahodgkin_208_i1:1.21
	ahodgkin_207release:1.19
	ahodgkin_206release:1.17
	ahodgkin_205release:1.17
	ahodgkin_204release:1.17
	ahodgkin_202release:1.16
	ahodgkin_201release:1.15
	ahodgkin_200release:1.15
	ahodgkin_133beta:1.15
	ahodgkin_132beta:1.15
	ahodgkin_131beta:1.15
	ahodgkin_130beta:1.14
	ahodgkin_129:1.14
	ahodgkin_128beta:1.13
	ahodgkin_128alpha:1.11
	ahodgkin_127beta2:1.10
	ahodgkin_127beta:1.10
	ahodgkin_126beta:1.8
	ahodgkin_AW97patch:1.8
	ahodgkin_AW97:1.6;
locks; strict;
comment	@# @;


1.24
date	2006.03.13.22.06.20;	author ahodgkin;	state Exp;
branches;
next	1.23;

1.23
date	2000.05.31.15.58.53;	author ahodgkin;	state Exp;
branches;
next	1.22;

1.22
date	2000.02.25.17.08.57;	author ahodgkin;	state Exp;
branches;
next	1.21;

1.21
date	99.09.02.13.10.38;	author ahodgkin;	state Exp;
branches;
next	1.20;

1.20
date	99.03.30.15.52.10;	author ahodgkin;	state Exp;
branches;
next	1.19;

1.19
date	98.10.13.16.34.09;	author ahodgkin;	state Exp;
branches;
next	1.18;

1.18
date	98.09.07.11.47.08;	author ahodgkin;	state Exp;
branches;
next	1.17;

1.17
date	98.04.16.08.14.28;	author ahodgkin;	state Exp;
branches;
next	1.16;

1.16
date	98.03.20.12.13.05;	author ahodgkin;	state Exp;
branches;
next	1.15;

1.15
date	98.01.06.11.18.46;	author dbrown;	state Exp;
branches;
next	1.14;

1.14
date	97.12.12.15.12.53;	author dbrown;	state Exp;
branches;
next	1.13;

1.13
date	97.12.03.11.11.38;	author dbrown;	state Exp;
branches;
next	1.12;

1.12
date	97.12.03.10.39.30;	author dbrown;	state Exp;
branches;
next	1.11;

1.11
date	97.12.01.12.02.07;	author dbrown;	state Exp;
branches;
next	1.10;

1.10
date	97.11.20.10.22.59;	author dbrown;	state Exp;
branches;
next	1.9;

1.9
date	97.11.05.15.26.02;	author kbracey;	state Exp;
branches;
next	1.8;

1.8
date	97.10.17.14.16.17;	author dbrown;	state Exp;
branches;
next	1.7;

1.7
date	97.10.17.11.08.36;	author dbrown;	state Exp;
branches;
next	1.6;

1.6
date	97.10.13.12.58.00;	author dbrown;	state Exp;
branches;
next	1.5;

1.5
date	97.10.08.11.43.00;	author dbrown;	state Exp;
branches;
next	1.4;

1.4
date	97.10.07.16.23.48;	author dbrown;	state Exp;
branches;
next	1.3;

1.3
date	97.10.07.13.52.03;	author ahodgkin;	state Exp;
branches;
next	1.2;

1.2
date	97.10.07.10.41.46;	author dbrown;	state Exp;
branches;
next	1.1;

1.1
date	97.09.29.11.24.42;	author dbrown;	state Exp;
branches;
next	;


desc
@@


1.24
log
@  PDF export, some major redraw structural changes, updated resources,
  new build system, extensive Makefile modifications, const/restrict
  additions, various bug fixes.
Detail:
  PDF export facility. SEE Docs.User FOR DETAILS (important!). Includes
  UI for headers/footers in Choices and option switch in Print dialogue
  box. Minor bug fixes include printing bullet points and, at long last,
  the "print dialogue box contents are not set up" problem. Redraw engine
  now based entirely on function pointers. Draw export routine replaces
  screen output functions with Draw output functions; PDF does similar.
  Coordinate scaling system in Scale.c/h to help. Makefile changes: Now
  supports a more consistent set of build variants and has minimal
  duplication of object and library lists. New build system: !Mk...
  script files removed, FrontEnd tool !MkBrowse replaces it. See !ReadMe
  (replacing old ReadMe) in root for details. Requires FrontEnd 1.29,
  HTMLLib 0.02 and ImageLib 0.04 (by CVS VersionNum). Updated resources:
  Some attempt to bring all variants to a working level, but not much
  testing. Only the Phoenix JavaScript capable builds (Unicode or normal)
  are fully up to date, though, including PDF UI additions. Many other
  minor tweaks, and extensive use of const and restrict qualifiers
  propagated through source code in response to their use in the new
  redraw system.
Admin:
  Draw and PDF export tested quite heavily. Appears to work well. Text
  file 'Docs.User' describes limitations. Note required new module and
  library versions listed above. Note that only JavaScript capable
  Phoenix resources are updated and only Phoenix was heavily tested.

Version 2.12. Tagged as 'Browse-2_12'
@
text
@/* Copyright 1997 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**************************************************************/
/* File:    Choices.h                                         */
/*          (C) 2000 Pace Micro Technology PLC                */
/*          All rights reserved                               */
/*                                                            */
/* Purpose: Functions related to the Chices dialogue box and  */
/*          associated sub-windows.                           */
/*                                                            */
/* Author:  D.T.A.Brown.                                      */
/*                                                            */
/* History: 23-Sep-1997 (DTAB): Created.                      */
/*          10-Apr-2000 (ADH): 64-wide comments adopted.      */
/**************************************************************/

#ifndef Browser_Choices__
  #define Browser_Choices__

  #include <kernel.h>
  #include <tboxlibs/toolbox.h>

  /* COMPONENT ID LIMITS                                  */
  /* ===================                                  */
  /*                                                      */
  /* The next free component ID is 0x27e9.                */
  /* AFTER 0x27FF MOVE ON TO the 0x1A00 BLOCK.            */
  /*                                                      */
  /* Allocated blocks are: 0x2600 - 0x27ff                */
  /*                       0x1a00 - 0x1bff                */

  /* Choices main dialogue component IDs */

  #define CDSet                 0x2600
  #define CDCancel              0x2601
  #define CDSaveButton          0x2602
  #define CDFirstSubRadio       0x2603
  #define CDPlaceHolder         0x260f

  /* Choices main dialogue and menu event codes */

  #define ECDSet                0x2600
  #define ECDCancel             0x2601
  #define ECDSaveButton         0x2602

  #define ECDToBeShown          0x27ff
  #define ECDHidden             0x27fe
  #define ECDRG2                0x27fd
  #define ECDSaveMenuClick      0x27fc
  #define ECDDispMenuClick      0x27fb
  #define ECDPlugMenuClick      0x27fa
  #define ECDTimeMenuClick      0x27f9
  #define ECDBordMenuClick      0x27f8
  #define ECDHiRadioClick       0x27f7
  #define ECDURIMenuClick       0x27f6
  #define ECDCookieMenuClick    0x27f5
  #define ECDJPEGMenuClick      0x27f4
  #define ECDRefererMenuClick   0x27f3
  #define ECDWinOpenMenuClick   0x27f1
  #define ECDWinCloseMenuClick  0x27f0
  #define ECDHFDateMenuClick    0x27ef
  #define ECDHFSpecialMenuClick 0x27ee
  #define ECDHFSpecSubMenuClick 0x27ed
  #define ECDPageBreakMenuClick 0x27ec

  /* Some sub-windows may want to send this event when closing, */
  /* e.g. any which lead to a List dialogue box being opened.   */

  #define ECD_SubWindowToClose  0x27f2

  /* Choices subwindows event codes */

  #define ECD_EncodingMenuBt    0x2656

  #define ECD_ColourButton      0x2690
  #define ECD_FontButton        0x26b0

  #define ECD_HlSaveBt          0x26d1
  #define ECD_HlDispBt          0x26d3
  #define ECD_HiSaveBt          0x26f1
  #define ECD_HiDispBt          0x26f3
  #define ECD_HiImSaveBt        0x2729
  #define ECD_HiAgeTypeBt       0x26f8

  #define ECD_ObjPlugBt         0x26c2

  #define ECD_TabInnerBordBt    0x26c7
  #define ECD_TabOuterBordBt    0x26ca

  #define ECD_URIHandlerBt      0x2788
  #define ECD_CookieBt          0x278d
  #define ECD_JPEGBt            0x2790
  #define ECD_RefererBt         0x2796

  #define ECD_WinOpenBt         0x2798
  #define ECD_WinCloseBt        0x27ba

  #define ECD_PageBreakBt       0x27be
  #define ECD_HFRadios          0x27bf
  #define ECD_HeaderFooterBt    0x27c6
  #define ECD_DateFormatBt      0x27d2
  #define ECD_LayoutRadios      0x27d3

  /* Choices subwindows */

  #define CDSubNone             -1
  #define CDNoSubwindows        11

  /* Choices Subwindow component ids */

  /* In all cases there may only be one of each */
  /* of these components.                       */

  #define CD_Homepage           0x2650
  #define CD_UnderlineLinks     0x2651
  #define CD_UseDocColours      0x2652
  #define CD_ShowForeground     0x2653
  #define CD_ShowBackground     0x2654
  #define CD_EncodingDisply     0x2655
  #define CD_EncodingMenuBt     0x2656

  #define CD_URLBar             0x2670
  #define CD_StatusBar          0x2671
  #define CD_ButtonBar          0x2672
  #define CD_FullScreen         0x2673

  #define CD_ClientPull         0x2674
  #define CD_NetscapeEmu        0x2675
  #define CD_FramesSupport      0x2676

  /* The colour display button MUST have a component id */
  /* one less than it's equivalent menu button and      */
  /* be in the same subwindow.                          */

  #define CD_BackColour         0x2690
  #define CD_BackColourBt       0x2691
  #define CD_TextColour         0x2692
  #define CD_TextColourBt       0x2693
  #define CD_LinkColour         0x2694
  #define CD_LinkColourBt       0x2695
  #define CD_UsedColour         0x2696
  #define CD_UsedColourBt       0x2697
  #define CD_FolwColour         0x2698
  #define CD_FolwColourBt       0x2699
  #define CD_SlctColour         0x269a
  #define CD_SlctColourBt       0x269b

  /* The window in which the fake page button resides */
  /* must not be auto redraw.                         */

  #define CD_FakePage           0x269c

  /* The display fields must have component id one */
  /* less than their equivalent menu buttons and   */
  /* be in the same subwindow.                     */

  #define CD_FontsTF1Disp       0x26b0
  #define CD_FontsTF1Bt         0x26b1
  #define CD_FontsTF2Disp       0x26b2
  #define CD_FontsTF2Bt         0x26b3
  #define CD_FontsTF3Disp       0x26b4
  #define CD_FontsTF3Bt         0x26b5
  #define CD_FontsSize          0x26b6
  #define CD_FontsSystem        0x26b7
  #define CD_FontsTF1Labl       0x26b8
  #define CD_FontsTF2Labl       0x26b9
  #define CD_FontsTF3Labl       0x26ba
  #define CD_FontsSzLabl1       0x26bb
  #define CD_FontsSzLabl2       0x26bc
  #define CD_FontsGroup1        0x26bd
  #define CD_FontsAspect        0x26be
  #define CD_FontsAspectLabl1   0x26bf
  #define CD_FontsAspectLabl2   0x2730
  #define CD_FontsMinSize       0x2731
  #define CD_FontsMinSizeLabl   0x2732

  /* Hotlist, history and image history */

  #define CD_HlSaveDisp         0x26d0
  #define CD_HlSaveBt           0x26d1
  #define CD_HlDispDisp         0x26d2
  #define CD_HlDispBt           0x26d3
  #define CD_HlAutoOpen         0x26d4
  #define CD_HlAutoScroll       0x26d5

  #define CD_HiSaveDisp         0x26f0
  #define CD_HiSaveBt           0x26f1
  #define CD_HiDispDisp         0x26f2
  #define CD_HiDispBt           0x26f3

  #define CD_HiDontAge          0x26f4
  #define CD_HiExpiryAgeLabl    0x26f5
  #define CD_HiExpiryAge        0x26f6
  #define CD_HiAgeTypeDisp      0x26f7
  #define CD_HiAgeTypeBt        0x26f8

  #define CD_HiDontSize         0x26f9
  #define CD_HiMaxSizeLabl1     0x26fa
  #define CD_HiMaxSize          0x26fb
  #define CD_HiMaxSizeLabl2     0x26fc

  #define CD_HiImDontAge        0x26fd
  #define CD_HiImExpiryAgeLabl  0x26fe
  #define CD_HiImExpiryAge      0x26ff
  #define CD_HiImAgeTypeDisp    0x2720
  #define CD_HiImAgeTypeBt      0x2721

  #define CD_HiImDontSize       0x2722
  #define CD_HiImMaxSizeLabl1   0x2723
  #define CD_HiImMaxSize        0x2724
  #define CD_HiImMaxSizeLabl2   0x2725

  #define CD_HiRadPage          0x2726
  #define CD_HiRadImage         0x2727

  #define CD_HiImSaveDisp       0x2728
  #define CD_HiImSaveBt         0x2729

  /* The ObjPlugDisp component must have a component id */
  /* one less than the ObjPlugBt component.             */

  #define CD_ObjHandle          0x26c0
  #define CD_ObjPlugDisp        0x26c1
  #define CD_ObjPlugBt          0x26c2
  #define CD_ObjPlugLabl        0x26c3

  /* Tables stuff (currently in objects window)         */

  #define CD_TabSupport         0x26c4
  #define CD_TabInnerBordLabl   0x26c5
  #define CD_TabInnerBordDisp   0x26c6
  #define CD_TabInnerBordBt     0x26c7
  #define CD_TabOuterBordLabl   0x26c8
  #define CD_TabOuterBordDisp   0x26c9
  #define CD_TabOuterBordBt     0x26ca

  #define CD_NetUseProxy        0x2700
  #define CD_NetProxyAddr       0x2701
  #define CD_NetProxyLabl       0x2702
  #define CD_NetLaunchProxy     0x2703
  #define CD_NetMaxImageFetch   0x2704

  #define CD_RefoWait           0x2780
  #define CD_RefoKeep           0x2781
  #define CD_RefoHold           0x2782

  #define CD_RefoTimeLabl       0x2783
  #define CD_RefoTimeDisp       0x2784
  #define CD_RefoTimeLabl2      0x2785

  #define CD_MSIE4StyleTables   0x278a

  /* URI handler */

  #define CD_URIHandlerLabl     0x2786
  #define CD_URIHandlerDisp     0x2787
  #define CD_URIHandlerBt       0x2788

  /* Cookies */

  #define CD_CookieLabl         0x278b
  #define CD_CookieDisp         0x278c
  #define CD_CookieBt           0x278d

  /* JPEG handling */

  #define CD_JPEGLabl           0x278e
  #define CD_JPEGDisp           0x278f
  #define CD_JPEGBt             0x2790

  /* Frames */

  #define CD_NoScrollBars       0x2791
  #define CD_DragToScroll       0x2792
  #define CD_ShowMayScroll      0x2793

  /* Referer headers */

  #define CD_RefererLabl        0x2794
  #define CD_RefererDisp        0x2795
  #define CD_RefererBt          0x2796

  /* Yet more options, with some unconditional JS stuff */
  /* because these are just definitions allocating      */
  /* component id space.                                */
  /*                                                    */
  /* The JS components must all be in the same window   */
  /* (see function choices_set_js_all_greyed).          */

  #define CD_JSTimeoutLabl      0x2799
  #define CD_JSTimeoutDisp      0x27a0
  #define CD_JSTimeoutLabl2     0x27a1

  #define CD_SupportJS          0x27a3
  #define CD_JSWatchdog         0x27a4
  #define CD_JSNavAsNav         0x27a5

  #define CD_JSWinOpenLabl      0x27b7
  #define CD_JSWinOpenDisp      0x2797
  #define CD_JSWinOpenBt        0x2798

  #define CD_JSWinCloseLabl     0x27b8
  #define CD_JSWinCloseDisp     0x27b9
  #define CD_JSWinCloseBt       0x27ba

  #define CD_JSErrorBoxes       0x27bb

  #define CD_JSOpenCloseLabl    0x27bc

  /* Not to be confused with scripting, these are for the image */
  /* RAM cache garbage collection scheme.                       */

  #define CD_GCAfterNewFetch    0x27a6

  #define CD_GCUnusedLimitLabl  0x27a7
  #define CD_GCUnusedLimitDisp  0x27a8
  #define CD_GCUnusedLimitLabl2 0x27a9

  #define CD_GCFreeLimitLabl    0x27aa
  #define CD_GCFreeLimitDisp    0x27ab
  #define CD_GCFreeLimitLabl2   0x27ac

  /* Buttons that open the List dialogue with varied contents */

  #define CD_ExcludeHTTPBt      0x27ad
  #define CD_ExcludeFTPBt       0x27ae
  #define CD_ExcludeAnyBt       0x27af
  #define CD_CookieAcceptBt     0x27b0
  #define CD_CookieRejectBt     0x27b1
  #define CD_NoImagesBt         0x27b2
  #define CD_NoPlugInsBt        0x27b3
  #define CD_NoScriptsBt        0x27b4
  #define CD_NoTablesBt         0x27b5

  /* Even more choices. Fortunately, minimal code support is */
  /* typically required.                                     */

  #define CD_PreserveWidth      0x27a2
  #define CD_StripExtensions    0x27b6

  /* Printing choices */

  #define CD_PageBreakDisp      0x27bd
  #define CD_PageBreakBt        0x27be

  #define CD_HeadersOff         0x27bf
  #define CD_HeadersFrom        0x27c0
  #define CD_HeadersDisp        0x27c1
  #define CD_FootersOff         0x27c2
  #define CD_FootersFrom        0x27c3
  #define CD_FootersDisp        0x27c4

  #define CD_HFLeftLabl         0x27de
  #define CD_HFMiddleLabl       0x27df
  #define CD_HFRightLabl        0x27e0

  #define CD_HeaderLabl         0x27e1
  #define CD_HeaderLeft         0x27c5
  #define CD_HeaderLeftBt       0x27c6
  #define CD_HeaderMiddle       0x27c7
  #define CD_HeaderMiddleBt     0x27c8
  #define CD_HeaderRight        0x27c9
  #define CD_HeaderRightBt      0x27ca

  #define CD_FooterLabl         0x27e2
  #define CD_FooterLeft         0x27cb
  #define CD_FooterLeftBt       0x27cc
  #define CD_FooterMiddle       0x27cd
  #define CD_FooterMiddleBt     0x27ce
  #define CD_FooterRight        0x27cf
  #define CD_FooterRightBt      0x27d0

  #define CD_DateFormatLabl     0x27e3
  #define CD_DateFormat         0x27d1
  #define CD_DateFormatBt       0x27d2

  #define CD_NormalHFLabl       0x27e4
  #define CD_NormalHFRadio      0x27d3
  #define CD_NormalHFBt         0x27d4
  #define CD_BookHFLabl         0x27e5
  #define CD_BookHFRadio        0x27d5
  #define CD_BookHFBt           0x27d6
  #define CD_SpreadHFLabl       0x27e6
  #define CD_SpreadHFRadio      0x27d7
  #define CD_SpreadHFBt         0x27d8

  #define CD_BoldHF             0x27d9
  #define CD_ItalicHF           0x27da

  #define CD_SizeHFLabl         0x27e7
  #define CD_SizeHFDisp         0x27db
  #define CD_PercentageHFLabl   0x27e8

  #define CD_PrintSetup         0x27dc
  #define CD_PrintStyle         0x27dd

  /* Cookie handling menu: */

  #define CD_CookieReject       0x0000
  #define CD_CookiePrompt       0x0001
  #define CD_CookieAccept       0x0002

  /* JPEG handling menu: */

  #define CD_JPEGOS             0x0000
  #define CD_JPEGBoth           0x0001
  #define CD_JPEGInternal       0x0002

  /* Referer header menu: */

  #define CD_RefererNever       0x0000
  #define CD_RefererAlways      0x0001
  #define CD_RefererWhenHTTP    0x0002

  /* URI usage menu: */

  #define CD_URINever           0x0000
  #define CD_URIProcOnly        0x0001
  #define CD_URIBroadUk         0x0002
  #define CD_URIProcAndBroad    0x0003
  #define CD_URIProcAndEvery    0x0004

  /* Display menu: */

  #define CD_DispDesc           0x0000
  #define CD_DispURL            0x0001

  /* Save menu: */

  #define CD_SaveNever          0x0000
  #define CD_SaveOnExit         0x0001
  #define CD_SaveAlways         0x0002

  /* Table border menu: */

  #define CD_TableBorder2D      0x0000
  #define CD_TableBorderAuto    0x0001
  #define CD_TableBorder3D      0x0002
  #define CD_TableBorderNone    0x0003

  /* Plugin menu: */

  #define CD_PlugDont           0x0000
  #define CD_PlugRedraw         0x0001
  #define CD_PlugASAP           0x0002

  /* Time menu: */

  #define CD_TimeMinutes        0x0000
  #define CD_TimeHours          0x0001
  #define CD_TimeDays           0x0002
  #define CD_TimeWeeks          0x0003
  #define CD_TimeMonths         0x0004

  /* Script window opening behaviour menu: */

  #define CD_WinOpenAllow       0x0000
  #define CD_WinOpenQuery       0x0001
  #define CD_WinOpenSuppress    0x0002
  #define CD_WinOpenReplace     0x0003

  /* Script window closing behaviour menu: */

  #define CD_WinCloseAlways     0x0000
  #define CD_WinCloseSometimes  0x0001
  #define CD_WinCloseQuery      0x0002
  #define CD_WinCloseSuppress   0x0003

  /* Header/footer date format menu: */

  #define CD_HFDate24Hour       0x0000
  #define CD_HFDate12Hour       0x0001
  #define CD_HFDateAMPM         0x0002
  #define CD_HFDateMinutes      0x0003
  #define CD_HFDateSeconds      0x0004
  #define CD_HFDateCentiseconds 0x0005
  #define CD_HFDateFullWeekday  0x0006
  #define CD_HFDateShortWeekday 0x0007
  #define CD_HFDateNumWeekday   0x0008
  #define CD_HFDateDayOfMonth   0x0009
  #define CD_HFDateOrdinalPS    0x000a
  #define CD_HFDateFullMonth    0x000b
  #define CD_HFDateShortMonth   0x000c
  #define CD_HFDateNumMonth     0x000d
  #define CD_HFDateCentury      0x000e
  #define CD_HFDateYear         0x000f
  #define CD_HFDateWeekOfYear   0x0010
  #define CD_HFDateDayOfYear    0x0011
  #define CD_HFDateTimezone     0x0012
  #define CD_HFDateExclaimation 0x0013
  #define CD_HFDatePercent      0x0014

  /* Header/footer text main menu: */

  #define CD_HFTextPageNumber   0x0000
  #define CD_HFTextTotalPages   0x0001
  #define CD_HFTextURL          0x0002
  #define CD_HFTextTitleBlank   0x0003
  #define CD_HFTextTitleURL     0x0004
  #define CD_HFTextDate         0x0005
  #define CD_HFTextHeadings     0x0006
  #define CD_HFTextExclaimation 0x0007

  /* Header/footer text sub-menu: */

  #define CD_HFSub123           0x0000
  #define CD_HFSubiii           0x0001
  #define CD_HFSubIII           0x0002
  #define CD_HFSubaaa           0x0003
  #define CD_HFSUbAAA           0x0004

  /* Page break menu: */

  #define CD_PBreakNever        0x0000
  #define CD_PBreakH1           0x0001
  #define CD_PBreakH2           0x0002
  #define CD_PBreakH3           0x0003
  #define CD_PBreakH4           0x0004
  #define CD_PBreakH5           0x0005
  #define CD_PBreakH6           0x0006

  /* Function prototypes */

  int               choices_to_be_shown        (int eventcode, ToolboxEvent * event, IdBlock * idb, void * handle);
  int               choices_hidden             (int eventcode, ToolboxEvent * event, IdBlock * idb, void * handle);

  _kernel_oserror * choices_close              (void);
  _kernel_oserror * choices_mode_change        (void);
  _kernel_oserror * choices_set_encoding_field (void);

#endif /* Browser_Choices__ */
@


1.23
log
@
64-wide comments adopted throughout. All headers protected against multiple
inclusion. Use of <> for external headers rather than "". For libraries,
<libname/header.h> is used rather than relying on a complex include path,
where appropriate. Move towards using external URILib rather than the local
copy. Phoenix JavaScript build resources are the only up to date set
currently so don't try others; more work still required on Makefile (e.g.
getting the ROM build working, and internationalisation issues).

Version 2.08. Not tagged
@
text
@d35 9
d73 4
d110 6
d119 1
a119 1
  #define CDNoSubwindows        10
d189 1
a189 3
  /* The Display fields must have component id one */
  /* less than their equivalent menu buttons and   */
  /* be in the same subwindow.                     */
d263 3
a265 2
  /* The URIHandlerDisp component must have a component id */
  /* one less than the URIHandlerBt component.             */
d271 1
a271 4
  #define CD_MSIE4StyleTables   0x278a

  /* The CookieDisp component must have a component id */
  /* one less than the CookieBt component.             */
d277 1
a277 2
  /* The JPEGDisp component must have a component id */
  /* one less than the JPEGBt component.             */
d283 2
d289 1
a289 2
  /* The RefererDisp component must have a component id */
  /* one less than the RefererBt component.             */
a309 3
  /* The WinOpenDisp component must have a component ID one */
  /* less than the WinOpenBt component.                     */

a313 3
  /* The WinCloseDisp component must have a component ID one */
  /* less than the WinCloseBt component.                     */

d353 56
d446 7
d481 53
d540 1
a540 1

a541 1
  _kernel_oserror * choices_mode_change        (void);
@


1.22
log
@Misecllaneous tweaks and fixes. Major addition is full header and footer
support in the printing system - see the Phoenix Choices file for more
information.

Only the Phoenix resources are up to date currently.
@
text
@d15 398
a412 386
/***************************************************/
/* File   : Choices.h                              */
/*                                                 */
/* Purpose: Functions relating to the Choices      */
/*          dialogue box and related sub windows.  */
/*                                                 */
/* Author : D.T.A.Brown                            */
/*                                                 */
/* History: 23-Sep-97: Created.                    */
/***************************************************/

/* Choices main dialogue component IDs */

#define CDSet                 0x2600
#define CDCancel              0x2601
#define CDSaveButton          0x2602
#define CDFirstSubRadio       0x2603
#define CDPlaceHolder         0x260f

/* Choices main dialogue and menu event codes */

#define ECDSet                0x2600
#define ECDCancel             0x2601
#define ECDSaveButton         0x2602

#define ECDToBeShown          0x27ff
#define ECDHidden             0x27fe
#define ECDRG2                0x27fd
#define ECDSaveMenuClick      0x27fc
#define ECDDispMenuClick      0x27fb
#define ECDPlugMenuClick      0x27fa
#define ECDTimeMenuClick      0x27f9
#define ECDBordMenuClick      0x27f8
#define ECDHiRadioClick       0x27f7
#define ECDURIMenuClick       0x27f6
#define ECDCookieMenuClick    0x27f5
#define ECDJPEGMenuClick      0x27f4
#define ECDRefererMenuClick   0x27f3
#define ECDWinOpenMenuClick   0x27f1
#define ECDWinCloseMenuClick  0x27f0

/* Some sub-windows may want to send this event when closing, */
/* e.g. any which lead to a List dialogue box being opened.   */

#define ECD_SubWindowToClose  0x27f2

/* Choices subwindows event codes */

#define ECD_EncodingMenuBt    0x2656

#define ECD_ColourButton      0x2690
#define ECD_FontButton        0x26b0

#define ECD_HlSaveBt          0x26d1
#define ECD_HlDispBt          0x26d3
#define ECD_HiSaveBt          0x26f1
#define ECD_HiDispBt          0x26f3
#define ECD_HiImSaveBt        0x2729
#define ECD_HiAgeTypeBt       0x26f8

#define ECD_ObjPlugBt         0x26c2

#define ECD_TabInnerBordBt    0x26c7
#define ECD_TabOuterBordBt    0x26ca

#define ECD_URIHandlerBt      0x2788
#define ECD_CookieBt          0x278d
#define ECD_JPEGBt            0x2790
#define ECD_RefererBt         0x2796

#define ECD_WinOpenBt         0x2798
#define ECD_WinCloseBt        0x27ba

/* Choices subwindows */

#define CDSubNone             -1
#define CDNoSubwindows        10

/* Choices Subwindow component ids */

/* In all cases there may only be one of each */
/* of these components.                       */

#define CD_Homepage           0x2650
#define CD_UnderlineLinks     0x2651
#define CD_UseDocColours      0x2652
#define CD_ShowForeground     0x2653
#define CD_ShowBackground     0x2654
#define CD_EncodingDisply     0x2655
#define CD_EncodingMenuBt     0x2656

#define CD_URLBar             0x2670
#define CD_StatusBar          0x2671
#define CD_ButtonBar          0x2672
#define CD_FullScreen         0x2673

#define CD_ClientPull         0x2674
#define CD_NetscapeEmu        0x2675
#define CD_FramesSupport      0x2676

/* The colour display button MUST have a component id */
/* one less than it's equivalent menu button and      */
/* be in the same subwindow.                          */

#define CD_BackColour         0x2690
#define CD_BackColourBt       0x2691
#define CD_TextColour         0x2692
#define CD_TextColourBt       0x2693
#define CD_LinkColour         0x2694
#define CD_LinkColourBt       0x2695
#define CD_UsedColour         0x2696
#define CD_UsedColourBt       0x2697
#define CD_FolwColour         0x2698
#define CD_FolwColourBt       0x2699
#define CD_SlctColour         0x269a
#define CD_SlctColourBt       0x269b

/* The window in which the fake page button resides */
/* must not be auto redraw.                         */

#define CD_FakePage           0x269c

/* The display fields must have component id one */
/* less than their equivalent menu buttons and   */
/* be in the same subwindow.                     */

#define CD_FontsTF1Disp       0x26b0
#define CD_FontsTF1Bt         0x26b1
#define CD_FontsTF2Disp       0x26b2
#define CD_FontsTF2Bt         0x26b3
#define CD_FontsTF3Disp       0x26b4
#define CD_FontsTF3Bt         0x26b5
#define CD_FontsSize          0x26b6
#define CD_FontsSystem        0x26b7
#define CD_FontsTF1Labl       0x26b8
#define CD_FontsTF2Labl       0x26b9
#define CD_FontsTF3Labl       0x26ba
#define CD_FontsSzLabl1       0x26bb
#define CD_FontsSzLabl2       0x26bc
#define CD_FontsGroup1        0x26bd
#define CD_FontsAspect        0x26be
#define CD_FontsAspectLabl1   0x26bf
#define CD_FontsAspectLabl2   0x2730
#define CD_FontsMinSize       0x2731
#define CD_FontsMinSizeLabl   0x2732

/* The Display fields must have component id one */
/* less than their equivalent menu buttons and   */
/* be in the same subwindow.                     */

#define CD_HlSaveDisp         0x26d0
#define CD_HlSaveBt           0x26d1
#define CD_HlDispDisp         0x26d2
#define CD_HlDispBt           0x26d3
#define CD_HlAutoOpen         0x26d4
#define CD_HlAutoScroll       0x26d5

#define CD_HiSaveDisp         0x26f0
#define CD_HiSaveBt           0x26f1
#define CD_HiDispDisp         0x26f2
#define CD_HiDispBt           0x26f3

#define CD_HiDontAge          0x26f4
#define CD_HiExpiryAgeLabl    0x26f5
#define CD_HiExpiryAge        0x26f6
#define CD_HiAgeTypeDisp      0x26f7
#define CD_HiAgeTypeBt        0x26f8

#define CD_HiDontSize         0x26f9
#define CD_HiMaxSizeLabl1     0x26fa
#define CD_HiMaxSize          0x26fb
#define CD_HiMaxSizeLabl2     0x26fc

#define CD_HiImDontAge        0x26fd
#define CD_HiImExpiryAgeLabl  0x26fe
#define CD_HiImExpiryAge      0x26ff
#define CD_HiImAgeTypeDisp    0x2720
#define CD_HiImAgeTypeBt      0x2721

#define CD_HiImDontSize       0x2722
#define CD_HiImMaxSizeLabl1   0x2723
#define CD_HiImMaxSize        0x2724
#define CD_HiImMaxSizeLabl2   0x2725

#define CD_HiRadPage          0x2726
#define CD_HiRadImage         0x2727

#define CD_HiImSaveDisp       0x2728
#define CD_HiImSaveBt         0x2729

/* The ObjPlugDisp component must have a component id */
/* one less than the ObjPlugBt component.             */

#define CD_ObjHandle          0x26c0
#define CD_ObjPlugDisp        0x26c1
#define CD_ObjPlugBt          0x26c2
#define CD_ObjPlugLabl        0x26c3

/* Tables stuff (currently in objects window)         */

#define CD_TabSupport         0x26c4
#define CD_TabInnerBordLabl   0x26c5
#define CD_TabInnerBordDisp   0x26c6
#define CD_TabInnerBordBt     0x26c7
#define CD_TabOuterBordLabl   0x26c8
#define CD_TabOuterBordDisp   0x26c9
#define CD_TabOuterBordBt     0x26ca

#define CD_NetUseProxy        0x2700
#define CD_NetProxyAddr       0x2701
#define CD_NetProxyLabl       0x2702
#define CD_NetLaunchProxy     0x2703
#define CD_NetMaxImageFetch   0x2704

#define CD_RefoWait           0x2780
#define CD_RefoKeep           0x2781
#define CD_RefoHold           0x2782

#define CD_RefoTimeLabl       0x2783
#define CD_RefoTimeDisp       0x2784
#define CD_RefoTimeLabl2      0x2785

/* The URIHandlerDisp component must have a component id */
/* one less than the URIHandlerBt component.             */

#define CD_URIHandlerLabl     0x2786
#define CD_URIHandlerDisp     0x2787
#define CD_URIHandlerBt       0x2788

#define CD_MSIE4StyleTables   0x278a

/* The CookieDisp component must have a component id */
/* one less than the CookieBt component.             */

#define CD_CookieLabl         0x278b
#define CD_CookieDisp         0x278c
#define CD_CookieBt           0x278d

/* The JPEGDisp component must have a component id */
/* one less than the JPEGBt component.             */

#define CD_JPEGLabl           0x278e
#define CD_JPEGDisp           0x278f
#define CD_JPEGBt             0x2790

#define CD_NoScrollBars       0x2791
#define CD_DragToScroll       0x2792
#define CD_ShowMayScroll      0x2793

/* The RefererDisp component must have a component id */
/* one less than the RefererBt component.             */

#define CD_RefererLabl        0x2794
#define CD_RefererDisp        0x2795
#define CD_RefererBt          0x2796

/* Yet more options, with some unconditional JS stuff */
/* because these are just definitions allocating      */
/* component id space.                                */
/*                                                    */
/* The JS components must all be in the same window   */
/* (see function choices_set_js_all_greyed).          */

#define CD_JSTimeoutLabl      0x2799
#define CD_JSTimeoutDisp      0x27a0
#define CD_JSTimeoutLabl2     0x27a1

#define CD_SupportJS          0x27a3
#define CD_JSWatchdog         0x27a4
#define CD_JSNavAsNav         0x27a5

/* The WinOpenDisp component must have a component ID one */
/* less than the WinOpenBt component.                     */

#define CD_JSWinOpenLabl      0x27b7
#define CD_JSWinOpenDisp      0x2797
#define CD_JSWinOpenBt        0x2798

/* The WinCloseDisp component must have a component ID one */
/* less than the WinCloseBt component.                     */

#define CD_JSWinCloseLabl     0x27b8
#define CD_JSWinCloseDisp     0x27b9
#define CD_JSWinCloseBt       0x27ba

#define CD_JSErrorBoxes       0x27bb

#define CD_JSOpenCloseLabl    0x27bc

/* Not to be confused with scripting, these are for the image */
/* RAM cache garbage collection scheme.                       */

#define CD_GCAfterNewFetch    0x27a6

#define CD_GCUnusedLimitLabl  0x27a7
#define CD_GCUnusedLimitDisp  0x27a8
#define CD_GCUnusedLimitLabl2 0x27a9

#define CD_GCFreeLimitLabl    0x27aa
#define CD_GCFreeLimitDisp    0x27ab
#define CD_GCFreeLimitLabl2   0x27ac

/* Buttons that open the List dialogue with varied contents */

#define CD_ExcludeHTTPBt      0x27ad
#define CD_ExcludeFTPBt       0x27ae
#define CD_ExcludeAnyBt       0x27af
#define CD_CookieAcceptBt     0x27b0
#define CD_CookieRejectBt     0x27b1
#define CD_NoImagesBt         0x27b2
#define CD_NoPlugInsBt        0x27b3
#define CD_NoScriptsBt        0x27b4
#define CD_NoTablesBt         0x27b5

/* Even more choices. Fortunately, minimal code support is */
/* typically required.                                     */

#define CD_PreserveWidth      0x27a2
#define CD_StripExtensions    0x27b6

/* Cookie handling menu: */

#define CD_CookieReject       0x0000
#define CD_CookiePrompt       0x0001
#define CD_CookieAccept       0x0002

/* JPEG handling menu: */

#define CD_JPEGOS             0x0000
#define CD_JPEGBoth           0x0001
#define CD_JPEGInternal       0x0002

/* Referer header menu: */

#define CD_RefererNever       0x0000
#define CD_RefererAlways      0x0001
#define CD_RefererWhenHTTP    0x0002

/* URI usage menu: */

#define CD_URINever           0x0000
#define CD_URIProcOnly        0x0001
#define CD_URIBroadUk         0x0002
#define CD_URIProcAndBroad    0x0003
#define CD_URIProcAndEvery    0x0004

/* Display menu: */

#define CD_DispDesc           0x0000
#define CD_DispURL            0x0001

/* Save menu: */

#define CD_SaveNever          0x0000
#define CD_SaveOnExit         0x0001
#define CD_SaveAlways         0x0002

/* Plugin menu: */

#define CD_PlugDont           0x0000
#define CD_PlugRedraw         0x0001
#define CD_PlugASAP           0x0002

/* Time menu: */

#define CD_TimeMinutes        0x0000
#define CD_TimeHours          0x0001
#define CD_TimeDays           0x0002
#define CD_TimeWeeks          0x0003
#define CD_TimeMonths         0x0004

/* Script window opening behaviour menu: */

#define CD_WinOpenAllow       0x0000
#define CD_WinOpenQuery       0x0001
#define CD_WinOpenSuppress    0x0002
#define CD_WinOpenReplace     0x0003

/* Script window closing behaviour menu: */

#define CD_WinCloseAlways     0x0000
#define CD_WinCloseSometimes  0x0001
#define CD_WinCloseQuery      0x0002
#define CD_WinCloseSuppress   0x0003

/* Function prototypes */
d414 1
a414 2
int               choices_to_be_shown        (int eventcode, ToolboxEvent * event, IdBlock * idb, void * handle);
int               choices_hidden             (int eventcode, ToolboxEvent * event, IdBlock * idb, void * handle);
d416 2
a417 1
_kernel_oserror * choices_close              (void);
d419 1
a419 2
_kernel_oserror * choices_set_encoding_field (void);
_kernel_oserror * choices_mode_change        (void);
@


1.21
log
@Long overdue check-in of intermediate browser build, from continued "out
of hours" work. Forgot to add a few files last time too.

List dialogue box handler complete, and exclusion lists implemented
within the main browser code. Full documentation in Choices file.
Save routine knows all about it but is now getting very slow - must
come up with a better scheme; for now, it puts the hourglass on...

StripExtensions option controls auto stripping of filename extensions.

More sensible ancestor / frame selection for keyboard shortcut items
and the save dialogues - having selected a frame won't lock you into
it for F3 and related shortcuts now (input focus in URL writable ->
get ancestor details, input focus in frame -> get frame details). F4
works in frames. F5 now generally present for 'view source' with a
corresponding menu entry in the File menu.

Odd thing in later Res files; there's no action set for Adjust clicks
on the main ToolAction items in the button bar. Very odd. Nothing
appears to be set in v2.07 either, yet adjust-click works. Even
stranger. Anyway, added in the relevant event details (same as for
Select click in all cases) and this fixes the problem.

Background colours in the TABLE tag ignored the "don't print any
backgrounds" Print Style setting. Fixed. Meanwhile, the "black
text with no backgrounds" option wasn't getting this right either;
fixed this also.

Event logging implemented; HTTP errors and script output via.
window.print extension. No internal error output yet.

Faith:Never behaviour extended. If ever a server sends something with
no content type or an unhandleable type, the browser will try and get a
filetype from the URL. If it gets text or HTML, it'll render the file.
Else it'll save it. Hacks around IIS 4's lack of a content type field
in the Marketeye login stuff, and similar other slightly broken sites.
@
text
@d53 2
a65 1

a69 1

a71 1

a72 1

d85 3
a268 1

a276 3
/*                                                    */
/* Note the gap at 0x2797 and 0x2798 - no special     */
/* reason; these can be used by any new components.   */
a281 2
#define CD_PreserveWidth      0x27a2

d286 21
d329 2
a330 2
/* And on, and on... Featuritis, anyone? Still, minimal code */
/* support is required for many options.                     */
d332 1
d385 14
@


1.20
log
@Intermediate check-in; building a browser from this gives you something
between 2.07 and 2.08. Only the Phoenix JavaScript resources are fully
up to date.

I *think* these are the changes since the last check-in:

When saved as a Draw file, horizontal rules were plotted one page width
too far to the right (wonder when that started happening?!). Fixed. In
addition, DrawFiles now accepted as OBJECTs - they weren't in the
recognised filetype list before. Doh.

Table size calculator tables_count_table would overestimate the number
of cells where ROWSPAN was present and there were other rows below the
one spanned. Fixed. In certain odd cases (e.g. optimised image exports
as HTML tables (!!) from the Gimp) this can save vast amounts of RAM.

Fixed problem where printing stops in the middle of a document. Redraw
engine pagination code was written in the days where lines couldn't
have gaps between them; they can now. If a gap fell at the bottom of
a page the engine would look down, see no line straddling or touching
the page edge, and assume there was nothing more. This case is now
correctly handled.

Made sure desktop and testbed Browse Res files had up-to-date Encoding
menus (v2.07 Phoenix has different menus from v2.07 Browse by oversight).

URL auto-completion piggy-backed onto manual completion code; any string
without '.', '/' or ':' in it gets run through completion to see if a
more meaningful item can be produced - "www" special cased out though.

New List dialogue box handler, used for proxy exclusions etc.
(incomplete), complete with appropriate Res file objects.
@
text
@d54 5
a270 11
/* Buttons that open the List dialogue with varied contents */

#define CD_ExcludeHTTPBt      0x27ad
#define CD_ExcludeFTPBt       0x27ae
#define CD_ExcludeAnyBt       0x27af
#define CD_CookieAcceptBt     0x27b0
#define CD_CookieRejectBt     0x27b1
#define CD_NoImagesBt         0x27b2
#define CD_NoPlugInsBt        0x27b3
#define CD_NoScriptsBt        0x27b4

d285 2
a290 2
#define CD_PreserveWidth      0x27a2

d300 17
@


1.19
log
@Tweaks to export rules in Makefile - ResJ source for JavaScript builds,
all of User dir exported, resources rule exports About as well as User.

Handles images with a width or height of 0 specified in the HTML.
Previously went for a default size placeholder and changes to image
sizes and/or redraw problems could occur before/after subsequent
reformatting (involved trivial changes to image_get_image_size and
image_redraw_area only).

Default parameter HRs now plot properly in rectangular pixel modes.

Choices code updated to cope with the minimum font size, JS support,
watchdog on/off and timeout, Navigator object option added generally
(act even *more* like Navigator), image GC after fetch, and image
GC unused image / free RAM constraints.

Code in JSnavigator.c updated to obey new "act more like Navigator"
option (see above). Currently declares itself as version 3.0.

Resources for all builds are up to date. All links in default hotlist
verified and corrected where necessary, with several new links added.

This is Release v2.07. Not tested very much, sorry; YMMV.
@
text
@d85 1
a85 1
#define CDNoSubwindows        9
d265 11
@


1.18
log
@Everyone else seems to be checking lots of stuff in lately, so I've
decided to join in. This is an intermediate check-in and so not all
resources etc. will be up to date. You should be able to make Phoenix
and a debug build out of it. As a reminder, to make a JavaScript build:

 * Build JSLib and NSPRLib. Recommend you leave -DUSEMEMLIB in there (as
   used by default) so you can watch it leak into a dynamic area... :-)
   If you do this, you'll need to build MemLib too, of course. If you
   do NOT use MemLib, *undefine JS_USING_MEMLIB in Main.c*!
 * Run !MkClean. This now strips dynamic dependencies from the MakeFile
   automatically, to save you having to do it yourself.
 * Run one of the TaskObey files with the "J" suffix, e.g. !DeskBrwsJ -
   this uses the same .o directory for object files and exports to the
   same position in the Targets directory as the non-JavaScript build,
   but it does produce a unique binary in 'abs' and symbols table in
   'syms'.
 * Sourcing an appropriate !Run (with increased WimpSlot value), !Boot
   and About resource is done automatically.
 * Some, but not all of the !xxxD (debug) TaskObey files will make
   JavaScript versions in passing - check the JSUFFIX value on the Make
   command line parameters in the file.

This'll only work on RISC OS 3.1 due to the use of MemLib.

Here's the change list:

Included MNG icons in sprites files; added Sprites23 for some builds.
Added in ANT URL file icon (b28) derived from URI file icon, because
the Save dialogue can need it.

No, you do *not* need to define the same keyboard shortcuts in each
frame since the ancestor keeps the input focus and we've basically
dropped non-nested Wimp support. Maintaining no less than 4 lists of
identical shortcuts was a pain. Some Res files now only have the
lists in the main browser window and button bar objects (these two
are both required still).

Ursula build Markers button arrangement changed from 1x3 horizontal to
2x2 tilted, as in Phoenix, by popular demand.

Couple of hotlist bugs fixed; dragging an item and deleteing it with
Ctrl+X didn't terminate the drag, and deleteting an item underneath a
menu opened for it didn't close the menu.

'SendReferer' option added to all Choices files, all set to 'always'.
Put just beneath 'Clone' as it refers to header items, though really,
both Clone and SendReferer should probably be in the "Fetch controls"
section rather than "Multiuser environments and proxying"! Front-end
control of this is available.

In image_export_original, save_save_source, save_transfer_source and
save_save_object, flex_set_budge(0) was called to lock the heap but the
return value wasn't stored. flex_set_budge(1) was then used to unlock
the heap. All calls now remember and restore the old value, which is
both safer in case one calls another and allows the flex_set_budge
call in Main.c to have an application-wide meaning, as intended.

Some restructuring to the data load and RAM transfer sections of
Protocols.c; remote hotlist builds wouldn't allow files to be loaded
to browser windows before, and can now drop URL, URI or text files to
the Open URL dialogue.

New option "MinimumFontSize", lets the 'size' attribute of the 'font'
element be overridden. Default value is 1, to allow the full range of
values for the attribute. Setting to 7, for example, would give font
size 7 text at all times. Another new option, "ToggleOnXOnly", to
make Toggle Size only extend the window vertically (with Ctrl then
being used to toggle to genuine full size, rather than vice versa).
All Choices files updated to hold both of these options; only the
first has front-end control available (see debug build Res file).

JavaScript Document object exists; frames array etc. working. Can now
just about use "http://www.acorn.com/~ahodgkin/jschain/" but it does
abort after a bit - problems with frames again, I suspect. Is is pretty
slow, too. Can now press Escape to terminate a script.

Main.c erroneously referred to Controls file entry "StopWebServe" as
"StopWebProxy". Fixed.

Keyboard shortcuts to raise SaveFile are now possible in a general sense;
the code before was in the ToBeShown handler and just checked for a parent
component of -1. It then assumed "save frame HTML source". Now there's the
savefile_raise_from_shortcut function, which together with the seven new
event codes in SaveFile.h allows saving of HTML source and frame location,
export of links, images, backgrounds and the page as text or draw, to all
be invoked by keyboard shortcuts. Some Res files have some of these defined.

In reformat_check_height, the first check to see if setpara should be set
references a field in tpLast without checking if it is NULL. Whilst the
'line > 0' check should mean that tpLast wasn't NULL anyway, a direct
call to the function from outside of the reformatter might have tripped
up on this - the check for tpLast != NULL is now made.

Adjust-click on close icon in window showing file: URL attempts to open
the parent Filer window.

Reformatter used to try and find a selectable token if keyboard control
was enabled in a really stupid place - could make reformatting become
very slow if no selectables were present, especially if the page had a
few tables on it. Preprocessor now does this (since it goes through all
of the tokens anyway), the reformatter just doing a last check to ensure
no frames have obscured the selectable and if so, it tries to move it.
Done in the reformatter as generating a line array implies the data really
is visible.

Ctrl+Tab URL completion now builds a full list of matches from the hotlist
and history and can cycle through them (Ctrl+Shift+Tab stepping backwards).

Will give a real error rather than just "Data Abort" if it goes wrong
now. Someone somewhere is setting bit 30 of the error which confused
the replacement signal handler. Flag bits are now masked off (as they
should've been to start with).
@
text
@a91 2
/* In BrowseDefaults sub window: */

a99 2
/* In Windows sub window: */

a108 2
/* In colours sub window: */

a130 2
/* In fonts subwindow */

a154 2
/* In hotlist subwindow */

a165 2
/* In history subwindow */

a198 2
/* In Objects subwindow */

a216 2
/* In network subwindow */

a222 2
/* Newer options...! Naming derived from associated Choices file entry */

d263 1
d265 30
@


1.17
log
@All !Run[D], Choices, Messages, Controls and Res files are up to date.

RefoKeep and RefoHold options added to, respectively, try and maintain
the line at the top of the visible area when reformatting, and not shrink
the vertical extent at the start of a reformat to try and avoid flicker
to the top of the page and back down again when RefoKeep is on. Choices
front-end implemented, which also allows RefoWait and RefoTime to be set.
Unfortunately for various reasons this doesn't help the page jumping when
unsized images come in (but RefoHold can improve matters...) - roll on
the image history.

DragToScroll and NoScrollBars options added for frames; included new
pointer type, Mouse_Shape_DTS, so relevant Controls file entries done
and Sprites[22] files updated as required. Noticed some builds have
a low-res ptr_link with a mask - mask removed.

Named anchor following fixed up somewhat - anchors near the bottom of
the page shouldn't be displayed, and then pulled down when the fetcher
releases null polls and ensures the y extent is correct (this through
implementing the min_height field in the browser_data structure).

RefoHang was never implemented and there seems little point to it now,
so the entry for it has been removed from the global choices structure
and all Choices files.

Markers menus should work properly now (in last check-in they would not
update correctly if Adjust was used on the entries).

URI handler usage now a lot more sensible, with configuration of how the
browser uses the module from both a Utils menu submenu (sic) and the
Choices dialogue.

Slightly dodgy 'hang around waiting for user input' stuff for the Cookies
dialogue box: All fetches are suspended; the fetcher remembers some info
about its state at the time the cookie came in, and restores it later; it
will only do this for one fetch at a time. It's necessary to single-thread
the fetcher at this point anyway, since other fetches may have a
dependency on the cookie that is hanging in mid-air at that point. As part
of this, some of the fetcher code has been split out into separate
functions (to try and 'black box' the code a bit). Anyway, Cookie Query
dialogue box now implemented with appropriate Choices file entry and
UI work in the Choices dialogue box.

Phoenix build Choices rearranged. Can now choose when the image history
is saved from the front end. Added also MSIE 4-style table option menu
for JPEG support (OS only, OS if it can handle it, internal only).

Should be a bit faster at loading the history - though 95% of the time
is spent in SWI URL_ParseURL. URL descriptions are stored more
efficiently as part of this - one malloc block instead of several
small blocks. The minimum block size for malloc blocks typically leads
to a significantly smaller startup wimpslot depending on the visit
history size.

Nasty bug in image system fixed. If an image size came in and a reformat
was to take place, the line the image lies in is found and the reformat
progresses from there. Unforunately, this didn't check to see if the
token can't be found in the line list, so it'd reformat from the top
of the page...! This would happen if, for example, an image halfway down
the page came in whilst a reformat for an image higher up had just begun.

In Choices.c, made choices_set_timetype_field, choices_set_uri_field,
choices_set_plugin_field, choices_set_cookie_field, and
choices_set_jpeg_field static (so they're not declared in Choices.h now).

Two memory leaks plugged in URL comparison routines in URLutils.c
(calling free() url_description instead of urlutils_free_descripton()).

Client pull reload handler was setting the reload flag if reloading
the same page, but forgetting to turn on reload_lock so
fetchpage_postprocessed was clearing the reload state... Similarly,
Ctrl+Shift+SELECT-Click on a link when the Controls file 'UseSmall'
entry is 'no' would not have reloaded as it should. Both fixed.

Frames shouldn't be so keen on acquiring horizontal scroll bars and never
letting them go when their width is decreased now. Frames set up for
'scrolling="yes"' will not start with no scroll bars and then gain them
shortly afterwards, causing flicker and two reformats - they'll start
with, and continue to hold, both scroll bars.

Pointer shouldn't flicker when over a frame border whilst other fetches
are progressing now.
@
text
@d52 1
d80 1
a80 1

d160 2
d276 7
d294 6
@


1.16
log
@Programming warehouse link removed from all hotlists - the page has gone.

Some compile-time hacks in place to use MemLib, a dynamic area based
malloc replacement which shrinks its heap when possible. All builds
have these switched off at the moment. Seemed to work with just Browse,
though there would be problems with message blocks stored in dynamic
areas because of the Wimp's '&3800000' check - however, it failed when
HTMLLib was made to use it, too. Don't know why yet.

ItemInfo.[c/h] source added, with Res file additions for testbed Browse
and Phoenix.

Small fetch windows now work properly regardless of toolbar settings
in the Choices.

Reload now reloads all images too, rather than only reloading them for
as long as the main page was being fetched.

Added a simple 'Find' facility.

Realised that event handlers in eventlib are called in reverse order
of registration, so the miscellaneous event handler is now registered
first rather than last.

Multiuser code added (most only active if SINGLE_USER is undefined). As
part of this, hotlist code now knows about read-only items (done for the
Customer-style 'Resources' file, but works generally anyway).
handle_add_hotlist doesn't try to save the hotlist itself anymore (the
hotlist_add function does all that through hotlist_modified anyway).

Customer build Choices and Controls updated slightly (e.g. ClaimHelp
off, hotlist to save on quit only).

Customer build now uses Phoenix-style buttons. Sprites files which
worked at the time (but will probably be out of date now) and included
most of the original Customer-style sprites are in
'Utils.Icons.Customer'.

Choices, Messages and Res files for all builds now stripped down to only
single user items or single plus multiuser for Customer build and testbed
build. Before, all contained a few multiuser bits in at least the Choices
file if not more.

Grammatical error ("Fetching frames contents" (sic.)) corrected in
default message, Toolbars.c, and all of the Messages files.

Customer build brought back to a servicable level (including
implementation of the Find dialogue box with animation and fixing
up authorisation and 'Stop' state in the tristate). Quite a few
missing #ifndef REMOTE_HOTLIST bits from hotlist code added...

Customer build will not use <Choices$Write> or Boot:Choices for any
file finding now. UseProxy defaults to 'yes', MaxImages to 2. Res
file includes Proxy Address setting (save_save_choices() now writes
the ProxyAddress line).
@
text
@d49 3
d67 2
d76 5
d205 3
d236 57
a325 1
_kernel_oserror * choices_set_plugin_field   (void);
@


1.15
log
@Added max image fetches choice.
@
text
@d248 1
a248 2
extern global_choices * new_choices;
extern ObjectId         choices_windowid;
d252 3
d256 1
@


1.14
log
@Implemented Launch Proxy option.
@
text
@d221 1
@


1.13
log
@Made TT aspect choice work with system font.
@
text
@d220 1
@


1.12
log
@Implemented TT aspect ratio choice.
@
text
@d147 2
a148 1
#define CD_FontsAspectLabl    0x26bf
@


1.11
log
@Implemented size and age expiry of image history.  There are two ways of
achieving this.

i)  There can be two sets of gadgets, one set for page history and another set
    for image history.

ii) There can be one set of gadgets for both settings and two radio buttons to
    select between them.

Only one of these may be present at the same time.  Currently the radio button
version is the one that is in place.  To change to the other version delete the
radio buttons and copy the gadgets from the ChoicesTMP window into the
appropriate window.
@
text
@d146 2
@


1.10
log
@Implemented history expiry and table border choices.
@
text
@d48 1
d177 14
@


1.9
log
@Added system font option to choices.
Stopped UNIFONT forcing system font use and added calls to Font_WideFormat.
Made sure the system font option is read before fm_init is called!

User agent string now set if Netscape faking is disabled (format used is
"Acorn Browse/1.26 (RISC OS 3.71)".
@
text
@d28 5
a32 5
#define CDSet              0x2600
#define CDCancel           0x2601
#define CDSaveButton       0x2602
#define CDFirstSubRadio    0x2603
#define CDPlaceHolder      0x260f
d36 12
a47 10
#define ECDSet             0x2600
#define ECDCancel          0x2601
#define ECDSaveButton      0x2602

#define ECDToBeShown       0x27ff
#define ECDHidden          0x27fe
#define ECDRG2             0x27fd
#define ECDSaveMenuClick   0x27fc
#define ECDDispMenuClick   0x27fb
#define ECDPlugMenuClick   0x27fa
d51 1
a51 1
#define ECD_EncodingMenuBt 0x2656
d53 1
a53 1
#define ECD_ColourButton   0x2690
d55 1
a55 1
#define ECD_FontButton     0x26b0
d57 2
a58 2
#define ECD_HlSaveBt     0x26d1
#define ECD_HlDispBt     0x26d3
d60 2
a61 2
#define ECD_HiSaveBt     0x26f1
#define ECD_HiDispBt     0x26f3
d63 6
a68 1
#define ECD_ObjPlugBt    0x26c2
d72 2
a73 2
#define CDSubNone          -1
#define CDNoSubwindows      9
d82 7
a88 7
#define CD_Homepage       0x2650
#define CD_UnderlineLinks 0x2651
#define CD_UseDocColours  0x2652
#define CD_ShowForeground 0x2653
#define CD_ShowBackground 0x2654
#define CD_EncodingDisply 0x2655
#define CD_EncodingMenuBt 0x2656
d92 8
a99 8
#define CD_URLBar        0x2670
#define CD_StatusBar     0x2671
#define CD_ButtonBar     0x2672
#define CD_FullScreen    0x2673

#define CD_ClientPull    0x2674
#define CD_NetscapeEmu   0x2675
#define CD_FramesSupport 0x2676
d107 12
a118 12
#define CD_BackColour   0x2690
#define CD_BackColourBt 0x2691
#define CD_TextColour   0x2692
#define CD_TextColourBt 0x2693
#define CD_LinkColour   0x2694
#define CD_LinkColourBt 0x2695
#define CD_UsedColour   0x2696
#define CD_UsedColourBt 0x2697
#define CD_FolwColour   0x2698
#define CD_FolwColourBt 0x2699
#define CD_SlctColour   0x269a
#define CD_SlctColourBt 0x269b
d123 1
a123 1
#define CD_FakePage     0x269c
d131 14
a144 14
#define CD_FontsTF1Disp 0x26b0
#define CD_FontsTF1Bt   0x26b1
#define CD_FontsTF2Disp 0x26b2
#define CD_FontsTF2Bt   0x26b3
#define CD_FontsTF3Disp 0x26b4
#define CD_FontsTF3Bt   0x26b5
#define CD_FontsSize    0x26b6
#define CD_FontsSystem  0x26b7
#define CD_FontsTF1Labl 0x26b8
#define CD_FontsTF2Labl 0x26b9
#define CD_FontsTF3Labl 0x26ba
#define CD_FontsSzLabl1 0x26bb
#define CD_FontsSzLabl2 0x26bc
#define CD_FontsGroup1  0x26bd
d152 6
a157 6
#define CD_HlSaveDisp   0x26d0
#define CD_HlSaveBt     0x26d1
#define CD_HlDispDisp   0x26d2
#define CD_HlDispBt     0x26d3
#define CD_HlAutoOpen   0x26d4
#define CD_HlAutoScroll 0x26d5
d161 15
a175 6
#define CD_HiSaveDisp   0x26f0
#define CD_HiSaveBt     0x26f1
#define CD_HiDispDisp   0x26f2
#define CD_HiDispBt     0x26f3
#define CD_HiLines      0x26f4
#define CD_HiMaxSize    0x26f5
d182 14
a195 4
#define CD_ObjHandle    0x26c0
#define CD_ObjPlugDisp  0x26c1
#define CD_ObjPlugBt    0x26c2
#define CD_ObjPlugLabl  0x26c3
d199 3
a201 3
#define CD_NetUseProxy  0x2700
#define CD_NetProxyAddr 0x2701
#define CD_NetProxyLabl 0x2702
d205 2
a206 2
#define CD_DispDesc     0x0000
#define CD_DispURL      0x0001
d210 3
a212 3
#define CD_SaveNever    0x0000
#define CD_SaveOnExit   0x0001
#define CD_SaveAlways   0x0002
d216 11
a226 3
#define CD_PlugDont     0x0000
#define CD_PlugRedraw   0x0001
#define CD_PlugASAP     0x0002
@


1.8
log
@Implemented proxy choices.
@
text
@d131 7
@


1.7
log
@Implemented font size choices.
@
text
@d164 6
@


1.6
log
@Minimal support for font choices added, fixed problem with colour changing with
browsers with no background colour specified.  Options for Objects implemented.
@
text
@d130 1
@


1.5
log
@Added Client pull, 'Netscape compatiblility' and frames support options.
@
text
@d45 1
d53 2
d61 2
d97 2
a98 1
/* one less than it's equivalent menu button.         */
d120 10
a129 1
#define CD_Fontsbits    0x26b0
d134 2
a135 1
/* less than their equivalent menu buttons.      */
d153 10
d173 6
@


1.4
log
@Choices now allows gadgets to be in any subwindow with some limitations which
are addressed in the header file.  Also there is no longer a concept of named
subwindows.
@
text
@d80 8
a87 4
#define CD_URLBar       0x2670
#define CD_StatusBar    0x2671
#define CD_ButtonBar    0x2672
#define CD_FullScreen   0x2673
@


1.3
log
@Res files had component 0x29fc in frame gadgets for Choices - that's
meant to be the 'fake page' display. Sorted that out.

Got rid of unnecessary #define in Choices.h; the gadget autodetect
for the colour choices took its place.

Unsized objects now default to the same dimensions as unsized images.
@
text
@d31 1
a31 11

#define CDBrowseDefaults   0x2603
#define CDWindows          0x2604
#define CDColours          0x2605
#define CDFonts            0x2606
#define CDHotlist          0x2607
#define CDHistory          0x2608
#define CDSub6             0x2609
#define CDSub7             0x260a
#define CDSub8             0x260b

a60 10
#define CDSubBrowseDefaults 0
#define CDSubWindows        1
#define CDSubColours        2
#define CDSubFonts          3
#define CDSubHotlist        4
#define CDSubHistory        5
#define CDSubSub6           6
#define CDSubSub7           7
#define CDSubSub8           8

d65 3
d87 3
d102 4
d113 3
@


1.2
log
@Choices 'fakepage' display added.
@
text
@a25 5
/* Define this if you want to display the Selected colour */
/* in the faked page.                                     */

#define ChoiceUseSelected

@


1.1
log
@Implemented dialogue based choices.
@
text
@d26 5
d121 3
d127 2
d136 2
d162 1
@
