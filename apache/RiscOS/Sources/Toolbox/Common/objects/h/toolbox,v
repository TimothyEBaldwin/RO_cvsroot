head	4.8;
access;
symbols
	Common-0_26-1:4.8
	Common-0_26:4.8
	Common-0_25:4.8
	Common-0_24:4.8
	Common-0_23:4.8
	Common-0_22:4.8
	Common-0_21:4.8
	Common-0_20:4.8
	Common-0_19:4.8
	Common-0_18:4.8
	Common-0_17:4.8
	Common-0_16:4.8
	Common-0_15:4.8
	Common-0_14:4.7
	RO_5_07:4.7
	Common-0_13:4.7
	Common-0_12:4.7
	dellis_autobuild_BaseSW:4.7
	Common-0_11:4.7
	Common-0_10:4.7
	Common-0_09:4.7
	Common-0_08:4.6
	sbrodie_sedwards_16Mar2000:4.6
	Common-0_07:4.6
	Common-0_06:4.6
	Common-0_05:4.6
	dcotton_autobuild_BaseSW:4.7
	Common-0_04:4.5
	Common-0_03:4.5
	Common-0_02:4.5
	Common-0_01:4.4
	mstphens_UrsulaRiscPCBuild_20Nov98:4.3
	sbrodie_Toolbox_Ursula_231198:4.3
	Ursula_RiscPC:4.3.0.4
	nicke_TBox_Common_20-9-98:4.3
	rthornb_UrsulaBuild-19Aug1998:4.3
	UrsulaBuild_FinalSoftload:4.3
	rthornb_UrsulaBuild-12Aug1998:4.3
	aglover_UrsulaBuild-05Aug1998:4.3
	rthornb_UrsulaBuild-29Jul1998:4.3
	rthornb_UrsulaBuild-22Jul1998:4.3
	rthornb_UrsulaBuild-15Jul1998:4.3
	rthornb_UrsulaBuild-07Jul1998:4.3
	rthornb_UrsulaBuild-17Jun1998:4.3
	sbrodie_commonlib_110698:4.3
	rthornb_UrsulaBuild-03Jun1998:4.3
	rthornb_UrsulaBuild-27May1998:4.3
	rthornb_UrsulaBuild-21May1998:4.3
	Ursula_bp:4.3
	Ursula:4.3.0.2
	Ursula_12May1998:4.2.0.4
	rthornb_UrsulaBuild_01May1998:4.2
	afrost_NC2_Generic:4.1.7.2
	Daytona:4.2.0.2
	Daytona_bp:4.2
	sbrodie_Expresso_final_190298:4.3
	sbrodie_Toolbox_Common_120298:4.3
	sbrodie_Expresso_BETA6_19980204:4.3
	Spinner_RCA116:4.1.7.2
	Spinner_B20_2:4.1.7.2
	Spinner_19_3:4.1.7.2
	Spinner_B18:4.1.7.2
	Spinner_B17:4.1.7.2
	Spin_merge_8Jul97:4.1.7.2
	Ursula_bp_8Jul97:4.2
	Spinner_B15:4.1.7.2
	Spinner_B14:4.1.7.2
	Spinner_B13:4.1.7.2
	Spinner_B12:4.1.7.2
	Spinner_B10:4.1.7.2
	Spin_merge_13May97:4.1.7.1
	Spinner_B7:4.1.7.2
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.2
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.2
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.8
date	2010.02.28.10.30.02;	author rsprowson;	state Exp;
branches;
next	4.7;

4.7
date	2000.05.04.12.14.55;	author sbrodie;	state Exp;
branches;
next	4.6;

4.6
date	99.11.16.17.02.07;	author sbrodie;	state Exp;
branches;
next	4.5;

4.5
date	99.02.16.16.57.46;	author sbrodie;	state Exp;
branches;
next	4.4;

4.4
date	99.01.18.12.19.13;	author sbrodie;	state Exp;
branches;
next	4.3;

4.3
date	98.02.04.19.47.30;	author sbrodie;	state Exp;
branches;
next	4.2;

4.2
date	97.05.13.09.11.34;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.21.58;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.21.58;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.19.39.55;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.13.10.13;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.19.35.29;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.02.04.17.17.31;	author pwombwel;	state Exp;
branches;
next	;


desc
@@


4.8
log
@Add a skeleton TextGadgets internal header file.
The error base and, where possible, error numbers are set to be the same as used in the RISC OS Ltd version of the TextGadgets module.

Version 0.15. Tagged as 'Common-0_15'
@
text
@/* Copyright 1996 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* File:    toolbox.h
 * Purpose: The RISC OS Toolbox module
 * Author:  Ian Johnson
 * History: 8-Dec-93: IDJ: created
 *          18-Apr-94: IDJ: removed options string from object hdr.
 *          02-Feb-97: EPW: Added Toolbox_ShowObject_AtPointer
 *          03-Feb-98: SNB: Added Service_ToolboxDying, Toolbox_BadMemoryReason, Toolbox_Memory_*
 *
 */


#ifndef __toolbox_h
#define __toolbox_h


/* --------------------------------------- fundamental types ------------------------------------------ */

typedef int            ObjectID;                 /* abstract Object ID (as used by client apps). */
typedef int            ComponentID;              /* component ID within an Object (eg gadget in Window) */
typedef int            ObjectClass;              /* the abstract class of an Object */

#define NULL_ObjectID    (ObjectID)0
#define NULL_ComponentID (ComponentID)-1


typedef struct                                   /* block filled in by Toolbox on Wimp Poll */
{
        ObjectID    ancestor_id;                 /* object's "ancestor" */
        ComponentID ancestor_component;
        ObjectID    parent_id;                   /* object's "parent" */
        ComponentID parent_component;
        ObjectID    self_id;                     /* object on which an event occurred */
        ComponentID self_component;
} IDBlock;



typedef struct
{
        int data [4];
} MessagesFD;                                    /* a MessageTrans file descriptor */





/* ----------------------------------------- Object templates ----------------------------------------- */

#define MAX_OBJECT_NAME 12

/* flags */

#define Object_CreateOnLoad      0x00000001
#define Object_ShowOnCreate      0x00000002
#define Object_Shared            0x00000004
#define Object_Ancestor          0x00000008

#define Object_ValidFlags        0x0000000f

/* template definition */

typedef struct                                    /* an object template header (after relocation) */
{
    ObjectClass        class_id;                  /* class of the object */
    int                flags;                     /* generic flags (see above) */
    int                version;                   /* object class module version */
    char               name[MAX_OBJECT_NAME];     /* name given to template for use in Toolbox_ObjectCreate */
    int                total_size;                /* size of whole object (inc header) */
    void              *body;                      /* object body (defined by object class module) */
    int                body_size;                 /* sizeof *body */
} ObjectTemplateHeader;


/* --------------------------------- Resource file format --------------------------------------------- */

#define ResourceFileVersion 101


typedef int StringReference;           /* offset into Object's string table */
typedef int MessageReference;          /* offset into Object's messages table */

/* relocations */

/* directives */

#define Relocate_StringReference     1
#define Relocate_MsgReference        2
#define Relocate_SpriteAreaReference 3
#define Relocate_ObjectOffset        4

typedef struct
{
        int             word_to_relocate;
        int             directive;

} Relocation;

typedef struct
{
        int             num_relocations;
        Relocation      relocations[1];
} RelocationTable;




/* Resource file header */

typedef struct
{
        int             file_id;         /* should be 'RESF' */
        int             version_number;  /* resource file version number * 100, eg 1.32 is 132 */
        int             object_offset;   /* byte offset of first template from start of file */
} ResourceFileHeader;


/* Resource file Object template */

typedef struct
{
        int                  string_table_offset;
        int                  message_table_offset;
        int                  relocation_table_offset;
        ObjectTemplateHeader hdr;

} ResourceFileObjectTemplateHeader;

/* ------------------------------------------- Toolbox SWIs ------------------------------------------- */

#define Toolbox_SWIChunkBase    0x44ec0

/* SWI Numbers */

#define Toolbox_CreateObject           (Toolbox_SWIChunkBase + 0)
#define Toolbox_DeleteObject           (Toolbox_SWIChunkBase + 1)
#define Toolbox_CopyObject             (Toolbox_SWIChunkBase + 2)
#define Toolbox_ShowObject             (Toolbox_SWIChunkBase + 3)
#define Toolbox_HideObject             (Toolbox_SWIChunkBase + 4)
#define Toolbox_GetObjectState         (Toolbox_SWIChunkBase + 5)
#define Toolbox_ObjectMiscOp           (Toolbox_SWIChunkBase + 6)
#define Toolbox_SetClientHandle        (Toolbox_SWIChunkBase + 7)
#define Toolbox_GetClientHandle        (Toolbox_SWIChunkBase + 8)
#define Toolbox_GetObjectClass         (Toolbox_SWIChunkBase + 9)
#define Toolbox_GetParent              (Toolbox_SWIChunkBase + 10)
#define Toolbox_GetAncestor            (Toolbox_SWIChunkBase + 11)
#define Toolbox_GetTemplateName        (Toolbox_SWIChunkBase + 12)
#define Toolbox_RaiseToolboxEvent      (Toolbox_SWIChunkBase + 13)
#define Toolbox_GetSysInfo             (Toolbox_SWIChunkBase + 14)
#define Toolbox_Initialise             (Toolbox_SWIChunkBase + 15)
#define Toolbox_LoadResources          (Toolbox_SWIChunkBase + 16)

#define Toolbox_Memory                 (Toolbox_SWIChunkBase + 57)
#define Toolbox_DeRegisterObjectModule (Toolbox_SWIChunkBase + 58)
#define Toolbox_TemplateLookUp         (Toolbox_SWIChunkBase + 59)
#define Toolbox_GetInternalHandle      (Toolbox_SWIChunkBase + 60)
#define Toolbox_RegisterObjectModule   (Toolbox_SWIChunkBase + 61)
#define Toolbox_RegisterPreFilter      (Toolbox_SWIChunkBase + 62)
#define Toolbox_RegisterPostFilter     (Toolbox_SWIChunkBase + 63)


/* flags for Toolbox_GetSysInfo */

#define Toolbox_GetSysInfo_TaskName                      0
#define Toolbox_GetSysInfo_MessagesFD                    1
#define Toolbox_GetSysInfo_DirName                       2
#define Toolbox_GetSysInfo_TaskHandle                    3
#define Toolbox_GetSysInfo_SpriteArea                    4


/* flags for Toolbox_CreateObject */

#define Toolbox_CreateObject_InCore             0x00000001


/* flags for Toolbox_DeleteObject */

#define Toolbox_DeleteObject_DontRecurse        0x00000001


/* flags for Toolbox_CopyObject */

#define Toolbox_CopyObject_DontRecurse          0x00000001


/* return values for Toolbox_GetObjectState */

#define Toolbox_GetObjectState_Showing         0x00000001


/* flags for Toolbox_RegisterPreFilter */

#define Toolbox_RegisterPreFilter_Remove        0x00000001


/* flags and types for Toolbox_RegisterPostFilter */

#define Toolbox_RegisterPostFilter_Remove       0x00000001
#define Toolbox_RegisterPostFilter_WimpEvent             1
#define Toolbox_RegisterPostFilter_WimpMessage           2
#define Toolbox_RegisterPostFilter_ToolboxEvent          3

#define Toolbox_RegisterPostFilter_AnyClass            (-1)
#define Toolbox_RegisterPostFilter_WimpObject            0

typedef struct
{
        int          code;                       /* pair of event code and object class */
        ObjectClass  class_id;                   /* used in Toolbox_RegisterPostFilter  */
} EventInterest;



/* flags and types for Toolbox_ShowObject */

#define Toolbox_ShowObject_AsMenu               0x00000001
#define Toolbox_ShowObject_AsSubMenu            0x00000002
#define Toolbox_ShowObject_AsSubWindow		0x00000004

#define Toolbox_ShowObject_Default                       0
#define Toolbox_ShowObject_FullSpec                      1
#define Toolbox_ShowObject_TopLeft                       2
#define Toolbox_ShowObject_Centre                        3
#define Toolbox_ShowObject_AtPointer                     4

typedef struct
{
        int x;
        int y;
} TopLeft;



/* flags and types for Toolbox_Memory */

#define Toolbox_Memory_ValidReasonBits          0xFF

#define Toolbox_Memory_Alloc                    0x00
#define Toolbox_Memory_Free                     0x01
#define Toolbox_Memory_Reallocate               0x02



/* ------------------------------------------- Toolbox Events ----------------------------------------- */

/* event codes */


#define Toolbox_Error             (Toolbox_SWIChunkBase + 0)
#define Toolbox_ObjectAutoCreated (Toolbox_SWIChunkBase + 1)
#define Toolbox_ObjectDeleted     (Toolbox_SWIChunkBase + 2)


typedef struct
{
        unsigned int     size;
        int              reference_number;
        unsigned int     event_code;
        unsigned int     flags;
} ToolboxEventHeader;


typedef struct
{
        ToolboxEventHeader hdr;
        union
        {
            char bytes [212];
            int  words [53];
        } data;

} ToolboxEvent;    /* generic structure of a Toolbox Event block */

typedef struct
{
        ObjectID     self;
        ComponentID  component;
        ToolboxEvent event;
} ToolboxEventMsg;


/* a Toolbox error event */

typedef struct
{
        ToolboxEventHeader hdr;
        int                errnum;
        char               errmess [256-20-sizeof(ToolboxEventHeader)-sizeof(ObjectID)-sizeof(ComponentID)-sizeof(int)];
} ToolboxErrorEvent;


/* object has been auto-created event */

typedef struct
{
        ToolboxEventHeader hdr;
        char               template_name [256-20-sizeof(ToolboxEventHeader)-sizeof(ObjectID)-sizeof(ComponentID)];
} ToolboxObjectAutoCreatedEvent;

/* object has been deleted */

typedef struct
{
        ToolboxEventHeader hdr;
        ObjectClass        class_id;
        void               *client_handle;
} ToolboxObjectDeletedEvent;




/* ----------------------------------------- Toolbox Error Numbers ------------------------------------ */

#define Program_Error               0x1b000000

#define Toolbox_ErrorBase           (Program_Error | 0x80cb00)

#define Toolbox_NoMem               (Toolbox_ErrorBase + 0)
#define Toolbox_BadSWI              (Toolbox_ErrorBase + 1)
#define Toolbox_InvalidObjectID     (Toolbox_ErrorBase + 2)
#define Toolbox_NotaToolboxTask     (Toolbox_ErrorBase + 3)
#define Toolbox_NoDirName           (Toolbox_ErrorBase + 4)
#define Toolbox_NoMsgsFD            (Toolbox_ErrorBase + 5)
#define Toolbox_NoIDBlock           (Toolbox_ErrorBase + 6)
#define Toolbox_BadResFile          (Toolbox_ErrorBase + 7)
#define Toolbox_TasksActive         (Toolbox_ErrorBase + 8)
#define Toolbox_TemplateNotFound    (Toolbox_ErrorBase + 9)
#define Toolbox_NoSuchPreFilter     (Toolbox_ErrorBase + 0xa)
#define Toolbox_NotaResFile         (Toolbox_ErrorBase + 0xb)
#define Toolbox_BadResFileVersion   (Toolbox_ErrorBase + 0xc)
#define Toolbox_BadFlags            (Toolbox_ErrorBase + 0xd)
#define Toolbox_BadGetSysInfoReason (Toolbox_ErrorBase + 0xe)
#define Toolbox_BadMemoryReason     (Toolbox_ErrorBase + 0xf)


#endif
@


4.7
log
@  Updated common Toolbox Makefile fragment.
  Extra shared facilities for object modules.
  Debug support improved.
Detail:
  New common operations for Toolbox object modules have been abstracted
    into this component in order to simplify the object modules.
  Debugging services made common to all modules and now uses DebugLib.
  Common Makefile fragment now exported with correct rules for ROM builds
    as well as RAM builds, and (new in this version), DebugLib RAM builds.
    As a result, all object modules now have debug versions available.
Admin:
  Requires BuildSys 1.92 or later (RiscOS/BuildSys; tag BuildSys-1_92)
  Requires Library 0.41 or later (RiscOS/Library; tag Library-0_41)
  Required by any Toolbox object module dated 4th May 2000 or later.

Version 0.09. Tagged as 'Common-0_09'
@
text
@d15 1
a15 1
/* File:    Toolbox.h
@


4.6
log
@  Added export of assembler headers for Window and Toolbox modules.
  C headers protect their definitions of service calls to avoid clashes
Detail:
  Exported headers contain SWI definitions only.
  Exported C headers protect their definitions of service call symbols
    to avoid clashes with Global/Services.h (which will contain them
    all from the next source drop)
Admin:
  Tested with the Window module.

Version 0.05. Tagged as 'Common-0_05'
@
text
@a348 17
/* ------------------------------------------- Toolbox Service Calls ---------------------------------- */

#define Service_ToolboxBase         (Toolbox_SWIChunkBase+1)

#ifndef Service_ToolboxStarting
#define Service_ToolboxStarting     (Service_ToolboxBase + 0)
#endif
#ifndef Service_ToolboxTaskBorn
#define Service_ToolboxTaskBorn     (Service_ToolboxBase + 1)
#endif
#ifndef Service_ToolboxTaskDied
#define Service_ToolboxTaskDied     (Service_ToolboxBase + 2)
#endif
#ifndef Service_ToolboxDying
#define Service_ToolboxDying        (Service_ToolboxBase + 3)
#endif

@


4.5
log
@  Changes to shut the compiler up.
Detail:
  Renamed (meaningless) formal parameter "template" in function declarations.
  Renamed other variables in the C sources too.
  Stops C compiler moaning about the use of symbols reserved for C++.
Admin:
  Required by Toolbox-1_47 and later.

Version 0.02. Tagged as 'Common-0_02'
@
text
@d353 1
d355 2
d358 2
d361 2
d364 1
@


4.4
log
@  Updated ToolboxObjectDeletedEvent structure to hold class and client handle.
Detail:
  Currently, there is no way of ascertaining the client handle that used to
    belong to a deleted object.  Thus applications cannot rely on this event
    to close down any associated data structures referenced via the client
    handle.  This event now provides the client handle and the class ID of
    the deleted object (application can check flags bit 0 to determine if
    they are valid).
Admin:
  Required by Toolbox-1_46 and later.

Version 0.01. Tagged as 'Common-0_01'
@
text
@d78 1
a78 1
    ObjectClass        class;                     /* class of the object */
d222 1
a222 1
        ObjectClass  class;                      /* used in Toolbox_RegisterPostFilter  */
@


4.3
log
@Build process improvements:
  !MkRam,fd7 added to enable RAM builds of all Toolbox modules
  MakeFile tidied up and support for RAM build added
Module now uses Toolbox memory allocation instead of calling OS_Module.
@
text
@d318 2
@


4.2
log
@Spinner branch merged
@
text
@d21 1
d166 1
d247 10
d344 1
d354 1
@


4.1
log
@Initial revision
@
text
@d20 1
d34 1
a34 1

d40 1
a40 1
{
d56 1
a56 1

d70 2
a71 2

#define Object_ValidFlags        0x0000000f
d94 1
a94 1

d138 1
a138 1

d195 1
a195 1

d229 1
d234 2
d241 1
a241 1
} TopLeft;
d285 1
a285 1
typedef struct
d316 1
a316 1

@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@Added ActionButton_SetFont
Added ActionButton_ClickShowCentred
Added ActionButton_ClickShowAtPointer

Added Toolbox_ShowObject_Centre
Added Toolbox_ShowObject_AtPointer
@
text
@a19 1
 *          02-Feb-97: EPW: Added Toolbox_ShowObject_AtPointer
d33 1
a33 1

d39 1
a39 1
{
d55 1
a55 1

d69 2
a70 2

#define Object_ValidFlags        0x0000000f
d93 1
a93 1

d137 1
a137 1

d194 1
a194 1

a227 1
#define Toolbox_ShowObject_AsSubWindow		0x00000004
a231 2
#define Toolbox_ShowObject_Centre                        3
#define Toolbox_ShowObject_AtPointer                     4
d237 1
a237 1
} TopLeft;
d281 1
a281 1
typedef struct
d312 1
a312 1

@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
