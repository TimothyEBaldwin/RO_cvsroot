head	4.5;
access;
symbols
	Window-1_79:4.5
	Window-1_78:4.5
	Window-1_77:4.5
	Window-1_76:4.5
	Window-1_75:4.5
	Window-1_74:4.5
	Window-1_73:4.5
	Window-1_72:4.5
	Window-1_71:4.5
	RO_5_07:4.5
	Window-1_70:4.5
	Window-1_69:4.5
	Window-1_68:4.5
	Window-1_67:4.5
	Window-1_66:4.5
	Window-1_65:4.5
	Window-1_64:4.5
	Window-1_63:4.5
	Window-1_62:4.4
	Window-1_61:4.3
	Window-1_60:4.3
	Window-1_59:4.3
	mstphens_UrsulaRiscPCBuild_20Nov98:4.3
	sbrodie_Toolbox_Ursula_231198:4.3
	Window-1_58:4.3
	Ursula_RiscPC:4.3.0.8
	Window-1_57:4.3
	rthornb_UrsulaBuild-19Aug1998:4.3
	UrsulaBuild_FinalSoftload:4.3
	rthornb_UrsulaBuild-12Aug1998:4.3
	Ursula:4.3.0.6
	Ursula_bp:4.3
	aglover_UrsulaBuild-05Aug1998:4.3
	Window-1_56:4.3
	rthornb_UrsulaBuild-29Jul1998:4.3
	Window-1_55:4.3
	rthornb_UrsulaBuild-22Jul1998:4.3
	rthornb_UrsulaBuild-15Jul1998:4.3
	rthornb_UrsulaBuild-07Jul1998:4.3
	Window-1_54:4.3
	rthornb_UrsulaBuild-17Jun1998:4.3
	Window-1_53:4.3
	Window-1_52:4.3
	Window-1_51:4.3
	rthornb_UrsulaBuild-03Jun1998:4.3
	rthornb_UrsulaBuild-27May1998:4.3
	rthornb_UrsulaBuild-21May1998:4.3
	Ursula_12May1998:4.3.0.4
	rthornb_UrsulaBuild_01May1998:4.3
	sbrodie_Window_1_49:4.3
	afrost_NC2_Generic:4.1.7.2
	sbrodie_Window_1_48:4.3
	Daytona:4.3.0.2
	Daytona_bp:4.3
	sbrodie_Expresso_final_190298:4.3
	sbrodie_Window_1_46:4.3
	sbrodie_Expresso_BETA6_19980204:4.3
	sbrodie_Window_1_44:4.3
	Spinner_RCA116:4.1.7.2
	Spinner_B20_2:4.1.7.2
	Spinner_19_3:4.1.7.2
	Spinner_B18:4.1.7.2
	Spinner_B17:4.1.7.2
	Spin_merge_8Jul97:4.1.7.2
	Ursula_bp_8Jul97:4.2
	Spinner_B15:4.1.7.2
	Spinner_B14:4.1.7.2
	Spinner_B13:4.1.7.2
	Ursula_bp_13Jun97:4.2
	Spin_merge_13Jun97:4.1.7.2
	Spinner_B12:4.1.7.2
	Spinner_B10:4.1.7.2
	Spin_merge_13May97:4.1.7.1
	Spinner_B7:4.1.7.2
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.2
	RCA_bp:4.1
	pwombwel_Rel_1_36:4.1.7.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.2
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.5
date	2000.05.04.12.57.27;	author sbrodie;	state Exp;
branches;
next	4.4;

4.4
date	99.11.17.12.05.07;	author sbrodie;	state Exp;
branches;
next	4.3;

4.3
date	97.07.08.10.14.09;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.05.13.09.12.40;	author kbracey;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.23.28;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.2.2.1
date	97.05.15.01.05.59;	author kbracey;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.23.28;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.19.47.18;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.13.19.33;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.19.42.58;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	97.03.19.18.57.45;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.5
log
@  Changed to use common Makefile system.
  Debug build facility added.
Detail:
  Uses core facilities from Common instead of having private copies.
  Makefile vastly simplified to simply define a few macros, then include
    the common Toolbox Makefile which is exported by Common.
Admin:
  Requires Common 0.09 or later (RiscOS/Sources/Toolbox/Common; Common-0_09)
  Requires BuildSys 1.92 or later (RiscOS/BuildSys; BuildSys-1_92)
  Requires Library 0.41 or later (RiscOS/Library; Library-0_41)

Version 1.63. Tagged as 'Window-1_63'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; Title:   s.toolbox
; Purpose: toolbox functions
; Author:  NK
; History: 31-Aug-94: NK : Created
;          16-Nov-99: SNB: 32-bit support plus other fixes

; APCS-R/APCS-32 compliant as per {CONFIG}
;   a1-a4,ip (R0-R3,R12) may be corrupted

        EXPORT  |toolbox_delete_object|
        EXPORT  |window_starting|

        AREA    |Veneers$$Code|, CODE, READONLY, PIC

        GET     hdr:ListOpts
        GET     hdr:Macros
        GET     hdr:System
        GET     hdr:Proc
        GET     hdr:Toolbox
        GET     hdr:Services

        MACRO
        MOVRet  $lr,$cond
        [ {CONFIG}=26
        MOV$cond.S    pc,$lr
        |
        MOV$cond      pc,$lr
        ]
        MEND

        MACRO
        LDMRet  $regs,$cond
        [ {CONFIG}=26
        LDM$cond.FD   sp!,{$regs,pc}^
        |
        LDM$cond.FD   sp!,{$regs,pc}
        ]
        MEND


toolbox_delete_object
        MOV     ip,lr
        SWI     XToolbox_DeleteObject
        MOVVC   a1,#0
        MOVRet  ip

window_starting
        STMFD   sp!,{r0-r7,lr}
        LDR     r1,=Service_WindowModuleStarting
        SWI     XOS_ServiceCall
        LDMRet  r0-r7

        END

@


4.4
log
@  32-bit build capability added.
  Magic numbers imported from header files.
  APIs fixed.
Detail:
  Assembler fixed to use {CONFIG} to determine which variant of
    APCS it is supposed to be using.
  Symbols imported from Hdr: for service calls and SWI names.
  Added MOVVC a1,#0 statements for SWI veneers which are declared in
    the C headers as returning _kernel_oserror * - comments indicated
    that this wasn't done before because the return values were not
    used.  Headers & code are now consistent.
Admin:
  Requires Common 0.06 (RiscOS/Sources/Toolbox/Common)
  Requires HdrSrc 0.61 (RiscOS/Sources/Programmer/HdrSrc)

Version 1.62. Tagged as 'Window-1_62'
@
text
@a24 6
        EXPORT  |resourcefs_deregister_files|
        EXPORT  |resourcefs_register_files|
        EXPORT  |register_with_toolbox|
        EXPORT  |deregister_with_toolbox|
        EXPORT  |read_mode_variable|
        EXPORT  |wimp_version|
a25 1
        EXPORT  |whats_a_decimal_point|
a32 2
        GET     hdr:ResourceFS
        GET     hdr:Wimp
a33 4
        GET     hdr:Window
        GET     hdr:FSNumbers
        GET     hdr:NewErrors
        GET     hdr:Territory
a60 44
resourcefs_deregister_files
        MOV     ip,lr
        SWI     XResourceFS_DeregisterFiles
        MOVVC   a1,#0
        MOVRet  ip

resourcefs_register_files
        MOV     ip,lr
        SWI     XResourceFS_RegisterFiles
        MOVVC   a1,#0
        MOVRet  ip

register_with_toolbox
        MOV     ip,lr
        MOV     a1,#0
        LDR     a2,=Window_ClassSWI
        MOV     a3,a2
        MOV     a4,#0
        SWI     XToolbox_RegisterObjectModule
        MOVVC   a1,#0
        MOVRet  ip

read_mode_variable
        MOV     ip,lr
        SWI     XOS_ReadModeVariable
        MOVVC   a1,R2
        MOVVS   a1,#0
        MOVRet  ip

wimp_version
        MOV     ip,lr
        MOV     a1,#7
        SWI     XWimp_ReadSysInfo
        MOVVS   a1,#200
        MOVRet  ip

deregister_with_toolbox
        MOV     ip,lr
        MOV     a1,#0
        LDR     a2,=Window_ClassSWI
        MOV     a3,a2
        SWI     XToolbox_DeRegisterObjectModule
        MOVRet  ip

a65 9

whats_a_decimal_point
        MOV     ip,lr
        MOV     a1,#-1
        MOV     a2,#0           ; read decimal
        SWI     XTerritory_ReadSymbols
        MOVVS   a1,#'.'
        LDRVCB  a1,[a1]
        MOVRet  ip
@


4.3
log
@Ursula branch merged
@
text
@d19 1
a19 1
;
d21 2
a22 16
; APCS compliant, a1-a4 (R0-R3) may be corrupted

; to save stacking, use a4 as a temporary link register
; unless we know the SWI will corrupt it.

; don't bother to handle errors unless the external code requires it

XToolbox_DeleteObject           * &64ec1
XToolbox_RegisterObjectModule   * &64efd
XToolbox_DeregisterObjectModule * &64efa
XResourceFS_DeregisterFiles     * &61B41
XResourceFS_RegisterFiles       * &61B40
XOS_ReadModeVariable            * &20035
XWimp_ReadSysInfo               * &600f2
XOS_ServiceCall                 * &20030
XTerritory_ReadSymbols          * &6305e
d34 33
a66 1
        AREA    |C$$Code|, CODE, READONLY
d69 1
a69 1
        MOV     a4,lr
d71 2
a72 1
        MOVS    pc,a4
d75 1
a75 1
        MOV     a4,lr
d77 2
a78 1
        MOVS    pc,a4
d81 1
a81 1
        MOV     a4,lr
d84 1
a84 1
        MOVS    pc,a4
d89 1
a89 2
        MOV     a2,#&82000
        ORR     a2,a2,#&80
d93 2
a94 2
	MOVVC	a1,#0
        MOVS    pc,ip
d97 1
a97 1
        MOV     a4,lr
d101 1
a101 1
        MOVS    pc,a4
d104 2
a105 2
        MOV     a4,lr
        MOV     R0,#7
d107 2
a108 1
        MOVS    pc,a4
d111 1
a111 1
        MOV     a4,lr
d113 4
a116 4
        MOV     a2,#&82000
        ORR     a2,a2,#&80
        SWI     XToolbox_DeregisterObjectModule
        MOVS    pc,a4
d120 1
a120 1
        LDR     r1,=&82881
d122 1
a122 1
        LDMFD   sp!,{r0-r7,pc}^
d125 1
a125 1
        MOV     a4,lr
d130 2
a131 2
        LDRVC   a1,[a1]
        MOVS    pc,a4
@


4.2
log
@Spinner branch merged
@
text
@d74 1
a75 1
        LDMFD   sp!,{pc}
@


4.2.2.1
log
@Fixed register_with_toolbox
@
text
@a73 1
	MOVVC	a1,#0
d75 1
@


4.1
log
@Initial revision
@
text
@d22 1
a22 1
    
d53 1
a53 1
        MOV     pc,a4
d58 1
a58 1
        MOV     pc,a4
d64 1
a64 1
        MOV     pc,a4
d66 2
a67 2
register_with_toolbox   
        STMFD   sp!,{lr}
d74 1
d82 1
a82 1
        MOV     pc,a4
d88 1
a88 1
        MOV     pc,a4
d90 1
a90 1
deregister_with_toolbox   
d96 1
a96 1
        MOV     pc,a4
d105 1
a105 1
        MOV     a4,lr  
d108 1
a108 1
        SWI     XTerritory_ReadSymbols    
d111 1
a111 1
        MOV     pc,a4
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.7.2
log
@Add "Extendable X and Extendable Y" toolbars.
Improve pane-handling algorithms.
Fix alignment of labels in labelled boxes.
Align numberrange's slider more neatly and put adjusters in right place
Stringsets tidied up
Some useful checking added to string_set_toolbox_event
Showing as subwindow fixed up a lot.
@
text
@d22 1
a22 1

d53 1
a53 1
        MOVS    pc,a4
d58 1
a58 1
        MOVS    pc,a4
d64 1
a64 1
        MOVS    pc,a4
d66 2
a67 2
register_with_toolbox
        MOV     ip,lr
a73 1
        MOVS    pc,ip
d81 1
a81 1
        MOVS    pc,a4
d87 1
a87 1
        MOVS    pc,a4
d89 1
a89 1
deregister_with_toolbox
d95 1
a95 1
        MOVS    pc,a4
d104 1
a104 1
        MOV     a4,lr
d107 1
a107 1
        SWI     XTerritory_ReadSymbols
d110 1
a110 1
        MOVS    pc,a4
@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
