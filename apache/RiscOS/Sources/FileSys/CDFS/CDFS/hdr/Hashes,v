head	4.13;
access;
symbols
	CDFS-2_63:4.13
	CDFS-2_62:4.13
	CDFS-2_61:4.13
	CDFS-2_60:4.12
	CDFS-2_59:4.11
	CDFS-2_58:4.10
	CDFS-2_57:4.10
	CDFS-2_56:4.10
	CDFS-2_55:4.10
	CDFS-2_54:4.9
	CDFS-2_53:4.7
	CDFS-2_52:4.6
	CDFS-2_51:4.6
	CDFS-2_50:4.6
	CDFS-2_49:4.6
	CDFS-2_48:4.6
	RO_5_07:4.6
	CDFS-2_47:4.6
	CDFS-2_46:4.6
	CDFS-2_45:4.5
	CDFS-2_44:4.5
	CDFS-2_43:4.5
	CDFS-2_42:4.5
	CDFS-2_41:4.5
	CDFS-2_40:4.4
	CDFS-2_39:4.4
	CDFS-2_38:4.4
	CDFS-2_37:4.3
	CDFS-2_35:4.2
	CDFS-2_30:4.1
	dellis_autobuild_BaseSW:4.1
	sbrodie_sedwards_16Mar2000:4.1
	dcotton_autobuild_BaseSW:4.1
	nturton_CDFS-2_29:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	nicke_CDFS_2_28:4.1.7.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	hsimons_BOCA-1_2-Release:4.1.7.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.13
date	2013.08.15.14.24.58;	author rsprowson;	state Exp;
branches;
next	4.12;
commitid	5ab0m7C1cVfMFy1x;

4.12
date	2013.08.15.14.13.02;	author rsprowson;	state Exp;
branches;
next	4.11;
commitid	6zDw3cu1Q3LIBy1x;

4.11
date	2013.07.15.20.36.57;	author rsprowson;	state Exp;
branches;
next	4.10;
commitid	ArzVzGqij5ueJBXw;

4.10
date	2012.04.22.11.13.10;	author rsprowson;	state Exp;
branches;
next	4.9;
commitid	FhAGZUD5Y3dD2R1w;

4.9
date	2012.04.22.11.08.58;	author rsprowson;	state Exp;
branches;
next	4.8;
commitid	MNiwWuPGZIIb1R1w;

4.8
date	2012.04.22.11.04.27;	author rsprowson;	state Exp;
branches;
next	4.7;
commitid	6PVuneYjhUEDZQ1w;

4.7
date	2012.04.21.21.56.34;	author rsprowson;	state Exp;
branches;
next	4.6;
commitid	LsBEkd8YV89lDM1w;

4.6
date	2002.11.26.20.13.01;	author bavison;	state Exp;
branches;
next	4.5;

4.5
date	2002.11.22.15.05.39;	author bavison;	state Exp;
branches;
next	4.4;

4.4
date	2002.11.04.21.21.41;	author bavison;	state Exp;
branches;
next	4.3;

4.3
date	2002.11.01.20.16.26;	author bavison;	state Exp;
branches;
next	4.2;

4.2
date	2002.11.01.19.47.47;	author bavison;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.31.49;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.31.49;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.47.47;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.31.38;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.27.57;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.13
log
@Add support for Joliet format CD-ROMs
hdr/Hashes
s/Directory
s/EntryFile
s/FileMan
s/Filer
s/Free
 - mass search and replace of lots of poorly named definitions, removing unused ones, creating implicit ones
hdr/MyMacros
 - shuffle some registers in ConvertToArchyDate to save one temporary so it can be used for something else
 - moved ReplaceBadCharacters here
hdr/Options
 - extra debug option
s/DiscOp
 - add Joliet, rename buffer indicies per hdr/Hashes
 - the fallback filetype assignment (when neither the ARCHIMEDES system extension nor MimeMap can help) can now be overridden by setting CDFS$DefaultType (which defaults to &FFD)
s/SWI
 - remove DAT<->MPEG mapping from the internal mapping table
s/Variables
 - trim out unused SWI_buffer reservation

Tested with valid ISO/Joliet/RockRidge supported combinations, documented in Docs/Combos, and accompanying test ISO images now stored there.
Tested with CD-I format disc 'Jigsaw' from Britannica.
Tested with High Sierra format disc 'Kings Quest V'.
Tested with photo CD sampler from Kodak.

Version 2.61. Tagged as 'CDFS-2_61'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; -> hdr.Hashes


;------------------------------------------
; Addressing modes for reading blocks of data
;------------------------------------------

LBAFormat               * 0
MSFFormat               * 1
PBFormat                * 2

;------------------------------------------
; FileSwitch limits
;------------------------------------------

MAXLENGTHOFNAME         * 64    ; MAX(ISO9660's 32*char, Joliet's 128*UCS2)
MAXLENGTHOFDISCNAME     * 32    ; Governed by PVD volume id
MAXNUMBEROFPATHS        * 8     ; Joliet allows > 8, but 64x8 is > the 240 path limit required anyway 
MAXNUMBEROFOPENFILES    * 255
FSBUFFERSIZE            * 2048  ; For BGet/BPut
MAXBUFFERSIZE           * 512   ; 512K maximum directory cache

FS_EXTRAINFORMATIONWORD * 0
FS_INFORMATIONWORD      * fsinfo_readonly + fsinfo_multifsextensions + \
                          + (MAXNUMBEROFOPENFILES :SHL: fsinfo_nfiles_shift) \
                          + (fsnumber_CDFS :SHL: fsinfo_number_shift)

;------------------------------------------
; Booleans
;------------------------------------------

TRUE                    * 0
FALSE                   * 1

;------------------------------------------
; CD driver interfacing
;------------------------------------------

MAXLUNS                    *    4
MAXNUMBEROFDRIVES          *    7    ; 0 TO 6 ALLOWED, 7 = HOST DEVICE
MAXNUMBEROFDRIVESSUPPORTED *    MAXLUNS * MAXNUMBEROFDRIVES

BITSUSEDBYDRIVENUMBER      *    2_00011111
BITSUSEDBYBUFFER           *    2_11100000
BUFFERSHIFT                *    5
        ASSERT  MAXNUMBEROFDRIVESSUPPORTED <= BITSUSEDBYDRIVENUMBER

; Control block offsets
DEVICEOFFSET               *   0     
CARDOFFSET                 *   4
LUNOFFSET                  *   8
DRIVETYPEOFFSET            *  12
RESERVEDOFFSET             *  16

; Returns from CD_DriveReady
READY                      *  0
NOTREADY                   *  1
BUSYRETRYTIME              *  5 * 100   ; Retry if drive is busy for 2 seconds - see 'TestKnowDisc'

;------------------------------------------------
; Media layout
;------------------------------------------------

mode1datasize           * 2048
mode2datasize           * 2336
USER_DATA_SIZE          * 2324
SECTOR_SIZE             * 2340
PVD                     * 16      ; Sector of primary volume descriptor

; Disc types
AUDIO                 *         0 ;
                                  ; Used for *playlist
DATA                  *         1 ;
MaxNumberOfBlocks     *        74 ;
MaxNumberOfSeconds    *        59 ;

DISCTYPE_ISO         *    2_00001 ; CDFS arbitrary internals
DISCTYPE_HISIERRA    *    2_00010 ;
DISCTYPE_CDI         *    2_00100 ;
DISCTYPE_JOLIET      *    2_11000 ; Mask
DISCTYPE_JOLIET1     *    2_01001 ; ISOish, UCS2-level 1
DISCTYPE_JOLIET2     *    2_10001 ; ISOish, UCS2-level 2
DISCTYPE_JOLIET3     *    2_11001 ; ISOish, UCS2-level 3

;------------------------------------------------
; ISO9660 volume descriptor definitions (from ECMA-119 section 8.4)
;------------------------------------------------
                                    ^ 0
IsoVolDescType                      # 1
IsoVolDescType_Boot                 * 0
IsoVolDescType_Primary              * 1
IsoVolDescType_Supplementary        * 2
IsoVolDescType_Partition            * 3
IsoVolDescType_Terminator           * 255
IsoVolDescId                        # 5
IsoVolDescVersion                   # 1
IsoVolDescFlags                     # 1    ; Unused for primary volume descriptor
IsoVolDescFlags_EscSeqNotISO2375    * 1
IsoVolDescSystemId                  # 32
IsoVolDescVolumeId                  # 32
                                    # 8    ; Reserved
IsoVolDescVolumeSpaceSize           # 8
IsoVolDescEscapeSequences           # 32   ; Unused for primary volume descriptor
IsoVolDescVolumeSetSize             # 4
IsoVolDescVolumeSequenceNumber      # 4
IsoVolDescLogicalBlockSize          # 4
IsoVolDescPathTableSize             # 8
IsoVolDescLocOfLPathTable           # 4
IsoVolDescLocOfOptionalLPathTable   # 4
IsoVolDescLocOfMPathTable           # 4
IsoVolDescLocOfOptionalMPathTable   # 4
IsoVolDescDirRecordRoot             # 34
IsoVolDescVolumeSetId               # 128
IsoVolDescPublisherId               # 128
IsoVolDescDataPreparerId            # 128
IsoVolDescApplicationId             # 128 
IsoVolDescCopyrightFileId           # 37
IsoVolDescAbstractFileId            # 37
IsoVolDescBibliographicFileId       # 37
IsoVolDescCreationDate              # 17
IsoVolDescModificationDate          # 17
IsoVolDescExpirationDate            # 17
IsoVolDescEffectiveDate             # 17
IsoVolDescFileStructureVersion      # 1
                                    # 1    ; Reserved
IsoVolDescApplicationData           # 512
                                    # 653  ; Reserved
        ASSERT  @@ = 2048

;------------------------------------------------
; High Sierra volume descriptor definitions (from a hotel in Nevada)
;------------------------------------------------
                                    ^ 0
                                    # 8    ; Reserved
HiSierraVolDescType                 # 1
HiSierraVolDescId                   # 5
HiSierraVolDescVersion              # 1
                                    # 1    ; Reserved
HiSierraVolDescSystemId             # 32
HiSierraVolDescVolumeId             # 32
                                    # 8    ; Reserved
HiSierraVolDescVolumeSpaceSize      # 8
                                    # 32   ; Reserved
HiSierraVolDescVolumeSetSize        # 4
HiSierraVolDescVolumeSequenceNumber # 4
HiSierraVolDescLogicalBlockSize     # 4
HiSierraVolDescPathTableSize        # 8
HiSierraVolDescLocOfLPathTable      # 4
                                    # 28   ; Reserved
HiSierraVolDescDirRecordRoot        # 34
                                    # 1834 ; Reserved
        ASSERT  @@ = 2048

;------------------------------------------------
; CD-I volume descriptor definitions (from Green Book 1994 Fig III.1)
;------------------------------------------------
                                    ^ 0
CdiVolDescType                      # 1
CdiVolDescType_Primary              * 1
CdiVolDescType_Supplementary        * 2
CdiVolDescType_Terminator           * 255
CdiVolDescId                        # 5
CdiVolDescVersion                   # 1
CdiVolDescFlags                     # 1
CdiVolDescSystemId                  # 32
CdiVolDescVolumeId                  # 32
                                    # 8    ; Reserved
CdiVolDescVolumeSpaceSize           # 8    ; Big endian only
CdiVolDescEscapeSequences           # 32
CdiVolDescVolumeSetSize             # 4    ; Big endian only
CdiVolDescVolumeSequenceNumber      # 4    ; Big endian only
CdiVolDescLogicalBlockSize          # 4    ; Big endian only
CdiVolDescPathTableSize             # 8    ; Big endian only
                                    # 8    ; Reserved
CdiVolDescLocOfMPathTable           # 4
                                    # 4    ; Reserved
                                    # 34   ; Reserved
CdiVolDescVolumeSetId               # 128
CdiVolDescPublisherId               # 128
CdiVolDescDataPreparerId            # 128
CdiVolDescApplicationId             # 128 
CdiVolDescCopyrightFileId           # 37
CdiVolDescAbstractFileId            # 37
CdiVolDescBibliographicFileId       # 37
CdiVolDescCreationDate              # 17
CdiVolDescModificationDate          # 17
CdiVolDescExpirationDate            # 17
CdiVolDescEffectiveDate             # 17
CdiVolDescFileStructureVersion      # 1
                                    # 1    ; Reserved
CdiVolDescApplicationData           # 512
                                    # 653  ; Reserved
        ASSERT  @@ = 2048

;------------------------------------------------------------
; Additional information field in a directory entry for CD-I
;------------------------------------------------------------

CDI_ADDINFO_FLAGS                     *   4
CDI_ADDINFO_LENGTH                    *  10   ; total length of additional information

; Flags of files on CDs


CDI_DIRECTORY_TYPE   *    128
CDI_DIRECTORY_TYPE_SHIFT *  6   ; Shift 'CDI_DIRECTORY_TYPE' right 6 times to equal ISO

SIZEOFBUFFER         *   1024*4 ; Used by *playlist and CDI_LoadBlock
myblocksize          *   2048

NEWLINE              *     13
SPACE                *     32
REPLACEMENTFORSPACE  *     160
DOT                  *     "."
REPLACEMENTFORDOT    *     "/"
HARDSPACE            *     31
WILDCHAR             *     "#"
WILDANY              *     "*"
REPLACEMENTFORWILD   *     "_"
SYSTEMROOT	     *     "$"
SYSTEMPARENT	     *     "^"
SYSTEMLIB	     *     "%"
SYSTEMURD	     *     "&"
SYSTEMCSD	     *     "@@"
SYSTEMCOLON	     *     ":"
SYSTEMQUOTE	     *     34 ; "
SYSTEMLT	     *	   "<"
SYSTEMGT	     *	   ">"
SYSTEMDEL	     *     127
REPLACEMENTFORSYSTEM *     "_"

ARCHYDIVIDER         *    "."
ARCHYFIELD           *    32  ; load / exec address and "ARCHIMEDES"
ARCHYPLINGBIT        *    1:SHL:8 ; Bit in file attributes to show ! in name

;------------------------------------------
; Offsets of offsets in a directory buffer
;------------------------------------------

                         ^   0
LBASTART                 #   0
OBJECTTYPE               #   0    ; Really only needs to be one bit
WASTER                   #   4
LOADADDRESS              #   4    ; Keep together ( see 'INFO' & '; 15' )
EXECUTIONADDRESS         #   4    ;
LENGTH                   #   4
TIMEDATE                 #   4
TIMEDATEHIBYTE           #   1
FILEATTRIBUTES           #   1
OBJECT__XA_ATTRIBUTES_LO #   1    ; Added 30-Aug-94, v 2.23
OBJECT__XA_ATTRIBUTES_HI #   1    ; Added 30-Aug-94, v 2.23
OBJECTNAME               #   0    ; Variable length ( last parameter ! )
; See 'Strings' MainDirInfo if change the hashes
LBASTARTOFFSET     *   LBASTART
OBJECTTYPEOFFSET   *   OBJECTTYPE
LOADADDRESSOFFSET  *   LOADADDRESS
EXECUTIONADDRESSOFFSET * EXECUTIONADDRESS
LENGTHOFFSET       *   LENGTH
TIMEDATEOFFSET     *   TIMEDATE
TIMEDATEHIBYTEOFFSET * TIMEDATEHIBYTE
FILEATTRIBUTESOFFSET * FILEATTRIBUTES
; XAATTRIBUTESOFFSET1 * OBJECT__XA_ATTRIBUTES_1
; XAATTRIBUTESOFFSET2 * OBJECT__XA_ATTRIBUTES_2
OBJECTNAMEOFFSET   *   OBJECTNAME

                           ^ 0
DirRecRecordSize           # 1
DirRecXASize               # 1
DirRecLBAOfFile            # 8    ; Both endian
DirRecExtentOfFile         # 8    ; Both endian
DirRecTimeDate             # 7
DirRecFlags                # 1
DirRecFlags_Hidden         * 1
DirRecFlags_Dir            * 2
DirRecFlags_Opaque         * 4    ; aka associated files
DirRecFlags_XARecord       * 8    ; extended attribute record contains further flags
DirRecFlags_Protection     * 16
DirRecFlags_Reserved5      * 32
DirRecFlags_Reserved6      * 64
DirRecFlags_MultiExtent    * 128  ; spans more than 4GB
DirRecFileUnitSize         # 1    ; Zero
DirRecFileGapSize          # 1    ; Zero
DirRecVolumeSequenceNumber # 4    ; Both endian
DirRecNameSize             # 1
DirRecName                 # 0    ; then NULLs to pad to even

                           ^ DirRecTimeDate
DirRecHiSierraTimeDate     # 6    ; Omits timezone byte
DirRecHiSierraFlags        # 1    ; Therefore flags are 1 byte earlier
DirRecHiSierraPad          # 1    ; And the next byte is unused

;--------------------------
; Offsets in a disc buffer
;--------------------------

                                ^ 0
DiscBuff_DiscType               # 1
DiscBuff_DiscMode               # 1
                                # 1           ; to align
DiscBuff_LBAOfVolDesc           # 1
DiscBuff_SizeOfDisc             # 4
DiscBuff_LBAOfMainDir           # 4
DiscBuff_SizeOfMainDir          # 4
DiscBuff_BlockSize              # 4
DiscBuff_DiscName               # MAXLENGTHOFDISCNAME + 4
DiscBuff_MainDirBuffer          # 0
            ASSERT (@@ :AND: 3) = 0

;---------------------------------
; Offsets for Open and GBPB files
;---------------------------------

                        ^ 0
STARTLBAOPEN            # 4
DISCNUMBEROPEN          # 4
SIZEOFBLOCKOPEN         # 4
SIZEOFFILEOPEN          # 4
FILESWITCHHANDLE        # 4
DRIVENUMBEROPEN         # 1
DISCMODEOPEN            # 1
DISCNAMEOPEN            # MAXLENGTHOFDISCNAME
DISCNAMEOPENOFFSET      * DISCNAMEOPEN

SizeOfOpenBuffer        # 0

;--------------------------------
; Offsets of buffer pointer list
;--------------------------------

MAX_BLOCKS_BUFFERED     * 1  ; Maximum ISO blocks buffered : my buffer
                             ; Currently, without a lot of hassle max_blocks_buffered must = 1
                        ^ 0
DISC                    # 4  ; 0
POINTER                 # 4  ; 4
BLOCK                   # 4  ; 8
BUFFERFLAGS             # 0
TRUNCATION              # 1  ; 9  ; truncation type for directory blocks
ISVOLDESC               # 1  ; 10 ; flag if this is a PVD/SVD volume descriptor
                        # 1  ; 11
                        # 1  ; 12
SIZEOFBUFFERENTRY       # 0

;-------------------------------
; Offsets for CDFS_DescribeDisc
;-------------------------------

                            ^ 0
SIZEOFDISCOFFSETFORDESCRIBE #  4
BLOCKSIZEOFFSETFORDESCRIBE  #  4
STARTLBAOFFSETFORDESCRIBE   #  4
DISCNAMEOFFSETFORDESCRIBE   #  MAXLENGTHOFDISCNAME
BOOTOPTIONOFFSETFORDESCRIBE #  1
RESERVEDBYTES               #  64 - {VAR}

;----------------------------------------------------------------------------------------------
; CD-ROM XA (to which CD-I complies) additional system use information in directory record
;----------------------------------------------------------------------------------------------

                   ^  0
XA__OWNER_ID       #  4       ;  0
XA__ATTRIBUTES_1   #  1       ;  4
XA__ATTRIBUTES_2   #  1       ;  5
XA__SIGNATURE_1    #  1       ;  6
XA__SIGNATURE_2    #  1       ;  7
XA__FILE_NUMBER    #  1       ;  8
XA__RESERVED       #  5       ;  9

XA__LENGTH         #  0       ; 14

ID__XA_SIGNATURE_1 *  'X'
ID__XA_SIGNATURE_2 *  'A'

;----------------------------------------------------------------------------------------------
; CD-ROM XA attributes stored in additional system use
;----------------------------------------------------------------------------------------------

ATTRIBUTES__XA_OWNER_READ     *    1:SHL:0
ATTRIBUTES__XA_RESERVED_1     *    1:SHL:1
ATTRIBUTES__XA_OWNER_EXECUTE  *    1:SHL:2
ATTRIBUTES__XA_RESERVED_2     *    1:SHL:3
ATTRIBUTES__XA_GROUP_READ     *    1:SHL:4
ATTRIBUTES__XA_RESERVED_3     *    1:SHL:5
ATTRIBUTES__XA_GROUP_EXECUTE  *    1:SHL:6
ATTRIBUTES__XA_RESERVED_4     *    1:SHL:7
ATTRIBUTES__XA_WORLD_READ     *    1:SHL:8
ATTRIBUTES__XA_RESERVED_5     *    1:SHL:9
ATTRIBUTES__XA_WORLD_EXECUTE  *    1:SHL:10
ATTRIBUTES__XA_MODE_2         *    1:SHL:11
ATTRIBUTES__XA_MODE_2_FORM_2  *    1:SHL:12
ATTRIBUTES__XA_INTERLEAVED    *    1:SHL:13
ATTRIBUTES__XA_CDDA           *    1:SHL:14
ATTRIBUTES__XA_DIRECTORY      *    1:SHL:15  ; This is the same as the ISO directory flag

;----------------------------------------------------------------------------------------------
; Hashes for RISC OS 3 messaging (massaging ?)
;----------------------------------------------------------------------------------------------

CDDriver_ErrorBlock           *    &803400
CDFS_ErrorBlock               *    &803440

ERROR_INVALIDPARAMETER  * 0 - 1
ERROR_NODRIVESCONFIGD   * 0 - 2
ERROR_TOOSMALL          * 0 - 3
ERROR_TOOBIG            * 0 - 4
ERROR_NOTFOUND          * 0 - 5
ERROR_NOSPACE           * 0 - 6
ERROR_G                 * 0 - 7    ; Unused
ERROR_INTERNALERROR     * 0 - 8
ERROR_BADDRIVE          * 0 - 9
ERROR_DISCNOTFOUND      * 0 - 10
ERROR_WRITETOCD         * 0 - 11
ERROR_DISCNOTKNOWN      * 0 - 12
ERROR_NOTREADABLE       * 0 - 13
ERROR_BADNAME           * 0 - 14
ERROR_O                 * 0 - 15   ; Unused
ERROR_NOTISO            * 0 - 16
ERROR_DRIVEEMPTY        * 0 - 17
ERROR_AUDIODISC         * 0 - 18

;----------------------------------------------------------------------------------------------
; Hashes for RISC OS 3 *Help messaging
;----------------------------------------------------------------------------------------------

HELP_EJECT         *   "1":SHL:8
HELP_CDFS          *   "2":SHL:8
HELP_CDDEVICES     *   "3":SHL:8
HELP_CDROMDRIVES   *   "4":SHL:8
HELP_CDROMBUFFERS  *   "5":SHL:8
HELP_LOCK          *   "6":SHL:8
HELP_UNLOCK        *   "7":SHL:8
HELP_PLAY          *   "8":SHL:8
HELP_PLAYLIST      *   "9":SHL:8
HELP_STOP          *   "a":SHL:8
HELP_DRIVE         *   "b":SHL:8
HELP_WHICHDISC     *   "c":SHL:8
HELP_BYE           *   "d":SHL:8
HELP_PLAYMSF       *   "e":SHL:8
HELP_SUPPORTED     *   "f":SHL:8
HELP_CDSPEED       *   "g":SHL:8
HELP_MOUNT         *   "h":SHL:8
HELP_DISMOUNT      *   "i":SHL:8
HELP_FREE          *   "j":SHL:8

        END
@


4.12
log
@Various CDFS enhancements
* Increase BGET/BPUT buffer declared to FileSwitch to 2k to match the natural sector size (FileSwitch has been able to support this since version 2.28)
* Remove local debug macros, use those from NDRDebug instead
* Change to use SETV/CLRV macros now the ones in HdrSrc are 26/32 neutral
* Clarify those situations where LBA mode is being selected by using symbol 'LBAFormat'
* Extend *WHICHDISC to allow an optional drive number to be provided (the code has existed for years, but the GSTrans flags and help denied its use)

Version 2.60. Tagged as 'CDFS-2_60'
@
text
@d30 3
a32 3
MAXLENGTHOFNAME         * 32
MAXLENGTHOFDISCNAME     * 32    ; Taken from PVD ( see ISO spec )
MAXNUMBEROFPATHS        * 8
d91 7
a97 3
ISO                  *      1     ; CDFS arbitrary internals
HISIERRA             *      2     ; 
OLD_CDI              *      3     ; 
a216 7
HIDDENTYPE	     *      1
DIRECTORYTYPE        *      2
OPAQUETYPE	     *      4 ; aka associated files
RECORDTYPE	     *      8 ; jrf: No idea
PROTECTIONTYPE	     *	    16
RESERVEDTYPE	     *      32
MULTIEXTENTTYPE	     *      64 ; jrf: These are gits
a249 3
LIBLENGTH * MAXLENGTHOFDISCNAME + ( MAXLENGTHOFNAME + 1 ) * MAXNUMBEROFPATHS + 4
URDLENGTH * MAXLENGTHOFDISCNAME + ( MAXLENGTHOFNAME + 1 ) * MAXNUMBEROFPATHS + 4

a266 8

FILENAMEOFFSET           *     33
FILELENGTHOFFSET         *     14
STARTOFFILEOFFSET        *      2
ISOFLAGSOFFSET           *     25
HISIERRATYPEOFFSET       *      9
HISIERRAFLAGSOFFSET      *     24

d280 29
a308 3
;-------------------------------------
; Offsets of offsets in a disc buffer
;-------------------------------------
d311 10
a320 18
DISCTYPE                        # 1
DISCTYPEOFFSETINABUFFER         * DISCTYPE
DISCMODE                        # 1
DISCMODEOFFSETINABUFFER         * DISCMODE
wasted1                         # 1           ; wasted bytes
wasted2                         # 1           ; to align rest
SIZEOFDISC                      # 4
SIZEOFDISCOFFSETINABUFFER       * SIZEOFDISC
LBAOFMAINDIR                    # 4
LBAOFMAINDIROFFSETINABUFFER     * LBAOFMAINDIR
LENGTHOFMAINDIR                 # 4
LENGTHOFMAINDIROFFSETINABUFFER  * LENGTHOFMAINDIR
BLOCKSIZE                       # 4
BLOCKSIZEOFFSETINABUFFER        * BLOCKSIZE
DISCNAME                        # MAXLENGTHOFDISCNAME + 4
DISCNAMEOFFSETINABUFFER         * DISCNAME
MAINDIRECTORY                   # 0
MAINDIRECTORYOFFSETINABUFFER    * MAINDIRECTORY
d350 5
a354 1
BLOCKY_OFFSET           # 4  ; 12 ;No limit to number of entries in a direct
@


4.11
log
@Replace indexes into PVD with sensible names
All references into the PVD now use defines rather than mystic numbers.
Fix in CutSpace for 2 letter CD titles being cropped to 1 letter.
Tested with 2 letter CD ISO and with a photo CD/ISO9660/CD-I test disc.

Version 2.59. Tagged as 'CDFS-2_59'
@
text
@d34 1
a34 1
FSBUFFERSIZE            * 1024  ; For BGet/BPut
@


4.10
log
@CDDriver error numbers taken from header file.
Note: CDFS' error block is actually offset within CDDriver's (by 64).
The report for *CDDevices now lines up properly with disc sizes < 100MB.
The syntax error for *PlayMSF no longer uses MessageTrans_GSLookup which tried to substitute the <> arguments.
Non internationalised module now has syntax error messages too.

Version 2.55. Tagged as 'CDFS-2_55'
@
text
@d82 1
a87 1
PVD                   *        16
d91 3
a93 4
; These are offsets in the PVD for all disc types supported
FILENAMEOFFSET       *     33
FILELENGTHOFFSET     *     14
STARTOFFILEOFFSET    *      2
d96 1
a96 1
; These are offsets in the PVD for each disc type
d98 41
d140 64
a203 13
ISOSTARTOFDISCNAMEINPVD               * 40
ISOLOGICALBLOCKSIZEOFFSET             * 128
ISOPOINTERTOROOTDIRECTORYOFFSET       * 158
ISOTYPEOFFSET                         *      1
ISOFLAGSOFFSET                        *     25
ISOPOINTERTOSIZEOFMAINDIRECTORY       * 158 + 12 ; DATA LENGTH OF ROOT DIR

HISIERRASTARTOFDISCNAMEINPVD          * 48
HISIERRALOGICALBLOCKSIZEOFFSET        * 136
HISIERRAPOINTERTOROOTDIRECTORYOFFSET  * 182
HISIERRATYPEOFFSET                    *      9
HISIERRAFLAGSOFFSET                   *     24
HISIERRAPOINTERTOSIZEOFMAINDIRECTORY  * 194 ; ( Hi byte / Lo byte )
a211 7
; These are extras for the PVD
DIVIDER              *      "."
ISO                  *      1
HISIERRA             *      2
OLD_CDI              *      3
DIRECTORYBYTESIZE    *   2048

d249 1
d274 7
a318 19
;------------------------
; Details for *CDDevices
;------------------------

spacesize   * 4

            ^ 0
deviceid    # 1
space1      # spacesize
LUN         # 1
space2      # spacesize
cardnumber  # 1
space3      # spacesize
Description # 8
space4      # spacesize
capacity    # 10
space5      # spacesize
firmware    # 4

a335 10
;-------------------------------------------
; Offsets for getting file .exe from a file
;-------------------------------------------

                        ^ 0
bufferexe               # 100
namebufferexe           # 5
numberbufferexe         # 10
fileextensionexe        # 5

@


4.9
log
@Exchange local definitions for central ones.
Hdr:HighFSI LowFSI Services CDROM CMOS UpCall and CDFS now used in preference to local definitions.
Macro 'Command' used to build the keyword table.
Some asserts added for safety.


Version 2.54. Tagged as 'CDFS-2_54'
@
text
@a73 68













;*************** CD driver error numbers *******************

ErrorBlock                           *   &803400
                                     ^   ErrorBlock
                                     ; See Hdr:CDErrors
SWIOutOfRangeNumber                  # 1       ; 0
BadAlignmentNumber                   # 1       ; 1
DriveNotSupportedNumber              # 1       ; 2
BadModeNumber                        # 1       ; 3
InvalidParameterNumber               # 1       ; 4
NotAudioTrackNumber                  # 1       ; 5
NoCaddyNumber                        # 1       ; 6
NoDriveNumber                        # 1       ; 7
InvalidFormatNumber # 1                        ; 8
BadMinutesNumber # 1                           ; 9
BadSecondsNumber # 1                           ; A
BadBlocksNumber # 1                            ; B
PhysicalBlockErrorNumber # 1                   ; C
DrawerLockedNumber # 1                         ; D
WrongDataModeNumber                  # 1       ; E
ChannelNotSupportedNumber # 1
BadDeviceIDNumber # 1
BadCardNumberNumber # 1
BadLUNNumberNumber # 1
NoSuchTrackNumber # 1
FaultyDiscNumber # 1
NoSuchBlockNumber # 1

 GBLA CDFSErrorNumber
CDFSErrorNumber SETA ErrorBlock + 64

;************************************************************























d341 3
d345 1
d349 2
d358 1
@


4.8
log
@Collapse old switches.
Switches from 10+ years ago removed. Demo version switch removed.

Version 2.53. Not tagged
@
text
@d15 1
a15 1
; -> Hashes  ( see $.CDFS.Test )
d18 3
a20 3
;***************************************************************************
; ***            Addressing modes for reading blocks of data            ***
;***************************************************************************
d22 3
a24 3
LBAFormat             *       0
MSFFormat             *       1
PBFormat              *       2
d26 3
a28 1
;***************************************************************************
d30 11
a40 2
mode1datasize                   *   2048
mode2datasize                   *   2336
d42 31
a73 6
FIRQ_Flag                   *   1:ROL:26
IRQ_Flag                    *   1:ROL:27
Overflow_Flag               *   1:ROL:28
Carry_Flag                  *   1:ROL:29
Zero_Flag                   *   1:ROL:30
Negative_Flag               *   1:ROL:31
a74 2
MAXNUMBEROFOPENFILES        *  255
;MAXNUMBEROFOPENFILES        *  256
a76 8
ON                   *      0
OFF                  *      1
TRUE                 *      0
FALSE                *      1
SAME                 *      1
NOTSAME              *      0
SELECTED             *      1
NOTSELECTED          *      0
a77 1
accesskey            *      1
a78 4
;hostvdu      * ON               ; debug to host
;debug        * OFF              ; turn on/off debugging messages
log          * OFF              ; Keep a log of the last command attempted
bufferlist   * OFF              ; *buf displays cdfs dir buffers
a80 2
USER_DATA_SIZE      *    2324
SECTOR_SIZE         *    2340
a82 1
 GBLA counter
a83 3
;***********************
; DeviceRetryCount is used by 'CheckDevice' to do retries
;***********************
a84 1
DEVICERETRYCOUNT * 400
a85 105
;------------------------------------------
; For more info on below, see page 968
;------------------------------------------
SPECIALFIELDSSUPPORTED      * 1:SHL:31
INTERACTIVESTREAMS          * 1:SHL:30
NULLLENGTHFILENAMES         * 1:SHL:29
FSDONTLOOKFORFILE           * 1:SHL:28
INFORMOFFLUSH               * 1:SHL:27
IMAGEEXTENSIONS             * 1:SHL:23      ; RISC_OS 3 only - canoncalise names etc;
NOSTOREDIRECTORIES          * 1:SHL:21      ; RISC_OS 3 only - if set RISC OS won't store dirs
EXTRAINFO                   * 1:SHL:17      ; RISC_OS 3 only
READONLYFS                  * 1:SHL:16      ; RISC_OS 3 only
FILINGSYSTEMNUMBER          * 37

;----------------------------------------------------
; Extra filing system information word RISC_OS 3 only
;----------------------------------------------------
EXTRA_EX                    * 1:SHL:2       ; Call filing system to do *Ex  if set
EXTRA_CAT                   * 1:SHL:1       ; Call filing system to do *Cat if set
EXTRA_FSENTRYFUNC34         * 1:SHL:0       ; FSEntry_Func 34 supported if set

FILINGSYSTEMINFORMATIONWORD       * MAXNUMBEROFOPENFILES:ROL:8 + FILINGSYSTEMNUMBER + READONLYFS + EXTRAINFO + IMAGEEXTENSIONS     ;+ NOSTOREDIRECTORIES
EXTRA_FILINGSYSTEMINFORMATIONWORD * 0

;-----------------------------------------


HELPISCODE            *        32  ; bit 29 - help offset points at code not string
FILINGFLAG            *        128 ; = bit 31 see page 638
FILINGSYSTEMDEPENDENT *        128
CONFIGURECOMMAND      *         64

FSBUFFERSIZE          *       1024
MAXBUFFERSIZE         *        512 ; 512K maximum directory cache

;*************
; SWI NUMBERS
;*************

X_bit                   *        1:ROL:17

;****************
; SERVICE NUMBERS
;****************

Service_FSRedeclare     *       &40

;*************** CD driver SWI numbers *******************

CD_BaseNumber          *        &41240
                       ^        CD_BaseNumber:OR:X_bit
XCD_Version            #        1                   ;  0
XCD_ReadData           #        1                   ;  1
XCD_SeekTo             #        1                   ;  2
XCD_DriveStatus        #        1                   ;  3
XCD_DriveReady         #        1                   ;  4
XCD_GetParameters      #        1                   ;  5
XCD_SetParameters      #        1                   ;  6
XCD_OpenDrawer         #        1                   ;  7
XCD_EjectButton        #        1                   ;  8
XCD_EnquireAddress     #        1                   ;  9
XCD_EnquireDataMode    #        1                   ; 10
XCD_PlayAudio          #        1                   ; 11
XCD_PlayTrack          #        1                   ; 12
XCD_AudioPause         #        1                   ; 13
XCD_EnquireTrack       #        1                   ; 14
XCD_ReadSubChannel     #        1                   ; 15
XCD_CheckDrive         #        1                   ; 16
XCD_DiscChanged        #        1                   ; 17
XCD_StopDisc           #        1                   ; 18
XCD_ReadCapacity       #        1                   ; 19
XCD_DiscUsed           *        XCD_ReadCapacity
XCD_AudioStatus        #        1                   ; 20
XCD_Inquiry            #        1                   ; 21
XCD_DiscHasChanged     #        1                   ; 22
XCD_Control            #        1                   ; 23
XCD_Supported          #        1                   ; 24
XCD_Prefetch           #        1                   ; 25
XCD_Reset              #        1                   ; 26
XCD_CloseDrawer        #        1                   ; 27
XCD_IsDrawerLocked     #        1                   ; 28
XCD_AudioControl       #        1                   ; 29
XCD_LastError          #        1                   ; 30
XCD_AudioLevel         #        1                   ; 31
XCD_Register           #        1                   ; 32
XCD_Unregister         #        1                   ; 33
XCD_ByteCopy           #        1                   ; 34
XCD_Identify           #        1                   ; 35
XCD_ConvertToLBA       #        1                   ; 36
XCD_ConvertToMSF       #        1                   ; 37
XCD_ReadAudio          #        1                   ; 38
XCD_ReadUserData       #        1                   ; 39
XCD_SeekUserData       #        1                   ; 40

;*************** CDFS SWI numbers *******************

CDFSSWIBaseNumber              *    &41E80
                               ^ CDFSSWIBaseNumber:OR:X_bit
XCDFS_ConvertDriveToDevice     # 1
XCDFS_SetBufferSize            # 1
XCDFS_GetBufferSize            # 1
XCDFS_SetNumberOfDrives        # 1
XCDFS_GetNumberOfDrives        # 1
XCDFS_GiveFileType             # 1
XCDFS_GiveNewName              # 1
d91 1
a91 1

d115 3
a119 1
bit_29                *         1:SHL:29
a120 1
DATATYPE              *         &FFD
a121 2
READONLY              *         0 ; Only read supported
UPDATEONLY            *         2 ; Open for update, but no actual writing
a122 1
PLINGBIT              *   1:SHL:8 ; Bit in file attributes to show ! in name
a123 1
SIZEOFTEMPAREA        *         8 ; remove at end
a124 1
HARDRAMLOCATION       *       &8A ; correct location
a126 1
MAXNUMBEROFDRIVESSUPPORTED *   28
a127 5
MAXNUMBEROFDRIVES     *         7    ;  0 TO 6 ALLOWED
                                     ; 7 = HOST DEVICE
BITSUSEDBYDRIVENUMBER *    2_11111
BITSUSEDBYBUFFER      *    2_11100000
BUFFERSHIFT           *         5
a128 1
MAXLUNS               *         4
a129 1
NUMBEROFDEVICES       *         7
a130 1
NUMBEROFDRIVESPERCARD *      MAXLUNS * NUMBEROFDEVICES
a131 2
MAXLENGTHOFNAME       *        32
;MAXLENGTHOFNAMEALIGNED *       12
a132 1
MAXNUMBEROFPATHS      *         8
a133 1
SIZEOFBUFFER           *       1024*4  ; used by *playlist and CDI_LoadBlock
a134 1
LENGTHOFDISCNAME      *        32    ; Taken from PVD ( see ISO spec )
a135 2
SIZEOFPATHNAME        *   ( ( MAXLENGTHOFNAME + 1 ) * MAXNUMBEROFPATHS )                                                          + LENGTHOFDISCNAME + 2
MAXNUMBEROFENTRIES    *       256
a136 1
;*************************************
d138 14
d155 1
a155 1

a156 1

a158 15

;**********************
; Control block offsets ( used with SWI CD_... )
;**********************

DEVICEOFFSET     *   0
CARDOFFSET       *   4
LUNOFFSET        *   8
DRIVETYPEOFFSET  *  12
RESERVEDOFFSET   *  16

;************************************************
; Used by 'Directory'
;************************************************

a159 1

a186 1

a188 3
;------------------------------------------------------------


a189 1

d196 1
a196 1
; flags of files on CDs
d209 1
a209 5
HIDDENOBJECT         *      1
PUBLICACCESS         *     16
MAXSIZEDIRECTORYENTRY *   255
PVD                   *        16

a232 11

NOTFOUND             *      0
FILE                 *      1
DIRECTORY            *      2
LOCKED               *      1:SHL:3

RLRL                 *     2_010001 ; gives RL / RL access for a file

DEFAULTLOADADDRESS   *  &8000
DEFAULTEXECUTEADDRESS * &8000

d234 1
d236 2
a237 1
NUMEROFDRIVESPERCARD *    28
d239 1
a239 4
LIBLENGTH * LENGTHOFDISCNAME + ( MAXLENGTHOFNAME + 1 ) * MAXNUMBEROFPATHS + 4
URDLENGTH * LENGTHOFDISCNAME + ( MAXLENGTHOFNAME + 1 ) * MAXNUMBEROFPATHS + 4

;***********************************************
d241 1
a241 5
;***********************************************

; see 'Strings' MainDirInfo if change the hashes

                         ^ 0
d243 1
d257 1
d270 24
a293 6
;***********************************************
; Offsets in a disc buffer
;***********************************************
                            ^ 0

;LENGTHOFDIRECTORYBUFFER * ( MAXNUMBEROFENTRIES * ( MAXLENGTHOFNAMEALIGNED + OBJECTNAMEOFFSET ) )
d295 1
a295 60
DISCTYPE                                    #   1
DISCTYPEOFFSETINABUFFER                     *   DISCTYPE
DISCMODE                                    #   1
DISCMODEOFFSETINABUFFER                     *   DISCMODE
wasted1                                     #   1           ; wasted bytes
wasted2                                     #   1           ; to align rest
SIZEOFDISC                                  #   4
SIZEOFDISCOFFSETINABUFFER                   *   SIZEOFDISC
LBAOFMAINDIR                                #   4
LBAOFMAINDIROFFSETINABUFFER                 *   LBAOFMAINDIR
LENGTHOFMAINDIR                             #   4
LENGTHOFMAINDIROFFSETINABUFFER              *   LENGTHOFMAINDIR
BLOCKSIZE                                   #   4
BLOCKSIZEOFFSETINABUFFER                    *   BLOCKSIZE
DISCNAME                                    #   LENGTHOFDISCNAME + 4
DISCNAMEOFFSETINABUFFER                     *   DISCNAME
MAINDIRECTORY                               #   0
MAINDIRECTORYOFFSETINABUFFER                *   MAINDIRECTORY

; put no more entries here, as it does not finish word-aligned !

ENDOFDISCBUFFER                             #   0

LENGTHOFDISCBUFFER                          *   ENDOFDISCBUFFER

;***********************************************
; Offsets for information returned by 'Enumerate Device'
;***********************************************

                 ^ 0

rubbish_length          * 8
vendor_length           * 8
product_length          * 16
revision_length         * 4

rubbish          # rubbish_length        ; used in the 'Test' initialising code
vendor           # vendor_length
product          # product_length
revision         # revision_length

vendor_offset           * vendor
product_offset          * product
revision_offset         * revision

TOSHIBA_NEW_TYPE        * 3301             ; New type of drive revision level
TOSHIBA_NEW_TYPE_HI     * TOSHIBA_NEW_TYPE:AND:&FF00
TOSHIBA_NEW_TYPE_LO     * TOSHIBA_NEW_TYPE:AND:&00FF

;***********************
; Details for CDFSFiler sprite held in memory
;***********************

SPRITELOADADDRESS       *  &FFFFF942
SPRITEEXECUTIONADDRESS  *  &4C25415F
SPRITEFILEATTRIBUTES    *  &00000011



;***********************
d297 1
a297 1
;***********************
a301 1

d314 1
a314 3


;***********************
d316 1
a316 13
;***********************

                ^ 0

STARTLBAOPEN    #   4
DISCNUMBEROPEN  #   4
SIZEOFBLOCKOPEN #   4
SIZEOFFILEOPEN  #   4
FILESWITCHHANDLE #  4
DRIVENUMBEROPEN #   1
DISCMODEOPEN    #   1
DISCNAMEOPEN    #   LENGTHOFDISCNAME
DISCNAMEOPENOFFSET * DISCNAMEOPEN
d318 10
a327 1
SizeOfOpenBuffer # 0
d329 1
d331 1
a331 1
;***********************
d333 1
a333 8
;***********************

                ^ 0
bufferexe        #  100
namebufferexe    #    5
numberbufferexe  #   10
fileextensionexe #    5

d335 5
d341 1
a341 1
;**********************
d343 1
a343 1
;**********************
d345 8
a352 1
; Currently, without a lot of hassle max_blocks_buffered must = 1
d354 1
a354 17
MAX_BLOCKS_BUFFERED * 1      ; Maximum ISO blocks buffered : my buffer

                 ^ 0
DISC             #    4      ; 0
POINTER          #    4      ; 4
BLOCK            #    4      ; 8
BLOCKY_OFFSET    #    4      ; 12 ;No limit to number of entries in a direct

SIZEOFBUFFERENTRY # 0        ; 16


 GBLA CDFSErrorNumber
CDFSErrorNumber SETA ErrorBlock + 64



;*********************
d356 1
a356 1
;*********************
a358 1

d362 1
a362 1
DISCNAMEOFFSETFORDESCRIBE   #  LENGTHOFDISCNAME
d366 3
d370 8
d379 1
d381 2
a382 2
; no longer applicable
;NUMBEROFBLOCKSBUFFERED * 5  ; Buffer blocks for GBPB
d384 3
a386 39
;*****************
; Returns from CD_DriveReady
;*****************

READY                 *  0
NOTREADY              *  1

;*****************

BUSYRETRYTIME         *  5 * 100   ; Retry if drive is busy for 2 seconds - see 'TestKnowDisc'


;*****************
; Drive types - shouldn't really need to use them, but keep anyway
;*****************

SONY_OLD     * 0
LMS231       * 1
TOSHIBA_OLD  * 2
TOSHIBA_NEW  * 5
SONY_NEW     * 6
CDR          * 7
NUMBEROFDRIVETYPES * 8

;*****************
; Upcall stuff
;*****************

Medium_Not_Present * 1
Medium_Found       * 4

;*****************
; This flag signals whether any more blocks need to be looked for.
; It sits above the block offset value.
;*****************

more_blocks * 1:SHL:31

;*****************
d388 16
d448 1
a448 49
;----------------------------------------------------------------------------------------------
; CD-ROM XA (to which CD-I complies) additional system use information in directory record
;----------------------------------------------------------------------------------------------

                   ^  0
XA__OWNER_ID       #  4       ;  0
XA__ATTRIBUTES_1   #  1       ;  4
XA__ATTRIBUTES_2   #  1       ;  5
XA__SIGNATURE_1    #  1       ;  6
XA__SIGNATURE_2    #  1       ;  7
XA__FILE_NUMBER    #  1       ;  8
XA__RESERVED       #  5       ;  9

XA__LENGTH         #  0       ; 14

ID__XA_SIGNATURE_1 *  'X'
ID__XA_SIGNATURE_2 *  'A'

;----------------------------------------------------------------------------------------------
; CD-ROM XA attributes stored in additional system use
;----------------------------------------------------------------------------------------------

ATTRIBUTES__XA_OWNER_READ     *    1:SHL:0
ATTRIBUTES__XA_RESERVED_1     *    1:SHL:1
ATTRIBUTES__XA_OWNER_EXECUTE  *    1:SHL:2
ATTRIBUTES__XA_RESERVED_2     *    1:SHL:3
ATTRIBUTES__XA_GROUP_READ     *    1:SHL:4
ATTRIBUTES__XA_RESERVED_3     *    1:SHL:5
ATTRIBUTES__XA_GROUP_EXECUTE  *    1:SHL:6
ATTRIBUTES__XA_RESERVED_4     *    1:SHL:7
ATTRIBUTES__XA_WORLD_READ     *    1:SHL:8
ATTRIBUTES__XA_RESERVED_5     *    1:SHL:9
ATTRIBUTES__XA_WORLD_EXECUTE  *    1:SHL:10
ATTRIBUTES__XA_MODE_2         *    1:SHL:11
ATTRIBUTES__XA_MODE_2_FORM_2  *    1:SHL:12
ATTRIBUTES__XA_INTERLEAVED    *    1:SHL:13
ATTRIBUTES__XA_CDDA           *    1:SHL:14
ATTRIBUTES__XA_DIRECTORY      *    1:SHL:15  ; This is the same as the ISO directory flag

;----------------------------------------------------------------------------------------------
; Useful file types
;----------------------------------------------------------------------------------------------

FILETYPE__MPEG                *    &BF8
FILETYPE__DATA                *    &FFD

;----------------------------------------------------------------------------------------------

 END
@


4.7
log
@Resolve the 32 assembler warnings
Mostly by swapping STASH/GRAB for Push/Pull macros.
Inlined the module header rather than defining it in a header file.
Renamed "Debug" macro to "DebugInline" to avoid clash with similarly named macro.

Version 2.53. Tagged as 'CDFS-2_53'
@
text
@a53 3
NUMBEROFDEMOTRIES * 150
demoversion * OFF              ; Only allow 'NUMBEROFDEMOTRIES' number of cd operations

@


4.6
log
@  Grubbing around with * commands.
Detail:
  * Added *Free.
  * Gave *Mount and *Dismount some help, based on the PRMs.
Admin:
  Tested on Tungsten.

Version 2.46. Tagged as 'CDFS-2_46'
@
text
@a17 42
;----------------------------------------------------------------------------------------------

;*** Register names used by all routines except 'copymem' ****************

PC  RN 15                   ; Define register names
LR  RN 14
SP  RN 13
R14 RN 14
R13 RN 13
R12 RN 12                   ; This register is linked to the variables in w/s
R11 RN 11
R10 RN 10
R9  RN  9
R8  RN  8
R7  RN  7
R6  RN  6
R5  RN  5
R4  RN  4
R3  RN  3
R2  RN  2
R1  RN  1
R0  RN  0

pc  RN 15
lr  RN 14
sp  RN 13
r14 RN 14
r13 RN 13
r12 RN 12                   ; This register is linked to the variables in w/s
r11 RN 11
r10 RN 10
r9  RN  9
r8  RN  8
r7  RN  7
r6  RN  6
r5  RN  5
r4  RN  4
r3  RN  3
r2  RN  2
r1  RN  1
r0  RN  0

@


4.5
log
@  A few fixes.
Detail:
  * Fixed a couple of top-bit-set pointer problems
  * Fixed a couple of places where it was assumed that SWIs preserved flags
  * Uses kernel internationalisation for command help, so full tokenisation
    now works properly
  * Added NdrDebug support
Admin:
  Tested on Tungsten.

Version 2.41. Tagged as 'CDFS-2_41'
@
text
@d693 3
@


4.4
log
@  Lots of changes for RISC OS 5.
Detail:
  * Updated to use objasm, shared makefiles and global headers
  * Ripped out lots of RISC OS 2 support code so we can see the wood for the
    trees now
  * 32-bit compatible (a bit of a slog)
  * Now has its own resources phase, replacing the use of the CDFSResources
    module. Also means that messages can now be tokenised properly. For
    good measure, split out CmdHelp tokens into separate file
  * Hopefully fixed more bugs along the way than I introduced. I've seen
    lots of nasty stack imbalances in error cases, but not fixed all of
    them, I'm afraid
Admin:
  Tested briefly on a Risc PC; not enough support modules to run on Tungsten
  yet.

Version 2.38. Tagged as 'CDFS-2_38'
@
text
@d99 2
a100 2
hostvdu      * ON               ; debug to host
debug        * OFF              ; turn on/off debugging messages
@


4.3
log
@Manual merge of the RISC OS 4.02 version of CDFS (2.37, based upon Acorn's
RiscOS/UnU/OS_Core/FileSys/CDFS/CDFS234 version 2.35).

Tagged as 'CDFS-2_37'
@
text
@a18 5
; This allows conditional compilation for RISC OS 2 or 3
;----------------------------------------------------------------------------------------------
RISC_OS       * 3          ; MUST BE 2, 3 or more (?)

;----------------------------------------------------------------------------------------------
a73 1
I_bit                 *  &08000000
a137 4
 [ RISC_OS = 2
FILINGSYSTEMINFORMATIONWORD       * MAXNUMBEROFOPENFILES:ROL:8 + FILINGSYSTEMNUMBER
EXTRA_FILINGSYSTEMINFORMATIONWORD * 0
 |
a139 1
 ]
a157 42
XOS_WriteC             *        0:OR:X_bit
XOS_WriteS             *        &1:OR:X_bit
XOS_Write0             *        &2:OR:X_bit
XOS_NewLine            *        &3:OR:X_bit
XOS_CLI                *        &5:OR:X_bit
XOS_Byte               *        &6:OR:X_bit
XOS_Args               *        &9:OR:X_bit
XOS_BGet               *        &A:OR:X_bit
XOS_Find               *        &D:OR:X_bit
XOS_Module             *        &1E:OR:X_bit
XOS_ReadUnsigned       *        &21:OR:X_bit
XOS_ReadVarVal         *        &23:OR:X_bit
XOS_SetVarVal          *        &24:OR:X_bit
XOS_GSTrans            *        &27:OR:X_bit
XOS_BinaryToDecimal    *        &28:OR:X_bit
XOS_FSControl          *        &29:OR:X_bit
XOS_EvaluateExpression *        &2D:OR:X_bit
XOS_UpCall             *        &33:OR:X_bit
XOS_ReadMonotonicTime  *        &42:OR:X_bit
XOS_PrettyPrint        *        &44:OR:X_bit
XOS_WriteN             *        &46:OR:X_bit
XOS_ReadSysInfo        *        &58:OR:X_bit
XOS_CRC                *        &5B:OR:X_bit
XOS_WriteI             *        &100:OR:X_bit
XOS_ConvertDateAndTime *        &C0:OR:X_bit
XOS_ConvertHex8        *        &D4:OR:X_bit
XOS_ConvertCardinal1   *        &D5:OR:X_bit
XOS_ConvertCardinal2   *        &D6:OR:X_bit
XOS_ConvertCardinal4   *        &D8:OR:X_bit
XOS_ConvertFixedFileSize *      &EB:OR:X_bit

XSCSI_Control          *        &403c2:OR:X_bit
XMessageTrans_OpenFile *        &41501:OR:X_bit
XMessageTrans_Lookup   *        &41502:OR:X_bit
XMessageTrans_CloseFile *       &41504:OR:X_bit
XMessageTrans_ErrorLookup *     &41506:OR:X_bit
XMessageTrans_GSLookup *        &41507:OR:X_bit
XResourceFS_RegisterFiles *     &41b40:OR:X_bit
XResourceFS_DeregisterFiles *   &41b41:OR:X_bit
XHostFS_HostVdu       *       &40100:OR:X_bit
XHostFS_TubeVdu       *       &40101:OR:X_bit

a657 2
 [ RISC_OS > 2

a671 1
 ]
a676 3
 [ RISC_OS > 2


a692 2

 ]
@


4.2
log
@This is a manual merge of CDFS 2.35 from RiscOS/UnU/OS_Core/CDFS/CDFS234
treating nturton_CDFS-2_29 as the branch point.
@
text
@d26 1
a26 1
 
a109 2
CheckConfiguredDrives   * ON    ; don't start up if conf.drives=0

d269 4
a272 4
XCDFS_SetBufferSize            # 1      
XCDFS_GetBufferSize            # 1       
XCDFS_SetNumberOfDrives        # 1       
XCDFS_GetNumberOfDrives        # 1       
d414 2
d417 7
d436 1
d442 13
d551 1
a551 1
product          # product_length 
d597 1
a597 1
 
d753 1
a753 1
 ]                 
d799 1
@


4.1
log
@Initial revision
@
text
@d66 8
d113 4
d262 3
d341 1
a341 1
SIZEOFBUFFER           *       1024*4  ; used by *playlist
d379 1
d381 1
d384 6
a390 1
ISOLOGICALBLOCKSIZEOFFSET             * 128
a391 1
ISOPOINTERTOROOTDIRECTORYOFFSET       * 158
a392 1
ISOTYPEOFFSET                         *      1
a393 1
ISOFLAGSOFFSET                        *     25
a394 1
ISOPOINTERTOSIZEOFMAINDIRECTORY       * 158 + 12 ; DATA LENGTH OF ROOT DIR
d397 11
d413 1
d415 1
d417 3
d460 12
a471 10
LBASTART           #   0
OBJECTTYPE         #   0    ; Really only needs to be one bit
WASTER             #   4
LOADADDRESS        #   4    ; Keep together ( see 'INFO' & '; 15' )
EXECUTIONADDRESS   #   4    ;
LENGTH             #   4
TIMEDATE           #   4
TIMEDATEHIBYTE     #   1
FILEATTRIBUTES     #   1
OBJECTNAME         #   0    ; Variable length ( last parameter ! )
d481 2
d733 45
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
