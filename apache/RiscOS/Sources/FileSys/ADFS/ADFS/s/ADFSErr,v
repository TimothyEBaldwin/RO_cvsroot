head	4.2;
access;
symbols
	ADFS-3_54:4.2
	ADFS-3_53:4.2
	ADFS-3_52:4.2
	ADFS-3_51:4.2
	ADFS-3_50:4.2
	ADFS-3_49:4.2
	ADFS-3_48:4.1
	ADFS-3_47:4.1
	ADFS-3_46:4.1
	ADFS-3_45:4.1
	ADFS-3_44:4.1
	ADFS-3_43:4.1
	ADFS-3_42:4.1;
locks; strict;
comment	@# @;


4.2
date	2015.10.28.21.18.58;	author rsprowson;	state Exp;
branches;
next	4.1;
commitid	eQ0PZPWgLdfy7VGy;

4.1
date	2012.03.19.01.03.05;	author bavison;	state Exp;
branches;
next	;
commitid	hgQDqMrEQt76LqXv;


desc
@@


4.2
log
@Refactor unaligned LDM in old style error return
Would only trigger if ADFS was being run on an ARMv7 but using an old style FileCore that didn't support the new error scheme, hence mostly for completeness.
Spotted by Jon Abbott, ref https://www.riscosopen.org/forum/forums/4/topics/3682

Typo in error string corrected in passing.

Version 3.49. Tagged as 'ADFS-3_49'
@
text
@
        GBLS    FSName
FSName  SETS    "adfs"

        GBLS    fcerror
fcerror SETS    "FSErr"

        MACRO
$num    FSErr   $name, $str
        =       "        AddError $FSName.$name, ""$str"", &"
        =       :STR: (&10000 + fsnumber_$FSName:SHL:8 + &$num), 10
        MEND


        GET     ListOpts
        GET     FSNumbers

        AREA    Text, DATA

        ; File header
        =       "; This is an autogenerated file, do not edit", 10, 10

        ; Define all the errors that FileCore generates for the FS
        GET     FileCoreErr

        ; Define additional FS errors
11      FSErr   FormatEsc, Escape whilst formatting (disc structure invalid)
70      FSErr   FormatNotSupportedOnWinnie, Format not available for Winnies
71      FSErr   DensityNotSupported, Density not supported
72      FSErr   SectorSizeNotSupported, Sector size not supported
73      FSErr   TooManySectors, Too many sectors on a track
74      FSErr   BadFormat, Bad format
75      FSErr   TooManyDefects2, Too many defects
76      FSErr   NoFloppy, Floppy drive not connected
A0      FSErr   DriverInUse, Driver in use

        ; File footer
        =       10, "        END", 10

        ; Pad to word alignment with newline characters
        ALIGN   4, 0, 10


        END
@


4.1
log
@  Reworked error code
Detail:
  Now uses Hdr:FileCoreErr rather than containing its own definitions of the
  low-level FileCore error numbers. Autogenerates and exports a new header,
  Hdr:ADFSErr, and a C version of the same, containing error definitions
  within the ADFS error block, derived from the error offsets from
  Hdr:FileCoreErr plus the ADFS-specific errors. s.AdfsErrors is now only
  used to list the errors for which an error block needs to be allocated for
  ADFS's own use.
Admin:
  No changes to the binary.

Version 3.42. Tagged as 'ADFS-3_42'
@
text
@d30 1
a30 1
72      FSErr   SectorSizeNotSupported, Sectors size not supported
@

