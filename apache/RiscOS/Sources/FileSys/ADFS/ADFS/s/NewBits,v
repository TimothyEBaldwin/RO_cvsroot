head	4.9;
access;
symbols
	ADFS-3_54:4.9
	ADFS-3_53:4.9
	ADFS-3_52:4.9
	ADFS-3_51:4.9
	ADFS-3_50:4.9
	ADFS-3_49:4.9
	ADFS-3_48:4.9
	ADFS-3_47:4.9
	ADFS-3_46:4.9
	ADFS-3_45:4.8
	ADFS-3_44:4.8
	ADFS-3_43:4.8
	ADFS-3_42:4.8
	ADFS-3_41:4.8
	ADFS-3_40:4.7
	ADFS-3_39:4.7
	ADFS-3_38:4.7
	ADFS-3_37:4.7
	ADFS-3_36:4.6
	RO_5_07:4.6
	ADFS-3_35:4.6
	ADFS-3_34:4.6
	ADFS-3_33:4.4
	dellis_autobuild_BaseSW:4.3
	ADFS-3_32:4.3
	Ursula_merge:4.2.2.1
	Ursula_RiscPC_merge:4.2.2.1
	sbrodie_sedwards_16Mar2000:4.2
	dcotton_autobuild_BaseSW:4.4
	sbrodie_UrsulaRiscPC_ADFS-3_30:4.2.2.1
	Ursula_RiscPC_bp:4.2.2.1
	nturton_ADFS-3_29:4.2
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2.2.1
	Ursula_RiscPC:4.2.2.1.0.2
	sproven_ADFS-3_31:4.2.2.2
	nicke_ADFS_3_26:4.1.7.1
	rthornb_UrsulaBuild-19Aug1998:4.2.2.1
	UrsulaBuild_FinalSoftload:4.2.2.1
	rthornb_UrsulaBuild-12Aug1998:4.2.2.1
	aglover_UrsulaBuild-05Aug1998:4.2.2.1
	rthornb_UrsulaBuild-29Jul1998:4.2.2.1
	rthornb_UrsulaBuild-22Jul1998:4.2.2.1
	hsimons_BOCA-1_2-Release:4.1.7.1
	rthornb_UrsulaBuild-15Jul1998:4.2.2.1
	rthornb_UrsulaBuild-07Jul1998:4.2.2.1
	rthornb_UrsulaBuild-17Jun1998:4.2.2.1
	rthornb_UrsulaBuild-03Jun1998:4.2.2.1
	rthornb_UrsulaBuild-27May1998:4.2.2.1
	rthornb_UrsulaBuild-21May1998:4.2.2.1
	rthornb_UrsulaBuild_01May1998:4.2.2.1
	sproven_330:4.2.2.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.2.0.6
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.9
date	2012.10.21.11.42.57;	author rsprowson;	state Exp;
branches;
next	4.8;
commitid	yOiiX7g8HT2Zlfpw;

4.8
date	2011.10.14.07.38.47;	author rsprowson;	state Exp;
branches;
next	4.7;
commitid	tK3tjaAo92QGZhDv;

4.7
date	2010.12.06.14.14.47;	author bavison;	state Exp;
branches;
next	4.6;

4.6
date	2003.01.17.19.33.28;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	2002.09.18.15.03.30;	author kbracey;	state Exp;
branches;
next	4.4;

4.4
date	2000.11.17.12.25.56;	author bavison;	state Exp;
branches;
next	4.3;

4.3
date	2000.07.11.10.39.25;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.01.21.16.00.31;	author nturton;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.31.24;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.2.2.1
date	98.04.17.16.34.54;	author sproven;	state Exp;
branches;
next	4.2.2.2;

4.2.2.2
date	98.09.02.18.37.43;	author sproven;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.31.24;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.35.43;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.29.26;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.24.55;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.9
log
@Tabs expanded
Assembler source uses spaces round here in general, follow suit.
Not tagged.
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
        GBLL    FileCache
FileCache SETL  {TRUE}

        GBLL    NewFs
NewFs   SETL    {TRUE}

        GBLL    TickerVPatch    ;patch to release TickerV when loading to
                                ;replace versions 0.02,0.03 which left claimed
TickerVPatch SETL {FALSE}

        GBLL    PodFix
PodFix  SETL    {TRUE}

        GBLL    WTEST
WTEST   SETL    {TRUE}

; 32-bit mode proof fiq handling
; This is 26-bit mode proof, so no need to make it machine dependant
        GBLL    FIQ32bit
FIQ32bit        SETL    {TRUE}

; Enables control over whether Engineering mode verify is enabled
; or disabled on the IDE controller (default disabled)
        GBLL    EngineeringMode
EngineeringMode SETL    {TRUE}

        GBLL    IDEPower
IDEPower        SETL    {TRUE}

; allow auto-detection of IDE devices
        GBLL    AutoDetectIDE
AutoDetectIDE   SETL    {TRUE}

; new 32-bit FileCore error reporting scheme
        GBLL    NewErrors
NewErrors       SETL    {TRUE}

 [ NewErrors
NewErrorBit * CreateFlag_NewErrorSupport
 |
NewErrorBit * 0
 ]

; updated semantics of scatter list to allow background transfer
; to/from top-bit set logical addresses
        GBLL    FixTBSAddrs
FixTBSAddrs     SETL    {TRUE}
ScatterListNegThresh    *       &10000

        END
@


4.8
log
@Update to use some of the exported FileCore headers.
There are still a large number of local copies that should be visited, but this change at least allows it to assemble again FileCore-3_45.
Tungsten and IOMD variants assemble, but others untested.

Version 3.41. Tagged as 'ADFS-3_41'
@
text
@a43 4
; enables Ursula-style service table
	GBLL	ServicePolice
ServicePolice	SETL	{TRUE}

d45 2
a46 2
	GBLL	AutoDetectIDE
AutoDetectIDE	SETL	{TRUE}
@


4.7
log
@  Reintroduced support for IOMD machines
Detail:
  There was no "Ver" file for Machine=32, and the code for build switch
  settings appropriate for IOMD had not been kept up-to-date with various
  changes to the module which were made to support Tungsten. This version
  provides working IDE support for IOMD HAL builds, although there are
  still some issues with floppy support. Tungsten builds should be
  functionally identical.
Admin:
  Tested on a Risc PC. Joint development effort by Tom Walker and Ben Avison.

Version 3.37. Tagged as 'ADFS-3_37'
@
text
@d57 1
a57 1
NewErrorBit * NewErrorSupport
@


4.6
log
@* ADFS_DiscOp64 and ADFS_ATAPIOp added.
* New FileCore error passing scheme supported.
* PCI floppy support functional.
* 48-bit LBA support added for ADFS_IDEUserOp and accessing beyond the
  first 128GB of a drive - not thoroughly tested.
* IDE autodetection improved

Version 3.34. Tagged as 'ADFS-3_34'
@
text
@a51 3
	GBLL	TwinIDEHardware
TwinIDEHardware	SETL	{TRUE}

@


4.5
log
@32-bit conversion started, Tungsten hard disc support added.
Hard disc functional, but PIO mode only. Don't go near the floppy.

Version 3.33. Not tagged
@
text
@d55 10
@


4.4
log
@  Loading to/saving from top-bit-set addresses should now work.
Detail:
  The problem was in the API definition of the scatter lists used in
  background data transfer. These consist of a sequence of word pairs,
  holding addresses and lengths; any negative (ie top-bit-set) address word
  is defined to mean that the list continues at an location that is offset
  by that amount. To get around this, the check is now made not on whether
  the address word is negative, but on whether it is equal to or greater
  than (less negative than) &FFFF0000. This means that accesses to these
  addresses will still fail, but such addresses should be reserved for
  system use anyway.
Admin:
  Tested briefly.

Version 3.33. Tagged as 'ADFS-3_33'
@
text
@a14 3
        GBLL    MEMC1A
MEMC1A  SETL    {TRUE}

d47 7
@


4.3
log
@  Ursula_RiscPC branch merged.

Detail:
  The Ursula_RiscPC branch contained version 3.30 of ADFS, which had
  minimal updates for Ursula, such as the service call table. This
  version, incorporating changes on the Ursula branch up to
  the Ursula_RiscPC_bp tag, is now merged on to the trunk as 3.32.
  This leaves version 3.31 on the Ursula branch, unmerged. This contains
  unfinished support for auto-detection of IDE drives and support for
  Phoebe hardware.

Version 3.32. Tagged as 'ADFS-3_32'
@
text
@d51 6
@


4.2
log
@Version Spin_merge taken
@
text
@d47 4
@


4.2.2.1
log
@Updated to use new Ursula service table.
@
text
@a46 4
; enables Ursula-style service table
	GBLL	ServicePolice
ServicePolice	SETL	{TRUE}

@


4.2.2.2
log
@This version of ADFS implements support for Ursula discs and stuff.

New SWI ADFS_IDEDeviceInfo

ADFS_IDEUserOp, ADFS_ControllerType modified for more drives.

Low level driver modified to use twin controllers.

Auto-detection of devices.  ProbeIDEDevices implemented to find them.

Mapping of devices made flexible to cope with any arrangement of devices.

Code to use ID information instead of boot block numbers not yet active,
needs to be brought up to date with autodetect code, and needs to do the
LBA side of things properly.

*configure IDETimeout added.

This uses CMOS byte 189, which ADFS previously used for approx winnie sizes,
but this is obsolete use.

To do:


Need to remove *configure IDEDiscs!

Need to support fast PIO modes and selection of appropriate mode.
@
text
@a50 15
; enables floppy-like mount of IDE discs

	GBLL	UseIdentify
UseIdentify	SETL	{FALSE}

; allow auto-detection of IDE devices
	GBLL	AutoDetectIDE
AutoDetectIDE	SETL	{TRUE}

	GBLL	TwinIDEHardware
TwinIDEHardware	SETL	{TRUE}

	GBLL	NewFloppyHardware
NewFloppyHardware SETL	{TRUE}

@


4.1
log
@Initial revision
@
text
@d44 3
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@a43 3
        GBLL    IDEPower
IDEPower        SETL    {TRUE}

@


4.1.5.1
log
@Import from SrcFiler
@
text
@a43 3
        GBLL    IDEPower
IDEPower        SETL    {TRUE}

@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@a43 3
        GBLL    IDEPower
IDEPower        SETL    {TRUE}

@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
