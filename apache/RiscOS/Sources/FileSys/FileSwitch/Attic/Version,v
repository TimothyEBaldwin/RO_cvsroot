head	4.5;
access;
symbols
	FileSwitch-2_69:4.4
	FileSwitch-2_68:4.4
	FileSwitch-2_67:4.4
	RO_5_07:4.4
	FileSwitch-2_66:4.4
	FileSwitch-2_65:4.4
	FileSwitch-2_64:4.4
	FileSwitch-2_63:4.4
	FileSwitch-2_62:4.4
	FileSwitch-2_61:4.4
	FileSwitch-2_60:4.4
	FileSwitch-2_59:4.4
	FileSwitch-2_58:4.4
	FileSwitch-2_57:4.4
	FileSwitch-2_56:4.4
	FileSwitch-2_55:4.4
	FileSwitch-2_54:4.4
	FileSwitch-2_53:4.4
	dellis_autobuild_BaseSW:4.4
	FileSwitch-2_52:4.4
	FileSwitch-2_51:4.4
	ROLtd-4_02:4.3.2.7
	FileSwitch-2_45:4.3.2.7
	Ursula_merge:4.3.2.7
	FileSwitch-2_50:4.4
	sbrodie_sedwards_16Mar2000:4.4
	FileSwitch-2_41:4.4
	dcotton_Spin_merge:4.1.7.1
	FileSwitch-2_40:4.4
	dcotton_autobuild_BaseSW:4.4
	FileSwitch-2_39:4.4
	FileSwitch-2_43:4.3.2.6
	Ursula_FileSwitch-2_42:4.3.2.5
	mstphens_UrsulaRiscPCBuild_20Nov98:4.3.2.4
	Ursula_RiscPC:4.3.2.4.0.2
	nicke_FileSwitch-2_29:4.1.7.1
	FileSwitch-2_38:4.4
	rthornb_UrsulaBuild-19Aug1998:4.3.2.4
	UrsulaBuild_FinalSoftload:4.3.2.4
	rthornb_UrsulaBuild-12Aug1998:4.3.2.4
	aglover_UrsulaBuild-05Aug1998:4.3.2.4
	rthornb_UrsulaBuild-29Jul1998:4.3.2.4
	rthornb_UrsulaBuild-22Jul1998:4.3.2.4
	rthornb_UrsulaBuild-15Jul1998:4.3.2.4
	rthornb_UrsulaBuild-07Jul1998:4.3.2.4
	rthornb_UrsulaBuild-17Jun1998:4.3.2.4
	rthornb_UrsulaBuild-03Jun1998:4.3.2.4
	rthornb_UrsulaBuild-27May1998:4.3.2.4
	rthornb_UrsulaBuild-21May1998:4.3.2.4
	rthornb_UrsulaBuild_01May1998:4.3.2.4
	afrost_Funai01-33:4.1.7.1
	afrost_NC2_Generic:4.1.7.1
	sproven_241:4.3.2.4
	sproven_2_40:4.3.2.3
	sproven_2_38:4.3.2.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.3.0.4
	Daytona_bp:4.3
	Ursula:4.3.0.2
	Ursula_bp:4.3
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.2
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.5
date	2011.10.20.20.17.47;	author rsprowson;	state dead;
branches;
next	4.4;
commitid	Y5wScswtCs4a08Ev;

4.4
date	98.10.22.13.35.22;	author nturton;	state Exp;
branches;
next	4.3;

4.3
date	97.05.02.09.22.01;	author kbracey;	state Exp;
branches
	4.3.2.1;
next	4.2;

4.2
date	97.01.14.17.11.34;	author nturton;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.32.40;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.3.2.1
date	98.03.27.10.46.05;	author sproven;	state Exp;
branches;
next	4.3.2.2;

4.3.2.2
date	98.03.27.12.42.41;	author mstphens;	state Exp;
branches;
next	4.3.2.3;

4.3.2.3
date	98.04.07.11.07.20;	author sproven;	state Exp;
branches;
next	4.3.2.4;

4.3.2.4
date	98.04.16.14.49.00;	author sproven;	state Exp;
branches;
next	4.3.2.5;

4.3.2.5
date	98.12.17.16.16.13;	author sbrodie;	state Exp;
branches;
next	4.3.2.6;

4.3.2.6
date	99.01.18.10.45.55;	author sbrodie;	state Exp;
branches;
next	4.3.2.7;

4.3.2.7
date	2000.03.20.14.55.32;	author kbracey;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.32.40;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.00.49.00;	author nturton;	state Exp;
branches
	4.1.3.1.2.1;
next	4.1.3.2;

4.1.3.2
date	97.05.01.14.33.29;	author kbracey;	state Exp;
branches;
next	;

4.1.3.1.2.1
date	97.04.30.12.02.05;	author kbracey;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.36.05;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.32.44;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.5
log
@Fix for *COPY finishing too early with files > 2G
Same drill, V was being set or not preserved when it shouldn't or should be. In light of this all locations that do CMP/SUBS/ADDS involving fileptr/extent/anything ending in size or length have been reviewed and ammended where needed.
Trim some dead code.
Discard 'Version' file.

Version 2.70. Tagged as 'FileSwitch-2_70'
@
text
@; > Version

        GET     VersionASM
        GBLA    Version

Version SETA    Module_Version

        END
@


4.4
log
@Now copes with SWI OS_SynchroniseCodeAreas returning an error.  The old
code preserved the V bit, but trashed r0.

Version 2.38. Tagged as 'FileSwitch-2_38'
@
text
@@


4.3
log
@Version RO_3_71 merged
@
text
@d3 1
a4 2
        GBLS    VString
        GBLS    Date
d6 1
a6 3
Version SETA    237              ; FileSwitch
VString SETS    "2.37"           ; 1.54
Date    SETS    "02 May 1997"   ; 02 Sep 1988
@


4.3.2.1
log
@Modified to add truncation of long file names in *cat, *info, *fileinfo
*ex and *lex.
@
text
@d7 3
a9 3
Version SETA    238              ; FileSwitch
VString SETS    "2.38"           ; 1.54
Date    SETS    "27 Mar 1998"   ; 02 Sep 1988
@


4.3.2.2
log
@add code to use pre-allocated blocks rather than stressing SysHeap
  (speed up - see MercifulToSysHeap)
update service handler to Ursula format
@
text
@d7 3
a9 3
Version SETA    239              ; FileSwitch
VString SETS    "2.39"           ; 1.54
Date    SETS    "27 Mar 1998"    ; 02 Sep 1988
@


4.3.2.3
log
@Fixed bug whereby *info <filename> (where the filename is not wildcarded)
gives the error "buffer overflow".  Error also fixed for *fileinfo.
@
text
@d7 3
a9 3
Version SETA    240              ; FileSwitch
VString SETS    "2.40"           ; 2.40
Date    SETS    "07 Apr 1998"    ; 07 Apr 1998
@


4.3.2.4
log
@Updated the FSControl code to make the copy operation use a dynamic area,
instead of the free pool.  The maximum size of this dynamic area is set as
the size of the 'next' slot.  This prevents the problems associated with
*copy where it will claim all the free memory, thus stoppping for example
filecore from growing its directory buffer, or zap from growing its dynamic
area.  This makes multiple *copies in task windows usable.
@
text
@d7 3
a9 3
Version SETA    241              ; FileSwitch
VString SETS    "2.41"           ; 2.10
Date    SETS    "16 Apr 1998"    ; 16 Apr 1998
@


4.3.2.5
log
@  Import of SProven's version 2.42 which hasn't been checked in previously.
Detail:
  The difference from 2.41 is that this version sets up the *copy dynamic
    area with the next slot output value of Wimp_SlotSize, or a default
    value of 640K if that SWI fails, instead of the Free slot.
Admin:
  Module identifies itself as FileSwitch 2.42 (22 Apr 1998) and is that
    module which several people appear to be softloading.

Tagged as Ursula_FileSwitch-2_42.
@
text
@d7 3
a9 3
Version SETA    242              ; FileSwitch
VString SETS    "2.42"           ; 2.10
Date    SETS    "22 Apr 1998"    ; 16 Apr 1998
@


4.3.2.6
log
@  Improved FileSwitch's defence against faulty filesystems to fix memory
    leak shown up by NFS module.
Detail:
  When FileSwitch wants to canonicalise a disc name and special field,
    it calls the filing systems (those which have the capability) to
    perform this operation.  It allocates memory blocks from the System
    Heap to store the results, only freeing the respective block if the
    filing system said that there was no special field and/or disc name.
    However, it relies on the filing system remembering to exit with R1
    = R3 on entry, and R2 = R4 on entry (FSEntry_Func 23; PRM 2-570).
    NFS forgets to do this and other FSes have been alleged to forget too.
    FileSwitch now defends itself against such filesystems to ensure that
    these leaks can no longer occur.  NFS has been fixed too (in 2.37)
    The result of this leak is to fill the system heap with orphaned
    blocks and, typically, lots of fragmentation of free space in the heap
    causing the machine to become sluggish after several hours of uptime
    as the heap is continually scanned during block allocation.
Admin:
  Built into Ursula softload ROM image for testing and verified that the
    test program (which just attempts repeated canonicalisation of an NFS
    filename with a special field) no longer causes the System Heap to
    fill up with blocks containing the special field.
@
text
@d7 3
a9 3
Version SETA    243              ; FileSwitch
VString SETS    "2.43"           ; 2.10
Date    SETS    "18 Jan 1999"    ; 18 Jan 1999
@


4.3.2.7
log
@  Merge of RISC OS Ltd version 2.41.
Detail:
  Version from RISC OS 4.02 merged in manually - some sbrodie/sproven fixes
  were not present in ROL version.
Admin:
  Not tested.
  Tagged as FileSwitch-2_45.
@
text
@d7 3
a9 3
Version SETA    244              ; FileSwitch
VString SETS    "2.44"           ; 2.10
Date    SETS    "20 Mar 2000"    ; 16 Apr 1998
@


4.2
log
@Module merged
@
text
@d7 3
a9 3
Version SETA    236              ; FileSwitch
VString SETS    "2.36"           ; 1.54
Date    SETS    "14 Jan 1997"   ; 02 Sep 1988
@


4.1
log
@Initial revision
@
text
@d7 3
a9 3
Version SETA    227              ; FileSwitch
VString SETS    "2.27"           ; 1.54
Date    SETS    "06 Mar 1995"    ; 02 Sep 1988
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@d7 3
a9 3
Version SETA    229              ; FileSwitch
VString SETS    "2.29"           ; 1.54
Date    SETS    "09 Sep 1996"    ; 02 Sep 1988
@


4.1.5.1
log
@Import from SrcFiler
@
text
@d7 3
a9 3
Version SETA    229              ; FileSwitch
VString SETS    "2.29"           ; 1.54
Date    SETS    "09 Sep 1996"    ; 02 Sep 1988
@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@d7 3
a9 3
Version SETA    235              ; FileSwitch
VString SETS    "2.35"           ; 1.54
Date    SETS    "10 Jul 1996"   ; 02 Sep 1988
@


4.1.3.2
log
@Version RO_3_71 taken
@
text
@d7 3
a9 3
Version SETA    236              ; FileSwitch
VString SETS    "2.36"           ; 1.54
Date    SETS    "19 Dec 1996"   ; 02 Sep 1988
@


4.1.3.1.2.1
log
@Merged from 3.71 CD
@
text
@d7 3
a9 3
Version SETA    236              ; FileSwitch
VString SETS    "2.36"           ; 1.54
Date    SETS    "19 Dec 1996"   ; 02 Sep 1988
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
