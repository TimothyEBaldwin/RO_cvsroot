head	4.6;
access;
symbols
	FileCore-3_75:4.6
	FileCore-3_74:4.6
	FileCore-3_73:4.6
	FileCore-3_72:4.6
	FileCore-3_71:4.6
	FileCore-3_70:4.6
	FileCore-3_69:4.6
	FileCore-3_68:4.6
	FileCore-3_67:4.6
	FileCore-3_66:4.6
	FileCore-3_65:4.6
	FileCore-3_64:4.6
	FileCore-3_63:4.6
	FileCore-3_62:4.6
	FileCore-3_61:4.6
	FileCore-3_60:4.6
	FileCore-3_59:4.6
	FileCore-3_58:4.6
	FileCore-3_57:4.6
	FileCore-3_56:4.6
	FileCore-3_55:4.6
	FileCore-3_54:4.6
	FileCore-3_53:4.6
	FileCore-3_52:4.6
	FileCore-3_51:4.6
	FileCore-3_50:4.6
	FileCore-3_49:4.6
	FileCore-3_48:4.5
	FileCore-3_47:4.5
	FileCore-3_46:4.5
	FileCore-3_45:4.5
	FileCore-3_44:4.5
	FileCore-3_43:4.5
	FileCore-3_42:4.5
	FileCore-3_41:4.5
	FileCore-3_40:4.4
	FileCore-3_39:4.4
	FileCore-3_38:4.4
	FileCore-3_37:4.4
	FileCore-3_36:4.4
	FileCore-3_35:4.4
	FileCore-3_34:4.4
	FileCore-3_33:4.4
	RO_5_07:4.4
	FileCore-3_32:4.4
	FileCore-3_31:4.4
	FileCore-3_30:4.3
	FileCore-3_29:4.3
	FileCore-3_28:4.2
	FileCore-3_25-4_9_2_2:4.2
	FileCore-3_27:4.2
	FileCore-3_26:4.2
	FileCore-3_22-4_6_2_1:4.1
	bavison_FileCore-3_22_dev_bp:4.1
	bavison_FileCore-3_22:4.1.0.12
	FileCore-3_25-4_9_2_1:4.2
	HAL:4.2.0.2
	FileCore-3_25:4.2
	FileCore-3_24:4.2
	FileCore-3_23:4.2
	dellis_autobuild_BaseSW:4.1
	FileCore-3_22:4.1
	Ursula_merge:4.1
	ROL_merge:4.1
	FileCore-3_21:4.1
	ROL_Ursula_merge:4.1
	Ursula_RiscPC_merge:4.1
	sbrodie_sedwards_16Mar2000:4.1
	dcotton_autobuild_BaseSW:4.3
	ROL_FileCore-3_21:4.1
	ROL_FileCore-3_20:4.1
	ROL:4.1.0.10
	ROL_bp:4.1
	Ursula_RiscPC_bp:4.1
	FileCore-3_18:4.1
	FileCore-3_01:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	FileCore-3_00:4.1
	FileCore-2_99:4.1
	aglover_FileCore-3_17:4.1
	sproven_FileCore-3_16:4.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	sproven_FileCore-3_15:4.1
	sproven_314:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_Funai01-33:4.1.7.1
	afrost_NC2_Generic:4.1.7.1
	sproven_313:4.1
	sproven_3_11:4.1
	sproven_3_10:4.1
	sproven_Ursula_3_09:4.1
	sproven_3_07:4.1
	sproven_3_06:4.1
	sproven_3_05:4.1
	sproven_3_04:4.1
	Spinner_RCA116:4.1.7.1
	sproven_3_03:4.1
	sproven_3_02:4.1
	sproven_3_01:4.1
	sproven_2_99:4.1
	sproven_2_98:4.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.6
date	2012.03.19.01.02.15;	author bavison;	state Exp;
branches;
next	4.5;
commitid	kiHA1sAUGttNKqXv;

4.5
date	2011.09.13.19.13.15;	author rsprowson;	state Exp;
branches;
next	4.4;
commitid	PKTDORFkNFRVOmzv;

4.4
date	2003.04.03.18.33.28;	author kbracey;	state Exp;
branches;
next	4.3;

4.3
date	2001.05.14.14.27.07;	author sbrodie;	state Exp;
branches;
next	4.2;

4.2
date	2000.10.30.13.26.34;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.32.15;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.32.15;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.00.10.23;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.33.53;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.30.47;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.6
log
@  Reworked error code
Detail:
  Created a new exported header file, Hdr:FileCoreErr, which will serve as
  the single centralised location that defines the error numbers used in the
  low-level FileCore interfaces. s.Errors is now only used for allocating
  error blocks, not for defining error numbers. Also now exports C versions
  of both the pre-existing Hdr:FileCore and the new header.
Admin:
  No changes to the binary.

Version 3.49. Tagged as 'FileCore-3_49'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
;> Errors

; error codes are 32 bits and have different internal and external formats

; Internal format
; b31=1 => disc error
;  b0  to b20 disc byte address / 256
;  b21 t0 b23 drive
;  b24 to b29 disc error num
;  b30        0 (to distinguish from other peoples errors)
; b31=0 => not disc error
;  b0  to b6  error num
;  b8  to b29 clear
;  b30        0 (to distinguish from other peoples errors)
;  b31 set if disc error

; External Format
;  b0  to b7  error num
;  b8  to b29 module number
;  b30 1
;  b31 0

 [ BigDisc
; b31=1 & x30=1  => extended disc error
;  b0 to b29 -> error block (!!!! 32-bit problem !!!!)
;  error block word 0    b0 to b5 disc error num
;                        b6 to b31 clear
;  error block word 1    b0 to b28 disc sector address
;                        b29 to b31 drive
 ]

;except for 'escape' and 'disc error' internal error num = external error num

MaxDiscErr      * 2_00111111

ExternalErrorBit bit 30
DiscErrorBit     bit 31

NewDiscErrorBit  bit 0

FileCoreModuleNum   * &108

ErrorTable
IntEscapeErr    * &80

        ; Define all the 1-byte error numbers
        GET     Hdr:FileCoreErr
 
        ; Now allocate an error block for each one
fcerror SETS    "FileCoreErrBlk"

        MACRO
$num    FileCoreErrBlk $name, $str
$name.ErrBlk MakeInternatErrorBlock adfs$name,, $name
        MEND
        
        GET     Hdr:ADFSErr ; the table uses ADFS errors, patched up later
        GET     Hdr:FileCoreErr
 
        &       FileCoreModuleNum :SHL: 8 ;end of table marker
        =       "FileCoreError",0         ;failsafe in case no match found
        ALIGN
        
        END
@


4.5
log
@Delete s.AsmHdr, s.DevVersion, Version, s.ModHand
Delete Doc.!ReadMe, update Doc.!Implement
Collapse dead switches.
s.MyMacros:
 Remove 'nop' macro, use NOP.
s.Defns:
 Some definitions taken from global headers.
s.Commands:
 Indentation and function calling parameter comments reviewed.

Still produces the same binary as 3.40.
@
text
@a56 10
        MACRO
$num    error   $name,$str
        ASSERT  &$num>0         ;word aligned 0 byte marks entry end
        ASSERT  &$num<&100
$name.Err *     &$num
$name.ErrBlk &       &$num :OR: (FileCoreModuleNum :SHL: 8)
        =       "$name",0
        %       (4-(.-Module_BaseAddr):MOD:4):MOD:4 ;align with zeroes
        MEND

a58 66
11      error   ExtEscape,Escape
;70      error   FormatNotSupportedOnWinnie
;71      error   DensityNotSupported
;72      error   SectorSizeNotSupported
;73      error   TooManySectors
;92 ABORTED
;93 WONT
94      error   Defect,Can't map defect out
95      error   TooManyDefects,Too many defects
96      error   CantDelCsd,Can't delete current directory
97      error   CantDelLib,Can't delete library
98      error   CompactReq,Compaction required
99      error   MapFull,Free space map full
9A      error   BadDisc,Disc not formatted        ;not ADFS format
9B      error   TooManyDiscs,Too many discs
;9C      error   LibUnset,Library unset
9D      error   BadUp,Illegal use of ^
9E      error   AmbigDisc,Ambiguous disc name
9F      error   NotRefDisc,Not same disc
A0      error   InUse,FileCore in use
A1      error   BadParms,Bad parameters
A2      error   CantDelUrd,Can't delete user root directory
;A3      error   IsADir,Is a directory
;A4      error   IsAFile,Is a file
A5      error   Buffer,No room for buffer
A6      error   Workspace,FileCore Workspace corrupt
A7      error   MultipleClose,Multiple file closing errors
A8      error   BrokenDir,Broken directory
A9      error   BadFsMap,Bad free space map
AA      error   OneBadFsMap,One copy of map corrupt (use *CheckMap)
AB      error   BadDefectList,Bad defect list
AC      error   BadDrive,Bad drive
AD      error   Size,Sizes don't match                          ;BACKUP
;AE      error   SameDisc,Same disc                              ;BACKUP
AF      error   DestDefects,Destination disc has defects        ;BACKUP
B0      error   BadRename,Bad RENAME
B3      error   DirFull,Directory full
B4      error   DirNotEmpty,Directory not empty
;B7 OUTSIDE FILE
BD      error   Access,Access violation
C0      error   TooManyOpen,Too many open files
;C1 NOT OPEN FOR UPDATE
C2      error   Open,File open
C3      error   Locked,Locked
C4      error   Exists,Already exists
C5      error   Types,Types don't match
C6      error   DiscFull,Disc full
C7      error   Disc,Disc error
C9      error   WriteProt,Protected disc
CA      error   DataLost,Data lost
;CB BAD OPT
CC      error   BadName,Bad name
;CD DRIVE NOT READY
CF      error   BadAtt,Bad attribute
D3      error   DriveEmpty,Drive empty
D4      error   DiscNotFound,Disc not found
D5      error   DiscNotPresent,Disc not present
D6      error   NotFound,Not found
D7      error   DiscNotFileCore,FileCore does not understand this disc
D8      error   NotToAnImageYouDont,Operation inapplicable to disc images
DE      error   Channel,Channel
;DF EOF
E0      error   FSLocked, The disc is write protected
E1      error   FileTooBig, File too big
FD      error   WildCards,Wild cards
FE      error   BadCom,Bad command
d60 14
@


4.4
log
@* Various 32-bit compatibility fixes.
* Can use HAL for FIQ+timer manipulations.
* FileCore_DiscOp64 added (as user API - currently just converted to the
  standard byte or sector DiscOp call to the underlying module). See
  Doc.32bitAPIs for full details.
* New error-passing scheme to modules added (for full 32-bit addressing).
* FileCore_Features added (indicates new error scheme).
* OS_FSControl 49 (read 32-bit free space) now reports sensible clamped
  values for large discs, rather than values modulo 2^32.
* Accessing the end of files near 2GB in size could cause lock-ups in
  background transfers.
* F(+) and G(+) disc formats adjusted to have a little more skew to
  help the rather poor Iyonix floppy controller.

Version 3.31. Tagged as 'FileCore-3_31'
@
text
@d137 3
a139 2
        Text    "FileCoreError"          ;failsafe in case no match found

@


4.3
log
@  Updated build structure to use the shared AAsmModule makefile.
  Updated to build using objasm instead of aasm.
  Sources changed to be objasm-compatible.
Admin:
  Requires Library 0.72 or later.
  Requires BuildSys 3.09 or later.
  Requires Env 0.65 or later.

Version 3.29. Tagged as 'FileCore-3_29'
@
text
@d37 9
d52 2
@


4.2
log
@32-bit compatible. Some known issues remaining - don't use, except for
testing.

Version 3.23. Tagged as 'FileCore-3_23'
@
text
@d53 1
a53 1
        %       (4-(.-org):MOD:4):MOD:4 ;align with zeroes
@


4.1
log
@Initial revision
@
text
@d48 1
a48 1
        ASSERT  &$num>0         ;word aligned 0 byte marks entry end 
a106 1
 [ FileCache
a107 1
 ]
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
