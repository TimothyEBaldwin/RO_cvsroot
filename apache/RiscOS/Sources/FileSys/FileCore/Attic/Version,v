head	4.4;
access;
symbols
	FileCore-3_40:4.3
	FileCore-3_39:4.3
	FileCore-3_38:4.3
	FileCore-3_37:4.3
	FileCore-3_36:4.3
	FileCore-3_35:4.3
	FileCore-3_34:4.3
	FileCore-3_33:4.3
	RO_5_07:4.3
	FileCore-3_32:4.3
	FileCore-3_31:4.3
	FileCore-3_30:4.3
	FileCore-3_29:4.3
	FileCore-3_28:4.3
	FileCore-3_25-4_9_2_2:4.3
	FileCore-3_27:4.3
	FileCore-3_26:4.3
	FileCore-3_22-4_6_2_1:4.3
	bavison_FileCore-3_22_dev_bp:4.3
	bavison_FileCore-3_22:4.3.0.4
	FileCore-3_25-4_9_2_1:4.3
	HAL:4.3.0.2
	FileCore-3_25:4.3
	FileCore-3_24:4.3
	FileCore-3_23:4.3
	dellis_autobuild_BaseSW:4.3
	FileCore-3_22:4.3
	Ursula_merge:4.2.2.20
	ROL_merge:4.2.2.18.2.1
	FileCore-3_21:4.3
	ROL_Ursula_merge:4.2.2.18.2.1
	Ursula_RiscPC_merge:4.2.2.16
	sbrodie_sedwards_16Mar2000:4.3
	dcotton_autobuild_BaseSW:4.3
	ROL_FileCore-3_21:4.2.2.18.2.1
	ROL_FileCore-3_20:4.2.2.18.2.1
	ROL:4.2.2.18.0.2
	ROL_bp:4.2.2.18
	Ursula_RiscPC_bp:4.2.2.16
	FileCore-3_18:4.2.2.19
	FileCore-3_01:4.3
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2.2.16
	Ursula_RiscPC:4.2.2.16.0.2
	FileCore-3_00:4.3
	FileCore-2_99:4.3
	aglover_FileCore-3_17:4.2.2.18
	sproven_FileCore-3_16:4.2.2.17
	rthornb_UrsulaBuild-19Aug1998:4.2.2.16
	UrsulaBuild_FinalSoftload:4.2.2.16
	rthornb_UrsulaBuild-12Aug1998:4.2.2.16
	aglover_UrsulaBuild-05Aug1998:4.2.2.16
	rthornb_UrsulaBuild-29Jul1998:4.2.2.16
	rthornb_UrsulaBuild-22Jul1998:4.2.2.16
	rthornb_UrsulaBuild-15Jul1998:4.2.2.16
	rthornb_UrsulaBuild-07Jul1998:4.2.2.16
	rthornb_UrsulaBuild-17Jun1998:4.2.2.16
	rthornb_UrsulaBuild-03Jun1998:4.2.2.16
	rthornb_UrsulaBuild-27May1998:4.2.2.16
	rthornb_UrsulaBuild-21May1998:4.2.2.16
	sproven_FileCore-3_15:4.2.2.16
	sproven_314:4.2.2.15
	rthornb_UrsulaBuild_01May1998:4.2.2.14
	afrost_Funai01-33:4.1.7.1
	afrost_NC2_Generic:4.1.7.1
	sproven_313:4.2.2.14
	sproven_3_11:4.2.2.12
	sproven_3_10:4.2.2.11
	sproven_Ursula_3_09:4.2.2.10
	sproven_3_07:4.2.2.8
	sproven_3_06:4.2.2.7
	sproven_3_05:4.2.2.6
	sproven_3_04:4.2.2.5
	Spinner_RCA116:4.1.7.1
	sproven_3_03:4.2.2.4
	sproven_3_02:4.2.2.3
	sproven_3_01:4.2.2.2
	sproven_2_99:4.2.2.1
	sproven_2_98:4.2
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.2.0.6
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.2
	ARTtmp:4.1.7.1.0.2
	RCA:4.2.0.4
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.4
date	2011.09.13.19.13.08;	author rsprowson;	state dead;
branches;
next	4.3;
commitid	PKTDORFkNFRVOmzv;

4.3
date	98.09.21.12.06.59;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.01.06.13.47.25;	author nturton;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.32.03;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.2.2.1
date	97.08.14.13.12.11;	author sproven;	state Exp;
branches;
next	4.2.2.2;

4.2.2.2
date	97.09.16.14.46.12;	author sproven;	state Exp;
branches;
next	4.2.2.3;

4.2.2.3
date	97.11.17.13.31.55;	author sproven;	state Exp;
branches;
next	4.2.2.4;

4.2.2.4
date	97.12.01.12.00.54;	author sproven;	state Exp;
branches;
next	4.2.2.5;

4.2.2.5
date	97.12.11.23.21.17;	author sproven;	state Exp;
branches;
next	4.2.2.6;

4.2.2.6
date	98.01.09.11.44.32;	author sproven;	state Exp;
branches;
next	4.2.2.7;

4.2.2.7
date	98.01.19.12.26.14;	author sproven;	state Exp;
branches;
next	4.2.2.8;

4.2.2.8
date	98.01.23.16.39.50;	author sproven;	state Exp;
branches;
next	4.2.2.9;

4.2.2.9
date	98.01.30.17.52.53;	author sproven;	state Exp;
branches;
next	4.2.2.10;

4.2.2.10
date	98.02.11.16.48.50;	author sproven;	state Exp;
branches;
next	4.2.2.11;

4.2.2.11
date	98.02.17.14.59.23;	author sproven;	state Exp;
branches;
next	4.2.2.12;

4.2.2.12
date	98.03.18.11.09.14;	author sproven;	state Exp;
branches;
next	4.2.2.13;

4.2.2.13
date	98.04.02.15.46.31;	author sproven;	state Exp;
branches;
next	4.2.2.14;

4.2.2.14
date	98.04.16.15.26.21;	author sproven;	state Exp;
branches;
next	4.2.2.15;

4.2.2.15
date	98.05.07.16.55.39;	author sproven;	state Exp;
branches;
next	4.2.2.16;

4.2.2.16
date	98.05.08.12.29.45;	author sproven;	state Exp;
branches;
next	4.2.2.17;

4.2.2.17
date	98.09.02.16.09.21;	author sproven;	state Exp;
branches;
next	4.2.2.18;

4.2.2.18
date	98.09.09.08.36.10;	author aglover;	state Exp;
branches
	4.2.2.18.2.1;
next	4.2.2.19;

4.2.2.19
date	99.08.17.14.19.25;	author sbrodie;	state Exp;
branches;
next	4.2.2.20;

4.2.2.20
date	2000.05.09.10.55.11;	author sbrodie;	state Exp;
branches;
next	;

4.2.2.18.2.1
date	99.08.24.12.41.01;	author sbrodie;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.32.03;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.05.23.58.08;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.32.43;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.29.38;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.4
log
@Delete s.AsmHdr, s.DevVersion, Version, s.ModHand
Delete Doc.!ReadMe, update Doc.!Implement
Collapse dead switches.
s.MyMacros:
 Remove 'nop' macro, use NOP.
s.Defns:
 Some definitions taken from global headers.
s.Commands:
 Indentation and function calling parameter comments reviewed.

Still produces the same binary as 3.40.
@
text
@;>Version       Version file for FileCore

        GBLL    test_version
test_version SETL {FALSE}
;test_version SETL {TRUE}

        GBLA    max_fix
max_fix SETA    5

        END
@


4.3
log
@Spinner branch merged.
Makefile changed to use LocalRes$Path.
Changed to use srccommit.
StrongARM flag now set to :LNOT:STB

Version 2.99. Tagged as 'FileCore-2_99'
@
text
@@


4.2
log
@RiscOS 3.70 version used
@
text
@a2 9
        GBLS    version
version SETS    "2.98"

        GBLA    Version
Version SETA    298

        GBLS    date
date    SETS    "22 Jun 1996"

@


4.2.2.1
log
@Changes made to FileCore to support allowing idlen more than 15.  This allows
smaller LFAUs on discs.  The changes are not yet complete.  In particular, the
number of disc zones is limited to 255.  Some development testing has been
peformed, and the filing system is generally stable.  Areas which haven't
been fully tested include things like *Defect, FileCore_LayoutStructure,
FileCore_FloppyStructure, and the FileSwitch APIs for reading and examining
a disc's used space.

This version should not be used for any OS Builds with the BigMaps flag set
to true.  It should build as a normal version of FileCore with BigMaps and
BigDirs set to false.
@
text
@d4 1
a4 1
version SETS    "2.99"
d7 1
a7 1
Version SETA    299
d10 1
a10 1
date    SETS    "15 May 1997"
d13 2
a14 2
;test_version SETL {FALSE}
test_version SETL {TRUE}
@


4.2.2.2
log
@Fixed a bug with NewClaimFree (and its use of SortDir) which caused problems
with 16 bit object ids.  Now copes with long ids correctly.

Started on bits of code for the long file names work.
@
text
@d4 1
a4 1
version SETS    "3.01"
d7 1
a7 1
Version SETA    301
d10 1
a10 1
date    SETS    "16 Sep 1997"
d13 2
a14 2
test_version SETL {FALSE}
;test_version SETL {TRUE}
@


4.2.2.3
log
@Long file names changes nearly completed.

Only FileCore_LayoutStructure and FileCore_FloppyStructure remain to
updated for long file names.
@
text
@d4 1
a4 1
version SETS    "3.02"
d7 1
a7 1
Version SETA    302
d10 1
a10 1
date    SETS    "17 Nov 1997"
@


4.2.2.4
log
@Altered directory format (change backup dir entries to be one word instead
of an entire copy of the entry).  Also reduced size of a directory entry
by one word.  Also fixed a number of small bugs.
@
text
@d4 1
a4 1
version SETS    "3.03"
d7 1
a7 1
Version SETA    303
d10 1
a10 1
date    SETS    "01 Dec 1997"
@


4.2.2.5
log
@Fixed bugs in handling of growing directories, and made the directory
backup entries come back but only be one word long each.
@
text
@d4 1
a4 1
version SETS    "3.04"
d7 1
a7 1
Version SETA    304
d10 1
a10 1
date    SETS    "11 Dec 1997"
a12 1

@


4.2.2.6
log
@Fixed s.BigDirCode (GrowBigDir and ShrinkBigDir) to cope with BitSize<SecSize
and rewrote free space map memory management to place free space maps in
dynamic areas.
@
text
@d4 1
a4 1
version SETS    "3.05"
d7 1
a7 1
Version SETA    305
d10 1
a10 1
date    SETS    "09 Jan 1998"
@


4.2.2.7
log
@Now supports formatting of floppies with long file names.
@
text
@d4 1
a4 1
version SETS    "3.06"
d7 1
a7 1
Version SETA    306
d10 1
a10 1
date    SETS    "19 Jan 1998"
@


4.2.2.8
log
@Fixed:

DoOsFunRenameBigDir to work when renaming a shared file between dirs where
the file ends up as the last object in the target dir.

SanityCheckEDiscRecord to allow idlen>15 when DiscVersion=0

GrowBigDir to round up desired size to a multiple of the disc allocation
size.

Also:

Implemented non-working code to write cache the dir buffer.  WriteCacheDir
compile switch set to FALSE in s.DebugOpts.  Don't set it to TRUE unless
I tell you it's working.

Made SortDir not attempt to sort more than 2047 entries in a dir, to
avoid it overflowing ScratchSpace.

Made SortPair do one extra shell on the sort (makes it more efficient).
@
text
@d4 1
a4 1
version SETS    "3.07"
d7 1
a7 1
Version SETA    307
d10 1
a10 1
date    SETS    "23 Jan 1998"
@


4.2.2.9
log
@Two bugs fixed:

1) Fixed ReallyShared so that it doesn't omit to check the first
   object in the directory being scanned.

2) Fixed a long-standing ADFSBuffers problem.  This involves the
   UpdateBufState function attempting to attach a buffer as the
   Older or Younger buffer of the previous or next buffer in a
   file respectively.  Unfortunately, if there's only one buffer
   for a file, then it may attempt to attach it to the file
   control block - which is wrong.  Modified UpdateBufState to
   only attempt this when there are more than one objects in
   the chain.  Note:  there still may be problems in certain
   cases; this may need further looking into.

   This problem probably doesn't occur without long file names
   support enabled, because the fcb's contents look different
   then (name field is 10 chars instead of 256) so the problem
   is less likely to occur accidentally.
@
text
@d4 1
a4 1
version SETS    "3.08"
d7 1
a7 1
Version SETA    308
d10 1
a10 1
date    SETS    "30 Jan 1998"
@


4.2.2.10
log
@Binary-chop dir scanning fixed.  (BigLexEqv fixed so that it doesn't
try to compare the dir separator '.' in eg "Default.Thing" with another
object called "Default+" (was breaking binary chop dir search).

Fixed IdentifyDisc (s.Identify); old behaviour left the RootDir field
invalid (the disc bits were an external drive number, instead of an
internal disc number).  This causes problems if the disc fails to mount
due to, for example, memory problems, as the illegal value never gets
fixed (normally, MountDiscOnDrive would end up correcting the problem).
@
text
@d4 1
a4 1
version SETS    "3.09"
d7 1
a7 1
Version SETA    309
d10 1
a10 1
date    SETS    "11 Feb 1998"
@


4.2.2.11
log
@Fixed 4 bugs in DoOsFunRenameBigDir involving renameing of objects
between dirs with long filenames.

Fixed bug in OsFunResolveWildcard on long filenames.
@
text
@d4 1
a4 1
version SETS    "3.10"
d10 1
a10 1
date    SETS    "17 Feb 1998"
@


4.2.2.12
log
@Fixed parent directory handling for big dirs (was filling in the Disc part
of the field, which should be left as 0000s because the value of the disc
changes over time).

Further fix for ADFSBuffers (illegal pointer accessing) as it was found that
the previous fix wasn't good enough.  New fix appears to work where previous
failed.
@
text
@d4 1
a4 1
version SETS    "3.11"
d10 1
a10 1
date    SETS    "18 Mar 1998"
@


4.2.2.13
log
@Fixed bug in handling of Service_EnumerateFormats which was preventing all
formats being listed by ADFSFiler.
@
text
@d4 1
a4 1
version SETS    "3.12"
d7 1
a7 1
Version SETA    312
d10 1
a10 1
date    SETS    "02 Apr 1998"
@


4.2.2.14
log
@Now uses new Ursula service call mechanism.
@
text
@d4 1
a4 1
version SETS    "3.13"
d7 1
a7 1
Version SETA    313
d10 1
a10 1
date    SETS    "16 Apr 1998"
@


4.2.2.15
log
@Found a major inefficiency in the handling of file creation, closing of files
and other uses of the NextFree function.  In the case of file creation, the
problem was particularly bad on large free space maps, as the function was
of order N^2 on the size of the map, when the disc was nearly full.  As the
disc gets fuller, the problem gets worse; with 1400 zones in the map, N^2
is very large indeed.  This resulted in *cdir sometimes taking 1sec.

Now, a new function NextFree_Quick exists which performs similarly to NextFree,
but does not consider free spaces in zones beyond the current zone.  This
can be used by functions which need only examine free spaces in a given zone,
such as is the case in ClaimFreeSpace where it is stepping throigh zones to
find a single gap large enough for the entire file.

For other functions which work on a single zone, the speedup is less dramatic,
of the order N instead of N^2.
@
text
@d4 1
a4 1
version SETS    "3.14"
d7 1
a7 1
Version SETA    314
d10 1
a10 1
date    SETS    "06 May 1998"
@


4.2.2.16
log
@Altered s.Identify; wasn't correctly returning a string describing the disc
format for F+ discs.

Altered s.Commands; *map now correctly reports big directories and a big
free space map.
@
text
@d4 1
a4 1
version SETS    "3.15"
d7 1
a7 1
Version SETA    315
d10 1
a10 1
date    SETS    "08 May 1998"
@


4.2.2.17
log
@Fixed bug with zone compaction with idlen>15, in CompactZone.
@
text
@d4 1
a4 1
version SETS    "3.16"
d7 1
a7 1
Version SETA    316
d10 1
a10 1
date    SETS    "04 Jun 1998"
@


4.2.2.18
log
@Version 3.17 for Ursula. SWI DescribeDisc now reports the DiscVersion
and RootDirSize parameters for the disc.

Tagged as aglover_FileCore-3_17.

 -
@
text
@d4 1
a4 1
version SETS    "3.17"
d7 1
a7 1
Version SETA    317
d10 1
a10 1
date    SETS    "09 Sep 1998"
@


4.2.2.18.2.1
log
@  Import of RISC OS Ltd version of FileCore.
Admin:
  These sources are imported for interest only and must NOT be merged
    without wide prior consultation.

Tagged as ROL_FileCore-3_20
@
text
@d4 1
a4 1
version SETS    "3.20"
d7 1
a7 1
Version SETA    320
d10 1
a10 1
date    SETS    "16 Jun 1999"
@


4.2.2.19
log
@Added inclusion of Machine file in s.FileCore to stop Hdr:CMOS blowing up.

Tagged FileCore-3_18
@
text
@d4 1
a4 1
version SETS    "3.18"
d7 1
a7 1
Version SETA    318
d10 1
a10 1
date    SETS    "17 Aug 1999"
@


4.2.2.20
log
@  Merge of ROL branch to the Ursula branch.
Admin:
  Lots of bugfixes - see ROL branch logs for details.
@
text
@d4 1
a4 1
version SETS    "3.20"
d7 1
a7 1
Version SETA    320
d10 1
a10 1
date    SETS    "16 Jun 1999"
@


4.1
log
@Initial revision
@
text
@d4 1
a4 1
version SETS    "2.91"
d7 1
a7 1
Version SETA    291
d10 1
a10 1
date    SETS    "31 Mar 1995"
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@d4 1
a4 1
version SETS    "2.97"
d7 1
a7 1
Version SETA    297
d10 1
a10 1
date    SETS    "24 Aug 1995"
@


4.1.5.1
log
@Import from SrcFiler
@
text
@d4 1
a4 1
version SETS    "2.97"
d7 1
a7 1
Version SETA    297
d10 1
a10 1
date    SETS    "24 Aug 1995"
@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@d4 1
a4 1
version SETS    "2.98"
d7 1
a7 1
Version SETA    298
d10 1
a10 1
date    SETS    "22 Jun 1996"
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
