head	4.2;
access;
symbols
	FileCore-3_75:4.2
	FileCore-3_74:4.2
	FileCore-3_73:4.2
	FileCore-3_72:4.2
	FileCore-3_71:4.2
	FileCore-3_70:4.2
	FileCore-3_69:4.2
	FileCore-3_68:4.2
	FileCore-3_67:4.2
	FileCore-3_66:4.2
	FileCore-3_65:4.2
	FileCore-3_64:4.2
	FileCore-3_63:4.2
	FileCore-3_62:4.2
	FileCore-3_61:4.2
	FileCore-3_60:4.2
	FileCore-3_59:4.2
	FileCore-3_58:4.2
	FileCore-3_57:4.2
	FileCore-3_56:4.2
	FileCore-3_55:4.2
	FileCore-3_54:4.2
	FileCore-3_53:4.2
	FileCore-3_52:4.2
	FileCore-3_51:4.2
	FileCore-3_50:4.2
	FileCore-3_49:4.2
	FileCore-3_48:4.2
	FileCore-3_47:4.2
	FileCore-3_46:4.2
	FileCore-3_45:4.2
	FileCore-3_44:4.1
	FileCore-3_43:4.1
	FileCore-3_42:4.1
	FileCore-3_41:4.1
	FileCore-3_40:4.1
	FileCore-3_39:4.1
	FileCore-3_38:4.1
	FileCore-3_37:4.1
	FileCore-3_36:4.1
	FileCore-3_35:4.1
	FileCore-3_34:4.1
	FileCore-3_33:4.1
	RO_5_07:4.1
	FileCore-3_32:4.1
	FileCore-3_31:4.1
	FileCore-3_30:4.1
	FileCore-3_29:4.1
	FileCore-3_28:4.1
	FileCore-3_25-4_9_2_2:4.1
	FileCore-3_27:4.1
	FileCore-3_26:4.1
	FileCore-3_22-4_6_2_1:4.1
	bavison_FileCore-3_22_dev_bp:4.1
	bavison_FileCore-3_22:4.1.0.14
	FileCore-3_25-4_9_2_1:4.1
	HAL:4.1.0.12
	FileCore-3_25:4.1
	FileCore-3_24:4.1
	FileCore-3_23:4.1
	dellis_autobuild_BaseSW:4.1
	FileCore-3_22:4.1
	Ursula_merge:4.1
	ROL_merge:4.1
	FileCore-3_21:4.1
	ROL_Ursula_merge:4.1
	Ursula_RiscPC_merge:4.1
	sbrodie_sedwards_16Mar2000:4.1
	dcotton_autobuild_BaseSW:4.1
	ROL_FileCore-3_21:4.1
	ROL_FileCore-3_20:4.1
	ROL:4.1.0.10
	ROL_bp:4.1
	Ursula_RiscPC_bp:4.1
	FileCore-3_18:4.1
	FileCore-3_01:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	FileCore-3_00:4.1
	FileCore-2_99:4.1
	aglover_FileCore-3_17:4.1
	sproven_FileCore-3_16:4.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	sproven_FileCore-3_15:4.1
	sproven_314:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_Funai01-33:4.1.7.1
	afrost_NC2_Generic:4.1.7.1
	sproven_313:4.1
	sproven_3_11:4.1
	sproven_3_10:4.1
	sproven_Ursula_3_09:4.1
	sproven_3_07:4.1
	sproven_3_06:4.1
	sproven_3_05:4.1
	sproven_3_04:4.1
	Spinner_RCA116:4.1.7.1
	sproven_3_03:4.1
	sproven_3_02:4.1
	sproven_3_01:4.1
	sproven_2_99:4.1
	sproven_2_98:4.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.2
date	2011.10.14.07.23.43;	author rsprowson;	state Exp;
branches;
next	4.1;
commitid	D2Id4aPp4zmuUhDv;

4.1
date	96.11.05.09.32.13;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.32.13;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.00.03.04;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.33.44;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.30.33;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.2
log
@Revise exports in "hdr.FileCore".
Now, for each SWI call there is a definition of any pertinent structures it asks for and definitions of any bitfields within those flags. This avoids the need for clients to endlessly redefine these locally (in practice it looks like sections of FileCore were simply copy and pasted into clients RAMFS/SCSIFS/ADFS). Delete private definitions.
This binary was carefully checked to be identical since so many locations were changed.
Then, the following additional changes:
* InitDieSvc line 74, the floppy config is extracted using a mask and shift rather than reaching up the stack
* Identify lin 1254, the superfluous instruction marked as such deleted
* FileCore15 line 762 recoded the check for background op to not need the bit number defined any more
* FileCore00 moved the label 'anull' to be word aligned guaranteed
The duff pointer marker ('nowt' = &40000000) is no longer used to mark territory translation tables as invalid as that address is now quite reasonable. -1 is used instead.

Version 3.45. Tagged as 'FileCore-3_45'
@
text
@; Copyright 1996 Acorn Computers Ltd
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
        SUBT    MultiFS specific definitions

OldOpt  SETA    {OPT}
        OPT     OptNoList+OptNoP1List


; ***********************************
; ***    C h a n g e   L i s t    ***
; ***********************************

; Date       Name  Description
; ----       ----  -----------
; 26-Jan-91  JSR   Created
; 25-Feb-91  JSR   Correct DoFormat record to include sector size at its start
; 06-Mar-91  LVR   Removed Gap1 side 0/1 and make gap1
; 14-Mar-91  JSR   Replace FormatGap1Side0/Side1 the above change should have been
;                       applied to the DoFormat record only
; 25-Apr-91  JSR   Started list of format names
; 31-Jul-91  JSR   Add flags field to enumformats block
; 16-Jan-92  JSR   Add "Here's the *Format parameter" flag to enumformats

;
; These blocks are generated during a Service_EnumerateFormats operation.

                                        ^ 0
EnumFormats_Link                        # 4
EnumFormats_MenuString                  # 4
EnumFormats_MenuHelp                    # 4
EnumFormats_DiscFormatSWI               # 4
EnumFormats_DiscFormatParam             # 4
EnumFormats_LayoutStructureSWI          # 4
EnumFormats_LayoutStructureParam        # 4
EnumFormats_Flags                       # 4
EnumFormats_IsNative                    * 1:SHL:0
EnumFormats_HasFormatParam              * 1:SHL:1
EnumFormats_FormatParam                 # 4
SzEnumFormatsBlock                      # 0

;
; This block is the format description for FS_DiscFormat
                                        ^ 0
FormatSectorSize                        # 4
FormatGap1Side0                         # 4
FormatGap1Side1                         # 4
FormatGap3                              # 4
FormatSectorsPerTrk                     # 1
FormatDensity                           # 1       ; 1/2/3/4/8, see disc record defines
FormatOptions                           # 1
FormatOptIndexMark                      * 1:SHL:0
FormatOptDoubleStep                     * 1:SHL:1
FormatOptInterleaveSides                * 0:SHL:2
FormatOptSide0Only                      * 1:SHL:2
FormatOptSide1Only                      * 2:SHL:2
FormatOptSequenceSides                  * 3:SHL:2
FormatOptSidesMask                      * 3:SHL:2 
FormatLowSector                         # 1
FormatInterleave                        # 1
FormatSideSideSkew                      # 1       ; Signed
FormatTrackTrackSkew                    # 1       ; Signed
FormatFillValue                         # 1
FormatTracksToFormat                    # 4
FormatReserved                          # 36
SzFormatBlock                           # 0
        ASSERT  SzFormatBlock = 64

;
; This block is what's passed to FS_DiscOp format track
                                        ^ 0
DoFormatSectorSize                      # 4
DoFormatGap1                            # 4
                                        # 4       ; Reserved & must be zero
DoFormatGap3                            # 4
DoFormatSectorsPerTrk                   # 1
DoFormatDensity                         # 1       ; 1/2/3/4/8, see disc record defines
DoFormatOptions                         # 1       ; As per FormatOptions above
DoFormatFillValue                       # 1
DoFormatCylindersPerDrive               # 4
DoFormatReserved0                       # 4
DoFormatReserved1                       # 4
DoFormatReserved2                       # 4
DoFormatSectorList                      # 0       ; List follows, one word per sector

        OPT OldOpt
        END
@


4.1
log
@Initial revision
@
text
@a35 22
        MACRO
$FName  AFormat $TName
        GBLS    FormatName_$FName
FormatName_$FName SETS "$TName"
        MEND

; Formats
;
; It is best if this list is kept in alphabetical order of
; the textual name, these being the ones we wish to keep unique.
;

DOSFS_A         AFormat "A"     ; Atari, 720K, DS
DOSFS_B         AFormat "B"     ; Atari, 360K, SS
ADFS_D          AFormat "D"     ; ADFS, 640K, Old map, Old dirs, floppy flavour
ADFS_E          AFormat "E"     ; ADFS, 800K, New map, New Dirs, floppy flavour
ADFS_F          AFormat "F"     ; ADFS, 1600K, New map, New Dirs, winnie flavour
ADFS_L          AFormat "L"     ; ADFS, 800K, Old map, New Dirs, floppy flavour
DOSFS_M         AFormat "M"     ; MS-DOS 3.20+, 720K, DS
DOSFS_N         AFormat "N"     ; MS-DOS 3.20+, 360K, SS

; An EnumFormatsBlock
d39 13
a51 13
        ^       0
EnumFormats_Link                        #       4
EnumFormats_MenuString                  #       4
EnumFormats_MenuHelp                    #       4
EnumFormats_DiscFormatSWI               #       4
EnumFormats_DiscFormatParam             #       4
EnumFormats_LayoutStructureSWI          #       4
EnumFormats_LayoutStructureParam        #       4
EnumFormats_Flags                       #       4
EnumFormats_IsNative            * 1 :SHL: 0
EnumFormats_HasFormatParam      * 1 :SHL: 1
EnumFormats_FormatParam                 #       4
SzEnumFormatsBlock                      #       0
d54 24
a77 23
; This block is the format description of the hard part of a format
        ^       0
FormatSectorSize        #       4
FormatGap1Side0         #       4
FormatGap1Side1         #       4
FormatGap3              #       4
FormatSectorsPerTrk     #       1
FormatDensity           #       1
FormatOptions           #       1
FormatIndexMark         * 1:SHL:0
FormatDoubleStep        * 1:SHL:1
FormatInterleaveSides   * 0:SHL:2
FormatSide0Only         * 1:SHL:2
FormatSide1Only         * 2:SHL:2
FormatSequenceSides     * 3:SHL:2
FormatLowSector         #       1
FormatInterleave        #       1
FormatSideSideSkew      #       1       ; Signed
FormatTrackTrackSkew    #       1       ; Signed
FormatFillValue         #       1
TracksToFormat          #       4
FormatReserved          #       36
SzFormatBlock # 0
d81 15
a95 15
; This block is what's passed to _DiscOp format track
        ^       0
DoFormatSectorSize      #       4
DoFormatGap1            #       4
                        #       4       ; Reserved
DoFormatGap3            #       4
DoFormatSectorsPerTrk   #       1
DoFormatDensity         #       1
DoFormatOptions         #       1
DoFormatFillValue       #       1
DoFormatCylindersPerDrive #     4
DoFormatReserved0       #       4
DoFormatReserved1       #       4
DoFormatReserved2       #       4
DoFormatSectorList      #       0
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
