head	4.6;
access;
symbols
	DOSFS-1_14:4.6
	DOSFS-1_13:4.6
	DOSFS-1_12:4.6
	DOSFS-1_11:4.6
	DOSFS-1_10:4.6
	DOSFS-1_09:4.6
	DOSFS-1_08:4.6
	DOSFS-1_07:4.6
	DOSFS-1_06:4.6
	DOSFS-1_05:4.6
	DOSFS-1_04:4.6
	DOSFS-1_03:4.6
	DOSFS-1_02:4.6
	DOSFS-1_01:4.6
	DOSFS-1_00:4.5
	DOSFS-0_99:4.5
	DOSFS-0_98:4.5
	DOSFS-0_97:4.4
	DOSFS-0_96:4.4
	DOSFS-0_95:4.4
	DOSFS-0_94:4.4
	DOSFS-0_93:4.4
	DOSFS-0_92:4.4
	DOSFS-0_91:4.4
	DOSFS-0_90:4.4
	DOSFS-0_89:4.3
	DOSFS-0_88:4.3
	DOSFS-0_87:4.3
	DOSFS-0_86:4.2
	DOSFS-0_85:4.2
	DOSFS-0_84:4.2
	DOSFS-0_83:4.2
	DOSFS-0_82:4.2
	DOSFS-0_81:4.2
	DOSFS-0_80:4.2
	DOSFS-0_79:4.2
	RO_5_07:4.2
	DOSFS-0_78:4.2
	DOSFS-0_77:4.2
	DOSFS-0_76:4.2
	DOSFS-0_75:4.2
	DOSFS-0_74:4.2
	DOSFS-0_73:4.2
	DOSFS-0_72:4.2
	DOSFS-0_71:4.2
	DOSFS-0_70:4.2
	DOSFS-0_69:4.2
	DOSFS-0_68:4.1
	DOSFS-0_67:4.1
	DOSFS-0_66:4.1
	DOSFS-0_65:4.1
	dellis_autobuild_BaseSW:4.1
	sbrodie_sedwards_16Mar2000:4.1
	dcotton_autobuild_BaseSW:4.1
	DOSFS-0_64:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	nicke_DOSFS_0_63:4.1.7.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	hsimons_BOCA-1_2-Release:4.1.7.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.6
date	2013.01.13.18.57.35;	author rsprowson;	state Exp;
branches;
next	4.5;
commitid	IcVKoGKFReBN35Aw;

4.5
date	2013.01.13.18.49.47;	author rsprowson;	state Exp;
branches;
next	4.4;
commitid	fjzSOoRRnhA815Aw;

4.4
date	2012.06.10.13.25.19;	author bavison;	state Exp;
branches;
next	4.3;
commitid	tzPLCsjFs2keca8w;

4.3
date	2009.06.11.21.01.29;	author bavison;	state Exp;
branches;
next	4.2;

4.2
date	2002.09.22.11.30.07;	author rsprowson;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.33.07;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.33.07;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.00.55.38;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.37.56;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.34.23;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.6
log
@Add missing message, use central allocations for DOSFS' FS number
Missing 'Stack full' error message added (German translation needed).
Use DOSFS FS number from headers.
Tested with floppy disc (FAT12), 1GB image file (FAT16) and 4GB image file (FAT32) with no issues seen.

Version 1.01. Tagged as 'DOSFS-1_01'
@
text
@/* Copyright 1996 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*> h.TIMEconv <*/
/*-------------------------------------------------------------------------*/
/* RISC OS time conversion function             Copyright (c) 1989 JGSmith */
/*-------------------------------------------------------------------------*/

#ifndef __h_TIMEconv
#define __h_TIMEconv

/*-------------------------------------------------------------------------*/
/* build a picture of time */

#define tickssec      (100)             /* centi-seconds in a second */
#define ticksmin      (tickssec * 60)   /* seconds in a minute */
#define tickshour     (ticksmin * 60)   /* minutes in a hour */
#define ticksday      (tickshour * 24)  /* hours in a day */
#define ticksyear     (0xBBF81E00)      /* avoid cpp overflow */
/* This equates to 0xBBF81E00 if "cpp" can't do it. The month additions
 * work out as follows (number, month (days in month)):
 *      0x00000000 Jan (31)
 *      0x0FF6EA00 Feb (28)
 *      0x1E625200 Mar (31)
 *      0x2E593C00 Apr (30)
 *      0x3DCC5000 May (30)
 *      0x4DC33A00 Jun (31)
 *      0x5D364E00 Jul (31)
 *      0x6D2D3800 Aug (31)
 *      0x7D242200 Sep (30)
 *      0x8C973600 Oct (31)
 *      0x9C8E2000 Nov (30)
 *      0xAC013400 Dec (31)
 */

/*-------------------------------------------------------------------------*/
/* RISC OS and BBC centi-second time is stored in a 5byte structure */
typedef struct {
                word lo ;       /* lo 4 bytes of centi-second time */
                word hi ;       /* hi 1 byte  of centi-second time */
               } time5byte ;

/* Fully expanded time structure. This is to make it easier to convert to
 * different time encodings. The limit on the "year" field is defined by
 * the current RISC OS RTC system.
 */
typedef struct {
                int year ;              /* 1900..2079 */
                int month ;             /* 1..12 */
                int day ;               /* 1..31 */
                int hour ;              /* 0..23 */
                int minutes ;           /* 0..59 */
                int seconds ;           /* 0..59 */
                int centiseconds ;      /* 0..99 */
               } BCDtime ;

typedef struct {
                byte year ;             /* 0..99 */
                byte month ;            /* 1..12 */
                byte day ;              /* 1..31 */
                byte weekday ;          /* 1..7  */
                byte hour ;             /* 0..23 */
                byte minute ;           /* 0..59 */
                byte second ;           /* 0..59 */
               } ROBCDtime ;

/*-------------------------------------------------------------------------*/

time5byte *get_RISCOS_TIME(time5byte *time_buffer) ;
void       MSDOStoRISCOS(word DOStime,word DOSdate,time5byte *outtime) ;
char      *MSDOStoSTRING(word DOStime,word DOSdate) ;
word       RISCOStoTIME(time5byte *intime) ;
word       RISCOStoDATE(time5byte *intime) ;
int        longestTIMEstring(void) ;

/*-------------------------------------------------------------------------*/

#endif /* __h_TIMEconv */

/*-------------------------------------------------------------------------*/
/*> EOF h.TIMEconv <*/
@


4.5
log
@Rationalise some defines
Many magic numbers changed to exported defines.
Eliminated unused "BOOTblock.h" (was just nesting 1 include file).
Moved non ASCII definitions out of "ASCII.h" then found the remainder weren't used => eliminated.

Version 0.98. Tagged as 'DOSFS-0_98'
@
text
@a22 6
/* OS_Word 14 subreasons */
#define clock_textin                  (0)
#define clock_BCDin                   (1)
#define clock_BCDout                  (2)
#define clock_5byte                   (3)

@


4.4
log
@  Fixed timestamping
Detail:
  Renamed function "localTIME" to "get_RISCOS_TIME" since it has nothing to do
  with local time. This function used to call the C library function
  localtime(), but until recently the C library was non-conformant to the
  C standard, and simply produced a year/month/day/hour/minute/second breakdown
  as UTC. When this was fixed (RISC_OSLib 5.68) it changed DOSFS's behaviour;
  it was first detected because the reverse operation is implemented locally
  within DOSFS, so a read-modify-write of file attributes leads to the
  modification time being skewed by an amount equal to the difference between
  UTC and local time. Arguments can be made either to treat the on-disc time as
  local time (for compatibility with Windows and Mac OS) or as UTC (for
  compatibility with Linux or older RISC OS systems); I have opted to return
  behaviour to UTC. Also placed a lower limit on dates of the earliest date
  supported by FAT (1980), so for example if your system clock is set to 1970,
  as it will be if there is no RTC and NetTime is not operational, then you
  don't end up creating dates in the far future due to underflow.
Admin:
  Tested on a beagleboard

Version 0.90. Tagged as 'DOSFS-0_90'
@
text
@d23 5
a27 3
/*-------------------------------------------------------------------------*/

#include "ASCII.h"    /* standard typedefs and manifests */
@


4.3
log
@  #include file pathnames changed
Detail:
  Uses suffixed file extensions for compatiblity with both Norcroft and GCC.
Admin:
  Supplied by Peter Naulls, tested at ROOL

Version 0.86. Not tagged
@
text
@d84 1
a84 3
time5byte *localTIME(time5byte *time_buffer) ;
int        BCDto5byte(BCDtime *intime,time5byte *outtime) ;
int        convert5bytetoBCD(time5byte *intime,BCDtime *outtime) ;
@


4.2
log
@Deleted some dead variables and switches.
Eliminated MOVS and R14 fiddling to achieve 32 bit compatibility
RISCOS Ltd made 3 changes in their sources
 - ensure disc titles don't contain rogue characters (added)
 - files with time,date,and reserved fields of zero appears as DEADDEAD
   which is silly since Winodws uses this to mark a file unstamped which
   isn't quite the same thing! (not added)
 - syslog debugging support (not added)

Version 0.69. Tagged as 'DOSFS-0_69'
@
text
@d25 1
a25 1
#include "h.ASCII"    /* standard typedefs and manifests */
@


4.1
log
@Initial revision
@
text
@d34 1
a34 3
#if 0 /* overflows with this compiler */
#define ticksyear     (ticksday * 365)  /* days in an average year */
#else
a49 2
#define ticksyear (0xBBF81E00)
#endif
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
