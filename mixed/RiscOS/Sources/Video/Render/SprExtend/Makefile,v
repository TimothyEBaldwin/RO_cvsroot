head	4.22;
access;
symbols
	SprExtend-1_83:4.22
	SprExtend-1_82:4.22
	SprExtend-1_81:4.22
	SprExtend-1_80:4.22
	SprExtend-1_79:4.22
	SprExtend-1_78:4.22
	SprExtend-1_77:4.22
	SprExtend-1_76:4.21
	SprExtend-1_75:4.20
	SprExtend-1_74:4.20
	SprExtend-1_73:4.20
	SprExtend-1_72:4.20
	SprExtend-1_71-nocfsi:4.19
	SprExtend-1_71:4.18
	SprExtend-1_70-tracef:4.17
	SprExtend-1_70-headers:4.17
	SprExtend-1_70:4.16
	SprExtend-1_69:4.16
	SprExtend-1_68:4.16
	SprExtend-1_67:4.16
	SprExtend-1_66:4.16
	SprExtend-1_65:4.16
	SprExtend-1_64:4.16
	SprExtend-1_63:4.16
	SprExtend-1_62:4.16
	SprExtend-1_61:4.16
	SprExtend-1_60:4.16
	SprExtend-1_59:4.16
	SprExtend-1_58:4.16
	SprExtend-1_57:4.16
	SprExtend-1_56:4.16
	SprExtend-1_55:4.16
	SprExtend-1_54:4.16
	SprExtend-1_53:4.16
	SprExtend-1_52:4.16
	SprExtend-1_51:4.15
	SprExtend-1_50:4.14
	SprExtend-1_38-1_35_2_16:4.12.2.7
	SprExtend-1_49:4.13
	SprExtend-1_48:4.13
	SprExtend-1_47:4.13
	SprExtend-1_38-1_35_2_15:4.12.2.6
	SprExtend-1_46:4.13
	SprExtend-1_45:4.13
	SprExtend-1_44:4.13
	SprExtend-1_43:4.13
	SprExtend-1_42:4.13
	SprExtend-1_41:4.13
	SprExtend-1_38-1_35_2_14:4.12.2.5
	SprExtend-1_40:4.12
	SprExtend-1_38-1_35_2_13:4.12.2.5
	SprExtend-1_38-1_35_2_12:4.12.2.5
	SprExtend-1_38-1_35_2_11:4.12.2.5
	SprExtend-1_38-1_35_2_10:4.12.2.5
	SprExtend-1_38-1_35_2_9:4.12.2.5
	SprExtend-1_38-1_35_2_8:4.12.2.5
	SprExtend-1_39:4.12
	SprExtend-1_38-1_35_2_7:4.12.2.4
	SprExtend-1_38-1_35_2_6:4.12.2.3
	SprExtend-1_38-1_35_2_5:4.12.2.2
	SprExtend-1_38-1_35_2_4:4.12.2.1
	SprExtend-1_38-1_35_2_3:4.12
	SprExtend-1_38-1_35_2_2:4.12
	SprExtend-1_38-1_35_2_1:4.12
	MigrateIJG8b:4.12.0.2
	SprExtend-1_38:4.12
	SprExtend-1_37:4.12
	SprExtend-1_36:4.12
	SprExtend-1_35:4.12
	SprExtend-1_34:4.12
	SprExtend-1_33:4.12
	SprExtend-1_32:4.12
	SprExtend-1_31:4.12
	SprExtend-1_30:4.12
	SprExtend-1_29:4.12
	SprExtend-1_28:4.12
	SprExtend-1_27:4.11
	SprExtend-1_26:4.11
	SprExtend-1_25:4.11
	SprExtend-1_24:4.11
	SprExtend-1_23:4.10
	SprExtend-1_22:4.10
	SprExtend-1_21:4.10
	SprExtend-1_20:4.9
	SprExtend-1_19:4.9
	SprExtend-1_18:4.9
	SprExtend-1_17:4.8
	RO_5_07:4.8
	SprExtend-1_16:4.8
	SprExtend-1_15:4.8
	SprExtend-1_14:4.8
	SprExtend-1_13:4.8
	SprExtend-1_12:4.8
	SprExtend-1_11:4.8
	SprExtend-1_10:4.7
	SprExtend-1_09:4.6
	SprExtend-1_08:4.5
	dellis_autobuild_BaseSW:4.4
	SprExtend-1_07:4.4
	SprExtend-1_06:4.4
	sbrodie_sedwards_16Mar2000:4.3
	dcotton_autobuild_BaseSW:4.7
	SprExtend-1_05:4.3
	Ursula_merge:4.2.2.1
	nturton_SprExtend-1_04:4.2
	mstphens_UrsulaRiscPCBuild_20Nov98:4.2.2.1
	Ursula_RiscPC:4.2.2.1.0.2
	nicke_SprExtend-0_99:4.1.7.2
	rthornb_UrsulaBuild-19Aug1998:4.2.2.1
	UrsulaBuild_FinalSoftload:4.2.2.1
	rthornb_UrsulaBuild-12Aug1998:4.2.2.1
	aglover_UrsulaBuild-05Aug1998:4.2.2.1
	rthornb_UrsulaBuild-29Jul1998:4.2.2.1
	rthornb_UrsulaBuild-22Jul1998:4.2.2.1
	rthornb_UrsulaBuild-15Jul1998:4.2.2.1
	rthornb_UrsulaBuild-07Jul1998:4.2.2.1
	rthornb_UrsulaBuild-17Jun1998:4.2.2.1
	rthornb_UrsulaBuild-03Jun1998:4.2.2.1
	rthornb_UrsulaBuild-27May1998:4.2.2.1
	rthornb_UrsulaBuild-21May1998:4.2.2.1
	rthornb_UrsulaBuild_01May1998:4.2.2.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.2.0.6
	Daytona_bp:4.2
	Ursula:4.2.0.2
	Ursula_bp:4.2
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.2
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.22
date	2016.09.30.22.28.01;	author jballance;	state Exp;
branches;
next	4.21;
commitid	pqLInHhXmDrGDmoz;

4.21
date	2016.05.21.14.16.30;	author rool;	state Exp;
branches;
next	4.20;
commitid	xdjBCBYna4x7am7z;

4.20
date	2016.05.21.14.03.37;	author rool;	state Exp;
branches;
next	4.19;
commitid	4BquZHousteH5m7z;

4.19
date	2016.05.21.13.48.11;	author rool;	state Exp;
branches;
next	4.18;
commitid	F2CfxJ1XTlg50m7z;

4.18
date	2016.05.21.13.44.27;	author rool;	state Exp;
branches;
next	4.17;
commitid	ZDqmsyNiMhv6Zl7z;

4.17
date	2016.05.21.13.32.15;	author rool;	state Exp;
branches;
next	4.16;
commitid	yTqS85yKh7k8Ul7z;

4.16
date	2013.08.06.23.16.15;	author jlee;	state Exp;
branches;
next	4.15;
commitid	z9XOph7zDZQ2Ur0x;

4.15
date	2012.08.10.21.21.55;	author rsprowson;	state Exp;
branches;
next	4.14;
commitid	2YHsqEnypOzgS2gw;

4.14
date	2012.07.28.15.23.33;	author rsprowson;	state Exp;
branches;
next	4.13;
commitid	b5jdybqzJ3Wdjlew;

4.13
date	2011.03.14.23.29.58;	author srevill;	state Exp;
branches;
next	4.12;
commitid	liob2Sw1t7Hx8Sbv;

4.12
date	2010.09.25.12.19.13;	author rsprowson;	state Exp;
branches
	4.12.2.1;
next	4.11;

4.11
date	2010.09.01.20.48.45;	author rsprowson;	state Exp;
branches;
next	4.10;

4.10
date	2009.06.13.23.26.21;	author bavison;	state Exp;
branches;
next	4.9;

4.9
date	2008.10.17.13.19.21;	author srevill;	state Exp;
branches;
next	4.8;

4.8
date	2002.11.06.13.20.28;	author kbracey;	state Exp;
branches;
next	4.7;

4.7
date	2001.07.02.11.21.11;	author sbrodie;	state Exp;
branches;
next	4.6;

4.6
date	2001.05.17.12.59.34;	author sbrodie;	state Exp;
branches;
next	4.5;

4.5
date	2001.05.15.10.56.58;	author sbrodie;	state Exp;
branches;
next	4.4;

4.4
date	2000.05.12.12.59.04;	author kbracey;	state Exp;
branches;
next	4.3;

4.3
date	99.08.05.18.03.07;	author kbracey;	state Exp;
branches;
next	4.2;

4.2
date	97.01.21.11.56.17;	author nturton;	state Exp;
branches
	4.2.2.1;
next	4.1;

4.1
date	96.11.05.09.45.00;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.12.2.1
date	2011.01.04.21.45.22;	author rsprowson;	state Exp;
branches;
next	4.12.2.2;

4.12.2.2
date	2011.01.04.22.13.01;	author rsprowson;	state Exp;
branches;
next	4.12.2.3;

4.12.2.3
date	2011.01.09.10.42.50;	author rsprowson;	state Exp;
branches;
next	4.12.2.4;

4.12.2.4
date	2011.01.09.10.56.36;	author rsprowson;	state Exp;
branches;
next	4.12.2.5;

4.12.2.5
date	2011.01.13.21.12.07;	author rsprowson;	state Exp;
branches;
next	4.12.2.6;

4.12.2.6
date	2011.08.06.10.44.25;	author rsprowson;	state Exp;
branches;
next	4.12.2.7;
commitid	gAycmEnWp5AVeruv;

4.12.2.7
date	2012.07.28.14.42.44;	author rsprowson;	state Exp;
branches;
next	;
commitid	Ny6vV3CHXwee5lew;

4.2.2.1
date	98.03.26.14.46.13;	author rthornb;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.45.00;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.02.40.21;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.57.16;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.19.57;	author nturton;	state Exp;
branches;
next	4.1.7.2;

4.1.7.2
date	98.09.21.13.28.22;	author kbracey;	state Exp;
branches;
next	;


desc
@@


4.22
log
@  Repair ROM build
Detail:
  Amend asmcore static dependency to create an o directory, so rom build target works
Admin:
  (highlight level of testing that has taken place)
  (bugfix number if appropriate)


Version 1.77. Tagged as 'SprExtend-1_77'
@
text
@# Copyright 1996 Acorn Computers Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for SprExtend
#

COMPONENT = SpriteExtend
TARGET   ?= SprExtend
OBJS      = sources.${TARGET}
ROM_TARGET= rm.${TARGET}
RAM_TARGET= rm.SprExtendSA
ROM_OBJECT= ${TARGET}.o
RAM_OBJECT= ${TARGET}SA.o
EXP_HDR   = <export$dir>

include StdTools
include StdRules
include ModuleLibs

# To switch between making debugging and non-debugging versions of SprExtend:
#   change the #define of DEBUG in commondefs.h
#   change the SETL of 'debug' in sources.SprExtend
CDEFINES  = -DRISCOS -DAVOID_TABLES -DNO_ZERO_ROW_TEST -DLAZYDECODE
CINCLUDES = -IC:
CFLAGS   += ${C_NO_STKCHK}

SFILES =\
 jhdr.s\
 stdpalette.s\
 yuvtabs.s

IJGFILES =\
 jdmarker.o\
 jdhuff.o\
 jdarith.o\
 jdinput.o\
 jdmaster.o\
 jdmainct.o\
 jdcolor.o\
 jdapistd.o\
 jdapimin.o\
 jdpostct.o\
 jddctmgr.o\
 jdcoefct.o\
 jdsample.o\
 jdtrans.o\
 jcomapi.o\
 jcapimin.o\
 jcmaster.o\
 jchuff.o\
 jctrans.o\
 jcparam.o\
 jcmarker.o\
 jdatasrc.o\
 jdatadst.o\
 jidctfst.o\
 jaricom.o\
 jutils.o
 
# Extra utilites (generate assembler code)
GENJHDR    = utils.genjhdr
GENPALETTE = utils.genpalette
GENYUVTABS = utils.genyuvtabs

#
# Targets:
#
install: install_${TARGET}; @@

install_SprExtend: ${RAM_TARGET}
        ${MKDIR} ${INSTDIR}
        ${CP} ${RAM_TARGET} ${INSTDIR}.SprExtend ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: ram module installed

install_rom: ${ROM_TARGET}
        ${MKDIR} ${INSTDIR}
        ${CP} ${ROM_TARGET} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: rom module installed

rom: ${ROM_TARGET}
        @@${ECHO} ${COMPONENT}: rom module built

standalone: ${RAM_TARGET}
        @@${ECHO} ${COMPONENT}: ram module built

export: hdr.SprExtend
        ${CP} hdr.SprExtend ${EXP_HDR}.SprExtend ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: export complete

clean:
        ${RM} ${ROM_TARGET}
        ${RM} ${RAM_TARGET}
        ${RM} ${GENPALETTE}
        ${RM} ${GENYUVTABS}
        ${RM} ${GENJHDR}
        ${XWIPE} o ${WFLAGS}
        ${XWIPE} oh ${WFLAGS}
        ${XWIPE} od ${WFLAGS}
        ${XWIPE} s.* ${WFLAGS}
        @@${ECHO} ${COMPONENT}: cleaned

resources:
        ${MKDIR} ${RESDIR}.${TARGET}
        ${TOKENCHECK} LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${TARGET}.Messages  ${CPFLAGS}
        @@${ECHO} ${COMPONENT}: resource files copied

#
# Generate the SFILES:
#
yuvtabs.s: ${GENYUVTABS}
        ${RUN}${GENYUVTABS} > $@@

stdpalette.s: ${GENPALETTE}
        ${RUN}${GENPALETTE} > $@@

jhdr.s: ${GENJHDR}
        ${RUN}${GENJHDR} > $@@

${GENPALETTE}: genpalette.c
        ${MAKE} -f util/mk COMPONENT=genpalette THROWBACK=${THROWBACK}

${GENYUVTABS}: genyuvtabs.c
        ${MAKE} -f util/mk COMPONENT=genyuvtabs THROWBACK=${THROWBACK}

${GENJHDR}: genjhdr.c jpeglib.h jconfig.h jmorecfg.h
        ${MAKE} -f util/mk COMPONENT=genjhdr THROWBACK=${THROWBACK}

#
# Static dependencies:
#
${ROM_OBJECT}: ${OBJS} ${SFILES}
        ${MKDIR} o
        ${AS} ${ASFLAGS} -o $@@ ${OBJS}

${ROM_TARGET}: ${ROM_OBJECT} ${IJGFILES} asmcore.o
        ${LD} -o $@@ -rmf ${ROM_OBJECT} ${IJGFILES} asmcore.o

${RAM_OBJECT}: ${OBJS} ${SFILES}
        ${MKDIR} o
        ${AS} ${ASFLAGS} -PD "standalone SETL {TRUE}" -o $@@ ${OBJS}

${RAM_TARGET}: ${RAM_OBJECT} ${IJGFILES} asmcore.o resmsg.o 
        ${LD} -o $@@ -rmf ${RAM_OBJECT} ${IJGFILES} asmcore.o resmsg.o 
        ${MODSQZ} $@@

resmsg.o: LocalRes:Messages
        ${TOKENCHECK} LocalRes:Messages
        ${MKDIR} o
        ${RESGEN} resfsarea o.resmsg LocalRes:Messages Resources.SprExtend.Messages

asmcore.o:
        ${MKDIR} o
        ${CC} ${CFLAGS} $*.c

# Dynamic dependencies:
@


4.21
log
@Lazy MCU decoding
Detail:
  Only colour convert from the left clipping border (rounded down) to the right (rounding up).
  Only entropy decode the DC component for blocks likewise, skipping AC and IDCT steps.
Admin:
  Submission for the JPEG bounty.

Version 1.76. Tagged as 'SprExtend-1_76'
@
text
@d164 1
@


4.20
log
@Transcode arithmetics
Detail:
  Import of the raw coefficient Huffman entropy compressor elements of the IJG8d library.
  We don't need a full compressor (ala JCompMod) since there's never a need to go all the way through IDCT/upsampling/colour conversion only to reverse the whole process; it's sufficient only to collect up the raw coefficients and recompress them as a baseline JPEG.
  Two extra (temporary) dynamic areas are introduced, once to hold the raw coefficients and the other to act as a scratch file to make the JPEG in. See Doc/JPEGMmgr.
Admin:
  Submission for the JPEG bounty.

Version 1.72. Tagged as 'SprExtend-1_72'
@
text
@a16 34
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name    Description
# ----       ----    -----------
# 25-May-94  AMcC    Created.
# 12-Aug-94  AMcC    Updated for modified SpriteExtend (JPEG support)
# 29-Oct-94  AMcC    Exports hdr.SprExtend (SWI defs)
#                    Data file now called CFSIjpeg (was CFSI-jpeg)
#                    - exported to ChangeFSI at install time
# 01-Feb-95  GPS     Now compiles with cc505
# 13-Feb-95  GPS     CFSIjpeg now compiles with cc505
# 15-May-01  SNB     Re-engineered to use objasm throughout, not aasm
# 25-Sep-10  RPS     Now objasm is used, no need to postprocess C code
#                    as assembler with 'sed', just use the linker
#

#
# Paths
#
EXP_HDR = <export$dir>

# To switch between making debugging and non-debugging versions of SprExtend:
#   change the #define of DEBUG in h.commondefs
#   change the SETL of 'debug' in sources.SprExtend.
CDEFINES = -DRISCOS -DASMHUFF -DASMIDCT -DASMCOLOR
CINCLUDES = -IC:

#
# Generic options:
#
include StdTools
include StdRules
include ModuleLibs
a17 3
#
# Program specific options:
#
a19 1
CFLAGS   += ${C_NO_STKCHK}
d25 12
d107 3
a109 2
        ${XWIPE} o.* ${WFLAGS}
        ${XWIPE} oh.* ${WFLAGS}
d115 1
a115 1
        TokenCheck LocalRes:Messages
d144 1
a144 1
        do mkdir -p o
d151 1
a151 1
        do mkdir -p o
d159 2
a160 1
        TokenCheck LocalRes:Messages
a162 3
rojpeg.o:
        ${CC} ${CFLAGS} -DSOURCE_IS_rojpeg $*.c

d164 1
a164 1
        ${CC} ${CFLAGS} -DSOURCE_IS_asmcore $*.c
@


4.19
log
@Removed CFSI-JPEG support
Detail:
  ChangeFSI now makes its own helper plugin which just calls the JPEG SWIs of the host OS, so there's no need for SpriteExtend to be complicated by this now.
Admin:
  Submission for the JPEG bounty.
  Tagged as SprExtend-1_71-nocfsi
@
text
@a76 1
 jdatasrc.o\
d83 10
a93 1
 jcomapi.o\
d187 3
d191 1
a191 1
        ${CC} ${CFLAGS} $*.c
@


4.18
log
@Import of IJG8d library sources
Detail:
  Using the decoder in "example.c" as a starting point, we try to follow that sequence more closely even if in our embedded implementation some of the functions don't do much.
  Uses the default colour backend for 32bpp BGR output for most of the unusual cases.
  The most common 2x2 subsampling case uses a custom merged upsampler and colour converter, with colour output directly in RISC OS format for the respective screen mode.
Admin:
  Submission for the JPEG bounty.

Version 1.71. Tagged as 'SprExtend-1_71'
@
text
@a93 3
# Needed for ChangeFSI
CFSI-JPEG  = data.CFSIjpeg

a98 6
install_CFSIjpeg: ${CFSI-JPEG}
        ${MKDIR} ${INSTDIR}
        ${CP} ${CFSI-JPEG} ${INSTDIR}.CFSIjpeg ${CPFLAGS}
        Access ${INSTDIR}.CFSIjpeg lr/r
        @@${ECHO} ${COMPONENT}: CFSIjpeg file installed

a108 3
cfsi-jpeg: ${CFSI-JPEG}
        @@${ECHO} ${COMPONENT}: CFSIjpeg file generated

a121 1
        ${RM} ${CFSI-JPEG}
a157 7
# For ChangeFSI:
#
${CFSI-JPEG}: Sources.CFSI-JPEG jhdr.s stdpalette.s rojpeg.o
        ${AS} ${ASFLAGS} -o cfsi-jpeg.o Sources.CFSI-JPEG
        ${LD} -bin -o $@@ cfsi-jpeg.o rojpeg.o

#
a178 3
rojpeg.o:
        ${CC} ${CFLAGS} -DSOURCE_IS_rojpeg $*.c

d180 1
a180 1
        ${CC} ${CFLAGS} -DSOURCE_IS_asmcore $*.c
@


4.17
log
@Update headers to stock copy
Detail:
  Added headers jerror, jmorecfg, jpegint from IJG8d. Removed jpegdata header.
  Bulk rename of structure members to match newer headers, some RISCOS-isms wrapped in #ifdef RISCOS, retained for the time being.
  Assembler code now gets cinfo member offsets from jhdr.s derived from the C header rather than keeping its own dangerous copy of the offsets.
Admin
  Note: this has broken CFSI-jpeg as it expects the error values to be at the top of cinfo.
  Submission for the JPEG bounty.
  Tagged as SprExtend-1_70-headers.
@
text
@d49 2
a50 5

#
# Libraries
#
CLIB = CLIB:o.stubs
d57 1
d69 20
d106 1
a106 1
        @@echo ${COMPONENT}: CFSIjpeg file installed
d111 1
a111 1
        @@echo ${COMPONENT}: ram module installed
d116 1
a116 1
        @@echo ${COMPONENT}: rom module installed
d119 1
a119 1
        @@echo ${COMPONENT}: CFSIjpeg file generated
d122 1
a122 1
        @@echo ${COMPONENT}: rom module built
d125 1
a125 1
        @@echo ${COMPONENT}: ram module built
d129 1
a129 1
        @@echo ${COMPONENT}: export complete
d141 1
a141 1
        @@echo ${COMPONENT}: cleaned
d147 1
a147 1
        @@echo ${COMPONENT}: resource files copied
d184 2
a185 2
${ROM_TARGET}: ${ROM_OBJECT} asmcore.o
        ${LD} -o $@@ -rmf ${ROM_OBJECT} asmcore.o
d191 2
a192 2
${RAM_TARGET}: ${RAM_OBJECT} resmsg.o asmcore.o
        ${LD} -o $@@ -rmf ${RAM_OBJECT} resmsg.o asmcore.o
d200 1
a200 1
        ${CC} ${CFLAGS} ${C_NO_STKCHK} -DEMBED -DSOURCE_IS_rojpeg $*.c
d203 1
a203 1
        ${CC} ${CFLAGS} ${C_NO_STKCHK} -DEMBED -DSOURCE_IS_putscaled $*.c
@


4.16
log
@Add support for new sprite types & screen modes
Detail:
  Makefile - Updated to fix a couple of dependency issues and to make c/asmcore the main C file, not c/putscaled
  Sources/PutScaled - Add a utility routine that's used by the C code to get information about pixel formats
  Sources/SprAdjSize - Add support for wide masks & RISC OS 5 style sprite mode words
  Sources/SprExtend - Tidy up workspace by removing lots of unused bits and moving other bits within sight of the C code. Add flag to control whether C or assembler version of SprTrans is used. Query kernel for ECFYOffset/ECHShift locations instead of using hardcoded values in putscaled code. Add fix for garbage debug strings in softloaded debug versions of the module.
  Sources/SprOp - Add support for wide masks & RISC OS 5 style sprite mode words. Update makepalette16bpp to cope with all the new 16bpp modes. Flag_* -> ModeFlag_* renaming. Move some translation table handling code into a new routine, 'preparettr'. Update checktrans/converttrans to deal with new pixel formats.
  Sources/SprTrans - If the C version of SprTrans is enabled, disable all of these assembler bits except for the outer loop which steps over each row of the screen
  Sources/jdcolor - Updated to deal with new pixel formats. 16bpp conversion code split off into new file, Sources/jdcolor16.
  Sources/jdcolor16 - New file containing the guts of the YUV -> 16bpp conversion code. Gets included multiple times with different options to generate the different conversion routines (code is too big for a macro).
  c/asmcore - New file containing lots of common code ripped out of c/PutScaled - e.g. workspace definition, main functions for register assignment & instruction generation, and code for pixel format conversion. Pixel format conversion code rewritten to cope with new pixel formats, and code buffer key word generation rewritten to fix a couple of bugs (e.g. some issues with dithering options were observed)
  c/PutScaled - Ripped out lots of code that's now in c/asmcore. Now just deals with things that are PutScaled-specific, e.g. main plotter loop containing pixel read/write code. Code extended to cope with new pixel formats
  c/rojpeg, h/jinclude, h/jpegdata - Code extended to cope with new 16bpp conversion routines
  c/sprtrans - New C implementation of the core per-row transformed sprite plotting code generator. Allows reuse of the extensive pixel conversion code in c/asmcore, and allows for better code generation than the assembler original.
  h/putscaled - Worksapce definition updated to match assembler version
Admin:
  Tested on BB-xM, plotting lots of different sprites in lots of different modes
  Plotting of wide mask sprites not supported yet
  C version of YUV -> 16bpp code currently only deals with traditional &BGR 555 pixel format - code is aware of this and will do conversion to desired format if applicable (although quality may be reduced)
  Part of an implementation of the Extended Framebuffer Format spec:
  http://www.riscosopen.org/wiki/documentation/show/Extended%20Framebuffer%20Format%20Specification


Version 1.52. Tagged as 'SprExtend-1_52'
@
text
@d149 1
a149 1
${GENJHDR}: genjhdr.c jinclude.h jconfig.h jpegdata.h
@


4.15
log
@Add support for self registered resources (standalone)
* Listen for ResourceFS starting service call
* De/Register files appropriately
* Refactor makefile to have two possible install targets
* Simplify the ColourTrans RMEnsure

Version 1.51. Tagged as 'SprExtend-1_51'
@
text
@d40 1
a40 1
#   change the #define of DEBUG at the top of c.PutScaled
d149 1
a149 1
${GENJHDR}: genjhdr.c
d162 1
a162 1
${ROM_OBJECT}: ${OBJS} ${SFILES} putscaled.o
d166 2
a167 2
${ROM_TARGET}: ${ROM_OBJECT}
        ${LD} -o $@@ -rmf ${ROM_OBJECT} putscaled.o
d169 1
a169 1
${RAM_OBJECT}: ${OBJS} ${SFILES} resmsg.o putscaled.o
d173 2
a174 2
${RAM_TARGET}: ${RAM_OBJECT}
        ${LD} -o $@@ -rmf ${RAM_OBJECT} resmsg.o putscaled.o
d184 1
a184 1
putscaled.o:
@


4.14
log
@Adopt colour conversions from MigrateIJG8b branch
Now for every colour conversion there is a corresponding C function, allowing swapping between them for test purposes.
Here, 'ASMCOLOR' is selected and the C functions not even referenced in the makefile, see branch for use.
Permits use of USAT, for a small 1.5% speedup and smaller code.
Some other typedefs and comment shuffling copied over - should be harmless.

Version 1.50. Tagged as 'SprExtend-1_50'
@
text
@d59 2
a60 2
TARGET    = SprExtend
ROM_SOURCE= sources.${TARGET}
d62 3
a64 2
LOCALMSG  = rm.${TARGET}M
EXPORTS   = ${EXP_HDR}.SprExtend
d80 1
a80 1
# Rule patterns
d82 1
a82 1
.SUFFIXES: .o .oh .c .sources
d84 1
a84 11
.c.o:;       ${CC} -c ${CFLAGS} ${TFLAGS} -o $@@ $<
.c.oh:;      ${CC} -c ${CFLAGS} -o $@@ $<
.sources.o:; ${AS} ${ASFLAGS} -from $< -to $@@

#
# Rules:
#
all: ${CFSI-JPEG} ${LOCALMSG}
        @@echo ${COMPONENT}: all built

install: ${CFSI-JPEG}
d90 10
a102 3
#
# Generic rules:
#
d106 5
a110 1
export: ${EXPORTS}
a112 5
install_rom: ${ROM_TARGET}
        ${MKDIR} ${INSTDIR}
        ${CP} ${ROM_TARGET} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

d115 2
a116 1
        ${RM} ${LOCALMSG}
a119 1
        ${RM} ${CFSI-JPEG}
a130 19

ROM_OBJECT  = ${TARGET}.o
${ROM_OBJECT}: ${ROM_SOURCE} ${SFILES} putscaled.o
        do mkdir -p o
        ${AS} ${ASFLAGS} -o $@@ ${ROM_SOURCE}
${ROM_TARGET}: ${ROM_OBJECT}
        ${LD} -o $@@ -rmf ${ROM_OBJECT} putscaled.o

# Get the Messages from somewhere other than Resources:$.Resources.SprExtend
LCL_OBJECT = ${TARGET}M.o
${LOCALMSG}: ${LCL_OBJECT}
        ${LD} -rmf -o $@@ ${LCL_OBJECT} putscaled.o
${LCL_OBJECT}: ${ROM_SOURCE} ${SFILES} putscaled.o
        ${AS} ${ASFLAGS} -o $@@ ${ROM_SOURCE} -PD "localmessages SETL {TRUE}"

# Export the SWI definitions to Hdr:
${EXP_HDR}.SprExtend: hdr.SprExtend
        ${CP} hdr.SprExtend $@@ ${CPFLAGS}
        
d160 1
a160 1
# Standalone C code (no library calls) for the assembler to use:
d162 19
d182 1
a182 1
        ${CC} ${CFLAGS} ${TFLAGS} -ff -zps1 -DEMBED -DSOURCE_IS_rojpeg $*.c
d185 1
a185 1
        ${CC} ${CFLAGS} ${TFLAGS} -ff -zps1 -DEMBED -DSOURCE_IS_putscaled $*.c
@


4.13
log
@Made safe to build with newer ARM instruction support in objasm.

Replaced use of LSL (et al) macros with the new myLSL macros to avoid
potential clash with new pseudo-opcodes

Admin: requires HdrSrc 1.79 or later.

Version 1.41. Tagged as 'SprExtend-1_41'
@
text
@d42 1
a42 1
CDEFINES = -DRISCOS -DASMHUFF
@


4.12
log
@Remove postprocessing step of C code.
Since 2001 this module has been using objasm, but still using the C compiler to output (via -S) assembly code which is then passed through 'sed' and included via GET into the assembler code.
Changed to compile the C code into object files, and use the linker to patch up the unresolved references - this has required some reordering of the C code to make sure static functions now appear in the object file, and some reordering of the header files to ensure both the module and the CFSI version still compile without conflicts.
Minor fix to 'swiv2', the label was in the wrong place for _swi() though it's not used in this module so didn't affect the _swix() case.
Makefile cut down a bit. Unixify some path names.
Test code moved to 'Test/c' directory.
Tested in both debug and non debug cases via softloaded module. Oddly, it's 4 bytes longer than the previous version.

Version 1.28. Tagged as 'SprExtend-1_28'
@
text
@d123 3
a125 3
        ${WIPE} o.* ${WFLAGS}
        ${WIPE} oh.* ${WFLAGS}
        ${WIPE} s.* ${WFLAGS}
@


4.12.2.1
log
@Reinstate jrevdct4 option to use C code IDCT (switch "ASMIDCT").
Name inverse DCT to match IJG 8b integer fast implementation.
Remove -DEMBED option and collapse switches.
Useful for speed comparisons.

Version 1.38, 1.35.2.4. Tagged as 'SprExtend-1_38-1_35_2_4'
@
text
@d42 1
a42 1
CDEFINES = -DRISCOS -DASMHUFF -DASMIDCT
d70 1
a70 1
# Extra utilites (generate assembler tables)
d185 1
a185 1
        ${CC} -DSOURCE_IS_ROJPEG ${CFLAGS} ${TFLAGS} -zps1 $*.c
d188 1
a188 1
        ${CC} -DSOURCE_IS_PUTSCALED ${CFLAGS} ${TFLAGS} -zps1 $*.c
@


4.12.2.2
log
@Fix CFSIjpeg due to earlier rename of jidctfst
Rename remaining files to match IJG 8b.

Version 1.38, 1.35.2.5. Tagged as 'SprExtend-1_38-1_35_2_5'
@
text
@d60 1
a60 1
ROM_SOURCE= Sources.${TARGET}
d79 9
@


4.12.2.3
log
@Create assembler equivalents of C colour conversions, approx 10% speed up.
Add new switch ASMCOLOR to select which to use, C or assembler.
Remove FILE_ exit trace concept, just use __FILE__ instead in exit_erl.
Add some comments to exit_erl and friends.
A few bits of cinfo setup moved into start_pass_huff_decoder() or eliminated.
Bumped up the precision of SCALE_BITS in the C colour handling so FIX() uses more bits of an int.
Deleted the unused remenants of light dithering in the 8bpp colour converter - saves a few cycles.
colour_convert_8 and colour_convert_16 no longer save entry registers the C compiler doesn't care about.
Update genyuvtabs to EXPORT the table bases.
Split out the compilation of IJG files as separate objects in the make file, rather than including them from within rojpeg, which is itself included from putscaled.

Version 1.38, 1.35.2.6. Tagged as 'SprExtend-1_38-1_35_2_6'
@
text
@a31 1
# 08-Jan-11  RPS     IJG code compiled separately now as {IJGFILES}
d40 3
a42 3
#   change the #define of 'DEBUG' in 'h.commondefs'
#   change the SETL of 'debug' in 'sources.SprExtend'
CDEFINES = -DRISCOS -DASMHUFF -DASMIDCT -DASMCOLOR
a69 6
IJGFILES =\
 jdcolor.o\
 jdmarker.o\
 jdhuff.o\
 jidctfst.o

a78 6
# Rule patterns
#
.SUFFIXES: .o .c
.c.o:;  ${CC} -c ${CFLAGS} ${TFLAGS} -zps1 -o $@@ $<

#
d125 1
d127 1
a127 1
${ROM_OBJECT}: ${ROM_SOURCE} ${SFILES} ${IJGFILES} putscaled.o
d131 1
a131 1
        ${LD} -o $@@ -rmf ${ROM_OBJECT} ${IJGFILES} putscaled.o
d168 7
d176 1
a176 1
        ${CC} -DCHANGEFSI ${CFLAGS} ${TFLAGS} -zps1 $*.c
d178 2
a179 3
${CFSI-JPEG}: Sources.CFSI-JPEG jhdr.s stdpalette.s ${IJGFILES} rojpeg.o
        ${AS} ${ASFLAGS} -o cfsi-jpeg.o Sources.CFSI-JPEG
        ${LD} -bin -o $@@ cfsi-jpeg.o ${IJGFILES} rojpeg.o
@


4.12.2.4
log
@For completeness, implement the 2x2->8bpp and 2x2->16bpp colour conversions in C too.
While slower than their assembler equivalents it makes the whacky address generation a bit easier to follow.
Fix MakeFile to not stop when trying to deleted an empty directory.

Version 1.38, 1.35.2.7. Tagged as 'SprExtend-1_38-1_35_2_7'
@
text
@d127 3
a129 3
        -${WIPE} o.* ${WFLAGS}
        -${WIPE} oh.* ${WFLAGS}
        -${WIPE} s.* ${WFLAGS}
@


4.12.2.5
log
@Use USAT in 150 occurrences of colour clamping for ARMv6 and later.
Some IDCT renaming.
Shock addition of some documentation on how it all works.
Mirror fix from 1.39 on the trunk.
Debug
 Made DEBUG version compile again, earlier header shuffling was preventing it.
 Replaced the ' _ ' method of variadic macro emulation with more familiar double brackets for tracef().
 Eliminated IFDEBUG macro and just used #ifdef DEBUG/#endif or tracef() directly.
 Don't bother passing the line number and file name to exit() when in the non DEBUG case.

Version 1.38, 1.35.2.8. Tagged as 'SprExtend-1_38-1_35_2_8'
@
text
@d139 1
a139 1
${ROM_OBJECT}: ${ROM_SOURCE} ${SFILES} ${IJGFILES} tracing.o putscaled.o
d143 1
a143 1
        ${LD} -o $@@ -rmf ${ROM_OBJECT} ${IJGFILES} tracing.o putscaled.o
@


4.12.2.6
log
@Push recent changes on the trunk to the IJG8b branch.
Tested briefly, still works.

Version 1.38, 1.35.2.15. Tagged as 'SprExtend-1_38-1_35_2_15'
@
text
@d127 3
a129 3
        ${XWIPE} o.* ${WFLAGS}
        ${XWIPE} oh.* ${WFLAGS}
        ${XWIPE} s.* ${WFLAGS}
@


4.12.2.7
log
@Sync with trunk
Sources/SprOp - revision 4.10 copied
Sources/SprTrans - revision 4.16 copied
Sources/jdhuff - revision 4.7 copied
Also:
 DCI changed to instruction mnemonic for objasm 4
 Makefile excess '-c' removed
 Util.mk double inclusion of rules removed

Version 1.38, 1.35.2.16. Tagged as 'SprExtend-1_38-1_35_2_16'
@
text
@d89 1
a89 1
.c.o:;  ${CC} ${CFLAGS} ${TFLAGS} -zps1 -o $@@ $<
@


4.11
log
@Clean up pass.
Trim 200+ lines of changes dating back to 1987, combine with non duplicates in the 'BlackLog'.
Use 'offsetof' macro in genjhdr to avoid warnings about uninitialised variables, rename from makejhdr so all the utils are clearly demarked.
Add throwback to MkCFSI-j.
Replace reason codes passed to SWIs with textual equivalents from the respective header files.
Speed up SWI despatch a bit by making the first few debug instructions depend on 'debuggs'.
Qualify all of the debug switches with the global 'debug' one.
Eliminate single use of 'pullx' macro.
Make do_branch() take an unsigned opcode so 50% of the branches don't result in implied cast warnings.
Added an UNUSED() macro to reduce a few of the legitimate warnings (the remainder are either in the original JPEG code or ones that it is worth checking the logic of.
Unixify one last filename.

Version 1.24. Tagged as 'SprExtend-1_24'
@
text
@d30 2
a41 1

a42 1
#CDEFINES += -DDEBUG
d66 3
a68 4
 s.jhdr\
 s.putscaled\
 s.stdpalette\
 s.yuvtabs
d136 1
a136 1
${ROM_OBJECT}: ${ROM_SOURCE} ${SFILES}
d140 1
a140 1
        ${LD} -o $@@ -rmf ${ROM_OBJECT}
d145 2
a146 2
        ${LD} -rmf -o $@@ ${LCL_OBJECT}
${LCL_OBJECT}: ${ROM_SOURCE} ${SFILES}
d152 1
d154 1
a154 1
# Generate the SFILES
d156 1
a156 5
.c.s:;  ${CC} -S ${CFLAGS} ${TFLAGS} -ff -zps1 -DEMBED -DSOURCE_IS_$* $*.c
        ${SED} -e /IMPORT/d -e /dataseg/d -e /codeseg/d -e /AREA/d < s.$* > s.temp
        ${CP} s.temp s.$* ${CPFLAGS}d
        
s.yuvtabs: ${GENYUVTABS}
d159 1
a159 1
s.stdpalette: ${GENPALETTE}
d162 1
a162 1
s.jhdr: ${GENJHDR}
d165 1
a165 1
${GENPALETTE}: c.genpalette
d168 1
a168 1
${GENYUVTABS}: c.genyuvtabs
d171 1
a171 1
${GENJHDR}: c.genjhdr
d173 1
d177 3
a179 3
${CFSI-JPEG}: Sources.cfsi-jpeg s.jhdr s.rojpeg s.stdpalette
        ${AS} ${ASFLAGS} -o o.cfsi-jpeg Sources.cfsi-jpeg
        ${LD} -bin -o $@@ o.cfsi-jpeg
d182 1
a182 1
# Other bits:
d184 2
a185 20
j2s: o.j2s o.jdhuff o.jrevdct o.jcconv o.diffuse
        ${LD} -o $@@ o.j2s o.jdhuff o.jrevdct o.jcconv o.diffuse ${CLIB}

o.diffuse: sources.diffuseo s.stdpalette
        ${AS} ${ASFLAGS} -from sources.diffuseo -to $@@

o.jcconv: sources.jcconvo s.yuvtabs
        ${AS} ${ASFLAGS} -from sources.jcconvo -to $@@

o.jdhuff: sources.jdhuffo s.jhdr
        ${AS} ${ASFLAGS} -from sources.jdhuffo -to $@@

o.jrevdct: sources.jrevdcto
        ${AS} ${ASFLAGS} -from sources.jrevdcto -to $@@

put: o.put
        ${LD} -o $@@ o.put ${CLIB}

jput: o.jput
        ${LD} -o $@@ o.jput ${CLIB}
d187 2
a188 2
tdct: o.testdct o.idcto
        ${LD} -o $@@ o.testdct o.idcto ${CLIB}
@


4.10
log
@  Build fix
Detail:
  The build utilities utils.makejhdr, utils.genpalette and utils.genyuvtabs,
  compiled at build time, are now built using the HostTools shared makefile,
  and so will execute on any RISC OS build host even if the default compiler
  options are to target an incompatible ARM architecture. Also now sets the
  throwback flag when doing builds via the Mk obey file.
Admin:
  Tested using an APCS-R build on an Iyonix.

Version 1.20. Not tagged
@
text
@d72 1
a72 1
MAKEJHDR   = utils.makejhdr
d122 1
a122 1
        ${RM} ${MAKEJHDR}
d166 2
a167 2
s.jhdr: ${MAKEJHDR}
        ${RUN}${MAKEJHDR} > $@@
d175 2
a176 2
${MAKEJHDR}: c.makejhdr
        ${MAKE} -f util/mk COMPONENT=makejhdr THROWBACK=${THROWBACK}
@


4.9
log
@  Small makefile tweak
Detail:
  Creates install directories if not already present before doing the
  copy operation.
Admin:
  Will work.

Version 1.18. Tagged as 'SprExtend-1_18'
@
text
@a40 2
ASFLAGS  = -APCS 3/32bit/nofp -cpu 4
TFLAGS   = -APCS 3/32bit/nofp
d161 1
a161 1
        ${GENYUVTABS} > $@@
d164 1
a164 1
        ${GENPALETTE} > $@@
d167 1
a167 1
        ${MAKEJHDR} > $@@
d169 2
a170 2
${GENPALETTE}: oh.genpalette ${CLIB}
        ${LD} -o $@@ oh.genpalette ${CLIB}
d172 2
a173 2
${GENYUVTABS}: oh.genyuvtabs ${CLIB}
        ${LD} -o $@@ oh.genyuvtabs ${CLIB}
d175 2
a176 2
${MAKEJHDR}: oh.makejhdr ${CLIB}
        ${LD} -o $@@ oh.makejhdr ${CLIB}
@


4.8
log
@A couple of 32-bit fixes.
Used to interpret negative translation table pointers as "none"; now just 0
as per documentation.
Plotting 16bpp sprites into 32bpp modes now correctly sets the 3 least
significant bits of each channel - used to be set to 0 due to a typo.
Build option (currently set to on) to use SMULL instructions.

Version 1.11. Tagged as 'SprExtend-1_11'
@
text
@d97 1
d115 1
@


4.7
log
@  Moved the includes further down the Makefile.
Detail:
  Don't know why - probably didn't work with where they were?
Admin:
  Made this change months ago - can't remember anything else about it.


Version 1.10. Tagged as 'SprExtend-1_10'
@
text
@d41 1
a41 1
ASFLAGS  = -APCS 3/32bit/nofp
@


4.6
log
@  Oops - I'd put semicolons in the sed script.
Detail:
  This doesn't work because amu will (correctly) say that the semicolon
    is a command separator.  This is now fixed by passing each pattern
    separately with -e.
Admin:
  Not tested.


Version 1.09. Tagged as 'SprExtend-1_09'
@
text
@a36 5
#
# Generic options:
#
include StdTools

d46 5
@


4.5
log
@  Now uses objasm throughout instead of aasm.
Detail:
  The build structure for this module is not nice - I've sanitised it a
    bit, but it's still not nice.
Admin:
   Built and tested with the test program briefly - the test sprite seems
     to scale and rotate properly.  ChangeFSI not tested.


Version 1.08. Tagged as 'SprExtend-1_08'
@
text
@d157 1
a157 1
        ${SED} /IMPORT/d;/dataseg/d;/codeseg/d;/AREA/d < s.$* > s.temp
@


4.4
log
@32-bit compatible. Tagged as SprExtend-1_06
@
text
@d29 1
d40 1
a40 10
AASM    = aasm
CC      = cc
CP      = copy
LINK    = link
# -d does debug tables
MKDIR   = cdir
OBJASM  = objasm
RM      = remove
WIPE    = -wipe
SED     = Sed
d46 1
a46 3
ASFLAGS  = -depend !Depend -Stamp -quit -module
OBJFLAGS = -depend !Depend -APCS 3/32bit/nofp -Stamp -quit
CFLAGS   = -depend !Depend ${INCLUDES} ${DFLAGS}
d48 3
a50 6
DFLAGS   = -DRISCOS -DASMHUFF
#DFLAGS   = -DRISCOS -DASMHUFF -DDEBUG
CPFLAGS  = ~cfr~v
WFLAGS   = ~c~v

INCLUDES = -IC:
d60 5
a64 4
COMPONENT = SprExtend
SOURCE    = Sources.SprExtend
TARGET    = rm.SprExtend
LOCALMSG  = rm.SprExtendM
d88 1
a88 1
.sources.o:; ${OBJASM} ${OBJFLAGS} -from $< -to $@@
d107 1
a107 1
rom: ${TARGET}
d113 2
a114 2
install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
d118 1
a118 1
        ${RM} ${TARGET}
d130 3
a132 3
        ${MKDIR} ${RESDIR}.${COMPONENT}
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
d135 7
a141 2
${TARGET}: ${SOURCE} ${SFILES}
        ${AASM} ${ASFLAGS} -From ${SOURCE} -To $@@
d144 5
a148 2
${LOCALMSG}: Sources.LocalMsgs ${SFILES}
        ${AASM} ${ASFLAGS} -From Sources.LocalMsgs -To $@@
d156 4
a159 6
s.putscaled: c.putscaled
        ${CC} -s ${CFLAGS} ${TFLAGS} -ff -zps1 -DEMBED c.putscaled
        @@echo ${COMPONENT}: making s.putscaled aasm compatible
        ${SED} s/__rt_sdiv/|__rt_sdiv|/g < s.putscaled > s.temp
        ${SED} s/_swix/|_swix|/g < s.temp > s.putscaled

d161 1
a161 1
        ${GENYUVTABS} > s.yuvtabs
d164 1
a164 1
        ${GENPALETTE} > s.stdpalette
d167 1
a167 1
        ${MAKEJHDR} > s.jhdr
d170 1
a170 1
        ${LINK} -o $@@ oh.genpalette ${CLIB}
d173 1
a173 1
        ${LINK} -o $@@ oh.genyuvtabs ${CLIB}
d176 1
a176 1
        ${LINK} -o $@@ oh.makejhdr ${CLIB}
d181 2
a182 9
        ${AASM} ${ASFLAGS} -From Sources.cfsi-jpeg -To $@@
        SetType $@@ Data

# needed for the ChangeFSI inclusion:
s.rojpeg: c.rojpeg
        ${CC} -s ${CFLAGS} ${TFLAGS} -ff -zps1 -DEMBED -DCFSI c.rojpeg
        ${SED} s/__rt_sdiv/|__rt_sdiv|/g < s.rojpeg > s.temp
        ${CP} s.temp s.rojpeg ${CPFLAGS}
#        Run w.ZapS-ROJ
d188 1
a188 1
        ${LINK} -o j2s o.j2s o.jdhuff o.jrevdct o.jcconv o.diffuse ${CLIB}
d191 1
a191 1
        ${OBJASM} ${OBJFLAGS} -from sources.diffuseo -to $@@
d194 1
a194 1
        ${OBJASM} ${OBJFLAGS} -from sources.jcconvo -to $@@
d197 1
a197 1
        ${OBJASM} ${OBJFLAGS} -from sources.jdhuffo -to $@@
d200 1
a200 1
        ${OBJASM} ${OBJFLAGS} -from sources.jrevdcto -to $@@
d203 1
a203 1
        ${LINK} -o put o.put ${CLIB}
d206 1
a206 1
        ${LINK} -o jput o.jput ${CLIB}
d209 1
a209 3
        ${LINK} -o tdct o.testdct o.idcto ${CLIB}

o.swiv: sources.swiv
@


4.3
log
@Spinner and Ursula branches merged.
@
text
@d55 1
a55 1
OBJFLAGS = -depend !Depend -Stamp -quit
d57 1
d96 1
a96 1
.SUFFIXES: .o .c .sources
d98 2
a99 1
.c.o:;       ${CC} -c ${CFLAGS} -o $@@ $<
d137 1
d161 1
a161 1
        ${CC} -s ${CFLAGS} -ff -zps1 -DEMBED c.putscaled
d175 2
a176 2
${GENPALETTE}: o.genpalette ${CLIB}
        ${LINK} -o $@@ o.genpalette ${CLIB}
d178 2
a179 2
${GENYUVTABS}: o.genyuvtabs ${CLIB}
        ${LINK} -o $@@ o.genyuvtabs ${CLIB}
d181 2
a182 2
${MAKEJHDR}: o.makejhdr ${CLIB}
        ${LINK} -o $@@ o.makejhdr ${CLIB}
d192 1
a192 1
        ${CC} -s ${CFLAGS} -ff -zps1 -DEMBED -DCFSI c.rojpeg
@


4.2
log
@RiscOS 3.70 version taken
@
text
@d140 2
a141 1
        ${CP} Resources.${LOCALE}.Messages  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
a223 127
data.CFSI-jpeg: sources.csupport
data.CFSI-jpeg: sources.jdhuff
data.CFSI-jpeg: s.jhdr
data.CFSI-jpeg: sources.jrevdct
data.CFSI-jpeg: sources.jcconv
data.CFSI-jpeg: sources.diffuse
data.CFSI-jpeg: s.stdpalette
data.CFSI-jpeg: s.rojpeg
rm.SprExtend: Hdr:ListOpts
rm.SprExtend: Hdr:Macros
rm.SprExtend: Hdr:System
rm.SprExtend: Hdr:SWIs
rm.SprExtend: Hdr:CPU.Generic26
rm.SprExtend: Hdr:IO.GenericIO
rm.SprExtend: Hdr:RISCOS
rm.SprExtend: Hdr:ModHand
rm.SprExtend: Hdr:Services
rm.SprExtend: Hdr:VduExt
rm.SprExtend: Hdr:FSNumbers
rm.SprExtend: Hdr:NewErrors
rm.SprExtend: Hdr:NDRDebug
rm.SprExtend: Hdr:Sprite
rm.SprExtend: Hdr:ColourTran
rm.SprExtend: Hdr:PublicWS
rm.SprExtend: Hdr:Draw
rm.SprExtend: Hdr:ExtraLong
rm.SprExtend: Hdr:MsgTrans
rm.SprExtend: Hdr:Proc
rm.SprExtend: Hdr:HostFS
rm.SprExtend: Hdr:Debug
rm.SprExtend: Hdr:HostDebug
rm.SprExtend: Version
rm.SprExtend: Hdr:PDriver
rm.SprExtend: Sources.SWIs
rm.SprExtend: Sources.SprAdjSize
rm.SprExtend: Sources.SprTrans
rm.SprExtend: Sources.MsgCode
rm.SprExtend: Sources.PutScaled
rm.SprExtend: sources.CSupport
rm.SprExtend: S.PutScaled
rm.SprExtend: sources.jdhuff
rm.SprExtend: s.jhdr
rm.SprExtend: sources.jrevdct
rm.SprExtend: s.yuvtabs
rm.SprExtend: sources.jcconv
rm.SprExtend: sources.diffuse
rm.SprExtend: sources.swiv2
o.genpalette:	c.genpalette
o.putscaled:	c.putscaled
o.putscaled:	c.rojpeg
o.putscaled:	h.rojpeg
o.putscaled:	h.jinclude
o.putscaled:	h.jconfig
o.putscaled:	h.jpegdata
o.putscaled:	h.swis
o.putscaled:	h.kernel
o.putscaled:	c.jrdjfif
o.putscaled:	h.jinclude
o.putscaled:	c.jdhuff
o.putscaled:	h.jinclude
o.putscaled:	c.jcconv
o.putscaled:	c.SpriteOp
o.makejhdr:	c.makejhdr
o.makejhdr:	h.jinclude
o.makejhdr:	h.jconfig
o.makejhdr:	h.jpegdata
o.genyuvtabs:	c.genyuvtabs
data.CFSIjpeg: sources.csupport
data.CFSIjpeg: sources.jdhuff
data.CFSIjpeg: s.jhdr
data.CFSIjpeg: sources.jrevdct
data.CFSIjpeg: sources.jcconv
data.CFSIjpeg: sources.diffuse
data.CFSIjpeg: s.rojpeg
o.rojpeg:	c.rojpeg
o.rojpeg:	h.rojpeg
o.rojpeg:	h.jinclude
o.rojpeg:	h.jconfig
o.rojpeg:	h.jpegdata
o.rojpeg:	h.swis
o.rojpeg:	h.kernel
o.rojpeg:	c.jrdjfif
o.rojpeg:	h.jinclude
o.rojpeg:	c.jdhuff
o.rojpeg:	h.jinclude
o.rojpeg:	c.jcconv
o.rojpeg:	c.SpriteOp
rm.SprExtendM: Sources.SprExtend
rm.SprExtendM: Hdr:ListOpts
rm.SprExtendM: Hdr:Macros
rm.SprExtendM: Hdr:System
rm.SprExtendM: Hdr:SWIs
rm.SprExtendM: Hdr:CPU.Generic26
rm.SprExtendM: Hdr:IO.GenericIO
rm.SprExtendM: Hdr:RISCOS
rm.SprExtendM: Hdr:ModHand
rm.SprExtendM: Hdr:Services
rm.SprExtendM: Hdr:VduExt
rm.SprExtendM: Hdr:FSNumbers
rm.SprExtendM: Hdr:NewErrors
rm.SprExtendM: Hdr:NDRDebug
rm.SprExtendM: Hdr:Sprite
rm.SprExtendM: Hdr:ColourTran
rm.SprExtendM: Hdr:PublicWS
rm.SprExtendM: Hdr:Draw
rm.SprExtendM: Hdr:ExtraLong
rm.SprExtendM: Hdr:MsgTrans
rm.SprExtendM: Hdr:Proc
rm.SprExtendM: Hdr:HostFS
rm.SprExtendM: Hdr:Debug
rm.SprExtendM: Hdr:HostDebug
rm.SprExtendM: Version
rm.SprExtendM: Hdr:PDriver
rm.SprExtendM: Sources.SWIs
rm.SprExtendM: Sources.SprAdjSize
rm.SprExtendM: Sources.SprTrans
rm.SprExtendM: Sources.MsgCode
rm.SprExtendM: Sources.PutScaled
rm.SprExtendM: sources.CSupport
rm.SprExtendM: S.PutScaled
rm.SprExtendM: sources.jdhuff
rm.SprExtendM: s.jhdr
rm.SprExtendM: sources.jrevdct
rm.SprExtendM: s.yuvtabs
rm.SprExtendM: sources.jcconv
rm.SprExtendM: sources.diffuse
rm.SprExtendM: sources.swiv2
@


4.2.2.1
log
@Removed dynamic dependancies from Makefiles and removed all reference to Prefix
@
text
@d223 127
@


4.1
log
@Initial revision
@
text
@d231 66
a309 13
data.CFSIjpeg: sources.csupport
data.CFSIjpeg: sources.jdhuff
data.CFSIjpeg: s.jhdr
data.CFSIjpeg: sources.jrevdct
data.CFSIjpeg: sources.jcconv
data.CFSIjpeg: sources.diffuse
data.CFSIjpeg: s.rojpeg
o.genpalette:	c.genpalette
o.makejhdr:	c.makejhdr
o.makejhdr:	h.jinclude
o.makejhdr:	h.jconfig
o.makejhdr:	h.jpegdata
o.genyuvtabs:	c.genyuvtabs
a349 53
rm.SprExtend: Hdr:ListOpts
rm.SprExtend: Hdr:Macros
rm.SprExtend: Hdr:System
rm.SprExtend: Hdr:SWIs
rm.SprExtend: Hdr:CPU.Generic26
rm.SprExtend: Hdr:IO.GenericIO
rm.SprExtend: Hdr:RISCOS
rm.SprExtend: Hdr:ModHand
rm.SprExtend: Hdr:Services
rm.SprExtend: Hdr:VduExt
rm.SprExtend: Hdr:FSNumbers
rm.SprExtend: Hdr:NewErrors
rm.SprExtend: Hdr:NDRDebug
rm.SprExtend: Hdr:Sprite
rm.SprExtend: Hdr:ColourTran
rm.SprExtend: Hdr:PublicWS
rm.SprExtend: Hdr:Draw
rm.SprExtend: Hdr:ExtraLong
rm.SprExtend: Hdr:MsgTrans
rm.SprExtend: Hdr:Proc
rm.SprExtend: Hdr:HostFS
rm.SprExtend: Hdr:Debug
rm.SprExtend: Hdr:HostDebug
rm.SprExtend: Version
rm.SprExtend: Hdr:PDriver
rm.SprExtend: Sources.SWIs
rm.SprExtend: Sources.SprAdjSize
rm.SprExtend: Sources.SprTrans
rm.SprExtend: Sources.MsgCode
rm.SprExtend: Sources.PutScaled
rm.SprExtend: sources.CSupport
rm.SprExtend: S.PutScaled
rm.SprExtend: sources.jdhuff
rm.SprExtend: s.jhdr
rm.SprExtend: sources.jrevdct
rm.SprExtend: s.yuvtabs
rm.SprExtend: sources.jcconv
rm.SprExtend: sources.diffuse
rm.SprExtend: sources.swiv2
o.putscaled:	c.putscaled
o.putscaled:	c.rojpeg
o.putscaled:	h.rojpeg
o.putscaled:	h.jinclude
o.putscaled:	h.jconfig
o.putscaled:	h.jpegdata
o.putscaled:	h.swis
o.putscaled:	h.kernel
o.putscaled:	c.jrdjfif
o.putscaled:	h.jinclude
o.putscaled:	c.jdhuff
o.putscaled:	h.jinclude
o.putscaled:	c.jcconv
o.putscaled:	c.SpriteOp
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@d251 6
a335 1
o.genpalette:	c.genpalette
a349 5
o.makejhdr:	c.makejhdr
o.makejhdr:	h.jinclude
o.makejhdr:	h.jconfig
o.makejhdr:	h.jpegdata
o.genyuvtabs:	c.genyuvtabs
@


4.1.7.2
log
@Makefile modified to use LocalRes$Path.
@
text
@d140 1
a140 2
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
@


4.1.5.1
log
@Import from SrcFiler
@
text
@a230 39
rm.SprExtend: Hdr:ListOpts
rm.SprExtend: Hdr:Macros
rm.SprExtend: Hdr:System
rm.SprExtend: Hdr:SWIs
rm.SprExtend: Hdr:CPU.Generic26
rm.SprExtend: Hdr:IO.GenericIO
rm.SprExtend: Hdr:RISCOS
rm.SprExtend: Hdr:ModHand
rm.SprExtend: Hdr:Services
rm.SprExtend: Hdr:VduExt
rm.SprExtend: Hdr:FSNumbers
rm.SprExtend: Hdr:NewErrors
rm.SprExtend: Hdr:NDRDebug
rm.SprExtend: Hdr:Sprite
rm.SprExtend: Hdr:PublicWS
rm.SprExtend: Hdr:Draw
rm.SprExtend: Hdr:ExtraLong
rm.SprExtend: Hdr:MsgTrans
rm.SprExtend: Hdr:Proc
rm.SprExtend: Hdr:HostFS
rm.SprExtend: Hdr:Debug
rm.SprExtend: Hdr:HostDebug
rm.SprExtend: Version
rm.SprExtend: Hdr:PDriver
rm.SprExtend: Sources.SWIs
rm.SprExtend: Sources.SprAdjSize
rm.SprExtend: Sources.SprTrans
rm.SprExtend: Sources.MsgCode
rm.SprExtend: Sources.PutScaled
rm.SprExtend: sources.CSupport
rm.SprExtend: S.PutScaled
rm.SprExtend: sources.jdhuff
rm.SprExtend: s.jhdr
rm.SprExtend: sources.jrevdct
rm.SprExtend: s.yuvtabs
rm.SprExtend: sources.jcconv
rm.SprExtend: sources.diffuse
rm.SprExtend: s.stdpalette
rm.SprExtend: sources.swiv2
a251 14
o.putscaled:	c.putscaled
o.putscaled:	c.rojpeg
o.putscaled:	h.rojpeg
o.putscaled:	h.jinclude
o.putscaled:	h.jconfig
o.putscaled:	h.jpegdata
o.putscaled:	h.swis
o.putscaled:	h.kernel
o.putscaled:	c.jrdjfif
o.putscaled:	h.jinclude
o.putscaled:	c.jdhuff
o.putscaled:	h.jinclude
o.putscaled:	c.jcconv
o.putscaled:	c.SpriteOp
d297 53
@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@d231 66
a335 1
o.genpalette:	c.genpalette
a349 65
o.makejhdr:	c.makejhdr
o.makejhdr:	h.jinclude
o.makejhdr:	h.jconfig
o.makejhdr:	h.jpegdata
o.genyuvtabs:	c.genyuvtabs
data.CFSIjpeg: sources.csupport
data.CFSIjpeg: sources.jdhuff
data.CFSIjpeg: s.jhdr
data.CFSIjpeg: sources.jrevdct
data.CFSIjpeg: sources.jcconv
data.CFSIjpeg: sources.diffuse
data.CFSIjpeg: s.rojpeg
o.rojpeg:	c.rojpeg
o.rojpeg:	h.rojpeg
o.rojpeg:	h.jinclude
o.rojpeg:	h.jconfig
o.rojpeg:	h.jpegdata
o.rojpeg:	h.swis
o.rojpeg:	h.kernel
o.rojpeg:	c.jrdjfif
o.rojpeg:	h.jinclude
o.rojpeg:	c.jdhuff
o.rojpeg:	h.jinclude
o.rojpeg:	c.jcconv
o.rojpeg:	c.SpriteOp
rm.SprExtendM: Sources.SprExtend
rm.SprExtendM: Hdr:ListOpts
rm.SprExtendM: Hdr:Macros
rm.SprExtendM: Hdr:System
rm.SprExtendM: Hdr:SWIs
rm.SprExtendM: Hdr:CPU.Generic26
rm.SprExtendM: Hdr:IO.GenericIO
rm.SprExtendM: Hdr:RISCOS
rm.SprExtendM: Hdr:ModHand
rm.SprExtendM: Hdr:Services
rm.SprExtendM: Hdr:VduExt
rm.SprExtendM: Hdr:FSNumbers
rm.SprExtendM: Hdr:NewErrors
rm.SprExtendM: Hdr:NDRDebug
rm.SprExtendM: Hdr:Sprite
rm.SprExtendM: Hdr:ColourTran
rm.SprExtendM: Hdr:PublicWS
rm.SprExtendM: Hdr:Draw
rm.SprExtendM: Hdr:ExtraLong
rm.SprExtendM: Hdr:MsgTrans
rm.SprExtendM: Hdr:Proc
rm.SprExtendM: Hdr:HostFS
rm.SprExtendM: Hdr:Debug
rm.SprExtendM: Hdr:HostDebug
rm.SprExtendM: Version
rm.SprExtendM: Hdr:PDriver
rm.SprExtendM: Sources.SWIs
rm.SprExtendM: Sources.SprAdjSize
rm.SprExtendM: Sources.SprTrans
rm.SprExtendM: Sources.MsgCode
rm.SprExtendM: Sources.PutScaled
rm.SprExtendM: sources.CSupport
rm.SprExtendM: S.PutScaled
rm.SprExtendM: sources.jdhuff
rm.SprExtendM: s.jhdr
rm.SprExtendM: sources.jrevdct
rm.SprExtendM: s.yuvtabs
rm.SprExtendM: sources.jcconv
rm.SprExtendM: sources.diffuse
rm.SprExtendM: sources.swiv2
@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
