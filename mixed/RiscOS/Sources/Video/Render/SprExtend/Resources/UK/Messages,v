head	4.5;
access;
symbols
	SprExtend-1_83:4.5
	SprExtend-1_82:4.5
	SprExtend-1_81:4.5
	SprExtend-1_80:4.5
	SprExtend-1_79:4.5
	SprExtend-1_78:4.5
	SprExtend-1_77:4.5
	SprExtend-1_76:4.5
	SprExtend-1_75:4.5
	SprExtend-1_74:4.5
	SprExtend-1_73:4.5
	SprExtend-1_72:4.5
	SprExtend-1_71-nocfsi:4.4
	SprExtend-1_71:4.4
	SprExtend-1_70-tracef:4.4
	SprExtend-1_70-headers:4.4
	SprExtend-1_70:4.4
	SprExtend-1_69:4.4
	SprExtend-1_68:4.4
	SprExtend-1_67:4.4
	SprExtend-1_66:4.4
	SprExtend-1_65:4.4
	SprExtend-1_64:4.4
	SprExtend-1_63:4.4
	SprExtend-1_62:4.4
	SprExtend-1_61:4.4
	SprExtend-1_60:4.4
	SprExtend-1_59:4.4
	SprExtend-1_58:4.4
	SprExtend-1_57:4.4
	SprExtend-1_56:4.3
	SprExtend-1_55:4.3
	SprExtend-1_54:4.3
	SprExtend-1_53:4.3
	SprExtend-1_52:4.3
	SprExtend-1_51:4.3
	SprExtend-1_50:4.3
	SprExtend-1_38-1_35_2_16:4.3
	SprExtend-1_49:4.3
	SprExtend-1_48:4.3
	SprExtend-1_47:4.3
	SprExtend-1_38-1_35_2_15:4.3
	SprExtend-1_46:4.3
	SprExtend-1_45:4.3
	SprExtend-1_44:4.3
	SprExtend-1_43:4.3
	SprExtend-1_42:4.3
	SprExtend-1_41:4.3
	SprExtend-1_38-1_35_2_14:4.3
	SprExtend-1_40:4.3
	SprExtend-1_38-1_35_2_13:4.3
	SprExtend-1_38-1_35_2_12:4.3
	SprExtend-1_38-1_35_2_11:4.3
	SprExtend-1_38-1_35_2_10:4.3
	SprExtend-1_38-1_35_2_9:4.3
	SprExtend-1_38-1_35_2_8:4.3
	SprExtend-1_39:4.3
	SprExtend-1_38-1_35_2_7:4.3
	SprExtend-1_38-1_35_2_6:4.3
	SprExtend-1_38-1_35_2_5:4.3
	SprExtend-1_38-1_35_2_4:4.3
	SprExtend-1_38-1_35_2_3:4.3
	SprExtend-1_38-1_35_2_2:4.3
	SprExtend-1_38-1_35_2_1:4.3
	MigrateIJG8b:4.3.0.2
	SprExtend-1_38:4.3
	SprExtend-1_37:4.3
	SprExtend-1_36:4.3
	SprExtend-1_35:4.3
	SprExtend-1_34:4.3
	SprExtend-1_33:4.3
	SprExtend-1_32:4.3
	SprExtend-1_31:4.2
	SprExtend-1_30:4.2
	SprExtend-1_29:4.2
	SprExtend-1_28:4.2
	SprExtend-1_27:4.2
	SprExtend-1_26:4.2
	SprExtend-1_25:4.2
	SprExtend-1_24:4.2
	SprExtend-1_23:4.1
	SprExtend-1_22:4.1
	SprExtend-1_21:4.1
	SprExtend-1_20:4.1
	SprExtend-1_19:4.1
	SprExtend-1_18:4.1
	SprExtend-1_17:4.1
	RO_5_07:4.1
	SprExtend-1_16:4.1
	SprExtend-1_15:4.1
	SprExtend-1_14:4.1
	SprExtend-1_13:4.1
	SprExtend-1_12:4.1
	SprExtend-1_11:4.1
	SprExtend-1_10:4.1
	SprExtend-1_09:4.1
	SprExtend-1_08:4.1
	dellis_autobuild_BaseSW:4.1
	SprExtend-1_07:4.1
	SprExtend-1_06:4.1
	sbrodie_sedwards_16Mar2000:4.1
	dcotton_autobuild_BaseSW:4.1
	SprExtend-1_05:4.1
	Ursula_merge:4.1
	nturton_SprExtend-1_04:4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1
	Ursula_RiscPC:4.1.0.8
	nicke_SprExtend-0_99:4.1.7.1
	rthornb_UrsulaBuild-19Aug1998:4.1
	UrsulaBuild_FinalSoftload:4.1
	rthornb_UrsulaBuild-12Aug1998:4.1
	aglover_UrsulaBuild-05Aug1998:4.1
	rthornb_UrsulaBuild-29Jul1998:4.1
	rthornb_UrsulaBuild-22Jul1998:4.1
	rthornb_UrsulaBuild-15Jul1998:4.1
	rthornb_UrsulaBuild-07Jul1998:4.1
	rthornb_UrsulaBuild-17Jun1998:4.1
	rthornb_UrsulaBuild-03Jun1998:4.1
	rthornb_UrsulaBuild-27May1998:4.1
	rthornb_UrsulaBuild-21May1998:4.1
	rthornb_UrsulaBuild_01May1998:4.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	ARTtmp:4.1.7.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.5
date	2016.05.21.14.03.43;	author rool;	state Exp;
branches;
next	4.4;
commitid	4BquZHousteH5m7z;

4.4
date	2013.10.13.15.40.28;	author jlee;	state Exp;
branches;
next	4.3;
commitid	sXDj93HaCpcac99x;

4.3
date	2010.10.13.20.26.14;	author rsprowson;	state Exp;
branches;
next	4.2;

4.2
date	2010.09.01.20.48.48;	author rsprowson;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.45.11;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.5.1
	4.1.7.1;
next	;

4.1.1.1
date	96.11.05.09.45.11;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.02.41.57;	author nturton;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.12.58.01;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.21.20.39;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.5
log
@Transcode arithmetics
Detail:
  Import of the raw coefficient Huffman entropy compressor elements of the IJG8d library.
  We don't need a full compressor (ala JCompMod) since there's never a need to go all the way through IDCT/upsampling/colour conversion only to reverse the whole process; it's sufficient only to collect up the raw coefficients and recompress them as a baseline JPEG.
  Two extra (temporary) dynamic areas are introduced, once to hold the raw coefficients and the other to act as a scratch file to make the JPEG in. See Doc/JPEGMmgr.
Admin:
  Submission for the JPEG bounty.

Version 1.72. Tagged as 'SprExtend-1_72'
@
text
@#{DictTokens}
NoSprit:%0: Sprite doesn't exist
DivZero:%0: Division by zero
AppErr:%0: Can't append sprite
BadCBlk:%0: Source rectangle not inside sprite
BadFlgs:%0: Attempt to set reserved flags
BadGScl:%0: Grey-scale only does 16 colours
BadRect:%0: Source rectangle area zero
BadTfrm:%0 can only do linear transformations
BadTran:%0: Bad colour translation table
InvRC:%0: Invalid row or column
NoIRoom:%0: Not enough memory to insert sprite row or column
NoMem:%0: Not enough memory for sprite operation
NoWork:%0: Not enough memory in system sprite area
InvalidSpriteMode:%0: Invalid sprite mode
BadDepth:Mask or palette operations not supported in this display depth
BadType:Sprite type is not supported by this version of the SpriteExtend module
BadJPEG:Incomplete or corrupt JPEG data
BadJPEGUnsupported:JPEG format is not supported by this version of the SpriteExtend module
BadJPEGProgressive:Progressive JPEG rendering failed due to an internal error
BadJPEGPlot:Transformed JPEG plotting is not supported by this version of the SpriteExtend module
JPEGNoRoom:Not enough memory available to plot JPEG
JPEGFatal:JPEG plot failed due to fatal inconsistency
BadData:Unrecognised sprite data
NoGrScl:Operation 'PutSpriteGreyScaled' is not supported by this version of the SpriteExtend module
DynName:JPEG workspace
DynCoef:JPEG coefficients
DynTran:JPEG transcode
@


4.4
log
@Add OS_SpriteOp 38 (CreateRemoveAlpha) implementation. Fix FindMaskWidth.
Detail:
  Sources/SprOp:
  - Implemented OS_SpriteOp 38. For RISC OS 3.5 sprite types it's effectively the same as ROL's version, allowing conversion to/from alpha masks.
  - When given a sprite with a RISC OS 5 alpha channel, it will use that as the source of the alpha/mask data, allowing RISC OS 5 alpha channels to be converted to RISC OS 3.5 1bpp masks or Select alpha masks (including converting to a RISC OS 3.5 mode word where possible)
  - An extra flag (bit 30) has also been added; settings bits 30 & 31 will attempt to convert any existing 1bpp/8bpp mask to a RISC OS 5 alpha channel (or create a default alpha channel if the sprite has no mask). The conversion will fail if the colour depth is such that no alpha channel is possible.
  - Also fixed regression in FindMaskWidth; when converting from the Kernel version it looks like I missed a couple of lines, and all RISC OS 3.5/RISC OS 5 type mode words would have handled incorrectly
  Resources/UK/Messages:
  - Add InvalidSpriteMode error message, for use by OS_SpriteOp 38
Admin:
  Tested on BB-xM converting various sprites & masks to/from the different formats


Version 1.57. Tagged as 'SprExtend-1_57'
@
text
@d27 2
@


4.3
log
@Paper and fill some JPEG cracks.
The exit_c function was repeatedly being called with the line number argument and error code the wrong way round and since only bits 0-2 of the error code are inspected on exit any fatal exits from the ported JPEG library code would either report the wrong error or fail silently (depending on the line number) - example a 12 bits per sample JPEG would be rendered without fault into a screen full of random memory garbage.
Assembling/compiling with the 'jpeg' switch off didn't work, fixed, and also now zeros out the SWI decode values in the module header.
Moved include of 'yuvtabs.s' into the colour conversion code.
Deleted panic_exit, it did nothing useful but trace a value then exit, so it now just calls exit() like everyone else.
Removed excess call to find_image_dims(), this was needed just to get the workspace requirements when the JPEG had already been sized up by asm_find_image_dims() earlier. Side effect of removing the pilot JPEG code earlier is that this call can now only get to the JPEG code from a JPEG_ SWI. Changed to just pass the workspace requirements into 'c.PutScaled' and save a duplicate scan.
Fatal exits from the assembler huffman decoder now report a sensible error.
Trimmed out all the JPEG assessment code from 'c.PutScaled' and moved it into 'c.rojpeg' so the put scaled is only concerned with putting things scaled.
Sanitised the #includes a bit.
Fixed on last check of wp->save_mode looking at the wrong bits for the mode number.
Resolved all the warning in the genhdr/genyuvtabs/genpalette utilities by casting a bit harder.[A[B
Added new more descriptive error messages to the messages file (not currently used), and made the 'not supported by' ones consistent so the tokeniser might crunch the file a bit more.
In looks_like_jpeg() changed a bitwise to logical or.
Fixed longstanding problem of not being able to render JPEGs at a scale of less than 1/6 in any greyscale mode, because, err, there was no code to do it - only the colour case was checked for. Implemented for 8bpp grey and 32bpp grey (which gets dithered for other lower modes) by just converting the luma channel into an equally weighted RGB value or replicating it for 256 greys.
Tested in all 8 colour depths on a Risc PC using sampling ratios of 1x1; 2x1; 1x2; 2x2 of the IJG test image scaled in !Draw by 0.16.

Version 1.32. Tagged as 'SprExtend-1_32'
@
text
@d15 1
@


4.2
log
@Clean up pass.
Trim 200+ lines of changes dating back to 1987, combine with non duplicates in the 'BlackLog'.
Use 'offsetof' macro in genjhdr to avoid warnings about uninitialised variables, rename from makejhdr so all the utils are clearly demarked.
Add throwback to MkCFSI-j.
Replace reason codes passed to SWIs with textual equivalents from the respective header files.
Speed up SWI despatch a bit by making the first few debug instructions depend on 'debuggs'.
Qualify all of the debug switches with the global 'debug' one.
Eliminate single use of 'pullx' macro.
Make do_branch() take an unsigned opcode so 50% of the branches don't result in implied cast warnings.
Added an UNUSED() macro to reduce a few of the legitimate warnings (the remainder are either in the original JPEG code or ones that it is worth checking the logic of.
Unixify one last filename.

Version 1.24. Tagged as 'SprExtend-1_24'
@
text
@d16 1
d18 3
a20 1
BadJPEGPlot:Transformed JPEG plotting is not supported by this version of RISC OS
d24 2
a25 2
NoGrScl:Sprite operation 'PutSpriteGreyScaled' is not supported by this version of RISC OS
DynName:JPEG Workspace
@


4.1
log
@Initial revision
@
text
@d15 1
a15 1
BadDepth:Mask or Palette operations not supported in this display depth
d17 1
a17 1
BadJPEGPlot:Transformed JPEG plotting is not supported by this version of the SpriteExtend module
d19 3
a21 3
JPEGFatal:JPEG plot failed due to Internal Error
BadData:Unrecognised Sprite Data
NoGrScl:Sprite Operation 'PutSpriteGreyScaled' is not supported by this version of RISC OS
@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
