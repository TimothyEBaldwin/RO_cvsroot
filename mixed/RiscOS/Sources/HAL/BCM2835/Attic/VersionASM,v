head	1.35;
access;
symbols
	BCM2835-0_34:1.34
	BCM2835-0_33:1.33
	BCM2835-0_32:1.32
	BCM2835-0_31:1.31
	BCM2835-0_30:1.30
	BCM2835-0_29:1.29
	BCM2835-0_28:1.28
	BCM2835-0_27:1.27
	BCM2835-0_26:1.26
	BCM2835-0_25:1.25
	BCM2835-0_24:1.24
	BCM2835-0_23:1.23
	BCM2835-0_22:1.22
	BCM2835-0_21:1.21
	BCM2835-0_20:1.20
	BCM2835-0_19:1.19
	BCM2835-0_18:1.18
	BCM2835-0_17:1.17
	BCM2835-0_16:1.16
	BCM2835-0_15:1.15
	BCM2835-0_14:1.14
	BCM2835-0_13:1.13
	BCM2835-0_12:1.12
	BCM2835-0_11:1.11
	BCM2835-0_10:1.10
	BCM2835-0_09:1.9
	BCM2835-0_08:1.8
	BCM2835-0_07:1.7
	BCM2835-0_06:1.6
	BCM2835-0_05:1.5
	BCM2835-0_04:1.4
	BCM2835-0_03:1.3
	BCM2835-0_02:1.2
	BCM2835-0_01:1.1;
locks; strict;
comment	@# @;


1.35
date	2014.06.25.20.26.23;	author rsprowson;	state dead;
branches;
next	1.34;
commitid	t2hsIVQgmhb1AWFx;

1.34
date	2014.06.19.21.03.13;	author jlee;	state Exp;
branches;
next	1.33;
commitid	EcK8j6AjJmkFYaFx;

1.33
date	2014.04.29.13.11.38;	author bavison;	state Exp;
branches;
next	1.32;
commitid	XTukLgbliNPw0Ayx;

1.32
date	2014.04.13.09.04.20;	author rsprowson;	state Exp;
branches;
next	1.31;
commitid	Xh6TDzI29rgz9vwx;

1.31
date	2013.12.19.01.29.10;	author jlee;	state Exp;
branches;
next	1.30;
commitid	9aIOPJd7daoBkGhx;

1.30
date	2013.12.15.22.16.04;	author jlee;	state Exp;
branches;
next	1.29;
commitid	T2h6gFw85uUkmhhx;

1.29
date	2013.01.22.23.28.46;	author jlee;	state Exp;
branches;
next	1.28;
commitid	rTORMrQfEY7XggBw;

1.28
date	2013.01.20.12.22.53;	author rsprowson;	state Exp;
branches;
next	1.27;
commitid	to9W7DXiNcFvEWAw;

1.27
date	2012.09.18.20.00.15;	author rsprowson;	state Exp;
branches;
next	1.26;
commitid	t3AxX2bIshWwa3lw;

1.26
date	2012.09.18.15.56.16;	author jlee;	state Exp;
branches;
next	1.25;
commitid	Q7RFVaT25YGPO1lw;

1.25
date	2012.09.18.13.49.12;	author jlee;	state Exp;
branches;
next	1.24;
commitid	kPVw3k71agHe71lw;

1.24
date	2012.09.10.21.32.43;	author jlee;	state Exp;
branches;
next	1.23;
commitid	L45O4zI0nGicW1kw;

1.23
date	2012.09.08.23.39.44;	author jlee;	state Exp;
branches;
next	1.22;
commitid	5mzVM9Zii5AKHMjw;

1.22
date	2012.09.08.12.46.08;	author jlee;	state Exp;
branches;
next	1.21;
commitid	B5V3jq9teWHw5Jjw;

1.21
date	2012.09.02.20.03.39;	author jlee;	state Exp;
branches;
next	1.20;
commitid	FetF3i2OxxUzHZiw;

1.20
date	2012.08.28.23.12.39;	author bavison;	state Exp;
branches;
next	1.19;
commitid	BMUpqstey7aoUmiw;

1.19
date	2012.08.24.19.12.53;	author jballance;	state Exp;
branches;
next	1.18;
commitid	S2rvE3qMgEc6IPhw;

1.18
date	2012.08.08.22.51.09;	author jlee;	state Exp;
branches;
next	1.17;
commitid	FaqKbVzpT5yRqNfw;

1.17
date	2012.08.02.00.43.27;	author jlee;	state Exp;
branches;
next	1.16;
commitid	p73b1WEma91lhUew;

1.16
date	2012.07.23.23.06.48;	author jballance;	state Exp;
branches;
next	1.15;
commitid	iPi94JlBTrB72Kdw;

1.15
date	2012.07.22.22.32.48;	author jballance;	state Exp;
branches;
next	1.14;
commitid	6IVuPWq7pOksSBdw;

1.14
date	2012.07.19.10.29.18;	author jballance;	state Exp;
branches;
next	1.13;
commitid	7w2Uohftp8BdY9dw;

1.13
date	2012.07.16.23.30.40;	author jlee;	state Exp;
branches;
next	1.12;
commitid	iGPaMrXamo0goQcw;

1.12
date	2012.07.15.12.00.51;	author bavison;	state Exp;
branches;
next	1.11;
commitid	MovUER9fG0yBBEcw;

1.11
date	2012.07.07.19.46.20;	author jlee;	state Exp;
branches;
next	1.10;
commitid	qeOmpWpRzmnerFbw;

1.10
date	2012.07.01.20.26.35;	author bavison;	state Exp;
branches;
next	1.9;
commitid	WH7Fa39f5fh0RTaw;

1.9
date	2012.06.15.14.40.12;	author bavison;	state Exp;
branches;
next	1.8;
commitid	GozidpkBTrLSrO8w;

1.8
date	2012.06.06.23.34.47;	author jlee;	state Exp;
branches;
next	1.7;
commitid	K3wKcUWWf47oHH7w;

1.7
date	2012.06.03.14.03.36;	author jlee;	state Exp;
branches;
next	1.6;
commitid	xDMdy452l0MpDg7w;

1.6
date	2012.05.24.11.30.03;	author bavison;	state Exp;
branches;
next	1.5;
commitid	ktC5TlFk2flF6Y5w;

1.5
date	2012.05.24.07.18.20;	author jballance;	state Exp;
branches;
next	1.4;
commitid	VRHTZUnHjfOjIW5w;

1.4
date	2012.05.23.21.45.04;	author bavison;	state Exp;
branches;
next	1.3;
commitid	dyGUTwLbAf3ExT5w;

1.3
date	2012.05.22.23.56.15;	author jballance;	state Exp;
branches;
next	1.2;
commitid	9zrOo5VjFU0EiM5w;

1.2
date	2012.05.20.20.52.45;	author jballance;	state Exp;
branches;
next	1.1;
commitid	2BhE7hfsP23Glv5w;

1.1
date	2012.05.10.14.55.24;	author bavison;	state Exp;
branches;
next	;
commitid	cq3yF2R3c630Hb4w;


desc
@@


1.35
log
@VersionASM trimmed
@
text
@;
; This file is automatically maintained by srccommit, do not edit manually.
; Last processed by srccommit version: 1.1.
;
                        GBLS    Module_MajorVersion
                        GBLA    Module_Version
                        GBLS    Module_MinorVersion
                        GBLS    Module_Date
                        GBLS    Module_FullVersion
                        GBLS    Module_ApplicationDate
                        GBLS    Module_HelpVersion
                        GBLS    Module_ComponentName
                        GBLS    Module_ComponentPath
Module_MajorVersion     SETS    "0.34"
Module_Version          SETA    34
Module_MinorVersion     SETS    ""
Module_Date             SETS    "19 Jun 2014"
Module_ApplicationDate  SETS    "19-Jun-14"
Module_ComponentName    SETS    "BCM2835"
Module_ComponentPath    SETS    "mixed/RiscOS/Sources/HAL/BCM2835"
Module_FullVersion      SETS    "0.34"
Module_HelpVersion      SETS    "0.34 (19 Jun 2014)"
                        END
@


1.34
log
@Add support code required for DWCDriver 'FIQ fix'
Detail:
  hdr/BCM2835, hdr/USB, s/USB - Update HAL_USBControllerInfo to return the MPHI address & IRQ number
  s/Interrupts - Add some missing memory barriers. Change FIQ enable/disable calls to not alter IRQ masking of the interrupt - simplifies the code and avoids any ordering issues with code that switches interrupts between IRQ & FIQ
  s/Timers - Add missing memory barrier
Admin:
  Tested on Raspberry Pi
  Requires Kernel-5_35-4_79_2_227 to build


Version 0.34. Tagged as 'BCM2835-0_34'
@
text
@@


1.33
log
@  Make HAL report keyboard present during boot
Detail:
  Given the complexity of the USB system on the BCM2835, it seems unlikely
  that the HAL keyboard scan will ever be implemented. Not only does this
  mean it doesn't honour any of the CMOS reset or monitor configuration keys,
  but it means the kernel will always attempt to boot the configured
  filing system and drive, irrespective of the *Configure [No]Boot setting,
  after printing "No keyboard present - autobooting". By changing the HAL
  to report a keyboard present but with no keys held down, we at least get
  the [No]Boot option honoured again (even if the Shift key can't be used
  to invert its sense), and have the message suppressed.
Admin:
  Tested on a Raspberry Pi.

Version 0.33. Tagged as 'BCM2835-0_33'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.33"
Module_Version          SETA    33
d17 2
a18 2
Module_Date             SETS    "29 Apr 2014"
Module_ApplicationDate  SETS    "29-Apr-14"
d21 2
a22 2
Module_FullVersion      SETS    "0.33"
Module_HelpVersion      SETS    "0.33 (29 Apr 2014)"
@


1.32
log
@Use IIC status definitions from HALEntries header
Mark HAL_IICDevice as a null entry, since bit 4 of the flags says we don't support that mode of operation anyway.

Version 0.32. Tagged as 'BCM2835-0_32'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.32"
Module_Version          SETA    32
d17 2
a18 2
Module_Date             SETS    "13 Apr 2014"
Module_ApplicationDate  SETS    "13-Apr-14"
d21 2
a22 2
Module_FullVersion      SETS    "0.32"
Module_HelpVersion      SETS    "0.32 (13 Apr 2014)"
@


1.31
log
@Add RTC HAL device
Detail:
  CJE's RTC module uses a DS1307-compatible RTC chip similar to the one used in the Iyonix. Previously the kernel handled talking to it, but now that low-level RTC handling has been moved out of the kernel we need an RTC HAL device in the BCM2835 HAL instead.
  s/RTC - A copy of s.RTC from the Tungsten HAL, relicensed as BSD with permission from Rob Sprowson
  Makefile, hdr/StaticWS, s/Top - Additional changes needed to hook the code into the HAL
Admin:
  Tested on Raspberry Pi, but without an RTC module fitted
  However the similarity of the clock chip to the one in the Iyonix should mean there's little chance of this code failing to work correctly when an RTC is fitted


Version 0.31. Tagged as 'BCM2835-0_31'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.31"
Module_Version          SETA    31
d17 2
a18 2
Module_Date             SETS    "19 Dec 2013"
Module_ApplicationDate  SETS    "19-Dec-13"
d21 2
a22 2
Module_FullVersion      SETS    "0.31"
Module_HelpVersion      SETS    "0.31 (19 Dec 2013)"
@


1.30
log
@Remove obsolete stub HAL video API implementation
Detail:
  s/Top, s/Video - Removed obsolete HAL video API implementation. A stub implementation is no longer required for systems that have a GraphicsV driver in a module, and can even cause problems if the OS decides to use the HAL implementation instead of the module one.
Admin:
  Tested in BCM2835 ROM
  Requires Kernel-5_35-4_79_2_203


Version 0.30. Tagged as 'BCM2835-0_30'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.30"
Module_Version          SETA    30
d17 2
a18 2
Module_Date             SETS    "15 Dec 2013"
Module_ApplicationDate  SETS    "15-Dec-13"
d21 2
a22 2
Module_FullVersion      SETS    "0.30"
Module_HelpVersion      SETS    "0.30 (15 Dec 2013)"
@


1.29
log
@Implement HAL_IRQMax
Detail:
  hdr/BCM2835 - Add definition for highest IRQ number
  s/Boot, s/Interrupts - Added HAL_IRQMax implementation, to ensure correct functionality with latest Kernel
Admin:
  Tested on 256MB Pi model B
  Requires Kernel-5_35-4_79_2_182


Version 0.29. Tagged as 'BCM2835-0_29'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.29"
Module_Version          SETA    29
d17 2
a18 2
Module_Date             SETS    "22 Jan 2013"
Module_ApplicationDate  SETS    "22-Jan-13"
d21 2
a22 2
Module_FullVersion      SETS    "0.29"
Module_HelpVersion      SETS    "0.29 (22 Jan 2013)"
@


1.28
log
@Add NoInitIRQ to list type controller declarations
Flag not previously inspected by DMA-0_19, but is in DMA-0_20. API cleanup for API version 1.0 since this is the only list type NoInitIRQ HAL in existance.

Version 0.28. Tagged as 'BCM2835-0_28'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.28"
Module_Version          SETA    28
d17 2
a18 2
Module_Date             SETS    "20 Jan 2013"
Module_ApplicationDate  SETS    "20-Jan-13"
d21 2
a22 2
Module_FullVersion      SETS    "0.28"
Module_HelpVersion      SETS    "0.28 (20 Jan 2013)"
@


1.27
log
@Reserve 5 bytes for timestamping
Also, swap magic numbers for defines.

Version 0.27. Tagged as 'BCM2835-0_27'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.27"
Module_Version          SETA    27
d17 2
a18 2
Module_Date             SETS    "18 Sep 2012"
Module_ApplicationDate  SETS    "18-Sep-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.27"
Module_HelpVersion      SETS    "0.27 (18 Sep 2012)"
@


1.26
log
@Fix building with latest kernel
Detail:
  s/Top, s/Video - Renamed HAL_Video entries to match naming convention used by latest kernel
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.26. Tagged as 'BCM2835-0_26'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.26"
Module_Version          SETA    26
d21 2
a22 2
Module_FullVersion      SETS    "0.26"
Module_HelpVersion      SETS    "0.26 (18 Sep 2012)"
@


1.25
log
@Add a video HAL device to allow BCMVideo to determine which DMA channel it can use for render ops
Detail:
  hdr/StaticWS, s/Top, s/Video - Added a simple VDU HAL device that exposes a DMA channel to BCMVideo for use with GraphicsV_Render
  hdr/BCM2835 - Don't allow DMA channel 12 to be used; latest firmware seems to have a bug which claims its free when in reality it isn't.
  s/Messaging, s/DMA - Adjust DMA init to allow the video device to claim a DMA channel before the DMA devices are initialised
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.25. Tagged as 'BCM2835-0_25'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.25"
Module_Version          SETA    25
d21 2
a22 2
Module_FullVersion      SETS    "0.25"
Module_HelpVersion      SETS    "0.25 (18 Sep 2012)"
@


1.24
log
@Use BCS1 instead of BCS0 for IIC when running on rev 2 boards
Detail:
  hdr/BCM2835, hdr/StaticWS, s/IIC - On rev 2 boards the usage of BSC0 and BSC1 have been swapped, such that BSC1 is now sent to the expansion header instead of BSC0.
  To allow RISC OS to continue to work with clock chips and other hardware fitted to the header, expose BSC1 to RISC OS if on a rev 2 board, or BSC0 if on a rev 1.
Admin:
  Changes received from Dave Higton
  Tested by Dave on rev 1 & rev 2 boards, with IIC devices
  Tested by me on rev 1 board (with no IIC devices fitted)


Version 0.24. Tagged as 'BCM2835-0_24'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.24"
Module_Version          SETA    24
d17 2
a18 2
Module_Date             SETS    "10 Sep 2012"
Module_ApplicationDate  SETS    "10-Sep-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.24"
Module_HelpVersion      SETS    "0.24 (10 Sep 2012)"
@


1.23
log
@Implement HAL_PhysInfo. Other misc tweaks.
Detail:
  s/Top - Added HAL_PhysInfo implementation. Tweaked HAL_Reset to reduce chances of failure.
  s/Stubs - Removed obsolete, unused UART stubs. Use KbdFlag_Done instead of magic number.
Admin:
  Tested on Raspberry Pi


Version 0.23. Tagged as 'BCM2835-0_23'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.23"
Module_Version          SETA    23
d17 2
a18 2
Module_Date             SETS    "09 Sep 2012"
Module_ApplicationDate  SETS    "09-Sep-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.23"
Module_HelpVersion      SETS    "0.23 (09 Sep 2012)"
@


1.22
log
@Read board model, revision, and available DMA channels from messaging channel. Report board revision via GPIO HAL device. Recover lost ROM relocation code.
Detail:
  hdr/StaticWS, s/Messaging, s/Top - Now reads board model, revision and available DMA channels from messaging channel
  hdr/StaticWS, s/GPIO - Updated GPIO HAL device to report board revision instead of a generic response of 'unknown'
  s/Top - Recovered ROM relocation code that got lost during a merge. End of ROM image no longer being corrupted, and RISC OS now sees correct amount of RAM.
  s/DMA - Ditch old code to read available DMA channels and use value read by HAL_QueryPlatform instead.
Admin:
  Tested on Raspberry Pi (B rev 1) with various start.elf sizes & versions
  DMA channel reporting only available with latest firmware (i.e. 8th Sep)
  Board revision number read by messaging channel seems to match that returned by /proc/cpuinfo on Linux


Version 0.22. Tagged as 'BCM2835-0_22'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.22"
Module_Version          SETA    22
d17 2
a18 2
Module_Date             SETS    "08 Sep 2012"
Module_ApplicationDate  SETS    "08-Sep-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.22"
Module_HelpVersion      SETS    "0.22 (08 Sep 2012)"
@


1.21
log
@Strip out video code & on-screen debug
Detail:
  Makefile, s/Display - Deleted on-screen debug code
  hdr/BCM2835, hdr/StaticWS, s/IIC, s/Messaging, s/Stubs, s/Top, s/UART - Strip out calls to on-screen debug code, and a few bits of video code
  s/Video - Video code removed and replaced with stub functions similar to other HALs. Only remaining useful code is HAL_Video_StartupMode, which in time should probably be moved to BCMVideo as well.
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.21. Tagged as 'BCM2835-0_21'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.21"
Module_Version          SETA    21
d17 2
a18 2
Module_Date             SETS    "02 Sep 2012"
Module_ApplicationDate  SETS    "02-Sep-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.21"
Module_HelpVersion      SETS    "0.21 (02 Sep 2012)"
@


1.20
log
@  Addition of I2C support
Detail:
  Implementation of the high-level HAL IIC interface provided by Dave Higton.
Admin:
  Checked it builds and runs at ROOL.

Version 0.20. Tagged as 'BCM2835-0_20'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.20"
Module_Version          SETA    20
d17 2
a18 2
Module_Date             SETS    "29 Aug 2012"
Module_ApplicationDate  SETS    "29-Aug-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.20"
Module_HelpVersion      SETS    "0.20 (29 Aug 2012)"
@


1.19
log
@Detail:
	changed HAL_ExtMachineID return value to 0 so kernel then calls
	HAL_MachineID and fetches the MAC address correctly

Admin:


Version 0.19. Tagged as 'BCM2835-0_19'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.19"
Module_Version          SETA    19
d17 2
a18 2
Module_Date             SETS    "24 Aug 2012"
Module_ApplicationDate  SETS    "24-Aug-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.19"
Module_HelpVersion      SETS    "0.19 (24 Aug 2012)"
@


1.18
log
@Don't claim that we support soft-off
Detail:
  s/Top - Fix HAL_PlatformInfo to not claim that we support soft-off
Admin:
  Tested in Pi ROM
  Fixes machine restarting after shutdown


Version 0.18. Tagged as 'BCM2835-0_18'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.18"
Module_Version          SETA    18
d17 2
a18 2
Module_Date             SETS    "08 Aug 2012"
Module_ApplicationDate  SETS    "08-Aug-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.18"
Module_HelpVersion      SETS    "0.18 (08 Aug 2012)"
@


1.17
log
@Add GPIO & VCHIQ HAL devices. Fix FlushDataCache macro to perform a clean & invalidate instead of just an invalidate.
Detail:
  s/GPIO - Basic implementation of the GPIO HAL device to allow the GPIO module to detect the board type
  s/VCHIQ, hdr/StaticWS - New VCHIQ HAL device which exposes the functionality required by the work-in-progress VCHIQ driver.
  Makefile, s/Top - Hook up the new files/devices
  hdr/BCM2835 - Make the FlushDataCache macro perform a clean & invalidate, to match the behaviour of FlushDataCacheRange
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.17. Tagged as 'BCM2835-0_17'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.17"
Module_Version          SETA    17
d17 2
a18 2
Module_Date             SETS    "02 Aug 2012"
Module_ApplicationDate  SETS    "02-Aug-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.17"
Module_HelpVersion      SETS    "0.17 (02 Aug 2012)"
@


1.16
log
@Detail: removed a flaw that crept in the last commit which prevented
        correct screen display.
	Now expects a start.elf released 24/7/2012 or later for correct
	display initialisation
Admin:


Version 0.16. Tagged as 'BCM2835-0_16'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.16"
Module_Version          SETA    16
d17 2
a18 2
Module_Date             SETS    "24 Jul 2012"
Module_ApplicationDate  SETS    "24-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.16"
Module_HelpVersion      SETS    "0.16 (24 Jul 2012)"
@


1.15
log
@Detail:  Frame buffer allocation via message channel almost complete. working
        HAL_MachineID functioning correctly
Admin:


Version 0.15. Tagged as 'BCM2835-0_15'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.15"
Module_Version          SETA    15
d17 2
a18 2
Module_Date             SETS    "22 Jul 2012"
Module_ApplicationDate  SETS    "22-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.15"
Module_HelpVersion      SETS    "0.15 (22 Jul 2012)"
@


1.14
log
@
	Various updates to do with the messaging channel, HAL_MachineID, and HAL_Reset

Detail:
	HAL_Reset now causes a complete reboot of the machiine. It isnt yet properly called from
	the kernel.. I've not investigated why yet. Behaviour tested using OS_Hardware call

	HAL_MachineID, with the github start.elf from 18 July 2012 will provide a valid MAC address ..
	i.e. that specific to this machine. The a1 value in HAL_ExtendedID needs to be set 0 for this to be reported
	by OS_ReadSysInfo .. unfortunately, again at this stage, it stalls the boot when set 0, so just for now
	the committed value for a1 in HAL_ExtendedID is not 0 .

	centralised messaging routine added. This is used a fair bit in acquiring the operating environment
	Not yet used in the DMA stuff. probably ought to be. At present the messaging channel this mainly
	handles is not complete, so information from this code is still WIP

Admin:
  (highlight level of testing that has taken place)
  (bugfix number if appropriate)


Version 0.14. Tagged as 'BCM2835-0_14'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.14"
Module_Version          SETA    14
d17 2
a18 2
Module_Date             SETS    "19 Jul 2012"
Module_ApplicationDate  SETS    "19-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.14"
Module_HelpVersion      SETS    "0.14 (19 Jul 2012)"
@


1.13
log
@Improve RAM detection/setup code. Update mailbox code in DMA driver.
Detail:
  s/Top - Improved RAM detection/setup to not assume that the OS image is at &0000 (current start.elf seems to place it at &8000). New code correctly supports compressed ROMs, and has some basic code implemented to read the RAM setup from the mailbox property interface (currently disabled, pending official firmware rollout + final testing)
  s/DMA - Updated mailbox property interface code to adhere to the current spec. Still needs testing with release firmware (the start.elf I'm using seems to report no DMA channels as being available)
Admin:
  Tested with a release start.elf (July 9th, or thereabouts) as well as a more recent test version containing initial mailbox property interface implementation
  Fixes issue with last 32K of ROM being wiped on startup


Version 0.13. Tagged as 'BCM2835-0_13'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.13"
Module_Version          SETA    13
d17 2
a18 2
Module_Date             SETS    "17 Jul 2012"
Module_ApplicationDate  SETS    "17-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.13"
Module_HelpVersion      SETS    "0.13 (17 Jul 2012)"
@


1.12
log
@  Support for reading (fake) CMOS
Detail:
  * Moved the NVMemory entries out of s.Stubs into s.CMOS.
  * Removed default list of CMOS contents and replaced with a block of zeros.
    It was never in physical address order and wasn't being used anyway.
    Default CMOS belongs in the kernel in any case.
  * Reports NVMemory type 3 (HAL calls) rather than 0 (no CMOS).
  * No longer reports a Delete power-on (CMOS reset) on every boot.
Admin:
  Tested on Raspberry Pi

Version 0.12. Tagged as 'BCM2835-0_12'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.12"
Module_Version          SETA    12
d17 2
a18 2
Module_Date             SETS    "15 Jul 2012"
Module_ApplicationDate  SETS    "15-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.12"
Module_HelpVersion      SETS    "0.12 (15 Jul 2012)"
@


1.11
log
@Add DMA driver
Detail:
  s/DMA, hdr/DMA, Makefile - DMA driver, as an implementation of the DMA controller and list type DMA channel HAL devices
  hdr/StaticWS - Added DMA workspace definition
  hdr/BCM2835 - Removed DMA control block definition (now in hdr/DMA). Add definitions for the mailbox property interface, which should be supported by the GPU firmware sometime soon.
  s/Top - Export a couple of the debug functions. Store logical & physical address of NCNB workspace instead of hackily getting phys addr of the (cacheable) HAL workspace. Call DMA_InitDevices in HAL_InitDevices.
Admin:
  Tested in BCM2835 ROM
  DMA driver hasn't received large amounts of testing, lacks support for finite-length circular transfers, and currently only has one DMA channel enabled
  More DMA channels should be available once the mailbox property interface is functional and we know which channels the GPU does and doesn't use.


Version 0.11. Tagged as 'BCM2835-0_11'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.11"
Module_Version          SETA    11
d17 2
a18 2
Module_Date             SETS    "07 Jul 2012"
Module_ApplicationDate  SETS    "07-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.11"
Module_HelpVersion      SETS    "0.11 (07 Jul 2012)"
@


1.10
log
@  Fixes for SD support
Detail:
  * Engage the GPIO controller's pull-up resistors on SDCLK, CMD and DAT0-DAT3.
    In tests, this seems to address the worst of the unreliability we have
    seen previously.
  * Remove the entry to change the bus between push-pull and open-drain modes.
    The BCM2835 simply doesn't seem to be able to do this. Fortunately, all
    the cards I have tested seem to be OK with the GPIO controller's pull-up
    on the CMD line (however strong that is - it's undocumented) engaged at
    all times.
  * Time a dummy command in order to calculate the speed of the input clock
    to the SD controller block (there doesn't appear to be any way to read
    its speed directly!) This is necessary because recent versions of the
    firmware have not only changed the default clock speed, but even made it
    a user-configurable option in config.txt. It's very important that we
    know how fast it is - if we set the dividers so SDCLK is too slow, then
    the workaround for the register write bug won't work, too fast and we
    overclock the cards, potentially damaging them.
  * Re-enable high speed mode. As long as we don't use the High Speed Enable
    bit in Host Control 1 (see change in SDIODriver 0.03) this seems to work
    for me.
Admin:
  Tested against my collection of test cards on a Raspberry Pi with the
  firmware from the 2012-06-22 commit on github, and with
  init_emmc_clock=100000000 in config.txt (though other values, or the
  absence of that line, or the entire file, should also work). The only
  issues I had appeared to be due to mechanical problems with the SD socket,
  and went away after the card was reseated one or more times.

Version 0.10. Tagged as 'BCM2835-0_10'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.10"
Module_Version          SETA    10
d17 2
a18 2
Module_Date             SETS    "01 Jul 2012"
Module_ApplicationDate  SETS    "01-Jul-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.10"
Module_HelpVersion      SETS    "0.10 (01 Jul 2012)"
@


1.9
log
@  SD support, and miscellaneous other changes
Detail:
  * Bugfix to HAL_FIQDisableAll - it wasn't clearing the FIQ register (would
    only have caused trouble in practice if the same device was subsequently
    enabled as an IRQ).
  * Added a load of memory barriers to s.Interrupts and s.Timers to conform
    to the requirement stated in 1.3 of the datasheet.
  * Added a HAL device for the Arasan SDHCI controller. Note that this does
    not currently work reliably, and results vary from card to card. High
    speed support is currently disabled until we are able to verify that it
    works reliably.
  * Added a sprinkling of "GET Hdr:ListOpts" because the space reserved for
    the SDHCI HAL device in hdr.StaticWS is determined by including
    Hdr:HALDevice and Hdr:SDHCIDevice, which need it.
  * When support for saving "CMOS" to the SD card is added, the ROM image
    file (kernel.img) is the only one we can count on the bootloader
    installing in memory, so I think we're going to have to work using the
    table in s.CMOS. Broadcom seems to like messing around with the space
    just after the processor vector table, so rather than adding a pointer
    to the table there, I've opted to mark it using a magic word.
Admin:
  Tested on a Raspberry Pi - as noted above, there are reliability issues.

Version 0.09. Tagged as 'BCM2835-0_09'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.09"
Module_Version          SETA    9
d17 2
a18 2
Module_Date             SETS    "15 Jun 2012"
Module_ApplicationDate  SETS    "15-Jun-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.09"
Module_HelpVersion      SETS    "0.09 (15 Jun 2012)"
@


1.8
log
@Sanitise HAL_USBControllerInfo
Detail:
  s/USB - For valid controllers, HAL_USBControllerInfo now always returns the correct USB struct size and fills in the controller type. The rest of the buffer is filled in only if the supplied size is large enough. This allows for proper probing of controllers without knowing the required buffer sizes beforehand.
Admin:
  Tested in BCM2835 ROM


Version 0.08. Tagged as 'BCM2835-0_08'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.08"
Module_Version          SETA    8
d17 2
a18 2
Module_Date             SETS    "07 Jun 2012"
Module_ApplicationDate  SETS    "07-Jun-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.08"
Module_HelpVersion      SETS    "0.08 (07 Jun 2012)"
@


1.7
log
@Add USB support
Detail:
  hdr/USB - New header with definition of usbinfo struct that's used by HAL_USBControllerInfo
  hdr/BCM2835 - Add note clarifying how mailboxes are used
  s/Top - Enable power to USB on startup
  s/USB - Implement HAL_USBControllerInfo to expose Synopsys USB controller details to RISC OS
Admin:
  Tested in BCM2835 ROM with Apr 19th start.elf


Version 0.07. Tagged as 'BCM2835-0_07'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.07"
Module_Version          SETA    7
d17 2
a18 2
Module_Date             SETS    "03 Jun 2012"
Module_ApplicationDate  SETS    "03-Jun-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.07"
Module_HelpVersion      SETS    "0.07 (03 Jun 2012)"
@


1.6
log
@  Whitespace changes
Detail:
  Substituted remaining hard spaces with normal ones and expanded tabs.
  This now matches the de facto standard for other components, and also looks
  better in the CVS web viewer.
Admin:
  No code changes

Version 0.06. Tagged as 'BCM2835-0_06'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.06"
Module_Version          SETA    6
d17 2
a18 2
Module_Date             SETS    "24 May 2012"
Module_ApplicationDate  SETS    "24-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.06"
Module_HelpVersion      SETS    "0.06 (24 May 2012)"
@


1.5
log
@   Corrected booting issues with UseALBlob compile switch
Detail:
   s.Top
Admin:
  tested locally JB
  (highlight level of testing that has taken place)
  (bugfix number if appropriate)


Version 0.05. Tagged as 'BCM2835-0_05'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.05"
Module_Version          SETA    5
d21 2
a22 2
Module_FullVersion      SETS    "0.05"
Module_HelpVersion      SETS    "0.05 (24 May 2012)"
@


1.4
log
@  Complete rework of timer and interrupt code
Detail:
 * Moved interrupt and timer code out of s.Stubs - they're not stubs any more.
 * Rewrote timer and counter code to use GPU system timer 1 for our Timer0
   rather than the ARM timer. This is recommended in the Broadcom datasheet
   because it's driven from the APB clock and so its speed will vary in
   reduced or low power mode.
 * HAL_CounterDelay now, well, does a delay!
 * Added a Timer1, driven from GPU system timer 3 - common code with Timer0.
 * Reshuffled device numbers so the GPU interrupts are at the bottom. This
   works better for FIQs and makes Timer0 the lowest priority interrupt.
 * Higher device numbers are now consistently treated as higher priority.
 * Stopped using bits 8-31 of the basic interrupt registers. These can't be
   masked, so they cause the kernel to lock up if generated, which happens
   if the GPU interrupt which they alias is generated (which appears to
   include the timers even though this is not documented).
 * Added definitions for all the interrupts, including those redacted from the
   datasheet - we need them at least for timers, USB and SD.
 * Stopped HAL_IRQClear from doing anything - this interrupt controller
   doesn't do latching. To acknowledge timer interrupts, you should use
   HAL_TimerIRQClear (and HAL_IRQClear too for compatibility with other ports).
 * Implemented HAL_IRQStatus and all the FIQ control routines.
 * Offsets to interrupt controller registers now use symbolic names.
 * Replaced some hard spaces in sources with normal ones.
Admin:
  Tested on a beta Raspberry Pi. Confirmed that interrupt handlers for both
  ARM and GPU sources can both be operational simultaneuosly. However, the FIQ
  code has not been tested. Timer0 is verified as running at the correct
  speed and reporting a count *down* in the correct range (not a count up as
  some previous versions did). HAL_CounterDelay appears correct also.

Version 0.04. Tagged as 'BCM2835-0_04'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.04"
Module_Version          SETA    4
d17 2
a18 2
Module_Date             SETS    "23 May 2012"
Module_ApplicationDate  SETS    "23-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.04"
Module_HelpVersion      SETS    "0.04 (23 May 2012)"
@


1.3
log
@   Boots with May17th start.elf
Detail:
   Recent changes in the broadcom startup code now accomodated. frame buffer
   will now determine whether it is L2 cached or not, and be set up accordingly.
   ATAGs not currently read, so ram size defaulted.
  ** note that there will be further updates to this over the following days
  ** trackikng startup code changes.
   added HAL_TimerIRQClear entry
Admin:
  (highlight level of testing that has taken place)
  (bugfix number if appropriate)


Version 0.03. Tagged as 'BCM2835-0_03'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.03"
Module_Version          SETA    3
d21 2
a22 2
Module_FullVersion      SETS    "0.03"
Module_HelpVersion      SETS    "0.03 (23 May 2012)"
@


1.2
log
@
  Update of HAL to incorporate separate development of HAL by J Ballance
  Will now compile against initial developemnt start.elf, and against the
  start.elf in general release at this date. (compile switch UseALBlob in
  hdr.BCM2835). Extended header defs, Updated IRQ stuff, HAL_FramebufferAddress
  Reworked Timers, + a number of other bits. Still work in progress.
Detail:
  (list files and functions that have changed)
Admin:
  Compiled and working - as far as it goes -. Will enable use with the current
  start.elf, and is (subject to any minor changes introduced) ready for use with the
  version due for release shortly which will provide the correct transparency operation,
  and a better aligned frame buffer

Version 0.02. Tagged as 'BCM2835-0_02'
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.02"
Module_Version          SETA    2
d17 2
a18 2
Module_Date             SETS    "20 May 2012"
Module_ApplicationDate  SETS    "20-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.02"
Module_HelpVersion      SETS    "0.02 (20 May 2012)"
@


1.1
log
@created by srccommit.
@
text
@d14 2
a15 2
Module_MajorVersion     SETS    "0.01"
Module_Version          SETA    1
d17 2
a18 2
Module_Date             SETS    "10 May 2012"
Module_ApplicationDate  SETS    "10-May-12"
d21 2
a22 2
Module_FullVersion      SETS    "0.01"
Module_HelpVersion      SETS    "0.01 (10 May 2012)"
@

