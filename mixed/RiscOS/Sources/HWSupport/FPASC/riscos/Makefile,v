head	4.15;
access;
symbols
	FPASC-4_36:4.14
	FPASC-4_35:4.13
	FPASC-4_34:4.13
	FPASC-4_33-1:4.13
	FPASC-4_33:4.13
	FPASC-4_32:4.13
	FPASC-4_31:4.13
	FPASC-4_30:4.13
	FPASC-4_29:4.13
	FPASC-4_28-2:4.12
	FPASC-4_28:4.12
	FPASC-4_27:4.12
	FPASC-4_26:4.12
	FPASC-4_25:4.12
	FPASC-4_24:4.12
	FPASC-4_23:4.12
	RO_5_07:4.11
	FPASC-4_22:4.11
	FPASC-4_21:4.10
	FPASC-4_20:4.9
	FPASC-4_19:4.8
	FPASC-4_18:4.7
	FPASC-4_17:4.7
	FPASC-4_16:4.7
	FPASC-4_15:4.7
	FPASC-4_14:4.6
	dellis_autobuild_BaseSW:4.5
	FPASC-4_13:4.5
	FPASC-4_12:4.5
	sbrodie_sedwards_16Mar2000:4.4
	kbracey_32bit_merge:4.3.2.1
	FPASC-4_11:4.4
	FPASC-4_10-4_3_2_1:4.3.2.1
	kbracey_32bit:4.3.0.2
	dcotton_autobuild_BaseSW:4.7
	FPASC-4_10:4.3
	Ursula_merge:4.1.4.1
	mstphens_UrsulaRiscPCBuild_20Nov98:4.1.4.1
	Ursula_RiscPC:4.1.4.1.0.2
	nicke_FPASC-4_05:4.1.7.1
	FPASC-4_09:4.2
	rthornb_UrsulaBuild-19Aug1998:4.1.4.1
	UrsulaBuild_FinalSoftload:4.1.4.1
	rthornb_UrsulaBuild-12Aug1998:4.1.4.1
	aglover_UrsulaBuild-05Aug1998:4.1.4.1
	rthornb_UrsulaBuild-29Jul1998:4.1.4.1
	rthornb_UrsulaBuild-22Jul1998:4.1.4.1
	rthornb_UrsulaBuild-15Jul1998:4.1.4.1
	rthornb_UrsulaBuild-07Jul1998:4.1.4.1
	rthornb_UrsulaBuild-17Jun1998:4.1.4.1
	rthornb_UrsulaBuild-03Jun1998:4.1.4.1
	rthornb_UrsulaBuild-27May1998:4.1.4.1
	rthornb_UrsulaBuild-21May1998:4.1.4.1
	rthornb_UrsulaBuild_01May1998:4.1.4.1
	afrost_NC2_Generic:4.1.7.1
	Spinner_RCA116:4.1.7.1
	Spinner_B20_2:4.1.7.1
	Spinner_19_3:4.1.7.1
	Spinner_B18:4.1.7.1
	Spinner_B17:4.1.7.1
	Spinner_B15:4.1.7.1
	Spinner_B14:4.1.7.1
	Spinner_B13:4.1.7.1
	Spinner_B12:4.1.7.1
	Spinner_B10:4.1.7.1
	Daytona:4.1.0.6
	Daytona_bp:4.1
	Ursula:4.1.0.4
	Ursula_bp:4.1
	Spinner_B7:4.1.7.1
	RO_3_71:4.1.3.1
	ARTtmp_merge:4.1.7.1
	Spin_3Apr97:4.1.7.1
	RCA_bp:4.1
	ARTtmp:4.1.7.1.0.2
	RCA:4.1.0.2
	Spin_merge:4.1.7.1
	MergeFiles:4.1.3.1
	RO_3_70:4.1.3.1
	NC_1_06:4.1.7.1
	Spinner:4.1.7
	Spin_xx:4.1.5
	NC_xx:4.1.5.1
	RO_3_60:4.1.1.1
	StrongARM:4.1.3
	Black:4.1.1;
locks; strict;
comment	@# @;


4.15
date	2018.04.12.01.01.32;	author bavison;	state Exp;
branches;
next	4.14;
commitid	g5vTCT2S9rhiy5yA;

4.14
date	2017.12.12.14.26.33;	author jlee;	state Exp;
branches;
next	4.13;
commitid	UcqjHjbUqubBTBiA;

4.13
date	2011.08.06.20.20.18;	author jlee;	state Exp;
branches;
next	4.12;
commitid	RGwDCySu9G6uquuv;

4.12
date	2004.11.12.16.38.32;	author bavison;	state Exp;
branches;
next	4.11;

4.11
date	2004.06.20.14.59.20;	author mhobbs;	state Exp;
branches;
next	4.10;

4.10
date	2004.01.26.17.29.19;	author kbracey;	state Exp;
branches;
next	4.9;

4.9
date	2003.02.21.14.35.24;	author kbracey;	state Exp;
branches;
next	4.8;

4.8
date	2002.04.12.13.42.15;	author srevill;	state Exp;
branches;
next	4.7;

4.7
date	2001.05.31.13.23.06;	author kbracey;	state Exp;
branches;
next	4.6;

4.6
date	2000.10.02.16.02.01;	author kbracey;	state Exp;
branches;
next	4.5;

4.5
date	2000.03.24.10.53.16;	author kbracey;	state Exp;
branches;
next	4.4;

4.4
date	99.11.26.14.37.34;	author sbrodie;	state Exp;
branches;
next	4.3;

4.3
date	99.08.03.17.56.55;	author kbracey;	state Exp;
branches
	4.3.2.1;
next	4.2;

4.2
date	98.09.21.12.36.49;	author kbracey;	state Exp;
branches;
next	4.1;

4.1
date	96.11.05.09.35.52;	author nturton;	state Exp;
branches
	4.1.1.1
	4.1.3.1
	4.1.4.1
	4.1.5.1
	4.1.7.1;
next	;

4.3.2.1
date	99.11.23.17.19.16;	author kbracey;	state Exp;
branches;
next	;

4.1.1.1
date	96.11.05.09.35.52;	author nturton;	state Exp;
branches;
next	;

4.1.3.1
date	96.11.06.01.24.38;	author nturton;	state Exp;
branches;
next	;

4.1.4.1
date	98.03.27.10.35.11;	author mstphens;	state Exp;
branches;
next	;

4.1.5.1
date	96.11.21.11.51.38;	author nturton;	state Exp;
branches;
next	;

4.1.7.1
date	96.11.29.20.46.37;	author nturton;	state Exp;
branches;
next	;


desc
@@


4.15
log
@  Updated to build using shared makefiles
Detail:
  Makefile rewritten. All the changes elsewhere reflect the fact that
  CoreDir, VeneerDir and FileExt are now passed in from the makefile,
  since that has visibility of filespec differences between OSes.


Version 4.36. Not tagged
@
text
@# Copyright 1996 Acorn Computers Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Makefile for Floating Point Accelerator Support Code (FPASC)

COMPONENT ?= FPEmulator
SA_MODULE  = FPERAM${SUFFIX_MODULE}
ifeq (,${MAKE_VERSION})
ROM_SOURCE = s.${MACHINE}
else
ROM_SOURCE = ${MACHINE}.s
endif
HEADER1    = FPEmulator

FPEANCHOR ?= Low
# 32bit-compatible RAM builds store FPEAnchor locally, so that they're compatible with kernels which use high or low zero page workspace. But this means the module must write to its own image to set its workspace pointer.
# 26bit-only builds can stick with the legacy low FPEAnchor location, avoiding the need for the module to self-modify.
ifeq (${FPE_APCS},3/26bit)
FPEANCHOR_RAM ?= Low
else
FPEANCHOR_RAM ?= Local
endif

ifeq (,$(filter ${MAKECMDGOALS},rom install_rom))
ASFLAGS += -PD "FPEAnchorType SETS \"${FPEANCHOR_RAM}\""
else
ASFLAGS += -PD "FPEAnchorType SETS \"${FPEANCHOR}\""
endif
ASFLAGS += -APCS ${FPE_APCS}

ifeq (,${MAKE_VERSION})
ASFLAGS += -PD "CoreDir SETS \"^.coresrc.s.\"" -PD "VeneerDir SETS \"^.vensrc.riscos.\"" -PD "FileExt SETS \"\""   -I^
else
ASFLAGS += -PD "CoreDir SETS \"coresrc/\""     -PD "VeneerDir SETS \"vensrc/riscos/\""   -PD "FileExt SETS \".s\""
# The layout of source files in this component is rather non-standard!

SYMLINK_DEPEND = symlink_extra
symlink_extra:
	$(foreach linksource,$(wildcard ../coresrc/s/*), \
		$(shell \
			leaf=`basename ${linksource}`; \
			[ -d ${linksource} ] || [ -L objs/coresrc/$$leaf.s ] || mkdir -p objs/coresrc; \
			[ -d ${linksource} ] || [ -L objs/coresrc/$$leaf.s ] || ln -s ../../${linksource} objs/coresrc/$$leaf.s; \
		) \
	)
	$(foreach linksource,$(wildcard ../vensrc/riscos/*), \
		$(shell \
			leaf=`basename ${linksource}`; \
			[ -d ${linksource} ] || [ -L objs/vensrc/riscos/$$leaf.s ] || mkdir -p objs/vensrc/riscos; \
			[ -d ${linksource} ] || [ -L objs/vensrc/riscos/$$leaf.s ] || ln -s ../../../${linksource} objs/vensrc/riscos/$$leaf.s; \
		) \
	)
	@@[ -L objs/VersionASM ] || ln -s ../../VersionASM objs/VersionASM
endif

include AAsmModule

# Dynamic dependencies:
@


4.14
log
@Avoid self-modification for 26bit RAM builds
Detail:
  riscos/Makefile - tweak FPEAnchor handling so that 26bit RAM builds use the legacy low FPEAnchor location instead of storing FPEAnchor locally. This results in a read-only module that can be used in custom ROMs, and saves a few bytes of space.
Admin:
  Tested via building PlingSystem and checking FPEAnchorType is set correctly


Version 4.36. Tagged as 'FPASC-4_36'
@
text
@d16 10
a25 40
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name     Description
# ----       ----     -----------
# 25-May-94  AMcC     Created.
# 17-Aug-94  AMcC     Removed Specific machine names.
#                     If building for old series machines, comment out A600
#                     target and uncomment ARM2/3 target.
# 28-Jan-97  KJB      If building for a kernel that is capable of operating
#                     in a 32-mode with interrupts enabled, you can change
#                     the APCS to 32bit for a more efficient emulator

#
# Paths
#
EXP_HDR = <export$dir>

#
# Generic options:
#
MKDIR   = do mkdir -p
AS      = ObjAsm
CP      = Copy
LD      = Link
RM      = Remove
WIPE    = -Wipe
CCFLAGS = -c -depend !Depend -IC:
ASFLAGS = -depend !Depend
CPFLAGS = ~cfr~v
WFLAGS  = ~c~v

#
# Program specific options:
#
COMPONENT = FPEmulator
TARGET_ROM = rm.${MACHINE}.FPEmulator
TARGET_RAM = rm.${MACHINE}.FPERAM
EXPORTS   = ${EXP_HDR}.FPEmulator
d35 33
a67 50
#
# Generic rules:
#
rom: ${TARGET_ROM}
        @@echo ${COMPONENT}: rom module built

export: ${EXPORTS}
        @@echo ${COMPONENT}: export complete

install: ${TARGET_RAM}
        ${MKDIR} ${INSTDIR}
        ${CP} ${TARGET_RAM} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: ram module installed

install_rom: ${TARGET_ROM}
        ${CP} ${TARGET_ROM} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
        @@echo ${COMPONENT}: rom module installed

clean:
        ${RM} ${TARGET_ROM}
        ${RM} ${TARGET_RAM}
        ${WIPE} o.* ${WFLAGS}
        @@echo ${COMPONENT}: cleaned

resources:
        ${MKDIR} ${RESDIR}.${COMPONENT}
	TokenCheck LocalRes:Messages
        ${CP} LocalRes:Messages  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
        @@echo ${COMPONENT}: resource files copied

${TARGET_RAM}: o.fpe_ram
        ${MKDIR} rm.${MACHINE}
        ${LD} -rmf -o $@@ o.fpe_ram

${TARGET_ROM}: o.fpe_rom
        ${MKDIR} rm.${MACHINE}
        ${LD} -rmf -o $@@ o.fpe_rom

o.fpe_ram: s.${MACHINE}
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -PD "FPEAnchorType SETS \"${FPEANCHOR_RAM}\"" s.${MACHINE} $@@

o.fpe_rom: s.${MACHINE}
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -PD "FPEAnchorType SETS \"${FPEANCHOR}\"" s.${MACHINE} $@@

${EXP_HDR}.FPEmulator: hdr.FPEmulator
        ${CP} hdr.FPEmulator $@@ ${CPFLAGS}

BBETYPE = fpasc
bbe-fpasc: bbe-generic
        BBE_Export_File ^.VersionNum
@


4.13
log
@Update to work with zero page relocation
Detail:
  Unlike most modules which can just store the zero page pointers in their workspace, FPEmulator is a bit trickier since the zero page pointers are needed from within abort handlers and other places where the module workspace pointer is hard to come by (in fact, FPEmulator uses FPEAnchor to store the module workspace pointer)
  So rather than break/rework lots of perfectly good code, there are now three different FPEmulator builds available, selected via the new FPEAnchorType option:
  * FPEAnchorType=Low will select a build suitable for machines with FPEAnchor at its original location in zero page. This is the default for ROM builds.
  * FPEAnchorType=High will select a build suitable for the FPEAnchor location (&ffff0ff4) that's used with zero page relocation. Machines with relocated zero page must specify this option in their components file.
  * FPEAnchorType=Local will select a build suitable for softloading. Rather than rely on using a zero page location for storing the workspace pointer, the module just stores it within itself. This option is selected automatically for RAM builds and can't be overriden via the components file.
  File changes:
  riscos/Makefile - Reworked makefile to support the new options
  riscos/FPEMacros - Updated AdrWS macro to work with FPEAnchorType=Local
  riscos/options - For non-local builds, declare the appropriate value for FPEAnchor
  riscos/start - Use appropriate FPEAnchor initialisation code
Admin:
  All 3 configs tested (ROM builds on BB-xM, RAM softload on Iyonix)


Version 4.29. Tagged as 'FPASC-4_29'
@
text
@d57 7
d104 1
a104 1
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -PD "FPEAnchorType SETS \"Local\"" s.${MACHINE} $@@
@


4.12
log
@  BBE tidying.
Detail:
  Exports VersionNum to BBE.
  Also removed dynamic dependencies fom Makefile.
Admin:
  Tested in a Tungsten BBE build.

Retagged, since this won't affect existing builds.
@
text
@d53 2
a54 1
TARGET    = rm.${MACHINE}.FPEmulator
d56 1
d61 1
a61 1
rom: ${TARGET}
d67 1
a67 1
install: ${TARGET}
d69 1
a69 1
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
d72 2
a73 2
install_rom: ${TARGET}
        ${CP} ${TARGET} ${INSTDIR}.${COMPONENT} ${CPFLAGS}
d77 2
a78 1
        ${RM} ${TARGET}
d88 1
a88 1
${TARGET}: o.fpe
d90 1
a90 1
        ${LD} -rmf -o $@@ o.fpe
d92 9
a100 2
o.fpe: s.${MACHINE}
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -CPU 5 s.${MACHINE} $@@
@


4.11
log
@  Changed Makefile to refer to 'machine' rather than 'system' and add support for STB5
Detail:
  Files modified: riscos.Makefile, MkRom310, MkRom350, MkRom, MkRomIyx
  Files added: riscos.MkRom380, MkRomUrs
               s.Phoebe, STB5, Tungsten
Admin:
  Upated from Kev's machine by Mike H.

Version 4.22. Tagged as 'FPASC-4_22'
@
text
@d95 4
a99 32
o.fpe: s.STB5
o.fpe: ^.coresrc.s.main
o.fpe: ^.coresrc.^.coresrc.s.defaults
o.fpe: ^.coresrc.^.vensrc.riscos.options
o.fpe: Hdr:t.^.ListOpts
o.fpe: Hdr:t.^.Macros
o.fpe: Hdr:t.^.Services
o.fpe: Hdr:t.^.ModHand
o.fpe: Hdr:t.^.EnvNumbers
o.fpe: ^.coresrc.^.vensrc.riscos.FPEMacros
o.fpe: ^.coresrc.^.vensrc.riscos.^.^.VersionASM
o.fpe: Hdr:t.^.SWIs
o.fpe: Hdr:t.^.RISCOS
o.fpe: ^.coresrc.^.coresrc.s.optcheck
o.fpe: ^.coresrc.^.coresrc.s.regnames
o.fpe: ^.coresrc.^.coresrc.s.armdefs
o.fpe: ^.coresrc.^.coresrc.s.fpadefs
o.fpe: ^.coresrc.^.coresrc.s.wsdefs
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.globalws
o.fpe: ^.coresrc.^.vensrc.riscos.start
o.fpe: ^.coresrc.^.coresrc.s.toplevel
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.macros
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpaundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpeundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.ldst
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.rounding
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.nans
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.arith
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transhw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.interf
o.fpe: ^.coresrc.^.vensrc.riscos.end
@


4.10
log
@* Denormalised numbers now held consistently in their nominal precision.
  MVF/MNF/ABS of a denormalised number without a change of precision
  treated specially, much like signalling NaNs. This prevents spurious
  underflow traps if they're enabled. Previously

       ; Underflow traps on
       LDFS    F0,DenormalisedSingle
       MVFS    F0,F0

  or

       ; Underflow traps off
       LDFD    F0,SmallestNormalDouble
       MUFD    F0,F0,#0.5
       ; Turn underflow traps on
       STFD    F0,xxx

  would have generated traps.

* LDFP/STFP rearrangement of NaN significands reinstated, as DDT
  can now make use of it.

* Typos in over/underflow code for LDFP corrected.

* Makefile changed to build in rm.${SYSTEM} instead of rm.${MACHINE}.

* Experimental dynamic rounding controls added to FPSR (for emulator
  only). Currently disabled; does not affect LDFP or STFP yet.

Version 4.21. Tagged as 'FPASC-4_21'
@
text
@d53 1
a53 1
TARGET    = rm.${SYSTEM}.FPEmulator
d86 1
a86 1
        ${MKDIR} rm.${SYSTEM}
d89 2
a90 2
o.fpe: s.${System}
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -CPU 5 s.${System} $@@
d96 32
@


4.9
log
@Bug fix in STFP - minor error at bottom of word.
New switch to allow use of CLZ.
Added Docs.

Version 4.20. Tagged as 'FPASC-4_20'
@
text
@d53 1
a53 1
TARGET    = rm.${MACHINE}.FPEmulator
d86 1
a86 1
        ${MKDIR} rm.${MACHINE}
@


4.8
log
@  * Fixed install phase;
  * Moved stripdepnd out of Makefile;
  * Variants passed on amu command line.
Detail:
  * You can now specify the precise build variant of the FPEmulator by passing
    System=... and FPE_APCS=... on the amu command line. There are now more
    files in riscos.s to set the options for various types (as per Wimp).
    The default FPE as was is now built with: System="RO380" FPE_APCS="3/32bit"
Admin:
  Builds.
Version 4.19. Tagged as 'FPASC-4_19'
@
text
@d90 1
a90 1
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS ${FPE_APCS} -CPU ARM7M s.${System} $@@
@


4.7
log
@Added check to make sure we ignore undefined instruction exceptions generated
while in Thumb state.

Version 4.15. Tagged as 'FPASC-4_15'
@
text
@d38 1
a38 1
MKDIR   = CDir
d65 5
a84 2
# ARM600
#
d89 2
a90 11
o.fpe: s.fpemedusa
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS 3/32bit -CPU ARM7M s.fpemedusa $@@

# ARM2/3
#
#${TARGET}: o.fpe400
#        ${MKDIR} rm.${MACHINE}
#        ${LD} -rmf -o $@@ o.fpe400
#
#o.fpe400: s.fpe400
#        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS 3/26bit s.fpe400 $@@
a95 2
o.fpe400: s.fpe400 ^.coresrc.s.main ^.coresrc.^.coresrc.s.defaults ^.coresrc.^.vensrc.riscos.options Hdr:t.^.ListOpts Hdr:t.^.Macros Hdr:t.^.Services Hdr:t.^.ModHand Hdr:t.^.EnvNumbers ^.coresrc.^.vensrc.riscos.FPEMacros ^.coresrc.^.vensrc.riscos.^.^.VersionASM ^.coresrc.^.coresrc.s.regnames ^.coresrc.^.coresrc.s.armdefs ^.coresrc.^.coresrc.s.fpadefs ^.coresrc.^.coresrc.s.wsdefs ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws ^.coresrc.^.coresrc.^.vensrc.riscos.globalws ^.coresrc.^.vensrc.riscos.start ^.coresrc.^.coresrc.s.toplevel ^.coresrc.^.coresrc.^.coresrc.s.macros ^.coresrc.^.coresrc.^.coresrc.s.fpaundef ^.coresrc.^.coresrc.^.coresrc.s.fpeundef ^.coresrc.^.coresrc.^.coresrc.s.ldst ^.coresrc.^.coresrc.^.coresrc.s.rounding ^.coresrc.^.coresrc.^.coresrc.s.nans ^.coresrc.^.coresrc.^.coresrc.s.arith ^.coresrc.^.coresrc.^.coresrc.s.transhw ^.coresrc.^.coresrc.^.coresrc.s.transsw ^.coresrc.^.coresrc.^.coresrc.s.interf ^.coresrc.^.vensrc.riscos.end
o.fpe: s.fpemedusa ^.coresrc.s.main ^.coresrc.^.coresrc.s.defaults ^.coresrc.^.vensrc.riscos.options Hdr:t.^.ListOpts Hdr:t.^.Macros Hdr:t.^.Services Hdr:t.^.ModHand Hdr:t.^.EnvNumbers ^.coresrc.^.vensrc.riscos.FPEMacros ^.coresrc.^.vensrc.riscos.^.^.VersionASM Hdr:t.^.SWIs Hdr:t.^.RISCOS ^.coresrc.^.coresrc.s.regnames ^.coresrc.^.coresrc.s.armdefs ^.coresrc.^.coresrc.s.fpadefs ^.coresrc.^.coresrc.s.wsdefs ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws ^.coresrc.^.coresrc.^.vensrc.riscos.globalws ^.coresrc.^.vensrc.riscos.start ^.coresrc.^.coresrc.s.toplevel ^.coresrc.^.coresrc.^.coresrc.s.macros ^.coresrc.^.coresrc.^.coresrc.s.fpaundef ^.coresrc.^.coresrc.^.coresrc.s.fpeundef ^.coresrc.^.coresrc.^.coresrc.s.ldst ^.coresrc.^.coresrc.^.coresrc.s.rounding ^.coresrc.^.coresrc.^.coresrc.s.nans ^.coresrc.^.coresrc.^.coresrc.s.arith ^.coresrc.^.coresrc.^.coresrc.s.transhw ^.coresrc.^.coresrc.^.coresrc.s.transsw ^.coresrc.^.coresrc.^.coresrc.s.interf ^.coresrc.^.vensrc.riscos.end
@


4.6
log
@* Fixes to allow correct builds for 26-bit systems (RISC OS 3.1) and 32-bit
  systems using the 32-bit core (RISC OS 3.5-3.7).

Version 4.14. Tagged as 'FPASC-4_14'
@
text
@d102 2
@


4.5
log
@  Multiple context version of FP emulator and FPA support code - FP in
  callbacks and interrupts can now be yours.

  Exception dumps now available (integer and FP).

Detail:
* Changed to multiple-context version of the core. This will allow floating-
  point to be used safely in callbacks and interrupt routines (as long as
  you call the appropriate context changing SWIs). This activates the
  dormant SWIs FPEmulator_ChangeContext, FPEmulator_ContextLength and
  FPEmulator_InitContext. FPEmulator_DeactivateContext and
  FPEmulator_ActivateContext now have full functionality.

* Added new SWI interfaces to core: FPEmulator_Abort, FPEmulator_LoadContext
  and FPEmulator_SaveContext.

* On FP exceptions, integer registers are copied into the exception dump area.
  (TO DO: registers are USR mode ones - should take pains to figure out
  SVC or IRQ ones as required).

* The FPEmulator now has an exception dump area for floating point registers -
  a suitable version of Debugger will show these with *ShowFPRegs.

* FPEmulator_ChangeContext and FPEmulator_DeactivateContext now return -1
  for the default context.

* Run time detection of SVC stack position added.

* No longer creates a MessageTrans descriptor on the stack.

* Removed broken STM^ fudge from the FPA veneer, as the only StrongARMs that
  need it can't use the FPA.

* Fixed a typo in core_abort.

* Stopped continuous emulation runs crossing 4K page boundaries, with a view
  to improving abort handling.

* Use of DREG debugging macros fixed (line endings were being inserted in the
  wrong place).

* Prototype code to catch aborts inside the emulator and change the registers
  to make it look like the emulated instruction aborted. This is cute, but
  causes problems with anything like Ursula's lazy task-swapping. Really this
  needs to be done only on fatal aborts. Compiled out for now.

Version 4.12. Tagged as 'FPASC-4_12'
@
text
@d84 1
a84 2
        ${LD} -bin -o $@@ o.fpe
        SetType $@@ &FFA
d93 1
a93 2
#        ${LD} -bin -o $@@ o.fpe400
#        SetType $@@ &FFA
a101 32
o.fpe: s.fpemedusa
o.fpe: ^.coresrc.s.main
o.fpe: ^.coresrc.^.coresrc.s.defaults
o.fpe: ^.coresrc.^.vensrc.riscos.options
o.fpe: Hdr:t.^.ListOpts
o.fpe: Hdr:t.^.Macros
o.fpe: Hdr:t.^.Services
o.fpe: Hdr:t.^.ModHand
o.fpe: Hdr:t.^.EnvNumbers
o.fpe: ^.coresrc.^.vensrc.riscos.FPEMacros
o.fpe: ^.coresrc.^.vensrc.riscos.^.^.VersionASM
o.fpe: Hdr:t.^.SWIs
o.fpe: Hdr:t.^.RISCOS
o.fpe: ^.coresrc.^.coresrc.s.regnames
o.fpe: ^.coresrc.^.coresrc.s.armdefs
o.fpe: ^.coresrc.^.coresrc.s.fpadefs
o.fpe: ^.coresrc.^.coresrc.s.wsdefs
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.globalws
o.fpe: ^.coresrc.^.vensrc.riscos.start
o.fpe: ^.coresrc.^.coresrc.s.toplevel
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.macros
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpaundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpeundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.ldst
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.rounding
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.nans
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.arith
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transhw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transsw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.interf
o.fpe: ^.coresrc.^.vensrc.riscos.end
@


4.4
log
@  Merge of FPEmulator which uses the new macros in HdrSrc 0.63
Detail:
  Now 32-bit module compatible.
Admin:
  Tested the 26-bit build in the Customer F5 build.
  32-bit build tested on prototype 32-bit RISC OS.


Version 4.11. Tagged as 'FPASC-4_11'
@
text
@d112 1
@


4.3
log
@Ursula branch merged. This contains:
  Use of UMULL (compiled out).
  Service call table.
  Runs in UND32 mode (requires latest Kernel), giving a speed boost.

Version 4.10. Tagged as 'FPASC-4_10'
@
text
@d104 31
@


4.3.2.1
log
@ObjASM 3.12 syntax warning fixes.
32-bit compatible, hopefully.
Requires HdrSrc.

Version 4.10, 4.3.2.1. Tagged as 'FPASC-4_10-4_3_2_1'
@
text
@a103 31
o.fpe: s.fpemedusa
o.fpe: ^.coresrc.s.main
o.fpe: ^.coresrc.^.coresrc.s.defaults
o.fpe: ^.coresrc.^.vensrc.riscos.options
o.fpe: Hdr:t.^.ListOpts
o.fpe: Hdr:t.^.Macros
o.fpe: Hdr:t.^.Services
o.fpe: Hdr:t.^.ModHand
o.fpe: ^.coresrc.^.vensrc.riscos.FPEMacros
o.fpe: ^.coresrc.^.vensrc.riscos.^.^.VersionASM
o.fpe: Hdr:t.^.SWIs
o.fpe: Hdr:t.^.RISCOS
o.fpe: ^.coresrc.^.coresrc.s.regnames
o.fpe: ^.coresrc.^.coresrc.s.armdefs
o.fpe: ^.coresrc.^.coresrc.s.fpadefs
o.fpe: ^.coresrc.^.coresrc.s.wsdefs
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.globalws
o.fpe: ^.coresrc.^.vensrc.riscos.start
o.fpe: ^.coresrc.^.coresrc.s.toplevel
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.macros
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpaundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpeundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.ldst
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.rounding
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.nans
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.arith
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transhw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transsw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.interf
o.fpe: ^.coresrc.^.vensrc.riscos.end
@


4.2
log
@Makefile modified to use LocalRes$Path.
Changed to use srccommit.
German resources added.

Version 4.09. Tagged as 'FPASC-4_09'
@
text
@d26 3
d38 6
a43 6
MKDIR   = cdir
AS      = objasm
CP      = copy
LD      = link
RM      = remove
WIPE    = -wipe
d45 1
a45 1
ASFLAGS = -depend !Depend -apcs 3/26bit
d85 1
a85 1
        settype $@@ Module
d88 1
a88 1
        ${AS} -I Hdr:t.^ ${ASFLAGS} s.fpemedusa $@@
d95 1
a95 1
#        settype $@@ Module
d97 2
a98 2
#o.fpe: s.fpe400
#        ${AS} -I Hdr:t.^ ${ASFLAGS} s.fpe400 $@@
a103 32
o.fpe: s.fpemedusa
o.fpe: ^.coresrc.s.main
o.fpe: ^.coresrc.^.coresrc.s.defaults
o.fpe: ^.coresrc.^.vensrc.riscos.options
o.fpe: Hdr:t.^.ListOpts
o.fpe: Hdr:t.^.Macros
o.fpe: Hdr:t.^.Proc
o.fpe: Hdr:t.^.Services
o.fpe: Hdr:t.^.ModHand
o.fpe: ^.coresrc.^.vensrc.riscos.FPEMacros
o.fpe: ^.coresrc.^.vensrc.riscos.^.^.VersionASM
o.fpe: Hdr:t.^.SWIs
o.fpe: Hdr:t.^.RISCOS
o.fpe: ^.coresrc.^.coresrc.s.regnames
o.fpe: ^.coresrc.^.coresrc.s.armdefs
o.fpe: ^.coresrc.^.coresrc.s.fpadefs
o.fpe: ^.coresrc.^.coresrc.s.wsdefs
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.ctxtws
o.fpe: ^.coresrc.^.coresrc.^.vensrc.riscos.globalws
o.fpe: ^.coresrc.^.vensrc.riscos.start
o.fpe: ^.coresrc.^.coresrc.s.toplevel
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.macros
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpaundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.fpeundef
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.ldst
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.rounding
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.nans
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.arith
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transhw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.transsw
o.fpe: ^.coresrc.^.coresrc.^.coresrc.s.interf
o.fpe: ^.coresrc.^.vensrc.riscos.end
@


4.1
log
@Initial revision
@
text
@d36 1
a36 1
AS      = armasm
d73 2
a74 1
        ${CP} Resources.${LOCALE}.Messages  ${RESDIR}.${COMPONENT}.Messages  ${CPFLAGS}
d111 1
a111 1
o.fpe: ^.coresrc.^.vensrc.riscos.Version
@


4.1.4.1
log
@incorporate KBracey changes:
  Use long multiply (assumes long multiply; won't work on ARM 610,710)
  Compile with 32-bit APCS for better efficiency (requires Ursula kernel)
  Also compile for soft FP only (suit SA110)
update module format to Ursula service handler table
@
text
@a25 3
# 28-Jan-97  KJB      If building for a kernel that is capable of operating
#                     in a 32-mode with interrupts enabled, you can change
#                     the APCS to 32bit for a more efficient emulator
d35 6
a40 6
MKDIR   = CDir
AS      = ObjAsm
CP      = Copy
LD      = Link
RM      = Remove
WIPE    = -Wipe
d42 1
a42 1
ASFLAGS = -depend !Depend
d81 1
a81 1
        SetType $@@ &FFA
d84 1
a84 1
        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS 3/32bit -CPU ARM7M s.fpemedusa $@@
d91 1
a91 1
#        SetType $@@ &FFA
d93 2
a94 2
#o.fpe400: s.fpe400
#        ${AS} -I Hdr:t.^ ${ASFLAGS} -APCS 3/26bit s.fpe400 $@@
d100 32
a131 1

@


4.1.7.1
log
@NCOS 1.06 Imported from Zip drive
@
text
@@


4.1.5.1
log
@Import from SrcFiler
@
text
@@


4.1.3.1
log
@Import from cleaned 370 CD
@
text
@@


4.1.1.1
log
@Import from cleaned 360 CD
@
text
@@
