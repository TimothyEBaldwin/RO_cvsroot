head	1.132;
access;
symbols
	USBDriver-1_29:1.132
	USBDriver-1_28:1.131
	USBDriver-1_27:1.130
	USBDriver-1_26:1.129
	USBDriver-1_25:1.128
	USBDriver-1_24:1.127
	USBDriver-1_23:1.126
	USBDriver-1_22:1.125
	USBDriver-1_21:1.124
	USBDriver-1_20:1.123
	USBDriver-1_19:1.122
	NetBSD-1_19:1.121
	NetBSD-1_18:1.120
	NetBSD-1_17:1.119
	NetBSD-1_16:1.118
	NetBSD-1_15:1.117
	NetBSD-1_14:1.116
	NetBSD-1_13:1.115
	NetBSD-1_12:1.114
	NetBSD-1_09-1:1.115
	NetBSD-1_11:1.114
	NetBSD-1_10:1.113
	NetBSD-1_09:1.112
	NetBSD-1_08:1.111
	NetBSD-1_07:1.110
	NetBSD-1_06:1.109
	NetBSD-1_05:1.108
	NetBSD-1_04:1.107
	NetBSD-1_03:1.106
	NetBSD-1_02:1.105
	NetBSD-1_01:1.104
	NetBSD-1_00:1.103
	NetBSD-0_99:1.102
	NetBSD-0_98:1.101
	NetBSD-0_97:1.100
	NetBSD-0_96:1.99
	NetBSD-0_95:1.98
	NetBSD-0_94:1.97
	NetBSD-0_93:1.96
	NetBSD-0_92:1.95
	NetBSD-0_91:1.94
	NetBSD-0_90:1.93
	NetBSD-0_89:1.92
	NetBSD-0_88:1.91
	NetBSD-0_87:1.90
	NetBSD-0_86:1.89
	NetBSD-0_85:1.88
	NetBSD-0_84:1.87
	NetBSD-0_83:1.86
	NetBSD-0_82:1.85
	NetBSD-0_81:1.84
	NetBSD-0_80:1.83
	NetBSD-0_79:1.82
	NetBSD-0_78:1.81
	NetBSD-0_77:1.80
	NetBSD-0_76:1.79
	NetBSD-0_75:1.78
	NetBSD-0_74:1.77
	NetBSD-0_73:1.76
	NetBSD-0_72:1.75
	NetBSD-0_71:1.74
	NetBSD-0_70:1.73
	NetBSD-0_69:1.72
	NetBSD-0_68:1.71
	NetBSD-0_67:1.70
	NetBSD-0_66:1.69
	NetBSD-0_65:1.68
	NetBSD-0_64:1.67
	NetBSD-0_63:1.66
	NetBSD-0_62:1.65
	NetBSD-0_61:1.64
	NetBSD-0_60:1.63
	NetBSD-0_59:1.62
	NetBSD-0_58:1.61
	NetBSD-0_57:1.60
	NetBSD-0_56:1.59
	NetBSD-0_55:1.58
	NetBSD-0_54:1.57
	NetBSD-0_53:1.56
	NetBSD-0_52:1.55
	NetBSD-0_51:1.54
	NetBSD-0_50:1.53
	NetBSD-0_49:1.51
	NetBSD-0_48:1.50
	NetBSD-0_47:1.48
	NetBSD-0_46:1.47
	NetBSD-0_45:1.46
	NetBSD-0_44:1.45
	NetBSD-0_43:1.44
	NetBSD-0_42:1.43
	NetBSD-0_41:1.42
	NetBSD-0_40:1.41
	NetBSD-0_39:1.40
	NetBSD-0_38:1.39
	NetBSD-0_37:1.38
	NetBSD-0_36:1.37
	NetBSD-0_35:1.36
	NetBSD-0_34:1.35
	NetBSD-0_33:1.34
	NetBSD-0_32:1.33
	NetBSD-0_31:1.32
	NetBSD-0_30:1.31
	NetBSD-0_29:1.30
	RO_5_07:1.29
	NetBSD-0_28:1.29
	NetBSD-0_27:1.28
	NetBSD-0_26:1.27
	NetBSD-0_25:1.26
	NetBSD-0_24:1.25
	NetBSD-0_23:1.24
	NetBSD-0_21-1_22_2_1:1.22.2.1
	NetBSD-0_22:1.23
	USB1:1.22.0.2
	NetBSD-0_21:1.22
	NetBSD-0_20:1.21
	NetBSD-0_19:1.20
	NetBSD-0_18:1.19
	NetBSD-0_17:1.18
	NetBSD-0_16:1.17
	NetBSD-0_15:1.16
	NetBSD-0_14:1.15
	NetBSD-0_13:1.14
	NetBSD-0_12:1.13
	NetBSD-0_11:1.12
	NetBSD-0_10:1.11
	NetBSD-0_09:1.10
	NetBSD-0_08:1.9
	NetBSD-0_07:1.8
	NetBSD-0_06:1.7
	NetBSD-0_05:1.6
	NetBSD-0_04:1.5
	NetBSD-0_03:1.4
	NetBSD-0_02:1.3
	NetBSD-0_01:1.2;
locks; strict;
comment	@# @;


1.132
date	2018.05.19.08.35.59;	author rool;	state Exp;
branches;
next	1.131;
commitid	TZl4zRwaa8mtSSCA;

1.131
date	2018.03.17.17.53.34;	author rsprowson;	state Exp;
branches;
next	1.130;
commitid	85OlElnAwJdjZPuA;

1.130
date	2018.01.20.13.53.07;	author rool;	state Exp;
branches;
next	1.129;
commitid	SF66VPIPamQpsCnA;

1.129
date	2018.01.13.13.02.46;	author rool;	state Exp;
branches;
next	1.128;
commitid	6lmfzXJIOyj6pImA;

1.128
date	2017.11.18.10.23.32;	author rool;	state Exp;
branches;
next	1.127;
commitid	PT1DhjogFGE4kvfA;

1.127
date	2017.10.15.20.43.33;	author rsprowson;	state Exp;
branches;
next	1.126;
commitid	eZXGEW63S9CxQbbA;

1.126
date	2017.10.07.09.08.31;	author rool;	state Exp;
branches;
next	1.125;
commitid	Qzw5gnXY6CB2g6aA;

1.125
date	2017.09.03.15.35.25;	author rsprowson;	state Exp;
branches;
next	1.124;
commitid	W2qPOStvI2VwuL5A;

1.124
date	2017.08.19.14.39.17;	author rool;	state Exp;
branches;
next	1.123;
commitid	N0fa5xCfC1haFP3A;

1.123
date	2017.07.30.11.37.04;	author rool;	state Exp;
branches;
next	1.122;
commitid	0fHS8wSWQgNvif1A;

1.122
date	2017.07.15.08.44.45;	author rool;	state Exp;
branches;
next	1.121;
commitid	TwVe1ppFdskJNiZz;

1.121
date	2017.03.18.09.16.10;	author rool;	state Exp;
branches;
next	1.120;
commitid	2l0r7Njg1TXdP0Kz;

1.120
date	2016.12.17.10.12.48;	author rool;	state Exp;
branches;
next	1.119;
commitid	yws6HYEy6os04kyz;

1.119
date	2016.12.10.12.54.16;	author rool;	state Exp;
branches;
next	1.118;
commitid	zPShgPr6RkVlbrxz;

1.118
date	2016.06.21.22.03.59;	author jlee;	state Exp;
branches;
next	1.117;
commitid	kareoT4McyRIKnbz;

1.117
date	2016.06.02.21.01.11;	author rsprowson;	state Exp;
branches;
next	1.116;
commitid	Lesq5d7XLhs21W8z;

1.116
date	2016.05.06.21.39.15;	author jlee;	state Exp;
branches;
next	1.115;
commitid	AKEXdAKJY2tU5t5z;

1.115
date	2016.05.02.19.14.46;	author rsprowson;	state Exp;
branches;
next	1.114;
commitid	Yalf9VtEPIFjqW4z;

1.114
date	2016.03.26.23.33.47;	author jlee;	state Exp;
branches;
next	1.113;
commitid	fnR7qvmh1fKT2d0z;

1.113
date	2016.03.26.23.15.17;	author jlee;	state Exp;
branches;
next	1.112;
commitid	ec4yF5CmJMfyWc0z;

1.112
date	2015.11.17.08.54.29;	author rsprowson;	state Exp;
branches;
next	1.111;
commitid	aGTTwPGVohbkmqJy;

1.111
date	2015.11.15.09.42.33;	author rool;	state Exp;
branches;
next	1.110;
commitid	QBgP4ciWEprNGaJy;

1.110
date	2015.11.12.22.28.29;	author rsprowson;	state Exp;
branches;
next	1.109;
commitid	xXLLfyXXvY7x1RIy;

1.109
date	2015.11.09.02.56.50;	author bavison;	state Exp;
branches;
next	1.108;
commitid	FHc9TaQL9YzzDmIy;

1.108
date	2015.11.04.22.19.53;	author rool;	state Exp;
branches;
next	1.107;
commitid	HzbqOzFGVg8xePHy;

1.107
date	2015.09.28.19.53.32;	author rsprowson;	state Exp;
branches;
next	1.106;
commitid	uzkkBixTPwO3C3Dy;

1.106
date	2015.09.17.16.03.36;	author rool;	state Exp;
branches;
next	1.105;
commitid	bTEnXVoCvWq6HCBy;

1.105
date	2015.08.24.20.42.44;	author jballance;	state Exp;
branches;
next	1.104;
commitid	OLhV7J4PBFRG0zyy;

1.104
date	2015.08.22.09.21.53;	author rool;	state Exp;
branches;
next	1.103;
commitid	IRTjPoQFcMG6jfyy;

1.103
date	2015.08.22.08.58.39;	author rsprowson;	state Exp;
branches;
next	1.102;
commitid	Gxk8mCJ5kQ38bfyy;

1.102
date	2015.08.22.08.45.40;	author rool;	state Exp;
branches;
next	1.101;
commitid	dUK1sdsZhCgG6fyy;

1.101
date	2015.08.21.19.59.36;	author rsprowson;	state Exp;
branches;
next	1.100;
commitid	lkGgBHyZsFbSRayy;

1.100
date	2015.08.14.22.22.18;	author jlee;	state Exp;
branches;
next	1.99;
commitid	NGdbu548pV9NShxy;

1.99
date	2015.08.02.08.39.59;	author rsprowson;	state Exp;
branches;
next	1.98;
commitid	CoYKyUwxzPaBIFvy;

1.98
date	2015.07.04.08.38.54;	author rsprowson;	state Exp;
branches;
next	1.97;
commitid	83feWxHUYZB0EWry;

1.97
date	2015.06.29.19.34.44;	author jlee;	state Exp;
branches;
next	1.96;
commitid	xm6CArfSWPrXqmry;

1.96
date	2015.01.06.00.04.38;	author jlee;	state Exp;
branches;
next	1.95;
commitid	tl9yMvzfmT5kyT4y;

1.95
date	2015.01.02.16.25.47;	author jballance;	state Exp;
branches;
next	1.94;
commitid	d826RZCxCbRS6t4y;

1.94
date	2015.01.01.14.58.56;	author rsprowson;	state Exp;
branches;
next	1.93;
commitid	1ZqmNuZnVfz5Fk4y;

1.93
date	2014.12.17.18.55.17;	author rsprowson;	state Exp;
branches;
next	1.92;
commitid	KWimk5PW6on3sq2y;

1.92
date	2014.10.25.18.43.28;	author rsprowson;	state Exp;
branches;
next	1.91;
commitid	SYXBVhhWAW5D5CVx;

1.91
date	2014.08.29.19.26.11;	author jlee;	state Exp;
branches;
next	1.90;
commitid	f6ArfsGGibMS9iOx;

1.90
date	2014.08.12.19.02.06;	author jlee;	state Exp;
branches;
next	1.89;
commitid	FNxPAvpghRgvz6Mx;

1.89
date	2014.06.01.14.32.03;	author jlee;	state Exp;
branches;
next	1.88;
commitid	oHh05566cwiloPCx;

1.88
date	2014.06.01.13.51.35;	author jlee;	state Exp;
branches;
next	1.87;
commitid	Vazl1SQGmZpsaPCx;

1.87
date	2014.05.27.19.31.32;	author jlee;	state Exp;
branches;
next	1.86;
commitid	wb2RWYxDipk3ddCx;

1.86
date	2014.05.06.20.37.19;	author rsprowson;	state Exp;
branches;
next	1.85;
commitid	mvJ8HKiFqZQsfwzx;

1.85
date	2014.04.26.11.34.05;	author jlee;	state Exp;
branches;
next	1.84;
commitid	nal1f0Yk6B22zbyx;

1.84
date	2013.07.13.17.33.21;	author rsprowson;	state Exp;
branches;
next	1.83;
commitid	vMk6UMBwDXCfMkXw;

1.83
date	2013.05.27.11.01.15;	author rsprowson;	state Exp;
branches;
next	1.82;
commitid	oiMiL7Z7wETo7gRw;

1.82
date	2013.05.25.22.16.37;	author rsprowson;	state Exp;
branches;
next	1.81;
commitid	CIRNQ3209zG4V3Rw;

1.81
date	2013.05.10.06.59.36;	author rsprowson;	state Exp;
branches;
next	1.80;
commitid	vl8blyfCfPxnk3Pw;

1.80
date	2013.03.30.23.46.21;	author jlee;	state Exp;
branches;
next	1.79;
commitid	QOU0ipH7csEsdSJw;

1.79
date	2012.12.05.01.59.14;	author jlee;	state Exp;
branches;
next	1.78;
commitid	QiGLK99lNineGYuw;

1.78
date	2012.09.19.16.03.54;	author jlee;	state Exp;
branches;
next	1.77;
commitid	dVW4qyWuIG6sP9lw;

1.77
date	2012.07.13.00.50.03;	author jlee;	state Exp;
branches;
next	1.76;
commitid	BcPnmDDFsvatXkcw;

1.76
date	2012.07.09.22.22.36;	author jlee;	state Exp;
branches;
next	1.75;
commitid	Y0MPgi404HAReWbw;

1.75
date	2012.06.24.21.55.23;	author jlee;	state Exp;
branches;
next	1.74;
commitid	4v309enDleTpz0aw;

1.74
date	2012.06.07.00.10.58;	author jlee;	state Exp;
branches;
next	1.73;
commitid	LkYeKFZjKWlNTH7w;

1.73
date	2012.05.14.22.13.26;	author rsprowson;	state Exp;
branches;
next	1.72;
commitid	JbOfrksR4zMjZJ4w;

1.72
date	2012.02.20.20.57.02;	author rsprowson;	state Exp;
branches;
next	1.71;
commitid	SAJJ0xbfbjtvgWTv;

1.71
date	2012.02.18.15.36.12;	author rsprowson;	state Exp;
branches;
next	1.70;
commitid	tTFWWR62eUupyETv;

1.70
date	2012.02.05.09.00.19;	author rsprowson;	state Exp;
branches;
next	1.69;
commitid	GjZYU9ee7HIwMWRv;

1.69
date	2012.02.04.21.06.39;	author rsprowson;	state Exp;
branches;
next	1.68;
commitid	L0w6MFCZgiZGPSRv;

1.68
date	2011.12.18.18.13.49;	author jlee;	state Exp;
branches;
next	1.67;
commitid	FTilKIPWIS83qHLv;

1.67
date	2011.12.10.21.42.15;	author jlee;	state Exp;
branches;
next	1.66;
commitid	KVm6UAsJ6mTvPGKv;

1.66
date	2011.12.04.19.22.40;	author jlee;	state Exp;
branches;
next	1.65;
commitid	zwyAy3p02v2AfUJv;

1.65
date	2011.08.22.22.38.08;	author jlee;	state Exp;
branches;
next	1.64;
commitid	DX6w1a2oIxQTFywv;

1.64
date	2011.08.08.21.17.10;	author jlee;	state Exp;
branches;
next	1.63;
commitid	Hr33MiiPstM1GKuv;

1.63
date	2011.08.05.00.10.36;	author jlee;	state Exp;
branches;
next	1.62;
commitid	jZdApF1uaRruLfuv;

1.62
date	2011.05.22.20.22.24;	author jlee;	state Exp;
branches;
next	1.61;
commitid	Ye1jVWDlKivFSIkv;

1.61
date	2011.04.14.20.03.46;	author bavison;	state Exp;
branches;
next	1.60;
commitid	q54VHNXbaCA10Qfv;

1.60
date	2011.02.01.22.26.47;	author jlee;	state Exp;
branches;
next	1.59;

1.59
date	2010.11.23.22.59.22;	author jlee;	state Exp;
branches;
next	1.58;

1.58
date	2010.10.20.18.34.29;	author srevill;	state Exp;
branches;
next	1.57;

1.57
date	2010.10.20.17.52.10;	author srevill;	state Exp;
branches;
next	1.56;

1.56
date	2010.09.14.21.07.34;	author jlee;	state Exp;
branches;
next	1.55;

1.55
date	2010.07.21.23.57.03;	author jlee;	state Exp;
branches;
next	1.54;

1.54
date	2010.04.19.11.35.06;	author bavison;	state Exp;
branches;
next	1.53;

1.53
date	2010.02.28.15.57.26;	author jlee;	state Exp;
branches;
next	1.52;

1.52
date	2010.01.30.17.37.49;	author jlee;	state Exp;
branches;
next	1.51;

1.51
date	2009.10.02.20.59.00;	author jlee;	state Exp;
branches;
next	1.50;

1.50
date	2009.09.06.20.44.01;	author jlee;	state Exp;
branches;
next	1.49;

1.49
date	2009.06.13.23.20.25;	author bavison;	state Exp;
branches;
next	1.48;

1.48
date	2009.05.09.19.32.45;	author jlee;	state Exp;
branches;
next	1.47;

1.47
date	2006.02.22.09.24.35;	author jballance;	state Exp;
branches;
next	1.46;

1.46
date	2006.01.05.12.43.04;	author jballance;	state Exp;
branches;
next	1.45;

1.45
date	2005.12.31.00.32.33;	author jballance;	state Exp;
branches;
next	1.44;

1.44
date	2005.12.30.22.39.54;	author dellis;	state Exp;
branches;
next	1.43;

1.43
date	2005.12.05.16.02.38;	author jballance;	state Exp;
branches;
next	1.42;

1.42
date	2005.06.05.22.08.59;	author jballance;	state Exp;
branches;
next	1.41;

1.41
date	2005.05.18.11.54.02;	author jballance;	state Exp;
branches;
next	1.40;

1.40
date	2005.04.24.23.13.53;	author jballance;	state Exp;
branches;
next	1.39;

1.39
date	2005.03.05.00.24.12;	author jballance;	state Exp;
branches;
next	1.38;

1.38
date	2005.02.24.14.02.55;	author jballance;	state Exp;
branches;
next	1.37;

1.37
date	2005.02.23.00.01.58;	author jballance;	state Exp;
branches;
next	1.36;

1.36
date	2005.02.18.00.35.56;	author jballance;	state Exp;
branches;
next	1.35;

1.35
date	2005.01.31.13.45.35;	author jballance;	state Exp;
branches;
next	1.34;

1.34
date	2005.01.21.22.30.19;	author jballance;	state Exp;
branches;
next	1.33;

1.33
date	2005.01.03.01.50.00;	author jballance;	state Exp;
branches;
next	1.32;

1.32
date	2004.12.30.02.34.14;	author jballance;	state Exp;
branches;
next	1.31;

1.31
date	2004.11.25.00.54.51;	author jballance;	state Exp;
branches;
next	1.30;

1.30
date	2004.11.12.13.04.14;	author kbracey;	state Exp;
branches;
next	1.29;

1.29
date	2004.08.12.14.47.37;	author jballance;	state Exp;
branches;
next	1.28;

1.28
date	2004.07.01.18.10.35;	author kbracey;	state Exp;
branches;
next	1.27;

1.27
date	2004.06.30.14.50.33;	author kbracey;	state Exp;
branches;
next	1.26;

1.26
date	2004.05.06.15.50.20;	author bavison;	state Exp;
branches;
next	1.25;

1.25
date	2004.03.22.15.03.59;	author kbracey;	state Exp;
branches;
next	1.24;

1.24
date	2004.02.16.15.43.48;	author kbracey;	state Exp;
branches;
next	1.23;

1.23
date	2004.01.21.20.49.13;	author bavison;	state Exp;
branches;
next	1.22;

1.22
date	2004.01.21.15.23.22;	author bavison;	state Exp;
branches
	1.22.2.1;
next	1.21;

1.21
date	2004.01.07.13.43.16;	author bavison;	state Exp;
branches;
next	1.20;

1.20
date	2003.06.16.14.03.48;	author bavison;	state Exp;
branches;
next	1.19;

1.19
date	2003.06.03.10.38.12;	author bavison;	state Exp;
branches;
next	1.18;

1.18
date	2003.05.23.18.20.44;	author bavison;	state Exp;
branches;
next	1.17;

1.17
date	2003.05.14.16.43.47;	author bavison;	state Exp;
branches;
next	1.16;

1.16
date	2003.04.23.14.10.12;	author rsprowson;	state Exp;
branches;
next	1.15;

1.15
date	2003.04.15.12.22.14;	author rsprowson;	state Exp;
branches;
next	1.14;

1.14
date	2003.04.12.12.57.35;	author rsprowson;	state Exp;
branches;
next	1.13;

1.13
date	2003.04.11.09.17.42;	author rsprowson;	state Exp;
branches;
next	1.12;

1.12
date	2003.04.10.14.07.17;	author kbracey;	state Exp;
branches;
next	1.11;

1.11
date	2003.04.08.21.31.12;	author rsprowson;	state Exp;
branches;
next	1.10;

1.10
date	2003.03.08.13.06.16;	author rsprowson;	state Exp;
branches;
next	1.9;

1.9
date	2003.03.02.17.05.49;	author rsprowson;	state Exp;
branches;
next	1.8;

1.8
date	2003.02.22.11.38.35;	author kbracey;	state Exp;
branches;
next	1.7;

1.7
date	2003.02.10.19.03.02;	author dellis;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.07.22.29.44;	author dellis;	state Exp;
branches;
next	1.5;

1.5
date	2003.01.31.12.38.55;	author dellis;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.29.10.55.53;	author dellis;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.28.10.25.49;	author dellis;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.28.09.55.12;	author dellis;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.28.09.53.02;	author dellis;	state Exp;
branches;
next	;

1.22.2.1
date	2004.02.16.15.38.41;	author kbracey;	state Exp;
branches;
next	;


desc
@@


1.132
log
@Fix for alternate selection
Detail:
  1) If the alt setting had been changed from 0 it couldn't be changed back to 0.
  2) The alt value that usbd_set_interface takes should be an index into
     the number of alternate settings (altidx) not idesc->bAlternateSetting.
  3) usbd_set_interface returns an error (USBD_IN_USE) if pipes are open
     on the interface when you try to change it. We should return this error
     if the alternate setting can't be changed as the alternate setting would
     be wrong.
  Replace uses of usbd_set_interface() with a new function which correctly maps alternate number to alternate index, and propagates errors back to the caller.
Admin:
  Submission from Colin Granville.

Version 1.29. Tagged as 'USBDriver-1_29'
@
text
@/* (1.29)
 *
 * This file is automatically maintained by srccommit, do not edit manually.
 * Last processed by srccommit version: 1.1.
 *
 */
#define Module_MajorVersion_CMHG        1.29
#define Module_MinorVersion_CMHG        
#define Module_Date_CMHG                19 May 2018

#define Module_MajorVersion             "1.29"
#define Module_Version                  129
#define Module_MinorVersion             ""
#define Module_Date                     "19 May 2018"

#define Module_ApplicationDate          "19-May-18"

#define Module_ComponentName            "USBDriver"
#define Module_ComponentPath            "mixed/RiscOS/Sources/HWSupport/USB/USBDriver"

#define Module_FullVersion              "1.29"
#define Module_HelpVersion              "1.29 (19 May 2018)"
#define Module_LibraryVersionInfo       "1:29"
@


1.131
log
@Update the big vendor/product table
Merged from NetBSD revision 1.745.

Version 1.28. Tagged as 'USBDriver-1_28'
@
text
@d1 1
a1 1
/* (1.28)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.28
d9 1
a9 1
#define Module_Date_CMHG                17 Mar 2018
d11 2
a12 2
#define Module_MajorVersion             "1.28"
#define Module_Version                  128
d14 1
a14 1
#define Module_Date                     "17 Mar 2018"
d16 1
a16 1
#define Module_ApplicationDate          "17-Mar-18"
d21 3
a23 3
#define Module_FullVersion              "1.28"
#define Module_HelpVersion              "1.28 (17 Mar 2018)"
#define Module_LibraryVersionInfo       "1:28"
@


1.130
log
@Send service call to announce USBDriver dead
Detail:
  Service_USB subreason 5 now announces the USBDriver has finalised, HCDs will be able to use this to do any cleanup they desire.
  usbmodule.c - Add service, remove and detach buses. Also, fix accidental dereference of address 1 in config_detach().
  USBDevFS.h & Doc/USB - Add service.
Admin:
  Requires TCPIPLibs-5_63 for the safe queue removal macros.
  Submission from Colin Granville.

Version 1.27. Tagged as 'USBDriver-1_27'
@
text
@d1 1
a1 1
/* (1.27)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.27
d9 1
a9 1
#define Module_Date_CMHG                20 Jan 2018
d11 2
a12 2
#define Module_MajorVersion             "1.27"
#define Module_Version                  127
d14 1
a14 1
#define Module_Date                     "20 Jan 2018"
d16 1
a16 1
#define Module_ApplicationDate          "20-Jan-18"
d21 3
a23 3
#define Module_FullVersion              "1.27"
#define Module_HelpVersion              "1.27 (20 Jan 2018)"
#define Module_LibraryVersionInfo       "1:27"
@


1.129
log
@Fix asynchronous endpoint stall function and tidy up
Detail:
  Add missing brace which otherwise meant only the line
    req.bmRequestType = UT_WRITE_ENDPOINT;
  was conditional, rather than the following 6 lines.
  The confusing set of #ifdef __riscos/#endif was masking a missed call to cleartoggle() which would leave the controller and device out of sync.
  Tidy this up, and apply similar to usbd_clear_endpoint_stall() for clarity.
Admin:
  usbdi.c - as detailed above, based on a submission from Colin Granville, with edits.
  usbmodule.c - delete unused DEVICEFSISBROKEN switch, the bug to which it refers was fixed in DeviceFS-0_63 in 2003.

Version 1.26. Tagged as 'USBDriver-1_26'
@
text
@d1 1
a1 1
/* (1.26)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.26
d9 1
a9 1
#define Module_Date_CMHG                13 Jan 2018
d11 2
a12 2
#define Module_MajorVersion             "1.26"
#define Module_Version                  126
d14 1
a14 1
#define Module_Date                     "13 Jan 2018"
d16 1
a16 1
#define Module_ApplicationDate          "13-Jan-18"
d21 3
a23 3
#define Module_FullVersion              "1.26"
#define Module_HelpVersion              "1.26 (13 Jan 2018)"
#define Module_LibraryVersionInfo       "1:26"
@


1.128
log
@Remove duplicate define
Detail:
  OHCI_DEBUG shouldn't be set here.
Admin:
  Submission for USB bounty.

Version 1.25. Tagged as 'USBDriver-1_25'
@
text
@d1 1
a1 1
/* (1.25)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.25
d9 1
a9 1
#define Module_Date_CMHG                18 Nov 2017
d11 2
a12 2
#define Module_MajorVersion             "1.25"
#define Module_Version                  125
d14 1
a14 1
#define Module_Date                     "18 Nov 2017"
d16 1
a16 1
#define Module_ApplicationDate          "18-Nov-17"
d21 3
a23 3
#define Module_FullVersion              "1.25"
#define Module_HelpVersion              "1.25 (18 Nov 2017)"
#define Module_LibraryVersionInfo       "1:25"
@


1.127
log
@Fix potential memory leak on failure
Should read endpoint descriptor or set protocol fail, free the softc.
Ref https://www.riscosopen.org/forum/forums/4/topics/9503

Version 1.24. Tagged as 'USBDriver-1_24'
@
text
@d1 1
a1 1
/* (1.24)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.24
d9 1
a9 1
#define Module_Date_CMHG                15 Oct 2017
d11 2
a12 2
#define Module_MajorVersion             "1.24"
#define Module_Version                  124
d14 1
a14 1
#define Module_Date                     "15 Oct 2017"
d16 1
a16 1
#define Module_ApplicationDate          "15-Oct-17"
d21 3
a23 3
#define Module_FullVersion              "1.24"
#define Module_HelpVersion              "1.24 (15 Oct 2017)"
#define Module_LibraryVersionInfo       "1:24"
@


1.126
log
@Clear up duplicate/unused OHCI/EHCI source files
Detail:
  Remove the (now) unused sources from when this component produced multiple targets. See Controllers/OHCIDriver & Controllers/EHCIDriver for the live copies.
  Remove unset USBHAL defines.
  Simplify the Makefile and !Mk* scripts.
  No longer export usbroothub_subr.h.
  Add a porting type "device_t" to usb_port.h.
Admin:
  Submission for USB bounty.

Version 1.23. Tagged as 'USBDriver-1_23'
@
text
@d1 1
a1 1
/* (1.23)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.23
d9 1
a9 1
#define Module_Date_CMHG                07 Oct 2017
d11 2
a12 2
#define Module_MajorVersion             "1.23"
#define Module_Version                  123
d14 1
a14 1
#define Module_Date                     "07 Oct 2017"
d16 1
a16 1
#define Module_ApplicationDate          "07-Oct-17"
d21 3
a23 3
#define Module_FullVersion              "1.23"
#define Module_HelpVersion              "1.23 (07 Oct 2017)"
#define Module_LibraryVersionInfo       "1:23"
@


1.125
log
@Align docs with alias variable reality
The documentation of the Alias$@@USBDevice variables barely made sense, and examples not that consistent - improve this.
Fix step 1 of the alias handling to match the docs (this was fixed previously in revision 1.34 but accidentally overwritten in 1.35 less than an hour later).
Add a check for malloc() failing in low memory situations.

Tested with a couple of USB devices and alias variables containing 'echo' commands.

Version 1.22. Tagged as 'USBDriver-1_22'
@
text
@d1 1
a1 1
/* (1.22)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.22
d9 1
a9 1
#define Module_Date_CMHG                03 Sep 2017
d11 2
a12 2
#define Module_MajorVersion             "1.22"
#define Module_Version                  122
d14 1
a14 1
#define Module_Date                     "03 Sep 2017"
d16 1
a16 1
#define Module_ApplicationDate          "03-Sep-17"
d21 3
a23 3
#define Module_FullVersion              "1.22"
#define Module_HelpVersion              "1.22 (03 Sep 2017)"
#define Module_LibraryVersionInfo       "1:22"
@


1.124
log
@Changes to header exports
Detail:
  Export usbroothub_subr.h, for those HC's that might need it.
  Export C version of usbhal.h, in addition to the assembler Hdr version, for MUSBDriver.
  Eliminate the dependency on opt_usbverbose.h - an empty header file - by merging the change from usb_subr.c revision 1.186 from NetBSD which guards it with internal _KERNEL_OPT (unset).
Admin:
  Submission for USB bounty.

Version 1.21. Tagged as 'USBDriver-1_21'
@
text
@d1 1
a1 1
/* (1.21)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.21
d9 1
a9 1
#define Module_Date_CMHG                19 Aug 2017
d11 2
a12 2
#define Module_MajorVersion             "1.21"
#define Module_Version                  121
d14 1
a14 1
#define Module_Date                     "19 Aug 2017"
d16 1
a16 1
#define Module_ApplicationDate          "19-Aug-17"
d21 3
a23 3
#define Module_FullVersion              "1.21"
#define Module_HelpVersion              "1.21 (19 Aug 2017)"
#define Module_LibraryVersionInfo       "1:21"
@


1.123
log
@Remove OHCIDriver & EHCIDriver as targets
Detail:
  Makefile and !Mk* updated, and corresponding unused files put in the attic.
  Add an interim OHCIHALLib and EHCIHALLib target so that the HAL library variant still builds.
  Split messages into CmdHelp and Messages per a normal C component.
  Remove unused wsconsio/wsmousevar porting headers, no longer used.
Admin:
  Submission for USB bounty.
  Note, the version number of the resulting module will jump to match the top level VersionNum file.

Version 1.20. Tagged as 'USBDriver-1_20'
@
text
@d1 1
a1 1
/* (1.20)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.20
d9 1
a9 1
#define Module_Date_CMHG                30 Jul 2017
d11 2
a12 2
#define Module_MajorVersion             "1.20"
#define Module_Version                  120
d14 1
a14 1
#define Module_Date                     "30 Jul 2017"
d16 1
a16 1
#define Module_ApplicationDate          "30-Jul-17"
d21 3
a23 3
#define Module_FullVersion              "1.20"
#define Module_HelpVersion              "1.20 (30 Jul 2017)"
#define Module_LibraryVersionInfo       "1:20"
@


1.122
log
@Get a new tag
Admin:
  This is a (server side) copy of the component previously called RiscOS/Sources/HWSupport/USB/NetBSD to be used for ongoing development, retaining the significant revision history.
  Submission for USB bounty.
@
text
@d1 1
a1 1
/* (1.19)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.19
d9 1
a9 1
#define Module_Date_CMHG                15 Jul 2017
d11 2
a12 2
#define Module_MajorVersion             "1.19"
#define Module_Version                  119
d14 1
a14 1
#define Module_Date                     "15 Jul 2017"
d16 1
a16 1
#define Module_ApplicationDate          "15-Jul-17"
d21 3
a23 3
#define Module_FullVersion              "1.19"
#define Module_HelpVersion              "1.19 (15 Jul 2017)"
#define Module_LibraryVersionInfo       "1:19"
@


1.121
log
@Missing newline from device info printout
Detail:
  During internationalisation, the last line lost its newline.
Admin:
  Submission from Colin Granville.

Version 1.19. Tagged as 'NetBSD-1_19'
@
text
@d9 1
a9 1
#define Module_Date_CMHG                18 Mar 2017
d14 1
a14 1
#define Module_Date                     "18 Mar 2017"
d16 1
a16 1
#define Module_ApplicationDate          "18-Mar-17"
d18 2
a19 2
#define Module_ComponentName            "NetBSD"
#define Module_ComponentPath            "mixed/RiscOS/Sources/HWSupport/USB/NetBSD"
d22 1
a22 1
#define Module_HelpVersion              "1.19 (18 Mar 2017)"
@


1.120
log
@Messages fixes, internationalisation, minor clean ups
Detail:
  USBDriver was performing unnecessary messages file reopening on Service_ResourceFSStarted (MessageTrans does this itself), remove this.
  Internationalised USBDriver, in particular its *Commands.
  Fixed standalone builds to output the messages file objects in the right place (Makefile mistake).
  Changed OHCIDriver and EHCIDriver to use allocated error bases rather than 0.
  Sync'd, where possible, the OHCIDriver and EHCIDriver sources which share a common heritage. Tentative shared interrupt support fixes for non-PCI attached controllers. Comment blocks & indentation improved.
  Export min() macro in usb_port.h.
  CMHG updated to not listen for unwanted services.
Admin:
  Submission for USB bounty.
  Tested on Pandaboard and Pi 2. OHCIDriver untested but low risk.

Version 1.18. Tagged as 'NetBSD-1_18'
@
text
@d1 1
a1 1
/* (1.18)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.18
d9 1
a9 1
#define Module_Date_CMHG                17 Dec 2016
d11 2
a12 2
#define Module_MajorVersion             "1.18"
#define Module_Version                  118
d14 1
a14 1
#define Module_Date                     "17 Dec 2016"
d16 1
a16 1
#define Module_ApplicationDate          "17-Dec-16"
d21 3
a23 3
#define Module_FullVersion              "1.18"
#define Module_HelpVersion              "1.18 (17 Dec 2016)"
#define Module_LibraryVersionInfo       "1:18"
@


1.119
log
@Case change to match documentation
Detail:
  DeRegisterBus->DeregisterBus. Since clients calling this SWI are compiled C or assembler, this doesn't affect existing modules which remain binary compatible.
Admin:
  Submission for USB bounty.

Version 1.17. Tagged as 'NetBSD-1_17'
@
text
@d1 1
a1 1
/* (1.17)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.17
d9 1
a9 1
#define Module_Date_CMHG                10 Dec 2016
d11 2
a12 2
#define Module_MajorVersion             "1.17"
#define Module_Version                  117
d14 1
a14 1
#define Module_Date                     "10 Dec 2016"
d16 1
a16 1
#define Module_ApplicationDate          "10-Dec-16"
d21 3
a23 3
#define Module_FullVersion              "1.17"
#define Module_HelpVersion              "1.17 (10 Dec 2016)"
#define Module_LibraryVersionInfo       "1:17"
@


1.118
log
@Revise TouchBook touchpad fix
Detail:
  build/c/usbmouse - Because the touchpad sends data that's consistent with a Boot protocol mouse, the data it sends is shorter than the expected size. This can result in bogus scroll wheel data being read from off the end of the buffer. Fix this by completely ignoring the report descriptor that the device returns and instead using a descriptor that's consistent with a Boot protocol mouse.
  build/Version - Increase USBDriver version number
Admin:
  Tested on TouchBook
  Fixes issue seen where garbage data at the end of the buffer would result in windows scrolling for every mouse interrupt


Version 1.16. Tagged as 'NetBSD-1_16'
@
text
@d1 1
a1 1
/* (1.16)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.16
d9 1
a9 1
#define Module_Date_CMHG                21 Jun 2016
d11 2
a12 2
#define Module_MajorVersion             "1.16"
#define Module_Version                  116
d14 1
a14 1
#define Module_Date                     "21 Jun 2016"
d16 1
a16 1
#define Module_ApplicationDate          "21-Jun-16"
d21 3
a23 3
#define Module_FullVersion              "1.16"
#define Module_HelpVersion              "1.16 (21 Jun 2016)"
#define Module_LibraryVersionInfo       "1:16"
@


1.117
log
@Fix for uninitialised wMaxPacketSize causing enumeration FS failure
The order of the new device enumeration means we have the initial device descriptor (hence bMaxPacketSize) but don't compute wMaxPacketSize until after addressing.
The XHCI HC needs this value by the addressing stage in order to setup the control endpoint context (other HC don't need it until later) so the specific case of a full speed device whose endpoint 0 has a non default max packet size would be set up using the default (of 64), then when the full device descriptor is requested the packet looks like a short transfer and the transaction ends having only collected (eg) 8 bytes. This would then appear as vendor &0000 product &0000 and not get any further.
Tested on Titanium.

Version 1.15. Tagged as 'NetBSD-1_15'
@
text
@d1 1
a1 1
/* (1.15)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.15
d9 1
a9 1
#define Module_Date_CMHG                02 Jun 2016
d11 2
a12 2
#define Module_MajorVersion             "1.15"
#define Module_Version                  115
d14 1
a14 1
#define Module_Date                     "02 Jun 2016"
d16 1
a16 1
#define Module_ApplicationDate          "02-Jun-16"
d21 3
a23 3
#define Module_FullVersion              "1.15"
#define Module_HelpVersion              "1.15 (02 Jun 2016)"
#define Module_LibraryVersionInfo       "1:15"
@


1.116
log
@Use HAL_TimerIRQClear in HAL library
Detail:
  build/c/usbhal - Don't assume HAL_IRQClear will clear the timer interrupt, use HAL_TimerIRQClear as well.
Admin:
  Tested on BB-xM


Version 1.14. Tagged as 'NetBSD-1_14'
@
text
@d1 1
a1 1
/* (1.14)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.14
d9 1
a9 1
#define Module_Date_CMHG                06 May 2016
d11 2
a12 2
#define Module_MajorVersion             "1.14"
#define Module_Version                  114
d14 1
a14 1
#define Module_Date                     "06 May 2016"
d16 1
a16 1
#define Module_ApplicationDate          "06-May-16"
d21 3
a23 3
#define Module_FullVersion              "1.14"
#define Module_HelpVersion              "1.14 (06 May 2016)"
#define Module_LibraryVersionInfo       "1:14"
@


1.115
log
@Fix for too short a memset
Found by pattern matching, this is the same change as DWCDriver-0_27.

Version 1.13. Tagged as 'NetBSD-1_13'
@
text
@d1 1
a1 1
/* (1.13)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.13
d9 1
a9 1
#define Module_Date_CMHG                02 May 2016
d11 2
a12 2
#define Module_MajorVersion             "1.13"
#define Module_Version                  113
d14 1
a14 1
#define Module_Date                     "02 May 2016"
d16 1
a16 1
#define Module_ApplicationDate          "02-May-16"
d21 3
a23 3
#define Module_FullVersion              "1.13"
#define Module_HelpVersion              "1.13 (02 May 2016)"
#define Module_LibraryVersionInfo       "1:13"
@


1.114
log
@Fix tagging mess with the reverted changes - move tag for current version beyond 1_10/1_11


Version 1.12. Tagged as 'NetBSD-1_12'
@
text
@d1 1
a1 1
/* (1.12)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.12
d9 1
a9 1
#define Module_Date_CMHG                26 Mar 2016
d11 2
a12 2
#define Module_MajorVersion             "1.12"
#define Module_Version                  112
d14 1
a14 1
#define Module_Date                     "26 Mar 2016"
d16 1
a16 1
#define Module_ApplicationDate          "26-Mar-16"
d21 3
a23 3
#define Module_FullVersion              "1.12"
#define Module_HelpVersion              "1.12 (26 Mar 2016)"
#define Module_LibraryVersionInfo       "1:12"
@


1.113
log
@Don't pretend to mess with cacheability of pages
Detail:
  build/c/port - Fix vtophys requesting that pages are made uncacheable. They're already uncacheable (all allocated via PCI_RAMAlloc), and once we're done with the pages we never do a 'make cacheable' call to balance it out
  build/Version - Bump version numbers of modules which use vtophys
Admin:
  Untested


Version 1.10. Tagged as 'NetBSD-1_10'
@
text
@d1 1
a1 1
/* (1.10)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.10
d11 2
a12 2
#define Module_MajorVersion             "1.10"
#define Module_Version                  110
d21 3
a23 3
#define Module_FullVersion              "1.10"
#define Module_HelpVersion              "1.10 (26 Mar 2016)"
#define Module_LibraryVersionInfo       "1:10"
@


1.112
log
@Don't build a veneer that points to nothing
The safety struct fillers added in OHCIDriver 0.44 and EHCIDriver 0.30 respectively were being carefully replaced by veneers to nothing. Skip veneer generation is the method isn't implemented.

Version 1.09. Tagged as 'NetBSD-1_09'
@
text
@d1 1
a1 1
/* (1.09)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.09
d9 1
a9 1
#define Module_Date_CMHG                17 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "1.09"
#define Module_Version                  109
d14 1
a14 1
#define Module_Date                     "17 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "17-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "1.09"
#define Module_HelpVersion              "1.09 (17 Nov 2015)"
#define Module_LibraryVersionInfo       "1:9"
@


1.111
log
@Add support for HC with hardware enumerate phase
Detail:
  Support controllers such as the XHCI which perform some steps of enumeration themselves in hardware, thereby needing some steps of the software enumeration to be bypassed.
  usb.c:
    Internally permit addr of 0, to represent the root hub, since the controller is responsible for allocating 1+. Merged from NetBSD 1.144.
  usb_subr.c:
    Test pointers against NULL not 0. Merged from NetBSD 1.191.
    Add 4 new bus methods, for prior to enumeration, address assignment phase, post enumeration fixup, and device removal.
  usbdivar.h:
    Prototypes of 4 new bus methods.
Admin:
  HC API version number bumped.
  Submission from Elesar.

Version 1.08. Tagged as 'NetBSD-1_08'
@
text
@d1 1
a1 1
/* (1.08)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.08
d9 1
a9 1
#define Module_Date_CMHG                15 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "1.08"
#define Module_Version                  108
d14 1
a14 1
#define Module_Date                     "15 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "15-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "1.08"
#define Module_HelpVersion              "1.08 (15 Nov 2015)"
#define Module_LibraryVersionInfo       "1:8"
@


1.110
log
@Resolve porting mistake on initial bus registration
On first registering a new bus in the the NetBSD build of the code usb_kthread_create(usb_create_event_thread, sc) is called which in turn creates the main event thread ("usb_event_thread").
The first thing usb_event_thread() does is set
  sc->sc_bus->needs_explore = 1;
  usb_discover(sc);
however in the RISC OS version of the code (usb.c around line 254) only the first action is performed, no discover happens.
This change schedules a callback via usb_needs_explore_callback() which in turn calls discover_callback() when the OS is next free, which calls usb_discover() for each bus in an equivalent way to NetBSD's event thread. There's then no longer any need for the special one-shot 11s rediscover callback, only the repeating 30s rediscover is needed.

For reference, the places that set needs_explore in this version are all in usb.c
  Line 254: set, but doesn't schedule a callback, as noted above
  Line 339: code not compiled for __riscos
  Line 548: set, does schedule a callback
  Line 727: cleared, in usb_discover()
  Line 743: set, does schedule a callback
  Line 756: code not called in RISC OS

NetBSD uses 500ms initial delay before discover, then 60s between discovers (or until requested by a hub, whichever is sooner).
RISC OS has a periodic callback of 30s (in usbmodule.c) and an initial discover of however long it is from the bus being registered until callbacks next fire usb_event_thread(), assumed ~500ms.

Version 1.07. Tagged as 'NetBSD-1_07'
@
text
@d1 1
a1 1
/* (1.07)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.07
d9 1
a9 1
#define Module_Date_CMHG                12 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "1.07"
#define Module_Version                  107
d14 1
a14 1
#define Module_Date                     "12 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "12-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "1.07"
#define Module_HelpVersion              "1.07 (12 Nov 2015)"
#define Module_LibraryVersionInfo       "1:7"
@


1.109
log
@  Fix HAL breakages caused by HAL_USBPortPower calls
Detail:
  In version 1.05, the USB library which is exported for the use of the HAL
  keyboard scan code unconditionally required the HAL_USBPortPower symbol.
  Not all HALs provide that entry point; for those that didn't, they would
  no longer link. Fixed by use of a bit of magic assembler.
Admin:
  Verified that OMAP3 ROM now builds again.

Version 1.06. Tagged as 'NetBSD-1_06'
@
text
@d1 1
a1 1
/* (1.06)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.06
d9 1
a9 1
#define Module_Date_CMHG                09 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "1.06"
#define Module_Version                  106
d14 1
a14 1
#define Module_Date                     "09 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "09-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "1.06"
#define Module_HelpVersion              "1.06 (09 Nov 2015)"
#define Module_LibraryVersionInfo       "1:6"
@


1.108
log
@Add support for HAL_USBPortPower to EHCI host controller
Detail:
  When signalled as a feature of the HAL device, call HAL_USBPortPower to turn on the port.
Admin:
  Submission from Willi Theiss.

Version 1.05. Tagged as 'NetBSD-1_05'
@
text
@d1 1
a1 1
/* (1.05)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.05
d9 1
a9 1
#define Module_Date_CMHG                04 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "1.05"
#define Module_Version                  105
d14 1
a14 1
#define Module_Date                     "04 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "04-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "1.05"
#define Module_HelpVersion              "1.05 (04 Nov 2015)"
#define Module_LibraryVersionInfo       "1:5"
@


1.107
log
@Internationalisation, help, and syntax improvments
Assign a proper error number and translate "Incompatible USBDriver version".
Don't bother internationalising the *commands which are for debug builds only.
Rephrase the help for USBQuirk so it makes sense, and trim the unmatched '<' from the syntax example.
Bracket the USBDiscover help with the same switch that governs the code, which has been disabled for over a decade.

Version 1.04. Tagged as 'NetBSD-1_04'
@
text
@d1 1
a1 1
/* (1.04)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.04
d9 1
a9 1
#define Module_Date_CMHG                28 Sep 2015
d11 2
a12 2
#define Module_MajorVersion             "1.04"
#define Module_Version                  104
d14 1
a14 1
#define Module_Date                     "28 Sep 2015"
d16 1
a16 1
#define Module_ApplicationDate          "28-Sep-15"
d21 3
a23 3
#define Module_FullVersion              "1.04"
#define Module_HelpVersion              "1.04 (28 Sep 2015)"
#define Module_LibraryVersionInfo       "1:4"
@


1.106
log
@Update table of device quirks
Detail:
  From NetBSD usb_quirks.c revision 1.81.
  usbmodule: NULL is for pointer types, not ints.
  usb_quirks: Group the RISC OS specific ones together, disable the non applicable UQ_APPLE_ISO ones, UQ_LOST_CS_DESC doesn't apply either but is only used for USB modem drivers not ported here. Untangle ifdefs around usbd_find_quirk().
Admin:
  Removed unused source file ums.c

Version 1.03. Tagged as 'NetBSD-1_03'
@
text
@d1 1
a1 1
/* (1.03)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.03
d9 1
a9 1
#define Module_Date_CMHG                17 Sep 2015
d11 2
a12 2
#define Module_MajorVersion             "1.03"
#define Module_Version                  103
d14 1
a14 1
#define Module_Date                     "17 Sep 2015"
d16 1
a16 1
#define Module_ApplicationDate          "17-Sep-15"
d21 3
a23 3
#define Module_FullVersion              "1.03"
#define Module_HelpVersion              "1.03 (17 Sep 2015)"
#define Module_LibraryVersionInfo       "1:3"
@


1.105
log
@  Minor makefile correction to enable o_hal component creation,
  and change to !MkExport to export EHCI and OHCI elements as well
Detail:
Admin:
  tested in iMx6 build


Version 1.02. Tagged as 'NetBSD-1_02'
@
text
@d1 1
a1 1
/* (1.02)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.02
d9 1
a9 1
#define Module_Date_CMHG                24 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "1.02"
#define Module_Version                  102
d14 1
a14 1
#define Module_Date                     "24 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "24-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "1.02"
#define Module_HelpVersion              "1.02 (24 Aug 2015)"
#define Module_LibraryVersionInfo       "1:2"
@


1.104
log
@Allow the endpoint validation string to include a direction flag
However, internally we get that info from the descriptor, so mask it off.
Submission from Colin Granville.

No version number bump, it's already been incremented today.

Version 1.01. Tagged as 'NetBSD-1_01'
@
text
@d1 1
a1 1
/* (1.01)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.01
d9 1
a9 1
#define Module_Date_CMHG                22 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "1.01"
#define Module_Version                  101
d14 1
a14 1
#define Module_Date                     "22 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "22-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "1.01"
#define Module_HelpVersion              "1.01 (22 Aug 2015)"
#define Module_LibraryVersionInfo       "1:1"
@


1.103
log
@Add some missing struct members
From NetBSD dev/usb/usbdivar.h 1.109.
As these extra members change the struct layout, bump the API version number too. Having carefully analysed which headers are actually required by host controllers (in NetBSD-0_98) also be explicit about them in Hdr/USBDriver rather than the former vague comment in h/usbdivar.

Hdr/USBDriver:
  Relocate API define here.
usbmodule.c:
  Include USBDriver.h to get the API define.
usbdivar.h:
  Add struct members from recent NetBSD.

Version 1.00. Tagged as 'NetBSD-1_00'
@
text
@d1 1
a1 1
/* (1.00)
d7 1
a7 1
#define Module_MajorVersion_CMHG        1.00
d11 2
a12 2
#define Module_MajorVersion             "1.00"
#define Module_Version                  100
d21 3
a23 3
#define Module_FullVersion              "1.00"
#define Module_HelpVersion              "1.00 (22 Aug 2015)"
#define Module_LibraryVersionInfo       "1:0"
@


1.102
log
@Fix to interface matching function
Use -1 as the invalid mark, so that an accidental match on interface=0 alternate=0 is no longer possible.
Submission from Colin Granville.

Version 0.99. Tagged as 'NetBSD-0_99'
@
text
@d1 1
a1 1
/* (0.99)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.99
d11 2
a12 2
#define Module_MajorVersion             "0.99"
#define Module_Version                  99
d21 3
a23 3
#define Module_FullVersion              "0.99"
#define Module_HelpVersion              "0.99 (22 Aug 2015)"
#define Module_LibraryVersionInfo       "0:99"
@


1.101
log
@Export USBDriver definitions to normal location
USBDriver was not exporting its SWI (and other) definitions to the export directory like other modules do, meaning the host controller drivers all have to reach into this component to get their hands on it.
Makefile:
  Export an assembler header, conversion to C, and SWI definitions from CMHG.
  Rationalise the dev/usb/h/* headers which are exported in addition to those that are pertinent to host controllers (was missing usbdivar, and was exporting unused usbdi_util).
  Export machine/h/bus too.
  As it's unusual for a CModule to output both a library and module and headers, the EXPDIR has been divided into EXPLIBDIR for those things in C:USB, and EXPDIR for the others.
ehcimodule.c/ohcimodule.c:
  Use the exported USBDriver.h

Version 0.98. Tagged as 'NetBSD-0_98'
@
text
@d1 1
a1 1
/* (0.98)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.98
d9 1
a9 1
#define Module_Date_CMHG                21 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "0.98"
#define Module_Version                  98
d14 1
a14 1
#define Module_Date                     "21 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "21-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "0.98"
#define Module_HelpVersion              "0.98 (21 Aug 2015)"
#define Module_LibraryVersionInfo       "0:98"
@


1.100
log
@Add memory barriers
Detail:
  dev/usb/h/usb_port - Implement usb_syncmem to call the appropriate memory barrier function. Required for when PCI_RAMAlloc starts returning Normal, non-cacheable memory rather than Device (although technically these barriers have always been needed for ARMv6+)
  build/c/port - Memory barrier implementation; uses the appropriate OS routine if available, otherwise uses a null op.
  build/Version - Bump EHCIDriver version number (the only module that uses these barriers so far)
Admin:
  Tested on BB-xM, PandaBoard


Version 0.97. Tagged as 'NetBSD-0_97'
@
text
@d1 1
a1 1
/* (0.97)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.97
d9 1
a9 1
#define Module_Date_CMHG                14 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "0.97"
#define Module_Version                  97
d14 1
a14 1
#define Module_Date                     "14 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "14-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "0.97"
#define Module_HelpVersion              "0.97 (14 Aug 2015)"
#define Module_LibraryVersionInfo       "0:97"
@


1.99
log
@Build fix
Don't set RES_OBJ to an empty string.
Rename merged messages variable to be merged resources dir (even though not used in that manner here).

Version 0.96. Tagged as 'NetBSD-0_96'
@
text
@d1 1
a1 1
/* (0.96)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.96
d9 1
a9 1
#define Module_Date_CMHG                02 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "0.96"
#define Module_Version                  96
d14 1
a14 1
#define Module_Date                     "02 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "02-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "0.96"
#define Module_HelpVersion              "0.96 (02 Aug 2015)"
#define Module_LibraryVersionInfo       "0:96"
@


1.98
log
@Fix to system variable launch & debug build
ohcimodule.c:
 Variable renamed so it builds with debug enabled.
usbmodule.c:
 Tighten up the logic deciding when to launch a USB$<thing> variable, previously it would be launched both for the initial device attach and then again for each interface.
 Remove local <stdlib.h> function prototypes.
 Reindent to 4 spaces to match the rest of the file.
 Fix confusion of ->dv_unit being an int not a pointer.
Submission from Colin Granville. Built, but not tested.

Version 0.95. Tagged as 'NetBSD-0_95'
@
text
@d1 1
a1 1
/* (0.95)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.95
d9 1
a9 1
#define Module_Date_CMHG                04 Jul 2015
d11 2
a12 2
#define Module_MajorVersion             "0.95"
#define Module_Version                  95
d14 1
a14 1
#define Module_Date                     "04 Jul 2015"
d16 1
a16 1
#define Module_ApplicationDate          "04-Jul-15"
d21 3
a23 3
#define Module_FullVersion              "0.95"
#define Module_HelpVersion              "0.95 (04 Jul 2015)"
#define Module_LibraryVersionInfo       "0:95"
@


1.97
log
@Handle absolute pointing devices in a more sensible manner
Detail:
  build/c/usbmouse - For absolute pointing devices, use the PointerV_Report "Abso" call to report absolute positions instead of relative
  build/Version - Bump USBDriver version number
Admin:
  Based on code supplied by Chris Mahoney; allows USB touchscreens such as the Adafruit AR1100 to work under RISC OS
  Tested locally in an Iyonix ROM build (with regular mouse)


Version 0.94. Tagged as 'NetBSD-0_94'
@
text
@d1 1
a1 1
/* (0.94)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.94
d9 1
a9 1
#define Module_Date_CMHG                29 Jun 2015
d11 2
a12 2
#define Module_MajorVersion             "0.94"
#define Module_Version                  94
d14 1
a14 1
#define Module_Date                     "29 Jun 2015"
d16 1
a16 1
#define Module_ApplicationDate          "29-Jun-15"
d21 3
a23 3
#define Module_FullVersion              "0.94"
#define Module_HelpVersion              "0.94 (29 Jun 2015)"
#define Module_LibraryVersionInfo       "0:94"
@


1.96
log
@Deregister IRQ handlers in Service_PreReset
Detail:
  build/c/ehcimodule, build/c/ohcimodule - Deregister IRQ handlers in Service_PreReset. Fixes a hang during reset on OMAP4.
  build/Version - Bump module version numbers for recent changes.
Admin:
  Tested on Pandaboard, Iyonix


Version 0.93. Tagged as 'NetBSD-0_93'
@
text
@d1 1
a1 1
/* (0.93)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.93
d9 1
a9 1
#define Module_Date_CMHG                06 Jan 2015
d11 2
a12 2
#define Module_MajorVersion             "0.93"
#define Module_Version                  93
d14 1
a14 1
#define Module_Date                     "06 Jan 2015"
d16 1
a16 1
#define Module_ApplicationDate          "06-Jan-15"
d21 3
a23 3
#define Module_FullVersion              "0.93"
#define Module_HelpVersion              "0.93 (06 Jan 2015)"
#define Module_LibraryVersionInfo       "0:93"
@


1.95
log
@  Revisit Service_PreReset activity
Detail:
  Recent investigations in stalling of OS_Reset showed that with multiple
  driver modules it was possible for the monotonic timer to be turned off
  before the usb system had shut down. Service_PreReset needs a rapid finite
  response to silence the relevant module's hardware and ensure it cannot
  intiiate something that could stall the reset process.
  As a result USBDriver module no longer issues Service_USB_DriverDying in
  its Service_PreReset response; it merely silences itself and removes itself
  from any vectors. This EHCIDriver and OHCIDriver modules now only need to
  silence themselves when receiving Service_PreReset.
Admin:
  tested in iMx6 and iyonix


Version 0.92. Tagged as 'NetBSD-0_92'
@
text
@d1 1
a1 1
/* (0.92)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.92
d9 1
a9 1
#define Module_Date_CMHG                02 Jan 2015
d11 2
a12 2
#define Module_MajorVersion             "0.92"
#define Module_Version                  92
d14 1
a14 1
#define Module_Date                     "02 Jan 2015"
d16 1
a16 1
#define Module_ApplicationDate          "02-Jan-15"
d21 3
a23 3
#define Module_FullVersion              "0.92"
#define Module_HelpVersion              "0.92 (02 Jan 2015)"
#define Module_LibraryVersionInfo       "0:92"
@


1.94
log
@Use KbdFlags from OSEntries header
Exposed possible return with reserved bit 8 set when enter was pressed.

Version 0.91. Tagged as 'NetBSD-0_91'
@
text
@d1 1
a1 1
/* (0.91)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.91
d9 1
a9 1
#define Module_Date_CMHG                01 Jan 2015
d11 2
a12 2
#define Module_MajorVersion             "0.91"
#define Module_Version                  91
d14 1
a14 1
#define Module_Date                     "01 Jan 2015"
d16 1
a16 1
#define Module_ApplicationDate          "01-Jan-15"
d21 3
a23 3
#define Module_FullVersion              "0.91"
#define Module_HelpVersion              "0.91 (01 Jan 2015)"
#define Module_LibraryVersionInfo       "0:91"
@


1.93
log
@Add some extra SMSC usbdevs
From NetBSD revision 1.687, this adds the 9514 hub featured on the Pandaboard.
Tested on a Pandaboard rev A3, now named in *USBDEVICES.

Version 0.90. Tagged as 'NetBSD-0_90'
@
text
@d1 1
a1 1
/* (0.90)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.90
d9 1
a9 1
#define Module_Date_CMHG                17 Dec 2014
d11 2
a12 2
#define Module_MajorVersion             "0.90"
#define Module_Version                  90
d14 1
a14 1
#define Module_Date                     "17 Dec 2014"
d16 1
a16 1
#define Module_ApplicationDate          "17-Dec-14"
d21 3
a23 3
#define Module_FullVersion              "0.90"
#define Module_HelpVersion              "0.90 (17 Dec 2014)"
#define Module_LibraryVersionInfo       "0:90"
@


1.92
log
@Update to use rationalised power and overcurrent API
OHCIDriver (only) had sketchy support for a HAL based scheme for controlling the port power and monitor overcurrent. However the implementation was limited to supporting the single port required for an embedded product (aka Rhenium in the CVS history). The change makes it follow a model much more akin to the HAL_TimerDevice/HAL_TimerIRQStatus/HAL_TimerIRQClear set of functions.
Version:
  Bumped OHCIDriver and USBDriver version numbers.
ohcimodule.c:
  Use some defines from OsBytes.h.
  Group the debug variables within the OHCI_DEBUG define so they go away in the release case.
  Allow for up to 15 ports to be controlled via the revised HAL API, and pass something other than a hardwired controller of 0 when controlling/monitoring power.
  Enumerate the device numbers for overcurrent monitoring on startup.
  Deal with the possibility of one (or more) of the device numbers being shared interrupts.
  Squash a few trivial compiler warnings.
ohcimodhead.cmhg:
  rename the handler/entry to reflect their use for overcurrent
ohci.c:
  Allow for up to 15 ports to be controlled by passing in the port index where needed.
usb_subr.c/usbdivar.h:
  Remove a RISC OS-ism in datatoggle, to converge with NetBSD a bit.
ehcivar.h/usb_port.h:
  Relocate the overrides for mutex_ functions here since this is the only controller using them. Previously when in "usb_port.h" they would indirectly get dragged in ia the nested include in "usb.h". The could in fact now be implemented using SyncLib, an exercise left to the reader.
usb.h
  Merge some of the device classes and other allocations from NetBSD.

While it's not been possible to test the revised API, due to not having sight of the original platform on which it was implemented, none of the actively maintained HALs currently use the HAL based power and overcurrent scheme anyway, so the new code never gets called. In that respect, it's no more broken then the previous single port-single controller version.

Version 0.89. Tagged as 'NetBSD-0_89'
@
text
@d1 1
a1 1
/* (0.89)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.89
d9 1
a9 1
#define Module_Date_CMHG                25 Oct 2014
d11 2
a12 2
#define Module_MajorVersion             "0.89"
#define Module_Version                  89
d14 1
a14 1
#define Module_Date                     "25 Oct 2014"
d16 1
a16 1
#define Module_ApplicationDate          "25-Oct-14"
d21 3
a23 3
#define Module_FullVersion              "0.89"
#define Module_HelpVersion              "0.89 (25 Oct 2014)"
#define Module_LibraryVersionInfo       "0:89"
@


1.91
log
@Merge in some EHCI fixes from NetBSD. Other minor changes.
Detail:
  build/Version - Bump EHCIDriver version number
  build/c/ehcihal, build/c/ehcimodule, build/c/ohcimodule - Use the HAL USB controller type & flag definitions from Hdr:HALEntries instead of using magic numbers
  build/c/ehcimodule - Avoid double-read of hardware register in debug version of bus_space_read_4(); ensures that we report the value that's actually returned to the driver
  dev/usb/c/ehci - Merge in the following revisions from NetBSD:
  - 1.172, 1.173, 1.178, 1.193 - Support for controllers with embedded transaction translators
  - 1.174 - alloc_sqtd_chain() fix for short packets that end on page boundaries
  - 1.179 - ehci_set_qh_qtd() fixed to terminate alternate next qTD pointer with EHCI_NULL, not 0
  dev/usb/h/ehcireg - Updated to latest NetBSD version (1.34)
  dev/usb/h/ehcivar - Merge in revision 1.38 (ETTF support)
Admin:
  Tested on BB-xM


Version 0.88. Tagged as 'NetBSD-0_88'
@
text
@d1 1
a1 1
/* (0.88)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.88
d9 1
a9 1
#define Module_Date_CMHG                29 Aug 2014
d11 2
a12 2
#define Module_MajorVersion             "0.88"
#define Module_Version                  88
d14 1
a14 1
#define Module_Date                     "29 Aug 2014"
d16 1
a16 1
#define Module_ApplicationDate          "29-Aug-14"
d21 3
a23 3
#define Module_FullVersion              "0.88"
#define Module_HelpVersion              "0.88 (29 Aug 2014)"
#define Module_LibraryVersionInfo       "0:88"
@


1.90
log
@Include device speed in *USBDevInfo output. Corrections to header export.
Detail:
  build/c/usbmodule - Improve *USBDevInfo to display the devices connection speed
  build/h/USBDevFS - Correct device speed listing to match reality
  build/Version - Bump USBDriver version number
Admin:
  Tested on Raspberry Pi


Version 0.87. Tagged as 'NetBSD-0_87'
@
text
@d1 1
a1 1
/* (0.87)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.87
d9 1
a9 1
#define Module_Date_CMHG                12 Aug 2014
d11 2
a12 2
#define Module_MajorVersion             "0.87"
#define Module_Version                  87
d14 1
a14 1
#define Module_Date                     "12 Aug 2014"
d16 1
a16 1
#define Module_ApplicationDate          "12-Aug-14"
d21 3
a23 3
#define Module_FullVersion              "0.87"
#define Module_HelpVersion              "0.87 (12 Aug 2014)"
#define Module_LibraryVersionInfo       "0:87"
@


1.89
log
@Updated to latest usbdevs file from NetBSD
Detail:
  dev/usb/usbdevs - Updated to the latest version from the NetBSD CVS, mainly for several new DisplayLink product IDs. Merged in our TouchBook definitions from rev 1.5, and commented out a couple of duplicate products.
  dev/usb/c/usb_quirks - Updated to cope with MetaGeek vendor being renamed to Misc
  build/Version - Bump USBDriver version number
Admin:
  Tested in OMAP3 ROM build


Version 0.86. Tagged as 'NetBSD-0_86'
@
text
@d1 1
a1 1
/* (0.86)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.86
d9 1
a9 1
#define Module_Date_CMHG                01 Jun 2014
d11 2
a12 2
#define Module_MajorVersion             "0.86"
#define Module_Version                  86
d14 1
a14 1
#define Module_Date                     "01 Jun 2014"
d16 1
a16 1
#define Module_ApplicationDate          "01-Jun-14"
d21 3
a23 3
#define Module_FullVersion              "0.86"
#define Module_HelpVersion              "0.86 (01 Jun 2014)"
#define Module_LibraryVersionInfo       "0:86"
@


1.88
log
@Tidy up exported USBDevFS.h
Detail:
  build/h/USBDevFS - Added extra #ifdef guard to allow USBDevFS.h to be safely included by software that uses the BSD USB headers. Add the DeviceFS_CallDevice codes that USBDriver uses.
  build/h/service - Removed redundant secondary definition of the service call structures which the drivers were using internally
  build/c/ehcihal - Removed redundant #includes
  build/c/ehcidriver, build/c/ohcidriver - Use USBDevFS.h instead of service.h
  build/c/usbmodule - Use USBDevFS.h instead of service.h. Get rid of local DeviceCall definitions and use the ones which are now in USBDevFS.h. Also switched over to using Interface/DevicsFS.h for the main DevicsFS call reason codes, to match the naming convention used by USBDevFS.h (as opposed to the OSLib naming convention that was used previously). Stripped the unused OBSOLETE_SERVICE_CALLS code.
  build/Makefile - Add usbdi_util.h to the header exports
Admin:
  Tested with building OMAP3, Tungsten & BCM2835 ROMs
  Builds to binary-identical modules as previous version.


Version 0.85. Tagged as 'NetBSD-0_85'
@
text
@d1 1
a1 1
/* (0.85)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.85
d11 2
a12 2
#define Module_MajorVersion             "0.85"
#define Module_Version                  85
d21 3
a23 3
#define Module_FullVersion              "0.85"
#define Module_HelpVersion              "0.85 (01 Jun 2014)"
#define Module_LibraryVersionInfo       "0:85"
@


1.87
log
@Fixes to callback implementation used by HAL drivers
Detail:
  build/c/usbhal - Restructured triggercbs() so that it doesn't use irqsema to prevent callbacks triggering recursively, as this behaviour can be required sometimes (e.g. xfer timeout callback for a blocking xfer that's being performed within the bus explore callback).
  Instead, a 'callbacks needed' flag is used to decide whether callbacks should be processed, which operates in a similar way to the kernel's CBack_VectorReq flag - once a triggercbs() instance starts processing callbacks, no other calls will process them until a new callback is inserted.
  Also fixed indexing of the callback array within triggercbs() to correctly deal with wrap-around
  build/Hdr/usbhal, dev/usb/h/usbhal - Add cbs_needed to workspace
Admin:
  Tested on BB-xM with high processor vectors
  Fixes hang during boot time keyboard scan that was seen when certain devices were connected


Version 0.84. Tagged as 'NetBSD-0_84'
@
text
@d1 1
a1 1
/* (0.84)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.84
d9 1
a9 1
#define Module_Date_CMHG                27 May 2014
d11 2
a12 2
#define Module_MajorVersion             "0.84"
#define Module_Version                  84
d14 1
a14 1
#define Module_Date                     "27 May 2014"
d16 1
a16 1
#define Module_ApplicationDate          "27-May-14"
d21 3
a23 3
#define Module_FullVersion              "0.84"
#define Module_HelpVersion              "0.84 (27 May 2014)"
#define Module_LibraryVersionInfo       "0:84"
@


1.86
log
@Missing va_end()'s added

Version 0.83. Tagged as 'NetBSD-0_83'
@
text
@d1 1
a1 1
/* (0.83)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.83
d9 1
a9 1
#define Module_Date_CMHG                06 May 2014
d11 2
a12 2
#define Module_MajorVersion             "0.83"
#define Module_Version                  83
d14 1
a14 1
#define Module_Date                     "06 May 2014"
d16 1
a16 1
#define Module_ApplicationDate          "06-May-14"
d21 3
a23 3
#define Module_FullVersion              "0.83"
#define Module_HelpVersion              "0.83 (06 May 2014)"
#define Module_LibraryVersionInfo       "0:83"
@


1.85
log
@Merge in latest usbd_new_device() changes from NetBSD
Detail:
  dev/usb/c/usb_subr - Merge in latest usbd_new_device() changes from NetBSD (rev 1.196). This primarily changes around the order of the SET_ADDRESS and descriptor get calls, as well as changing the descriptor get to request 64 bytes of data instead of 8.
  build/Version - Bump USBDriver version number
Admin:
  Tested on BB-xM, Raspberry Pi, Iyonix ROM softload
  Fixes issue reported on forums with Raspberry Pi Model A not initialising correctly when connected as a device. Previously it was getting stuck fetching the descriptors after setting the address.
  http://www.riscosopen.org/forum/forums/5/topics/2534


Version 0.82. Tagged as 'NetBSD-0_82'
@
text
@d1 1
a1 1
/* (0.82)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.82
d9 1
a9 1
#define Module_Date_CMHG                26 Apr 2014
d11 2
a12 2
#define Module_MajorVersion             "0.82"
#define Module_Version                  82
d14 1
a14 1
#define Module_Date                     "26 Apr 2014"
d16 1
a16 1
#define Module_ApplicationDate          "26-Apr-14"
d21 3
a23 3
#define Module_FullVersion              "0.82"
#define Module_HelpVersion              "0.82 (26 Apr 2014)"
#define Module_LibraryVersionInfo       "0:82"
@


1.84
log
@Ensure state consistent for restarting a transfer within a callback
Merge of code change from revision 1.152 of usbdi.c from NetBSD, function usb_transfer_complete - this just swaps the ordering around to ensure the callback & done are in the right order.
Built, but not tested.

Version 0.81. Tagged as 'NetBSD-0_81'
@
text
@d1 1
a1 1
/* (0.81)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.81
d9 1
a9 1
#define Module_Date_CMHG                13 Jul 2013
d11 2
a12 2
#define Module_MajorVersion             "0.81"
#define Module_Version                  81
d14 1
a14 1
#define Module_Date                     "13 Jul 2013"
d16 1
a16 1
#define Module_ApplicationDate          "13-Jul-13"
d21 3
a23 3
#define Module_FullVersion              "0.81"
#define Module_HelpVersion              "0.81 (13 Jul 2013)"
#define Module_LibraryVersionInfo       "0:81"
@


1.83
log
@Improvements to interface/alternate matching from partially specified special strings
Previously, if an endpoint was specified the endpoint type would be matched as type BULK even if that wasn't the case for the given endpoint number.
Also, the find_interface_and_endpoint could exit without assigning the alternate.

Line 2001: only search for BULK when neither the type nor endpoint were given
Line 2028: take the first match on any fields that were given, assign all 3 return values
Line 2094: remove some dead code, 'ep' is not read by find_interface_and_endpoint, so no need to initialise it

Test case
  OPENIN "devicefs#endpoint1;size8:USB1"
now gets the actual endpoint_type of the device, rather than BULK all the time.

Changes from Colin, ref http://www.riscosopen.org/forum/forums/3/topics/1895


Version 0.80. Tagged as 'NetBSD-0_80'
@
text
@d1 1
a1 1
/* (0.80)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.80
d9 1
a9 1
#define Module_Date_CMHG                27 May 2013
d11 2
a12 2
#define Module_MajorVersion             "0.80"
#define Module_Version                  80
d14 1
a14 1
#define Module_Date                     "27 May 2013"
d16 1
a16 1
#define Module_ApplicationDate          "27-May-13"
d21 3
a23 3
#define Module_FullVersion              "0.80"
#define Module_HelpVersion              "0.80 (27 May 2013)"
#define Module_LibraryVersionInfo       "0:80"
@


1.82
log
@Fix for out-by-1 error on incoming transfer
No transfer occurred if maxpacketsize exactly equalled the free space in the buffer.
Changes from Colin, ref http://www.riscosopen.org/forum/forums/3/topics/1895
Module version number bumped.

Version 0.79. Tagged as 'NetBSD-0_79'
@
text
@d1 1
a1 1
/* (0.79)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.79
d9 1
a9 1
#define Module_Date_CMHG                25 May 2013
d11 2
a12 2
#define Module_MajorVersion             "0.79"
#define Module_Version                  79
d14 1
a14 1
#define Module_Date                     "25 May 2013"
d16 1
a16 1
#define Module_ApplicationDate          "25-May-13"
d21 3
a23 3
#define Module_FullVersion              "0.79"
#define Module_HelpVersion              "0.79 (25 May 2013)"
#define Module_LibraryVersionInfo       "0:79"
@


1.81
log
@Fix for potential NULL pointer dereference
Spotted by Colin http://www.riscosopen.org/forum/forums/4/topics/1874
Built, but not tested.

Version 0.78. Tagged as 'NetBSD-0_78'
@
text
@d1 1
a1 1
/* (0.78)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.78
d9 1
a9 1
#define Module_Date_CMHG                10 May 2013
d11 2
a12 2
#define Module_MajorVersion             "0.78"
#define Module_Version                  78
d14 1
a14 1
#define Module_Date                     "10 May 2013"
d16 1
a16 1
#define Module_ApplicationDate          "10-May-13"
d21 3
a23 3
#define Module_FullVersion              "0.78"
#define Module_HelpVersion              "0.78 (10 May 2013)"
#define Module_LibraryVersionInfo       "0:78"
@


1.80
log
@Add re-entrancy check to USBDriver registration
Detail:
  build/c/ehcimodule, build/c/ohcimodule - Added a re-entrancy check to USBDriver registration, to avoid shenanigans if we receive "USBDriver has started" service calls while in the middle of registering
  build/Version - Bump EHCIDriver & OHCIDriver versions & dates
Admin:
  Tested on BB-xM
  Doesn't fix any known EHCIDriver/OHCIDriver-related issues, but is the same fix as was made to DWCDriver after the above-mentioned problem was found to be the cause of a hang on boot in recent Pi ROMs


Version 0.77. Tagged as 'NetBSD-0_77'
@
text
@d1 1
a1 1
/* (0.77)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.77
d9 1
a9 1
#define Module_Date_CMHG                30 Mar 2013
d11 2
a12 2
#define Module_MajorVersion             "0.77"
#define Module_Version                  77
d14 1
a14 1
#define Module_Date                     "30 Mar 2013"
d16 1
a16 1
#define Module_ApplicationDate          "30-Mar-13"
d21 3
a23 3
#define Module_FullVersion              "0.77"
#define Module_HelpVersion              "0.77 (30 Mar 2013)"
#define Module_LibraryVersionInfo       "0:77"
@


1.79
log
@Let other keyboard drivers know when the last USB keyboard is disconnected
Detail:
  build/c/usbkboard - detach_keyboard() now issues KeyV_KeyboardRemoved when the last keyboard is removed, to provide a hint to other keyboard drivers (e.g. PandoraKey) that they can reclaim KeyV.
  build/Version - Increased USBDriver version number
Admin:
  Tested on Pandora


Version 0.76. Tagged as 'NetBSD-0_76'
@
text
@d1 1
a1 1
/* (0.76)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.76
d9 1
a9 1
#define Module_Date_CMHG                05 Dec 2012
d11 2
a12 2
#define Module_MajorVersion             "0.76"
#define Module_Version                  76
d14 1
a14 1
#define Module_Date                     "05 Dec 2012"
d16 1
a16 1
#define Module_ApplicationDate          "05-Dec-12"
d21 3
a23 3
#define Module_FullVersion              "0.76"
#define Module_HelpVersion              "0.76 (05 Dec 2012)"
#define Module_LibraryVersionInfo       "0:76"
@


1.78
log
@Fix one read at the filesystem level turning into two transfers at the USB level
Detail:
  build/c/usbmodule - The introduction of the delayed_read flag brought with it a bug, whereby performing one read at the filing system level would result in two transfers at the USB level: One transfer triggered by the RxWakeUp device call, and a second read triggered by the Resume device call once the devices buffer becomes empty.
  To counter this a new read_status variable is used to track the state of the filesystem-level transfer; idle, busy, or complete. Only start_read calls triggered by RxWakeUp are able to start new filesystem-level transfers, while Resume is only able to continue transfers which had been paused due to lack of buffer space.
  Additionally if a RxWakeUp call is received before the previous transfer had finished, the read amount is now buffered correctly, and the read count/padding count will only be reset once the new read actually starts.
  Also made DeviceFS-level debug output more verbose and useful; most read/write debug output now lists the associated usbd_xfer_handle, making it easier to track transfers once they enter the NetBSD layer.
  build/Version - Increase USBDriver version number
Admin:
  Tested on BB-xM
  FTDIDriver now apears to work correctly again


Version 0.75. Tagged as 'NetBSD-0_75'
@
text
@d1 1
a1 1
/* (0.75)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.75
d9 1
a9 1
#define Module_Date_CMHG                19 Sep 2012
d11 2
a12 2
#define Module_MajorVersion             "0.75"
#define Module_Version                  75
d14 1
a14 1
#define Module_Date                     "19 Sep 2012"
d16 1
a16 1
#define Module_ApplicationDate          "19-Sep-12"
d21 3
a23 3
#define Module_FullVersion              "0.75"
#define Module_HelpVersion              "0.75 (19 Sep 2012)"
#define Module_LibraryVersionInfo       "0:75"
@


1.77
log
@Make delayed_read handling more robust
Detail:
  build/c/usbmodule - read_cb() now explicitly clears the delayed_read flag, and only issues a delayed read if the pipe isn't a repeating type
  build/Version - Increased USBDriver version number
Admin:
  Tested on BB-xM


Version 0.74. Tagged as 'NetBSD-0_74'
@
text
@d1 1
a1 1
/* (0.74)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.74
d9 1
a9 1
#define Module_Date_CMHG                13 Jul 2012
d11 2
a12 2
#define Module_MajorVersion             "0.74"
#define Module_Version                  74
d14 1
a14 1
#define Module_Date                     "13 Jul 2012"
d16 1
a16 1
#define Module_ApplicationDate          "13-Jul-12"
d21 3
a23 3
#define Module_FullVersion              "0.74"
#define Module_HelpVersion              "0.74 (13 Jul 2012)"
#define Module_LibraryVersionInfo       "0:74"
@


1.76
log
@Make get_transfer_info() take into account any delayed xfer
Detail:
  build/c/usbmodule - If there's a read xfer which has been delayed due to RxWakeup being called before the previous xfer had finished (e.g. while inside a buffer filling upcall), report the transfer as having not finished yet. Should match the old behaviour before the delayed reads were introduced.
  build/Version - Increment USBDriver version number
Admin:
  Tested briefly on BB-xM


Version 0.73. Tagged as 'NetBSD-0_73'
@
text
@d1 1
a1 1
/* (0.73)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.73
d9 1
a9 1
#define Module_Date_CMHG                09 Jul 2012
d11 2
a12 2
#define Module_MajorVersion             "0.73"
#define Module_Version                  73
d14 1
a14 1
#define Module_Date                     "09 Jul 2012"
d16 1
a16 1
#define Module_ApplicationDate          "09-Jul-12"
d21 3
a23 3
#define Module_FullVersion              "0.73"
#define Module_HelpVersion              "0.73 (09 Jul 2012)"
#define Module_LibraryVersionInfo       "0:73"
@


1.75
log
@Fix null pointer dereferences. Add protection against DeviceFS xfers being multiply inserted into their pipes xfer queue.
Detail:
  build/Version - Increased version numbers
  build/c/ehcimodule, build/c/ohcimodule - Fixed null pointer dereferences in debug code
  build/c/port, build/s/triggercbs - Fix debug code in tsleep() using hardcoded IRQsema ptr. Now requests the right pointer from build/s/triggercbs.
  build/c/usbmodule - Fix null pointer deferences in debug code and MonitorTX/MonitorRX handlers. Add xfer_busy and delayed_read flags to devstream struct in order to track whether the xfer associated with the stream is busy or not. Previously if the TxWakeUp/RxWakeUp device calls were made on a stream which already had an active xfer, the xfer would end up being inserted in the USB pipes xfer queue twice, creating a circular reference, resulting in (at the least) infinite loops in usbd_dump_queue() when debugging is enabled. Now, in the case of reads, a second read will automatically be issued once the first completes, while in the case of writes, the write request will simply be ignored. This isn't a proper fix for all the shortcomings of the DeviceFS interface, but at least the code is now a little bit safer.
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.72. Tagged as 'NetBSD-0_72'
@
text
@d1 1
a1 1
/* (0.72)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.72
d9 1
a9 1
#define Module_Date_CMHG                24 Jun 2012
d11 2
a12 2
#define Module_MajorVersion             "0.72"
#define Module_Version                  72
d14 1
a14 1
#define Module_Date                     "24 Jun 2012"
d16 1
a16 1
#define Module_ApplicationDate          "24-Jun-12"
d21 3
a23 3
#define Module_FullVersion              "0.72"
#define Module_HelpVersion              "0.72 (24 Jun 2012)"
#define Module_LibraryVersionInfo       "0:72"
@


1.74
log
@Make RHENIUM build switch go away. Misc housekeeping
Detail:
  build/Makefile, build/!MkDebug,fd7 - Debug versions of the modules can now be built just by passing "DEBUG=TRUE" to amu
  build/!MkRhenium,fd7 - Deleted obsolete file
  build/Version - Increased version numbers
  build/c/ehcihal, build/c/ehcimodule, build/c/ohcimodule - Only accept USB controllers if HAL_USBControllerInfo says the struct size is an exact match with what we expect. Rework USB controller enumeration to allow modules to properly support both PCI and HAL controllers being available on the same machine, and without RHENIUM switch (module sources only).
  build/c/ehcimodule - Get rid of remaining RHENIUM bits; RHENIUM flag no longer needed for 32bit wide register reads/writes to be supported
  build/c/ohcimodule, build/cmhg/ohcimodhead, dev/usb/c/ohci - Get rid of remaining RHENIUM bits; RHENIUM flag no longer needed for HAL port power controls to be supported.
  build/c/usbhal, build/c/usbmodule, dev/usb/c/uhub, dev/usb/h/usb_port - Get rid of empty riscos_failed_device function
  build/s/call_veneer, build/s/triggercbs - Use Entry/EXIT macros to avoid single-reg LDM/STM performance warnings. Convert tabs to spaces.
  dev/usb/h/usb - Get rid of RHENIUM switch on USB_PORT_RESET_DELAY. Now always uses non-RHENIUM value of 100ms.
Admin:
  Tested on rev A2 BB-xM, Iyonix, Raspberry Pi


Version 0.71. Tagged as 'NetBSD-0_71'
@
text
@d1 1
a1 1
/* (0.71)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.71
d9 1
a9 1
#define Module_Date_CMHG                07 Jun 2012
d11 2
a12 2
#define Module_MajorVersion             "0.71"
#define Module_Version                  71
d14 1
a14 1
#define Module_Date                     "07 Jun 2012"
d16 1
a16 1
#define Module_ApplicationDate          "07-Jun-12"
d21 3
a23 3
#define Module_FullVersion              "0.71"
#define Module_HelpVersion              "0.71 (07 Jun 2012)"
#define Module_LibraryVersionInfo       "0:71"
@


1.73
log
@Added the class specific device descriptors to the exported header file.
Internally they're already in "usb.h" but possibly useful elsewhere.

Version 0.70. Tagged as 'NetBSD-0_70'
@
text
@d1 1
a1 1
/* (0.70)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.70
d9 1
a9 1
#define Module_Date_CMHG                14 May 2012
d11 2
a12 2
#define Module_MajorVersion             "0.70"
#define Module_Version                  70
d14 1
a14 1
#define Module_Date                     "14 May 2012"
d16 1
a16 1
#define Module_ApplicationDate          "14-May-12"
d21 3
a23 3
#define Module_FullVersion              "0.70"
#define Module_HelpVersion              "0.70 (14 May 2012)"
#define Module_LibraryVersionInfo       "0:70"
@


1.72
log
@Use the passed buffer limit rather than 255.
Avoids potential buffer overrun, since the actual buffers are 128 at the moment.

Version 0.69. Tagged as 'NetBSD-0_69'
@
text
@d1 1
a1 1
/* (0.69)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.69
d9 1
a9 1
#define Module_Date_CMHG                20 Feb 2012
d11 2
a12 2
#define Module_MajorVersion             "0.69"
#define Module_Version                  69
d14 1
a14 1
#define Module_Date                     "20 Feb 2012"
d16 1
a16 1
#define Module_ApplicationDate          "20-Feb-12"
d21 3
a23 3
#define Module_FullVersion              "0.69"
#define Module_HelpVersion              "0.69 (20 Feb 2012)"
#define Module_LibraryVersionInfo       "0:69"
@


1.71
log
@Add some more usbdevs from the NetBSD sources.
In particular, the SMSC ethernet controller and hub on the Beagleboard
xm.
Changed pointer assignments & comparisons with 0 to be NULL for clarity.
Implement a left trim function for any printed out strings obtained from
the device (to mirror usbd_trim_spaces) so that when dopey manufacturers
use a space instead of their company name everything lines up still.

Version 0.68. Tagged as 'NetBSD-0_68'
@
text
@d1 1
a1 1
/* (0.68)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.68
d9 1
a9 1
#define Module_Date_CMHG                18 Feb 2012
d11 2
a12 2
#define Module_MajorVersion             "0.68"
#define Module_Version                  68
d14 1
a14 1
#define Module_Date                     "18 Feb 2012"
d16 1
a16 1
#define Module_ApplicationDate          "18-Feb-12"
d21 3
a23 3
#define Module_FullVersion              "0.68"
#define Module_HelpVersion              "0.68 (18 Feb 2012)"
#define Module_LibraryVersionInfo       "0:68"
@


1.70
log
@Small makefile simplification.
Two rules into one.

Version 0.67. Tagged as 'NetBSD-0_67'
@
text
@d1 1
a1 1
/* (0.67)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.67
d9 1
a9 1
#define Module_Date_CMHG                05 Feb 2012
d11 2
a12 2
#define Module_MajorVersion             "0.67"
#define Module_Version                  67
d14 1
a14 1
#define Module_Date                     "05 Feb 2012"
d16 1
a16 1
#define Module_ApplicationDate          "05-Feb-12"
d21 3
a23 3
#define Module_FullVersion              "0.67"
#define Module_HelpVersion              "0.67 (05 Feb 2012)"
#define Module_LibraryVersionInfo       "0:67"
@


1.69
log
@Change to use CModule shared makefile.
Remove some of the proliferation of !Mk[stuff] files due to lack of
relevance.
Combined the OBJ[target] listings into the main makefile with a switch.
Remove a spurious # from the EHCIMessages.

Version 0.66. Tagged as 'NetBSD-0_66'
@
text
@d1 1
a1 1
/* (0.66)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.66
d9 1
a9 1
#define Module_Date_CMHG                04 Feb 2012
d11 2
a12 2
#define Module_MajorVersion             "0.66"
#define Module_Version                  66
d14 1
a14 1
#define Module_Date                     "04 Feb 2012"
d16 1
a16 1
#define Module_ApplicationDate          "04-Feb-12"
d21 3
a23 3
#define Module_FullVersion              "0.66"
#define Module_HelpVersion              "0.66 (04 Feb 2012)"
#define Module_LibraryVersionInfo       "0:66"
@


1.68
log
@Add workaround for what looks like a bug in the DM37x EHCI controller
Detail:
  dev/usb/c/ehci - Force all EHCI data buffers to be 512 byte aligned.
  This is a workaround for what I believe is a bug in the DM37x EHCI controller - It looks like if the last packet of a bulk in transfer is a short packet, and that packet crosses a page boundary, then the second half of the packet doesn't seem to be written out to the correct address in memory.
  Version - increased EHCI module version number
Admin:
  Tested on rev A2 BB-xM
  Fixes issue reported on forums with unreliable USB ethernet:
  http://www.riscosopen.org/forum/fourms/5/topics/828#posts-9691


Version 0.65. Tagged as 'NetBSD-0_65'
@
text
@d1 1
a1 1
/* (0.65)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.65
d9 1
a9 1
#define Module_Date_CMHG                18 Dec 2011
d11 2
a12 2
#define Module_MajorVersion             "0.65"
#define Module_Version                  65
d14 1
a14 1
#define Module_Date                     "18 Dec 2011"
d16 1
a16 1
#define Module_ApplicationDate          "18-Dec-11"
d21 3
a23 3
#define Module_FullVersion              "0.65"
#define Module_HelpVersion              "0.65 (18 Dec 2011)"
#define Module_LibraryVersionInfo       "0:65"
@


1.67
log
@Improve scrollwheel handling
Detail:
  build/c/usbmouse - Scrollwheel code now only sends scroll requests in a given direction if the window has an appropriate scroll bar.
  build/Version - Incremented USBDriver version number
Admin:
  Tested in OMAP3 ROM
  Fixes issue reported on forums where it was possible to scroll filer windows horizontally if you used a mouse with a 'w' axis


Version 0.64. Tagged as 'NetBSD-0_64'
@
text
@d1 1
a1 1
/* (0.64)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.64
d9 1
a9 1
#define Module_Date_CMHG                10 Dec 2011
d11 2
a12 2
#define Module_MajorVersion             "0.64"
#define Module_Version                  64
d14 1
a14 1
#define Module_Date                     "10 Dec 2011"
d16 1
a16 1
#define Module_ApplicationDate          "10-Dec-11"
d21 3
a23 3
#define Module_FullVersion              "0.64"
#define Module_HelpVersion              "0.64 (10 Dec 2011)"
#define Module_LibraryVersionInfo       "0:64"
@


1.66
log
@Fix memory overwrites in root hub emulation
Detail:
  dev/usb/c/ehci, dev/usb/c/ohci - Fixed device descriptor and config descriptor reads writing outside the destination buffer if the buffer was small enough.
  build/Version - Incremented EHCI & OHCI version numbers & dates
Admin:
  Tested in OMAP3 ROM & Iyonix ROM softload


Version 0.63. Tagged as 'NetBSD-0_63'
@
text
@d1 1
a1 1
/* (0.63)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.63
d9 1
a9 1
#define Module_Date_CMHG                04 Dec 2011
d11 2
a12 2
#define Module_MajorVersion             "0.63"
#define Module_Version                  63
d14 1
a14 1
#define Module_Date                     "04 Dec 2011"
d16 1
a16 1
#define Module_ApplicationDate          "04-Dec-11"
d21 3
a23 3
#define Module_FullVersion              "0.63"
#define Module_HelpVersion              "0.63 (04 Dec 2011)"
#define Module_LibraryVersionInfo       "0:63"
@


1.65
log
@Update HAL USB code for new HAL_KbdScanInterrupt behaviour. Fix data aborts during keyboard scanning.
Detail:
  build/c/usbhal, build/h/usbhal - Updated USBHAL_KbdScanInterrupt to behave the same way HAL_KbdScanInterrupt is now expected to behave.
  build/c/ehci, build/c/ohci - Fixed some root hub emulation code which was writing to a global structure before copying it into the destination buffer. Although this works fine in ROM modules it was causing data aborts in the USB HAL libraries due to lack of automatic RW data relocation by the compiler.
  build/Version - Updated version numbers
Admin:
  Tested on rev C2 BB.


Version 0.62. Tagged as 'NetBSD-0_62'
@
text
@d1 1
a1 1
/* (0.62)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.62
d9 1
a9 1
#define Module_Date_CMHG                22 Aug 2011
d11 2
a12 2
#define Module_MajorVersion             "0.62"
#define Module_Version                  62
d14 1
a14 1
#define Module_Date                     "22 Aug 2011"
d16 1
a16 1
#define Module_ApplicationDate          "22-Aug-11"
d21 3
a23 3
#define Module_FullVersion              "0.62"
#define Module_HelpVersion              "0.62 (22 Aug 2011)"
#define Module_LibraryVersionInfo       "0:62"
@


1.64
log
@Fix null pointer access in OHCIDriver
Detail:
  build/c/ohcimodule - Not all PCI_ReadInfo calls were checking for null pointers afterwards, leading to strncpy being called with a null source
  build/Version - Updated OCHIDriver version number
Admin:
  Tested in Iyonix ROM softload


Version 0.61. Tagged as 'NetBSD-0_61'
@
text
@d1 1
a1 1
/* (0.61)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.61
d9 1
a9 1
#define Module_Date_CMHG                08 Aug 2011
d11 2
a12 2
#define Module_MajorVersion             "0.61"
#define Module_Version                  61
d14 1
a14 1
#define Module_Date                     "08 Aug 2011"
d16 1
a16 1
#define Module_ApplicationDate          "08-Aug-11"
d21 3
a23 3
#define Module_FullVersion              "0.61"
#define Module_HelpVersion              "0.61 (08 Aug 2011)"
#define Module_LibraryVersionInfo       "0:61"
@


1.63
log
@Update to work with zero page relocation. Remove ability to cancel transfers by pressing escape
Detail:
  build/c/port - Removed ability to cancel transfers by pressing escape. Too dangerous for things like mass storage devices, and the code won't work anyway for the common case of being in the wimp
  build/s/triggercbs - Try using OS_ReadSysInfo 6 to get IRQsema ptr before falling back on legacy address
  build/Version - Updated version numbers
Admin:
  Tested on rev A2 BB-xM


Version 0.60. Tagged as 'NetBSD-0_60'
@
text
@d1 1
a1 1
/* (0.60)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.60
d9 1
a9 1
#define Module_Date_CMHG                05 Aug 2011
d11 2
a12 2
#define Module_MajorVersion             "0.60"
#define Module_Version                  60
d14 1
a14 1
#define Module_Date                     "05 Aug 2011"
d16 1
a16 1
#define Module_ApplicationDate          "05-Aug-11"
d21 3
a23 3
#define Module_FullVersion              "0.60"
#define Module_HelpVersion              "0.60 (05 Aug 2011)"
#define Module_LibraryVersionInfo       "0:60"
@


1.62
log
@Add the ability to build the USB drivers as HAL-compatible static libraries
Detail:
  build/Makefile, build/OBJEHCIDriver, build/OBJOHCIDriver, build/OBJUSBDriver - Modified makefiles to build the HAL libs during the export libs phase
  build/!MkHAL,fd7 - Handy script for building the HAL libs
  build/Hdr/usbhal - Header containing definitions for the assembler code. Also gets exported so that HALs know how much workspace to reserve.
  build/c/usbhal - HAL version of usbmodule.c & port.c. Also contains the keyboard scan code, adapted from the code in the Tungsten HAL.
  build/s/porthal - Assembler versions of some port.c routines that were easier to do in assembler than C
  build/s/halheap - OS_Heap code that's been adapted for use in the HAL. Could easily be changed into a standalone library instead of being part of the HAL USB libs. Supports memory-efficient allocation of aligned blocks.
  build/c/ehcihal - HAL version of ehcimodule.c. Currently only supports EHCI controllers exposed via HAL_USBControllerInfo (i.e. no PCI support)
  build/c/ehcimodule, build/c/ohcimodule, build/c/port - Moved riscos_irq_clear into port.c. Removed unused microtime() function.
  build/c/usbmouse - Strip out some debug-related code in non-debug builds
  build/Version - Updated version numbers
  dev/usb/c/ehci, dev/usb/h/ehcivar - Adapted to add support for the HAL build. Apart from the base changes, the code has also been tweaked to significantly reduce the amount of memory used at runtime by the HAL version of the driver.
  dev/usb/c/hid, dev/usb/c/uhub, dev/usb/c/usb, dev/usb/c/usb_quirks, dev/usb/c/usb_subr, dev/usb/c/usbdi, dev/usb/c/usbdi_util, dev/usb/c/usbroothub_subr - Changes to support HAL builds. Mainly disabling bits that won't work in the HAL or disabling bits for RISC OS in general if they weren't being used in the first place.
  dev/usb/c/ohci, dev/usb/h/ohcivar - Basic changes to support HAL builds. However HAL OHCI support is still incomplete.
  dev/usb/h/usb_port - Added support for the HAL build. Also tweaked logprintf definition to get rid of logprintf calls entirely in non-debug builds.
  dev/usb/h/usbdivar - Added support for the HAL build.
  dev/usb/h/usbhal - New header used by the HAL build. Gets included by every C file to ensure the compiler doesn't use sb, and contains structs/macros to allow access to the shared workspace.
Admin:
  HAL & non-HAL builds tested on rev C2 BB, rev A2 BB-xM, rev C1 TouchBook.
  Non-HAL builds tested with Iyonix ROM softload.
  Needs latest Kernel source for OSEntries.h export.


Version 0.59. Tagged as 'NetBSD-0_59'
@
text
@d1 1
a1 1
/* (0.59)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.59
d9 1
a9 1
#define Module_Date_CMHG                22 May 2011
d11 2
a12 2
#define Module_MajorVersion             "0.59"
#define Module_Version                  59
d14 1
a14 1
#define Module_Date                     "22 May 2011"
d16 1
a16 1
#define Module_ApplicationDate          "22-May-11"
d21 3
a23 3
#define Module_FullVersion              "0.59"
#define Module_HelpVersion              "0.59 (22 May 2011)"
#define Module_LibraryVersionInfo       "0:59"
@


1.61
log
@  Build fix
Detail:
  A couple of source files now have a dependency on an auto-generated
  header file, dev/usb/usbdevs.h. Normally you get away with this, because
  it's created during the export_hdrs phase. But if the first build you do
  on a freshly checked-out build tree includes a rom phase, then srcbuild
  cleans the component between the export_hdrs and rom phases, so the rom
  phase fails. Fixed by adding a couple of static dependencies to Makefile.
Admin:
  Tested manually.

Version 0.58. Tagged as 'NetBSD-0_58'
@
text
@d1 1
a1 1
/* (0.58)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.58
d9 1
a9 1
#define Module_Date_CMHG                14 Apr 2011
d11 2
a12 2
#define Module_MajorVersion             "0.58"
#define Module_Version                  58
d14 1
a14 1
#define Module_Date                     "14 Apr 2011"
d16 1
a16 1
#define Module_ApplicationDate          "14-Apr-11"
d21 3
a23 3
#define Module_FullVersion              "0.58"
#define Module_HelpVersion              "0.58 (14 Apr 2011)"
#define Module_LibraryVersionInfo       "0:58"
@


1.60
log
@Fix modules so resources don't get included twice in ROM builds
Detail:
  A couple of the USB modules were including their resources both in the Messages module and within themselves, leading to wasted ROM space
  build/OBJOHCIDriver, build/OBJUSBDriver - Tweaked makefiles so that ohcimsgs.o and usbmsgs.o only get built/linked for RAM builds
  build/c/usbmodule - Fix erroneous attempt to free non-registered resource files in ROM builds
  Version - Increased OHCIDriver & USBDriver version numbers
Admin:
  Tested with Iyonix ROM softload. Saves approx 48k of ROM space.
  Fixes bug #265


Version 0.57. Tagged as 'NetBSD-0_57'
@
text
@d1 1
a1 1
/* (0.57)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.57
d9 1
a9 1
#define Module_Date_CMHG                01 Feb 2011
d11 2
a12 2
#define Module_MajorVersion             "0.57"
#define Module_Version                  57
d14 1
a14 1
#define Module_Date                     "01 Feb 2011"
d16 1
a16 1
#define Module_ApplicationDate          "01-Feb-11"
d21 3
a23 3
#define Module_FullVersion              "0.57"
#define Module_HelpVersion              "0.57 (01 Feb 2011)"
#define Module_LibraryVersionInfo       "0:57"
@


1.59
log
@Fix a few USBDriver bugs
Detail:
  build/c/usbdi - Fix compiler warning in usbd_clear_endpoint_stall()
  build/c/usbmodule - Fix detach_device() to deregister any pending attach callback for the detaching device. Fixes crash seen when inserting 16GB USB stick into EHCI port of rev C2 beagleboard (a current surge or something causes the stick to immediately disconnect then reconnect, but the disconnect occurs before the initial attach callback)
  build/c/usbmodule - Fix device_initialise() to use a timeout of 0 if no timeout was specified in the DeviceFS special field
  build/c/usbmodule - Fix the new read_cb() buffer padding logic to only pad up to totalcount instead of filling the entire buffer
Admin:
  Tested on rev C2 beagleboard.
  This seems to fix the problems that were preventing Steffen Huber's USB CD code from working properly.


Version 0.56. Tagged as 'NetBSD-0_56'
@
text
@d1 1
a1 1
/* (0.56)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.56
d9 1
a9 1
#define Module_Date_CMHG                23 Nov 2010
d11 2
a12 2
#define Module_MajorVersion             "0.56"
#define Module_Version                  56
d14 1
a14 1
#define Module_Date                     "23 Nov 2010"
d16 1
a16 1
#define Module_ApplicationDate          "23-Nov-10"
d21 3
a23 3
#define Module_FullVersion              "0.56"
#define Module_HelpVersion              "0.56 (23 Nov 2010)"
#define Module_LibraryVersionInfo       "0:56"
@


1.58
log
@Revert previous commit as it has already been superceded.

Version 0.55. Tagged as 'NetBSD-0_55'
@
text
@d1 1
a1 1
/* (0.55)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.55
d9 1
a9 1
#define Module_Date_CMHG                20 Oct 2010
d11 2
a12 2
#define Module_MajorVersion             "0.55"
#define Module_Version                  55
d14 1
a14 1
#define Module_Date                     "20 Oct 2010"
d16 1
a16 1
#define Module_ApplicationDate          "20-Oct-10"
d21 3
a23 3
#define Module_FullVersion              "0.55"
#define Module_HelpVersion              "0.55 (20 Oct 2010)"
#define Module_LibraryVersionInfo       "0:55"
@


1.57
log
@Minor bugfix and documentation improvements.
Detail:
  I have done some minor changes to the USB documenation in a few points
  and corrected a smaller bug inside the USB alias handling (used release
  instead interface).
Author:
  Thomas Milius

Version 0.54. Tagged as 'NetBSD-0_54'
@
text
@d1 1
a1 1
/* (0.54)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.54
d11 2
a12 2
#define Module_MajorVersion             "0.54"
#define Module_Version                  54
d21 3
a23 3
#define Module_FullVersion              "0.54"
#define Module_HelpVersion              "0.54 (20 Oct 2010)"
#define Module_LibraryVersionInfo       "0:54"
@


1.56
log
@Update hid.c, ums.c to latest (ish), update usbmouse.c, add TouchBook touchpad fix
Detail:
  dev/usb/c/hid, dev/usb/h/hid, dev/usb/c/ums - Updated to latest NetBSD versions (actually the version that was used for the recent core/EHCI update, so not 100% latest)
  build/c/usbmouse, dev/wscons/h/wsmousevar - Updated RISC OS USB mouse driver to be similar to the new NetBSD version. Also reformatted file to use tab char instead of inconsistent numbers of spaces for indentation.
  build/c/usbmouse, dev/usb/usbdevs - Added fix for broken TouchBook touchpad behaviour.
Admin:
  Tested with various mice on a beagleboard, and with the TouchBook touchpad.
  We should now have support for the W axis of mice, but that code is untested since I don't have any suitable mice to hand.


Version 0.53. Tagged as 'NetBSD-0_53'
@
text
@d1 1
a1 1
/* (0.53)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.53
d9 1
a9 1
#define Module_Date_CMHG                14 Sep 2010
d11 2
a12 2
#define Module_MajorVersion             "0.53"
#define Module_Version                  53
d14 1
a14 1
#define Module_Date                     "14 Sep 2010"
d16 1
a16 1
#define Module_ApplicationDate          "14-Sep-10"
d21 3
a23 3
#define Module_FullVersion              "0.53"
#define Module_HelpVersion              "0.53 (14 Sep 2010)"
#define Module_LibraryVersionInfo       "0:53"
@


1.55
log
@Update EHCI driver to NetBSD latest (as of 10/07/2010), improve DeviceFS interface
Detail:
  EHCI driver update:
    dev/usb/c/ehci - Updated to latest NetBSD version, except for revisions 1.134 and 1.135 which are too invasive to merge in without updating the rest of the USB stack. This new version brings lots of bug fixes, and adds (untested on RISC OS) support for EHCI isochronous transfers.
    dev/usb/h/ehcivar - Updated to latest NetBSD version, except for the sc_bus splitting that was held back from the ehci.c update
    dev/usb/h/usb, dev/usb/h/usbdi, dev/usb/usbdivar - partial update to latest as required/possible
    dev/usb/c/usb_quirks, dev/usb/h/ehcireg, dev/usb/h/usb_mem, dev/usb/h/usb_quirks, dev/usb/h/usbhid, dev/usb/usbdevs, dev/usb/devlist2h.awk, dev/wscons/h/wsconsio, dev/wscons/h/wsmousevar - Updated to latest NetBSD versions
    dev/usb/c/usbroothub_subr, dev/usb/h/usbroothub_subr - New files brought in from NetBSD sources for use with new EHCI driver
    build/objehcidriver - Added usbroorhub_subr to EHCI driver
    dev/usb/h/usb_port - Added extra dummy functions as required by new EHCI driver
    dev/build/c/port - Added extra parameter to callout_init as required by new EHCI driver
  DeviceFS improvements:
    build/c/usbmodule - Added DeviceFSCallDevice_GetHandles2 as a replacement for Thomas Milius's backwards-incompatible GetHandles changes. Added DeviceFSCallDevice_GetSetOptions call to control RX padding and TX force-short-xfer features. These features can also be controlled at endpoint creation time by new fields in the filename. Also fixed packet padding to not fill the buffer with garbage or potentially crash when the padded area is more than one packet in length.
  New bus registration API:
    Changes made to the data structures that are shared between the modules means that new checks are needed to ensure USB modules with incompatible APIs are not used with one another.
    build/h/usbdivar - Since this seems to be the file containing the main structures that are shared, it now has a #define at the top indicating the first version of the USBDriver module that implemented the data structures within. This version number is used to check that the driver modules are compatible.
    build/cmhg/usbmodhead, build/h/usbdriver, build/c/usbmodule - Add a new SWI, USBDriver_Version, to return the version number of the USBDriver module. Used for both intra-stack API version checks and can be useful for external code that wants to query DeviceFS feature availability.
    build/c/usbmodule, build/c/ehcimodule, build/c/ohcimodule - Updated USBDriver_RegisterBus SWI and the code that calls it to pass the API version number (as defined in usbdivar.h) to USBDriver when attempting to reigster the bus. USBDriver then ensures the version matches that of itself, and if not refuses to allow the bus to register. EHCI & OHCI modules also check that USBDriver is new enough to implement this behaviour via the USBDriver_Version SWI.
  And finally:
    build/version - Incremented module version numbers.
    build/doc/usb - Updated with details of new features
Admin:
  Tested in ROM softload on Iyonix & beagleboard. Beagleboard hub issues seem to be resolved, and there are no new bugs that I can see.


Version 0.52. Tagged as 'NetBSD-0_52'
@
text
@d1 1
a1 1
/* (0.52)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.52
d9 1
a9 1
#define Module_Date_CMHG                22 Jul 2010
d11 2
a12 2
#define Module_MajorVersion             "0.52"
#define Module_Version                  52
d14 1
a14 1
#define Module_Date                     "22 Jul 2010"
d16 1
a16 1
#define Module_ApplicationDate          "22-Jul-10"
d21 3
a23 3
#define Module_FullVersion              "0.52"
#define Module_HelpVersion              "0.52 (22 Jul 2010)"
#define Module_LibraryVersionInfo       "0:52"
@


1.54
log
@  Support for USB short packages
Detail:
  * DeviceFSCallDevice_TransferInfo and notation of padded bytes
  * Added (updated) documentation
Admin:
  Provided by Thomas Milius

Version 0.51. Tagged as 'NetBSD-0_51'
@
text
@d1 1
a1 1
/* (0.51)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.51
d9 1
a9 1
#define Module_Date_CMHG                19 Apr 2010
d11 2
a12 2
#define Module_MajorVersion             "0.51"
#define Module_Version                  51
d14 1
a14 1
#define Module_Date                     "19 Apr 2010"
d16 1
a16 1
#define Module_ApplicationDate          "19-Apr-10"
d21 3
a23 3
#define Module_FullVersion              "0.51"
#define Module_HelpVersion              "0.51 (19 Apr 2010)"
#define Module_LibraryVersionInfo       "0:51"
@


1.53
log
@Fix USBDriver's handling of PointerV. Increase module version numbers/dates.
Detail:
  build/c/usbmouse - USBDriver's PointerReason_Request handler now correctly restores the IRQ state to that of the caller, instead of unconditionally enabling IRQs. It also correctly intercepts the vector instead of passing it on to other claimants.
  build/Version - This fake VersionNum file hasn't been touched in a long time, leading to some newer versions of the USB modules being released with version numbers identical to their predecessors. This has now been fixed, so that each module has had its version increased by 0.01 and date increased to that of the last (functional) change.
Admin:
  Tested on rev C2 beagleboard


Version 0.50. Tagged as 'NetBSD-0_50'
@
text
@d1 1
a1 1
/* (0.50)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.50
d9 1
a9 1
#define Module_Date_CMHG                28 Feb 2010
d11 2
a12 2
#define Module_MajorVersion             "0.50"
#define Module_Version                  50
d14 1
a14 1
#define Module_Date                     "28 Feb 2010"
d16 1
a16 1
#define Module_ApplicationDate          "28-Feb-10"
d21 3
a23 3
#define Module_FullVersion              "0.50"
#define Module_HelpVersion              "0.50 (28 Feb 2010)"
#define Module_LibraryVersionInfo       "0:50"
@


1.52
log
@Rework USB driver makefile & cmhg files to avoid constant rebuilds of USBDriver.h
Detail:
  Limitations in the way CMHG was being told which message file to use meant that the makefile was constructed in a way that would automatically delete usbmodhead.h/.o after they were built, to protect against OHCIDriver or EHCIDriver causing the file to be built referencing the wrong messages file.
  However since each component uses a unique messages filename, and each component has its own CMHG file, there was absolutely no need for this - all that was needed was to update the CMHG files to reference the correct messages file directly.
  ROM builds are now a minute or two faster because of this, which is quite welcome since I can often find myself doing 30+ builds a day.
Admin:
  Tested by building Tungsten ROM and diffing new modules against old; no differences detected.
  Not tagged.


Version 0.49. Not tagged
@
text
@d1 1
a1 1
/* (0.49)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.49
d9 1
a9 1
#define Module_Date_CMHG                30 Jan 2010
d11 2
a12 2
#define Module_MajorVersion             "0.49"
#define Module_Version                  49
d14 1
a14 1
#define Module_Date                     "30 Jan 2010"
d16 1
a16 1
#define Module_ApplicationDate          "30-Jan-10"
d21 3
a23 3
#define Module_FullVersion              "0.49"
#define Module_HelpVersion              "0.49 (30 Jan 2010)"
#define Module_LibraryVersionInfo       "0:49"
@


1.51
log
@Fix EHCIDriver & OHCIDriver to sync the caches properly when setting up assembler veneers
Detail:
  init_veneer and build_veneer weren't calling OS_SynchroniseCodeAreas to properly sync the I+D caches after writing the assembler veneers to RMA. In some cases this was causing random crashes on boot. This should now be fixed.
Admin:
  Tested on rev C2 beagleboard


Version 0.49. Tagged as 'NetBSD-0_49'
@
text
@d9 1
a9 1
#define Module_Date_CMHG                02 Oct 2009
d14 1
a14 1
#define Module_Date                     "02 Oct 2009"
d16 1
a16 1
#define Module_ApplicationDate          "02-Oct-09"
d22 1
a22 1
#define Module_HelpVersion              "0.49 (02 Oct 2009)"
@


1.50
log
@Add workaround for incorrect sizeof(usb_status_t), disable debug_set_stamp_debug(TRUE) to fix interrupt issue
Detail:
  build/c/ehcimodule, build/c/ohcimodule, build/c/usbmodule - Make sure that timestamped debug messages aren't used, as they appear to cause interrupts to be briefly enabled, which causes all kinds of problems in sensitive bits of the code.
  dev/usb/c/usbdi, dev/usb/c/usbdi_util, dev/usb/h/usb - Because DISABLE_PACKED is being used to compile the USB drivers, sizeof(usb_status_t) was being calculated as 4 bytes instead of 2. Somehow this works fine with the EHCI driver (and presumably the OHCI driver), but it was causing problems with the MUSBDriver, so a hardcoded size of 2 is now used.
Admin:
  Tested on rev C2 beagleboard.


Version 0.48. Tagged as 'NetBSD-0_48'
@
text
@d1 1
a1 1
/* (0.48)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.48
d9 1
a9 1
#define Module_Date_CMHG                06 Sep 2009
d11 2
a12 2
#define Module_MajorVersion             "0.48"
#define Module_Version                  48
d14 1
a14 1
#define Module_Date                     "06 Sep 2009"
d16 1
a16 1
#define Module_ApplicationDate          "06-Sep-09"
d21 3
a23 3
#define Module_FullVersion              "0.48"
#define Module_HelpVersion              "0.48 (06 Sep 2009)"
#define Module_LibraryVersionInfo       "0:48"
@


1.49
log
@  Build fix
Detail:
  The build utility makedevs, compiled at build time, is now built using the
  HostTools shared makefile, and so will execute on any RISC OS build host
  even if the default compiler options are to target an incompatible ARM
  architecture.
Admin:
  Tested using an APCS-R build on an Iyonix.

Version 0.47. Not tagged
@
text
@d1 1
a1 1
/* (0.47)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.47
d9 1
a9 1
#define Module_Date_CMHG                14 Jun 2009
d11 2
a12 2
#define Module_MajorVersion             "0.47"
#define Module_Version                  47
d14 1
a14 1
#define Module_Date                     "14 Jun 2009"
d16 1
a16 1
#define Module_ApplicationDate          "14-Jun-09"
d21 3
a23 3
#define Module_FullVersion              "0.47"
#define Module_HelpVersion              "0.47 (14 Jun 2009)"
#define Module_LibraryVersionInfo       "0:47"
@


1.48
log
@Add support for HAL enumerated USB EHCI controllers, use HAL_IRQClear when clearing EHCI/OHCI controller interrupts
Detail:
  * HAL enumeration of EHCI controllers is performed in the same manner as for OHCI, and protected by #ifdef RHENIUM. HAL_USBControllerInfo must return with the usbinfo type field set to 1 to indicate EHCI.
  * HAL_IRQClear is now called by the EHCI & OHCI modules after clearing the interrupt flag in the USB controller, to allow the HAL to reset the interrupt controller if required (e.g. for OMAP3)
  * EHCI module (for HAL EHCI controllers) now has the option of forcing all EHCI register access to be 32bit size & alignment (requirement is indicated in OMAP3 TRM, although USB did seem to function fine without)
  build/c/ehcimodule - Add enumeration of HAL USB controllers. Add support for forcing all EHCI register access to be 32bit size & alignment. Add riscos_irqclear() implementation. Guard against unexpected behaviour if PCI module isn't present.
  build/c/ohcimodule - Add riscos_irqclear() implementation. Guard against unexpected behaviour if PCI module isn't present.
  dev/usb/c/ehci, dev/usb/c/ohci - call riscos_irqclear() when appropriate
  dev/usb/h/usb_port - riscos_irqclear() prototype
Admin:
  Tested on rev C2 beagleboard. Untested on Iyonix, but should be fine.


Version 0.47. Tagged as 'NetBSD-0_47'
@
text
@d9 1
a9 1
#define Module_Date_CMHG                09 May 2009
d14 1
a14 1
#define Module_Date                     "09 May 2009"
d16 1
a16 1
#define Module_ApplicationDate          "09-May-09"
d22 1
a22 1
#define Module_HelpVersion              "0.47 (09 May 2009)"
@


1.47
log
@	Replaced ep resync mechanism in usb_subr
Detail:
	in recent work endpoint resync mechanism in usb_subr
	was removed to re-align better with current NetBSD
	sources.. however without the mechanism Epson
	scanners fail to do repeat scans/
Admin:	Castle added IP


Version 0.46. Tagged as 'NetBSD-0_46'
@
text
@d1 1
a1 1
/* (0.46)
d4 1
a4 1
 * Last processed by srccommit version: 1.2.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.46
d9 1
a9 1
#define Module_Date_CMHG                22 Feb 2006
d11 2
a12 2
#define Module_MajorVersion             "0.46"
#define Module_Version                  46
d14 1
a14 1
#define Module_Date                     "22 Feb 2006"
d16 1
a16 1
#define Module_ApplicationDate          "22-Feb-06"
d19 1
a19 1
#define Module_ComponentPath            "RiscOS/Sources/HWSupport/USB/NetBSD"
d21 3
a23 3
#define Module_FullVersion              "0.46"
#define Module_HelpVersion              "0.46 (22 Feb 2006)"
#define Module_LibraryVersionInfo       "0:46"
@


1.46
log
@	re-merged some items missed by Dan, and corrected usbmodule for
	1 item missed earlier.. interrupt out endpoints noe demonstrated
	working
Detail:
Admin:  jb  Castle added IP


Version 0.45. Tagged as 'NetBSD-0_45'
@
text
@d1 1
a1 1
/* (0.45)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.45
d9 1
a9 1
#define Module_Date_CMHG                05 Jan 2006
d11 2
a12 2
#define Module_MajorVersion             "0.45"
#define Module_Version                  45
d14 1
a14 1
#define Module_Date                     "05 Jan 2006"
d16 1
a16 1
#define Module_ApplicationDate          "05-Jan-06"
d21 3
a23 3
#define Module_FullVersion              "0.45"
#define Module_HelpVersion              "0.45 (05 Jan 2006)"
#define Module_LibraryVersionInfo       "0:45"
@


1.45
log
@	updated release version numbers for OHCIDriver and USBDriver
	modules to reflect work done on USB Interrupt Out
Detail:
Admin:


Version 0.44. Tagged as 'NetBSD-0_44'
@
text
@d1 1
a1 1
/* (0.44)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.44
d9 1
a9 1
#define Module_Date_CMHG                31 Dec 2005
d11 2
a12 2
#define Module_MajorVersion             "0.44"
#define Module_Version                  44
d14 1
a14 1
#define Module_Date                     "31 Dec 2005"
d16 1
a16 1
#define Module_ApplicationDate          "31-Dec-05"
d21 3
a23 3
#define Module_FullVersion              "0.44"
#define Module_HelpVersion              "0.44 (31 Dec 2005)"
#define Module_LibraryVersionInfo       "0:44"
@


1.44
log
@  Now handles interrupt out transfers

Detail:
  There were many places where this was broken: the devicefs
interface was always starting off a read regardless of
whether it was an IN or OUT transfer, usbdi.c was setting
OUT interrupt transfers as repeating, which doesn't make sense,
and ohci.c was always making interrupt transfers OUT (this is
fixed in the latest BSD sources). Also the code which
unhalts endpoints at start of day has been removed, as this is
no longer in the BSD sources having been removed after it was
seend to have caused problems.

Admin:
  Tested with a CATC analyzer on an AverMedia FM radio. If now
operates properly with the code from Dave Higton.

Version 0.43. Tagged as 'NetBSD-0_43'
@
text
@d1 1
a1 1
/* (0.43)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.43
d9 1
a9 1
#define Module_Date_CMHG                30 Dec 2005
d11 2
a12 2
#define Module_MajorVersion             "0.43"
#define Module_Version                  43
d14 1
a14 1
#define Module_Date                     "30 Dec 2005"
d16 1
a16 1
#define Module_ApplicationDate          "30-Dec-05"
d21 3
a23 3
#define Module_FullVersion              "0.43"
#define Module_HelpVersion              "0.43 (30 Dec 2005)"
#define Module_LibraryVersionInfo       "0:43"
@


1.43
log
@	Added USB$Ignore_VVVV_PPPP variable.. if it exists
	then the internal hub/kbd/mouse checks are not done.
	it is left ONLY to external programs
Detail:
Admin:


Version 0.42. Tagged as 'NetBSD-0_42'
@
text
@d1 1
a1 1
/* (0.42)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.42
d9 1
a9 1
#define Module_Date_CMHG                05 Dec 2005
d11 2
a12 2
#define Module_MajorVersion             "0.42"
#define Module_Version                  42
d14 1
a14 1
#define Module_Date                     "05 Dec 2005"
d16 1
a16 1
#define Module_ApplicationDate          "05-Dec-05"
d21 3
a23 3
#define Module_FullVersion              "0.42"
#define Module_HelpVersion              "0.42 (05 Dec 2005)"
#define Module_LibraryVersionInfo       "0:42"
@


1.42
log
@	Fixed abort seen with some KVMs and ps2 adaptors in relation
	to !HID
Detail:
	Devices with HID kbd and mouse in separate interfaces were
	not being correctly 'forgotten' when the device was claimed
	by a 3rd party App (!HID). This was because a re-entrancy issue
	led to the second claimed i/f being removed before the first
	was fully removed.
	This led to a muddle in the dev->subdevs array. Solution was to
	unlink it from the subdevs array before 'detaching' it,
	instead of after.
Admin:
	Castle added IP. Tested at Castle. Will be initially released via
	the beta test site.


Version 0.41. Tagged as 'NetBSD-0_41'
@
text
@d1 1
a1 1
/* (0.41)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.41
d9 1
a9 1
#define Module_Date_CMHG                05 Jun 2005
d11 2
a12 2
#define Module_MajorVersion             "0.41"
#define Module_Version                  41
d14 1
a14 1
#define Module_Date                     "05 Jun 2005"
d16 1
a16 1
#define Module_ApplicationDate          "05-Jun-05"
d21 3
a23 3
#define Module_FullVersion              "0.41"
#define Module_HelpVersion              "0.41 (05 Jun 2005)"
#define Module_LibraryVersionInfo       "0:41"
@


1.41
log
@	several changes and nullpointer bug fixes
Detail:
	Includes several bug fixes and null pointer traps.
	Rhenium version reviewed and reset should be improved.
Admin:
	Tested in rhenium desktop build and iyonix build at castle
   	Castle added IP


Version 0.40. Tagged as 'NetBSD-0_40'
@
text
@d1 1
a1 1
/* (0.40)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.40
d9 1
a9 1
#define Module_Date_CMHG                18 May 2005
d11 2
a12 2
#define Module_MajorVersion             "0.40"
#define Module_Version                  40
d14 1
a14 1
#define Module_Date                     "18 May 2005"
d16 1
a16 1
#define Module_ApplicationDate          "18-May-05"
d21 3
a23 3
#define Module_FullVersion              "0.40"
#define Module_HelpVersion              "0.40 (18 May 2005)"
#define Module_LibraryVersionInfo       "0:40"
@


1.40
log
@	Update of NetBSD elements (except c.ohci) to track NetBSD current
	from mid April 2005.
	Inclusion of Mods to c.ehci (from Dan) to correctly handle low
	speed interrupt devices beyond USB2 hubs (i.e. keyboards and mice).
	Mod to EHCI resetting in service call handler to better cope with
	USBDriver being restarted 'underneath' it.
Detail:
Admin:
	Castle, Dan Ellis, NetBSD added IP. Tested at Castle. Will be
	beta tested at this revision level before full release.


Version 0.39. Tagged as 'NetBSD-0_39'
@
text
@d1 1
a1 1
/* (0.39)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.39
d9 1
a9 1
#define Module_Date_CMHG                25 Apr 2005
d11 2
a12 2
#define Module_MajorVersion             "0.39"
#define Module_Version                  39
d14 1
a14 1
#define Module_Date                     "25 Apr 2005"
d16 1
a16 1
#define Module_ApplicationDate          "25-Apr-05"
d21 3
a23 3
#define Module_FullVersion              "0.39"
#define Module_HelpVersion              "0.39 (25 Apr 2005)"
#define Module_LibraryVersionInfo       "0:39"
@


1.39
log
@         small change at start of pipe open process to accomodate
         error return provided by some mass storage devices.
Detail:
Admin:   tested at castle.. castle added ip


Version 0.38. Tagged as 'NetBSD-0_38'
@
text
@d1 1
a1 1
/* (0.38)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.38
d9 1
a9 1
#define Module_Date_CMHG                05 Mar 2005
d11 2
a12 2
#define Module_MajorVersion             "0.38"
#define Module_Version                  38
d14 1
a14 1
#define Module_Date                     "05 Mar 2005"
d16 1
a16 1
#define Module_ApplicationDate          "05-Mar-05"
d21 3
a23 3
#define Module_FullVersion              "0.38"
#define Module_HelpVersion              "0.38 (05 Mar 2005)"
#define Module_LibraryVersionInfo       "0:38"
@


1.38
log
@        2 specific changes to USBDriver module
        Added (and fixed code underlying) to give periodic
        explore of USB busses (cf NetBSD).
        Added USBDisover command to let user provoke this too.
        Reworked USB device number allocation to roll
        around at 999 to avoid field overflow in
        a number of places.
Detail:
Admin:  castle added IP. to be beta tested on beta test site


Version 0.37. Tagged as 'NetBSD-0_37'
@
text
@d1 1
a1 1
/* (0.37)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.37
d9 1
a9 1
#define Module_Date_CMHG                24 Feb 2005
d11 2
a12 2
#define Module_MajorVersion             "0.37"
#define Module_Version                  37
d14 1
a14 1
#define Module_Date                     "24 Feb 2005"
d16 1
a16 1
#define Module_ApplicationDate          "24-Feb-05"
d21 3
a23 3
#define Module_FullVersion              "0.37"
#define Module_HelpVersion              "0.37 (24 Feb 2005)"
#define Module_LibraryVersionInfo       "0:37"
@


1.37
log
@        An increased delay caused havoc with chicony keyboards in the field
Detail:
        USB_PORT_RESET_DELAY had been increased from 100 to 200ms in previous
        version. This was OK for most devices, and beneficial for some, BUT
        killed the Chicony keyboards shipped with many iyonix.. Delay has
        been reverted to 100ms, and is now run time alterable via the
        USB$PortResetDelay sysvar. This problem did not show up in beta testing!

Admin:  tested by JB with chicony.. delays up to around 160ms work with
        the chicony.
        Castle added IP

Version 0.36. Tagged as 'NetBSD-0_36'
@
text
@d1 1
a1 1
/* (0.36)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.36
d9 1
a9 1
#define Module_Date_CMHG                22 Feb 2005
d11 2
a12 2
#define Module_MajorVersion             "0.36"
#define Module_Version                  36
d14 1
a14 1
#define Module_Date                     "22 Feb 2005"
d16 1
a16 1
#define Module_ApplicationDate          "22-Feb-05"
d21 3
a23 3
#define Module_FullVersion              "0.36"
#define Module_HelpVersion              "0.36 (22 Feb 2005)"
#define Module_LibraryVersionInfo       "0:36"
@


1.36
log
@         changes and bug fixes that came to light following USB2 launch.
Detail:
         - VarVal launching.. string length was incorrectly calculated.
         - USB VarVals now correctly cleared if device failed during
           enumeration, after first SetVarVal call.
         - Triggercbs() modified to check interrupt context and be
           refuse (quietly) to trigger callbacks if interrupts threaded
           (result of possible issue .. but perhaps wise)
         - Added third QueryDelay variable, and an Info file to describe
           what does what.
Admin:
         checked at Castle.. due for extended check via beta test site
         before formal release.

         Castle + D Ellis added IP


Version 0.35. Tagged as 'NetBSD-0_35'
@
text
@d1 1
a1 1
/* (0.35)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.35
d9 1
a9 1
#define Module_Date_CMHG                18 Feb 2005
d11 2
a12 2
#define Module_MajorVersion             "0.35"
#define Module_Version                  35
d14 1
a14 1
#define Module_Date                     "18 Feb 2005"
d16 1
a16 1
#define Module_ApplicationDate          "18-Feb-05"
d21 3
a23 3
#define Module_FullVersion              "0.35"
#define Module_HelpVersion              "0.35 (18 Feb 2005)"
#define Module_LibraryVersionInfo       "0:35"
@


1.35
log
@Summary:  Minor tweaks to USBDriver and EHCI prior to USB2 release
          resulting from beta testing
Detail:
Admin:    castle and d ellis added IP beyond that in NetBSD sources


Version 0.34. Tagged as 'NetBSD-0_34'
@
text
@d1 1
a1 1
/* (0.34)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.34
d9 1
a9 1
#define Module_Date_CMHG                31 Jan 2005
d11 2
a12 2
#define Module_MajorVersion             "0.34"
#define Module_Version                  34
d14 1
a14 1
#define Module_Date                     "31 Jan 2005"
d16 1
a16 1
#define Module_ApplicationDate          "31-Jan-05"
d21 3
a23 3
#define Module_FullVersion              "0.34"
#define Module_HelpVersion              "0.34 (31 Jan 2005)"
#define Module_LibraryVersionInfo       "0:34"
@


1.34
log
@        Stack brought up to date with NetBSD sources as at 20050121.
        USB2 further debugged.
Detail:
        Check in prior to second beta release. Improvements also to
        softloading of replacement modules.
Admin:
        Checked with JB .. further crosschecking is still needed for rhenium.
        Castle/D Ellis added ip from NetBSD sources


Version 0.33. Tagged as 'NetBSD-0_33'
@
text
@d1 1
a1 1
/* (0.33)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.33
d9 1
a9 1
#define Module_Date_CMHG                21 Jan 2005
d11 2
a12 2
#define Module_MajorVersion             "0.33"
#define Module_Version                  33
d14 1
a14 1
#define Module_Date                     "21 Jan 2005"
d16 1
a16 1
#define Module_ApplicationDate          "21-Jan-05"
d21 3
a23 3
#define Module_FullVersion              "0.33"
#define Module_HelpVersion              "0.33 (21 Jan 2005)"
#define Module_LibraryVersionInfo       "0:33"
@


1.33
log
@       improved module startup sequence independance, and added
       service-prereset to
       the ehcimodule. modules in beta test in field
Detail:
Admin:
       castle added ip.  still to be tested on rhenium


Version 0.32. Tagged as 'NetBSD-0_32'
@
text
@d1 1
a1 1
/* (0.32)
d4 1
a4 1
 * Last processed by srccommit version: 1.68.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.32
d9 1
a9 1
#define Module_Date_CMHG                03 Jan 2005
d11 2
a12 2
#define Module_MajorVersion             "0.32"
#define Module_Version                  32
d14 1
a14 1
#define Module_Date                     "03 Jan 2005"
d16 1
a16 1
#define Module_ApplicationDate          "03-Jan-05"
d21 3
a23 3
#define Module_FullVersion              "0.32"
#define Module_HelpVersion              "0.32 (03 Jan 2005)"
#define Module_LibraryVersionInfo       "0:32"
@


1.32
log
@        Update of EHCIDriver to current NetBSD, together with needed changes
        in both OHCIDriver and USBDriver.


Detail:
        Code may change before formal release .. will be beta released
        ... Entered to CVS to get new version numbers, and for
        the record.
Admin:
        Castle/netbsd added IP .. will be tested more fully before
        formal release. Still to be verified on Rhenium.


Version 0.31. Tagged as 'NetBSD-0_31'
@
text
@d1 1
a1 1
/* (0.31)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.31
d9 1
a9 1
#define Module_Date_CMHG                30 Dec 2004
d11 2
a12 2
#define Module_MajorVersion             "0.31"
#define Module_Version                  31
d14 1
a14 1
#define Module_Date                     "30 Dec 2004"
d16 1
a16 1
#define Module_ApplicationDate          "30-Dec-04"
d21 3
a23 3
#define Module_FullVersion              "0.31"
#define Module_HelpVersion              "0.31 (30 Dec 2004)"
#define Module_LibraryVersionInfo       "0:31"
@


1.31
log
@       change to OHCIModule to pay heed to number of OHCI i/f reported
       by HAL (in Rhenium).. various other small adjustments to improve
       softloadability, both in OHCI and EHCI drivers.
Detail:
Admin:
    tested on iyonix and on rhenium
    castle added IP


Version 0.30. Tagged as 'NetBSD-0_30'
@
text
@d1 1
a1 1
/* (0.30)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.30
d9 1
a9 1
#define Module_Date_CMHG                25 Nov 2004
d11 2
a12 2
#define Module_MajorVersion             "0.30"
#define Module_Version                  30
d14 1
a14 1
#define Module_Date                     "25 Nov 2004"
d16 1
a16 1
#define Module_ApplicationDate          "25-Nov-04"
d21 3
a23 3
#define Module_FullVersion              "0.30"
#define Module_HelpVersion              "0.30 (25 Nov 2004)"
#define Module_LibraryVersionInfo       "0:30"
@


1.30
log
@Added 5 extra keycodes for Japanese keyboards to usbkboard.c

Version 0.29. Tagged as 'NetBSD-0_29'
@
text
@d1 1
a1 1
/* (0.29)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.29
d9 1
a9 1
#define Module_Date_CMHG                12 Nov 2004
d11 2
a12 2
#define Module_MajorVersion             "0.29"
#define Module_Version                  29
d14 1
a14 1
#define Module_Date                     "12 Nov 2004"
d16 1
a16 1
#define Module_ApplicationDate          "12-Nov-04"
d21 3
a23 3
#define Module_FullVersion              "0.29"
#define Module_HelpVersion              "0.29 (12 Nov 2004)"
#define Module_LibraryVersionInfo       "0:29"
@


1.29
log
@  Extensive changes and bug fixes to usb and ohci ..
  'blocked' several holes that could cause freezes with awkward
  usb devices.  Added latest changes from Dan Ellis too , especially for USB2
Detail:
 many
Admin:
 Tested in ROM at Castle, and beta tested with users


Version 0.28. Tagged as 'NetBSD-0_28'
@
text
@d1 1
a1 1
/* (0.28)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.28
d9 1
a9 1
#define Module_Date_CMHG                12 Aug 2004
d11 2
a12 2
#define Module_MajorVersion             "0.28"
#define Module_Version                  28
d14 1
a14 1
#define Module_Date                     "12 Aug 2004"
d16 1
a16 1
#define Module_ApplicationDate          "12-Aug-04"
d21 3
a23 3
#define Module_FullVersion              "0.28"
#define Module_HelpVersion              "0.28 (12 Aug 2004)"
#define Module_LibraryVersionInfo       "0:28"
@


1.28
log
@More John fixes.

Version 0.27. Tagged as 'NetBSD-0_27'
@
text
@d1 1
a1 1
/* (0.27)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.27
d9 1
a9 1
#define Module_Date_CMHG                01 Jul 2004
d11 2
a12 2
#define Module_MajorVersion             "0.27"
#define Module_Version                  27
d14 1
a14 1
#define Module_Date                     "01 Jul 2004"
d16 1
a16 1
#define Module_ApplicationDate          "01-Jul-04"
d21 3
a23 3
#define Module_FullVersion              "0.27"
#define Module_HelpVersion              "0.27 (01 Jul 2004)"
#define Module_LibraryVersionInfo       "0:27"
@


1.27
log
@Latest stuff from John - mainly Rhenium improvements.

Version 0.26. Tagged as 'NetBSD-0_26'
@
text
@d1 1
a1 1
/* (0.26)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.26
d9 1
a9 1
#define Module_Date_CMHG                30 Jun 2004
d11 2
a12 2
#define Module_MajorVersion             "0.26"
#define Module_Version                  26
d14 1
a14 1
#define Module_Date                     "30 Jun 2004"
d16 1
a16 1
#define Module_ApplicationDate          "30-Jun-04"
d21 3
a23 3
#define Module_FullVersion              "0.26"
#define Module_HelpVersion              "0.26 (30 Jun 2004)"
#define Module_LibraryVersionInfo       "0:26"
@


1.26
log
@  New versions from John.
Detail:
  * All modules will now rmkill/rmload more reliably
  * Keyboard driver disables kernel debounce on new enough kernels, needed
    for many PS2-USB adaptors, bar code scanners etc
  * Mouse driver will scroll wheel scroll any windows that do respond to
    scroll events, otherwise it issues PointerReason_WheelChange (9) to an
    external WimpScroll module
  * Several bugs and an interrupt hole resolved
Admin:
  Tested at Framlingham.

Version 0.25. Tagged as 'NetBSD-0_25'
@
text
@d1 1
a1 1
/* (0.25)
d4 1
a4 1
 * Last processed by srccommit version: 1.2.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.25
d9 1
a9 1
#define Module_Date_CMHG                06 May 2004
d11 2
a12 2
#define Module_MajorVersion             "0.25"
#define Module_Version                  25
d14 1
a14 1
#define Module_Date                     "06 May 2004"
d16 1
a16 1
#define Module_ApplicationDate          "06-May-04"
d21 3
a23 3
#define Module_FullVersion              "0.25"
#define Module_HelpVersion              "0.25 (06 May 2004)"
#define Module_LibraryVersionInfo       "0:25"
@


1.25
log
@Selects per-port power control for all ports before starting BSD code.
Fix suggested by Dan Ellis.

Version 0.24. Tagged as 'NetBSD-0_24'
@
text
@d1 1
a1 1
/* (0.24)
d4 1
a4 1
 * Last processed by srccommit version: 1.68.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.24
d9 1
a9 1
#define Module_Date_CMHG                22 Mar 2004
d11 2
a12 2
#define Module_MajorVersion             "0.24"
#define Module_Version                  24
d14 1
a14 1
#define Module_Date                     "22 Mar 2004"
d16 1
a16 1
#define Module_ApplicationDate          "22-Mar-04"
d21 3
a23 3
#define Module_FullVersion              "0.24"
#define Module_HelpVersion              "0.24 (22 Mar 2004)"
#define Module_LibraryVersionInfo       "0:24"
@


1.24
log
@Fixes from John Ballance:

Version 0.23. Tagged as 'NetBSD-0_23'
@
text
@d1 1
a1 1
/* (0.23)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.23
d9 1
a9 1
#define Module_Date_CMHG                16 Feb 2004
d11 2
a12 2
#define Module_MajorVersion             "0.23"
#define Module_Version                  23
d14 1
a14 1
#define Module_Date                     "16 Feb 2004"
d16 1
a16 1
#define Module_ApplicationDate          "16-Feb-04"
d21 3
a23 3
#define Module_FullVersion              "0.23"
#define Module_HelpVersion              "0.23 (16 Feb 2004)"
#define Module_LibraryVersionInfo       "0:23"
@


1.23
log
@Merge of Dan Ellis's USB2 sources.

Version 0.22. Tagged as 'NetBSD-0_22'
@
text
@d1 1
a1 1
/* (0.22)
d4 1
a4 1
 * Last processed by srccommit version: 1.2.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.22
d9 1
a9 1
#define Module_Date_CMHG                21 Jan 2004
d11 2
a12 2
#define Module_MajorVersion             "0.22"
#define Module_Version                  22
d14 1
a14 1
#define Module_Date                     "21 Jan 2004"
d16 1
a16 1
#define Module_ApplicationDate          "21-Jan-04"
d21 3
a23 3
#define Module_FullVersion              "0.22"
#define Module_HelpVersion              "0.22 (21 Jan 2004)"
#define Module_LibraryVersionInfo       "0:22"
@


1.22
log
@  Changes to work with TCPIPLibs 5.47.
Detail:
  NetBSD/FreeBSD differences in the naming of certain macros are now resolved
  in TCPIPLibs instead of locally. Also some reordering in the !Mk files in
  order to work with current versions of Zap.
Admin:
  Builds against TCPIPLibs 5.47. Note that this version of the USB sources
  also now requires TCPIPLibs 5.47.

Version 0.21. Tagged as 'NetBSD-0_21'
@
text
@d1 1
a1 1
/* (0.21)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.21
d11 2
a12 2
#define Module_MajorVersion             "0.21"
#define Module_Version                  21
d21 3
a23 3
#define Module_FullVersion              "0.21"
#define Module_HelpVersion              "0.21 (21 Jan 2004)"
#define Module_LibraryVersionInfo       "0:21"
@


1.22.2.1
log
@Added support for HAL USB devices.
Attempted interrupt hole fix.

Version 0.21, 1.22.2.1. Tagged as 'NetBSD-0_21-1_22_2_1'
@
text
@d4 1
a4 1
 * Last processed by srccommit version: 1.68.
d8 2
a9 2
#define Module_MinorVersion_CMHG        1.22.2.1
#define Module_Date_CMHG                16 Feb 2004
d13 2
a14 2
#define Module_MinorVersion             "1.22.2.1"
#define Module_Date                     "16 Feb 2004"
d16 1
a16 1
#define Module_ApplicationDate          "16-Feb-04"
d21 2
a22 2
#define Module_FullVersion              "0.21 (1.22.2.1)"
#define Module_HelpVersion              "0.21 (16 Feb 2004) 1.22.2.1"
@


1.21
log
@Update from John:
> Reduce root port reset delay to 50ms from 250ms to work with Chicony
> keyboards (again).  Comment out duplicate free(udev) at end of
> usbmodule:config_detach.

Version 0.20. Tagged as 'NetBSD-0_20'
@
text
@d1 1
a1 1
/* (0.20)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.20
d9 1
a9 1
#define Module_Date_CMHG                07 Jan 2004
d11 2
a12 2
#define Module_MajorVersion             "0.20"
#define Module_Version                  20
d14 1
a14 1
#define Module_Date                     "07 Jan 2004"
d16 1
a16 1
#define Module_ApplicationDate          "07-Jan-04"
d21 3
a23 3
#define Module_FullVersion              "0.20"
#define Module_HelpVersion              "0.20 (07 Jan 2004)"
#define Module_LibraryVersionInfo       "0:20"
@


1.20
log
@Updated the vendor/device headers and table

Version 0.19. Tagged as 'NetBSD-0_19'
@
text
@d1 1
a1 1
/* (0.19)
d4 1
a4 1
 * Last processed by srccommit version: 1.68.
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.19
d9 1
a9 1
#define Module_Date_CMHG                16 Jun 2003
d11 2
a12 2
#define Module_MajorVersion             "0.19"
#define Module_Version                  19
d14 1
a14 1
#define Module_Date                     "16 Jun 2003"
d16 1
a16 1
#define Module_ApplicationDate          "16-Jun-03"
d21 3
a23 3
#define Module_FullVersion              "0.19"
#define Module_HelpVersion              "0.19 (16 Jun 2003)"
#define Module_LibraryVersionInfo       "0:19"
@


1.19
log
@USB transfer failed reason strings in the messages files were incorrectly
being tokenised. Also added a couple of bits of debug.

Version 0.18. Tagged as 'NetBSD-0_18'
@
text
@d1 1
a1 1
/* (0.18)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.18
d9 1
a9 1
#define Module_Date_CMHG                03 Jun 2003
d11 2
a12 2
#define Module_MajorVersion             "0.18"
#define Module_Version                  18
d14 1
a14 1
#define Module_Date                     "03 Jun 2003"
d16 1
a16 1
#define Module_ApplicationDate          "03-Jun-03"
d21 3
a23 3
#define Module_FullVersion              "0.18"
#define Module_HelpVersion              "0.18 (03 Jun 2003)"
#define Module_LibraryVersionInfo       "0:18"
@


1.18
log
@Added new CallDevice reason code (&80000005) to clear a stall condition on
a pipe with a given FileSwitch handle
New usbdevs and usbdevs_data from NetBSD
Rewrote power source detection to skirt round dodgy devices which say
they're self powered,set MaxPower=0,and don't respond to a getstatus()
Copes better with devices being unplugged while a transfer using them is active

Version 0.17. Tagged as 'NetBSD-0_17'
@
text
@d1 1
a1 1
/* (0.17)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.17
d9 1
a9 1
#define Module_Date_CMHG                23 May 2003
d11 2
a12 2
#define Module_MajorVersion             "0.17"
#define Module_Version                  17
d14 1
a14 1
#define Module_Date                     "23 May 2003"
d16 1
a16 1
#define Module_ApplicationDate          "23-May-03"
d21 3
a23 3
#define Module_FullVersion              "0.17"
#define Module_HelpVersion              "0.17 (23 May 2003)"
#define Module_LibraryVersionInfo       "0:17"
@


1.17
log
@  Support for SCSISoftUSB, and some tidying up.
Detail:
  * Errors now use the allocated error number base, &819000, instead of a
    base in the private range, &50000000. "USB transfer failed" errors now
    have use a sub-range of error numbers from &819020; the original BSD
    error number can be retrieved from the bottom 5 bits of the RISC OS
    error number.
  * Service_USB 1 now returns the list in the order in which the devices,
    rather than in the reverse order as previous versions of the module did.
  * A little tweaking of h/usb_port to reduce compiler warnings.
  * Some compiler-satisfying changes to allow use of packed structures.
    (However, the compiler doesn't seem to work correctly yet, so this is
    currently switched out using -DDISABLE_PACKED on the command line.)
  * Added full stops to end of star command help strings for consistency
    with rest of OS.
  * New exports: USBDevFS (moved here from ^.h) and a few files in dev/usb/h
    and sys/h.
Admin:
  Error number overhaul and new exports are both required by SCSISoftUSB.

Version 0.16. Tagged as 'NetBSD-0_16'
@
text
@d1 1
a1 1
/* (0.16)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.16
d9 1
a9 1
#define Module_Date_CMHG                14 May 2003
d11 2
a12 2
#define Module_MajorVersion             "0.16"
#define Module_Version                  16
d14 1
a14 1
#define Module_Date                     "14 May 2003"
d16 1
a16 1
#define Module_ApplicationDate          "14-May-03"
d21 3
a23 3
#define Module_FullVersion              "0.16"
#define Module_HelpVersion              "0.16 (14 May 2003)"
#define Module_LibraryVersionInfo       "0:16"
@


1.16
log
@Put the port reset delay back to 50ms.Not sure why NetBSD decided to change
that but it broke the Chicony keyboard supplied in Castle's Iyonix.

Version 0.15. Tagged as 'NetBSD-0_15'
@
text
@d1 1
a1 1
/* (0.15)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.15
d9 1
a9 1
#define Module_Date_CMHG                23 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.15"
#define Module_Version                  15
d14 1
a14 1
#define Module_Date                     "23 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "23-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.15"
#define Module_HelpVersion              "0.15 (23 Apr 2003)"
#define Module_LibraryVersionInfo       "0:15"
@


1.15
log
@Removed a debugging delay from dev.c.ohci which was breaking everything.
Null vendor names no longer say oflaofla.

Version 0.14. Tagged as 'NetBSD-0_14'
@
text
@d1 1
a1 1
/* (0.14)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.14
d9 1
a9 1
#define Module_Date_CMHG                15 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.14"
#define Module_Version                  14
d14 1
a14 1
#define Module_Date                     "15 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "15-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.14"
#define Module_HelpVersion              "0.14 (15 Apr 2003)"
#define Module_LibraryVersionInfo       "0:14"
@


1.14
log
@Change to makefile so it remembers to compile "makedevs" first
before trying to make the device list (required after a clean).

Version 0.13. Tagged as 'NetBSD-0_13'
@
text
@d1 1
a1 1
/* (0.13)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.13
d9 1
a9 1
#define Module_Date_CMHG                12 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.13"
#define Module_Version                  13
d14 1
a14 1
#define Module_Date                     "12 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "12-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.13"
#define Module_HelpVersion              "0.13 (12 Apr 2003)"
#define Module_LibraryVersionInfo       "0:13"
@


1.13
log
@Nicked a few hub related fixes from later NetBSD versions.
Added stuff to delete the DeviceFS$USB*$Options variables when the module is
RMkilled.

Version 0.12. Tagged as 'NetBSD-0_12'
@
text
@d1 1
a1 1
/* (0.12)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.12
d9 1
a9 1
#define Module_Date_CMHG                11 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.12"
#define Module_Version                  12
d14 1
a14 1
#define Module_Date                     "11 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "11-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.12"
#define Module_HelpVersion              "0.12 (11 Apr 2003)"
#define Module_LibraryVersionInfo       "0:12"
@


1.12
log
@Fix for erratic behaviour after having unplugged hubs: TAILQ was
being given an entry which wasn't on its list, and the behaviour was to
break the list and poke a zero into the reset vector!
Also, some extra IFDEF's so that debug builds will work again.
A few typos/spelling errors changed.

Version 0.11. Tagged as 'NetBSD-0_11'
@
text
@d1 1
a1 1
/* (0.11)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.11
d9 1
a9 1
#define Module_Date_CMHG                10 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.11"
#define Module_Version                  11
d14 1
a14 1
#define Module_Date                     "10 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "10-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.11"
#define Module_HelpVersion              "0.11 (10 Apr 2003)"
#define Module_LibraryVersionInfo       "0:11"
@


1.11
log
@Before I forget,unset the DeviceFS$USBnnn$Options variable due to not
reusing numbers and DeviceFS not deleting them - is there such thing as
variable leaks?

Version 0.10. Tagged as 'NetBSD-0_10'
@
text
@d1 1
a1 1
/* (0.10)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.10
d9 1
a9 1
#define Module_Date_CMHG                08 Apr 2003
d11 2
a12 2
#define Module_MajorVersion             "0.10"
#define Module_Version                  10
d14 1
a14 1
#define Module_Date                     "08 Apr 2003"
d16 1
a16 1
#define Module_ApplicationDate          "08-Apr-03"
d21 3
a23 3
#define Module_FullVersion              "0.10"
#define Module_HelpVersion              "0.10 (08 Apr 2003)"
#define Module_LibraryVersionInfo       "0:10"
@


1.10
log
@Added the ability to specify an alternate interface in the deviceFS
special string.

Version 0.09. Tagged as 'NetBSD-0_09'
@
text
@d1 1
a1 1
/* (0.09)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.09
d9 1
a9 1
#define Module_Date_CMHG                08 Mar 2003
d11 2
a12 2
#define Module_MajorVersion             "0.09"
#define Module_Version                  9
d14 1
a14 1
#define Module_Date                     "08 Mar 2003"
d16 1
a16 1
#define Module_ApplicationDate          "08-Mar-03"
d21 3
a23 3
#define Module_FullVersion              "0.09"
#define Module_HelpVersion              "0.09 (08 Mar 2003)"
#define Module_LibraryVersionInfo       "0:9"
@


1.9
log
@Found a "busses" lingering in the messages file,also removed a \n which
must have been copied from a printf somewhere.
Old service call detail removed from c.port as it's defined in another
file differently!
USBDiscover is now only available for debugging purposes.
Internationalised the mouse name (default is still "USB mouse").

Version 0.08. Tagged as 'NetBSD-0_08'
@
text
@d1 1
a1 1
/* (0.08)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.08
d9 1
a9 1
#define Module_Date_CMHG                02 Mar 2003
d11 2
a12 2
#define Module_MajorVersion             "0.08"
#define Module_Version                  8
d14 1
a14 1
#define Module_Date                     "02 Mar 2003"
d16 1
a16 1
#define Module_ApplicationDate          "02-Mar-03"
d21 3
a23 3
#define Module_FullVersion              "0.08"
#define Module_HelpVersion              "0.08 (02 Mar 2003)"
#define Module_LibraryVersionInfo       "0:8"
@


1.8
log
@Fix to extern char * thingy which was causing hardware vector 0 to be
scrambled.
Makefile now zaps the linked directory too.

Version 0.07. Tagged as 'NetBSD-0_07'
@
text
@d1 1
a1 1
/* (0.07)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.07
d9 1
a9 1
#define Module_Date_CMHG                22 Feb 2003
d11 2
a12 2
#define Module_MajorVersion             "0.07"
#define Module_Version                  7
d14 1
a14 1
#define Module_Date                     "22 Feb 2003"
d16 1
a16 1
#define Module_ApplicationDate          "22-Feb-03"
d21 3
a23 3
#define Module_FullVersion              "0.07"
#define Module_HelpVersion              "0.07 (22 Feb 2003)"
#define Module_LibraryVersionInfo       "0:7"
@


1.7
log
@Resources file was a bit out of sync.No code changes.

Version 0.06. Tagged as 'NetBSD-0_06'
@
text
@d1 1
a1 1
/* (0.06)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.06
d9 1
a9 1
#define Module_Date_CMHG                10 Feb 2003
d11 2
a12 2
#define Module_MajorVersion             "0.06"
#define Module_Version                  6
d14 1
a14 1
#define Module_Date                     "10 Feb 2003"
d16 1
a16 1
#define Module_ApplicationDate          "10-Feb-03"
d21 3
a23 3
#define Module_FullVersion              "0.06"
#define Module_HelpVersion              "0.06 (10 Feb 2003)"
#define Module_LibraryVersionInfo       "0:6"
@


1.6
log
@Another fix to the previous buffer overrun fix,such that this time the
command aliases actually get executed now.
Timing code changed to work round HAL call not returning the right value
so temporarily wired to 2000000.
Change to Makefile so ROM builds don't have annoying throwback windows
popping up,this is now in the !Mk file.Also "-ff" function names away.

Version 0.05. Tagged as 'NetBSD-0_05'
@
text
@d1 1
a1 1
/* (0.05)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.05
d9 1
a9 1
#define Module_Date_CMHG                07 Feb 2003
d11 2
a12 2
#define Module_MajorVersion             "0.05"
#define Module_Version                  5
d14 1
a14 1
#define Module_Date                     "07 Feb 2003"
d16 1
a16 1
#define Module_ApplicationDate          "07-Feb-03"
d21 3
a23 3
#define Module_FullVersion              "0.05"
#define Module_HelpVersion              "0.05 (07 Feb 2003)"
#define Module_LibraryVersionInfo       "0:5"
@


1.5
log
@Fix for nasty bug where system variable assignment would trample over
random bits of the RMA

Version 0.04. Tagged as 'NetBSD-0_04'
@
text
@d1 1
a1 1
/* (0.04)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.04
d9 1
a9 1
#define Module_Date_CMHG                31 Jan 2003
d11 2
a12 2
#define Module_MajorVersion             "0.04"
#define Module_Version                  4
d14 1
a14 1
#define Module_Date                     "31 Jan 2003"
d16 1
a16 1
#define Module_ApplicationDate          "31-Jan-03"
d21 3
a23 3
#define Module_FullVersion              "0.04"
#define Module_HelpVersion              "0.04 (31 Jan 2003)"
#define Module_LibraryVersionInfo       "0:4"
@


1.4
log
@Minor bug fix,the system variable was getting run before the device
was fully established in DeviceFS - which could cause printing problems.

Version 0.03. Tagged as 'NetBSD-0_03'
@
text
@d1 1
a1 1
/* (0.03)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.03
d9 1
a9 1
#define Module_Date_CMHG                29 Jan 2003
d11 2
a12 2
#define Module_MajorVersion             "0.03"
#define Module_Version                  3
d14 1
a14 1
#define Module_Date                     "29 Jan 2003"
d16 1
a16 1
#define Module_ApplicationDate          "29-Jan-03"
d21 3
a23 3
#define Module_FullVersion              "0.03"
#define Module_HelpVersion              "0.03 (29 Jan 2003)"
#define Module_LibraryVersionInfo       "0:3"
@


1.3
log
@Fix to interrupt hole in mouse driver.
Version number now got from Version file,not hand tweaked CMHG file.
Timer was a factor 10 out in previous version due to typo.

Version 0.02. Tagged as 'NetBSD-0_02'
@
text
@d1 1
a1 1
/* (0.02)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.02
d9 1
a9 1
#define Module_Date_CMHG                28 Jan 2003
d11 2
a12 2
#define Module_MajorVersion             "0.02"
#define Module_Version                  2
d14 1
a14 1
#define Module_Date                     "28 Jan 2003"
d16 1
a16 1
#define Module_ApplicationDate          "28-Jan-03"
d21 3
a23 3
#define Module_FullVersion              "0.02"
#define Module_HelpVersion              "0.02 (28 Jan 2003)"
#define Module_LibraryVersionInfo       "0:2"
@


1.2
log
@Import of USB driver suitable for generic PCI based OHCI controllers.
Correction of spelling of busses to buses (noun plural).
OHCIdriver only responds to PCI service call to lookup vendor name when
the device is of class OHCI controller.

Version 0.01. Tagged as 'NetBSD-0_01'
@
text
@d1 1
a1 1
/* (0.01)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.01
d11 2
a12 2
#define Module_MajorVersion             "0.01"
#define Module_Version                  1
d21 3
a23 3
#define Module_FullVersion              "0.01"
#define Module_HelpVersion              "0.01 (28 Jan 2003)"
#define Module_LibraryVersionInfo       "0:1"
@


1.1
log
@created by srccommit.
@
text
@d1 1
a1 1
/* (0.00)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.00
d11 2
a12 2
#define Module_MajorVersion             "0.00"
#define Module_Version                  0
d21 3
a23 3
#define Module_FullVersion              "0.00"
#define Module_HelpVersion              "0.00 (28 Jan 2003)"
#define Module_LibraryVersionInfo       "0:0"
@

