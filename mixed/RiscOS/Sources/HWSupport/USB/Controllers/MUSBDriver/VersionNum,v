head	1.37;
access;
symbols
	MUSBDriver-0_35:1.37
	MUSBDriver-0_34:1.36
	MUSBDriver-0_33:1.35
	MUSBDriver-0_32:1.34
	MUSBDriver-0_31:1.33
	MUSBDriver-0_30:1.32
	MUSBDriver-0_29:1.31
	MUSBDriver-0_28:1.30
	MUSBDriver-0_27:1.29
	MUSBDriver-0_26:1.28
	MUSBDriver-0_25:1.27
	MUSBDriver-0_24:1.26
	MUSBDriver-0_23:1.25
	MUSBDriver-0_22:1.24
	MUSBDriver-0_21:1.23
	MUSBDriver-0_20:1.22
	MUSBDriver-0_19:1.21
	MUSBDriver-0_18:1.20
	MUSBDriver-0_17:1.19
	MUSBDriver-0_16:1.18
	MUSBDriver-0_15:1.17
	MUSBDriver-0_14:1.16
	MUSBDriver-0_13:1.15
	MUSBDriver-0_12:1.14
	MUSBDriver-0_11:1.13
	MUSBDriver-0_10:1.12
	MUSBDriver-0_09:1.11
	MUSBDriver-0_08:1.10
	MUSBDriver-0_07:1.9
	MUSBDriver-0_06:1.8
	MUSBDriver-0_05:1.7
	MUSBDriver-0_04:1.6
	MUSBDriver-0_03:1.5
	MUSBDriver-0_02:1.3;
locks; strict;
comment	@# @;
expand	@v@;


1.37
date	2018.01.27.09.40.04;	author rool;	state Exp;
branches;
next	1.36;
commitid	gzm2idj9zPnFPuoA;

1.36
date	2017.11.25.09.53.00;	author rool;	state Exp;
branches;
next	1.35;
commitid	SGxBNziFzcLEVogA;

1.35
date	2017.11.18.10.26.24;	author rool;	state Exp;
branches;
next	1.34;
commitid	yU4Q13DwEA04lvfA;

1.34
date	2017.09.23.09.01.52;	author rool;	state Exp;
branches;
next	1.33;
commitid	6rXidvVzktBEFi8A;

1.33
date	2017.08.19.14.50.41;	author rool;	state Exp;
branches;
next	1.32;
commitid	Rrk2EN8kMom5JP3A;

1.32
date	2017.07.15.09.05.03;	author rool;	state Exp;
branches;
next	1.31;
commitid	wbbi1NJtGQWfWiZz;

1.31
date	2016.12.18.11.50.05;	author jlee;	state Exp;
branches;
next	1.30;
commitid	MtZLizvfdCwozsyz;

1.30
date	2016.12.17.10.42.15;	author rool;	state Exp;
branches;
next	1.29;
commitid	CYGmihDmIHN6ekyz;

1.29
date	2016.05.02.19.11.08;	author rsprowson;	state Exp;
branches;
next	1.28;
commitid	yC6Kkcs3WTf4pW4z;

1.28
date	2016.03.26.23.49.34;	author jlee;	state Exp;
branches;
next	1.27;
commitid	tTloQaDczIFj8d0z;

1.27
date	2015.11.18.22.44.47;	author rsprowson;	state Exp;
branches;
next	1.26;
commitid	aBgIXq3khxmbVCJy;

1.26
date	2015.11.15.10.02.04;	author rool;	state Exp;
branches;
next	1.25;
commitid	pzOT0SOvb6uvNaJy;

1.25
date	2015.08.21.20.09.31;	author rsprowson;	state Exp;
branches;
next	1.24;
commitid	AR6BOUEtVfUgVayy;

1.24
date	2014.06.01.13.58.13;	author jlee;	state Exp;
branches;
next	1.23;
commitid	8OjtcW0RnvIJcPCx;

1.23
date	2014.05.27.19.19.36;	author jlee;	state Exp;
branches;
next	1.22;
commitid	WoQoyE1NXx3X8dCx;

1.22
date	2014.05.06.20.31.53;	author rsprowson;	state Exp;
branches;
next	1.21;
commitid	C9iEShBekVSBdwzx;

1.21
date	2013.03.30.23.42.34;	author jlee;	state Exp;
branches;
next	1.20;
commitid	KYekipBHsUiacSJw;

1.20
date	2012.09.23.23.13.12;	author jlee;	state Exp;
branches;
next	1.19;
commitid	ZUic5Ks4MdeL4Ilw;

1.19
date	2012.06.06.23.53.30;	author jlee;	state Exp;
branches;
next	1.18;
commitid	CFvOhB5lkQSNNH7w;

1.18
date	2011.12.04.19.19.09;	author jlee;	state Exp;
branches;
next	1.17;
commitid	a8y12AqmzdBneUJv;

1.17
date	2011.08.22.22.43.46;	author jlee;	state Exp;
branches;
next	1.16;
commitid	XF0NP2x7l03QHywv;

1.16
date	2011.08.05.00.06.11;	author jlee;	state Exp;
branches;
next	1.15;
commitid	XLVfaQiiOY4ZJfuv;

1.15
date	2011.07.11.20.15.50;	author jlee;	state Exp;
branches;
next	1.14;
commitid	Bnjdl5h4idKMe9rv;

1.14
date	2011.05.22.20.32.24;	author jlee;	state Exp;
branches;
next	1.13;
commitid	ojDCXEOv6C57WIkv;

1.13
date	2011.04.11.23.25.32;	author jlee;	state Exp;
branches;
next	1.12;
commitid	6pcEoJPvdLzddtfv;

1.12
date	2011.02.08.10.40.50;	author srevill;	state Exp;
branches;
next	1.11;

1.11
date	2010.09.14.20.59.59;	author jlee;	state Exp;
branches;
next	1.10;

1.10
date	2010.08.14.21.41.49;	author jlee;	state Exp;
branches;
next	1.9;

1.9
date	2010.07.21.23.59.59;	author jlee;	state Exp;
branches;
next	1.8;

1.8
date	2010.06.28.21.12.36;	author jlee;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.20.22.25.44;	author jlee;	state Exp;
branches;
next	1.6;

1.6
date	2009.10.19.23.18.28;	author jlee;	state Exp;
branches;
next	1.5;

1.5
date	2009.10.02.20.55.10;	author jlee;	state Exp;
branches;
next	1.4;

1.4
date	2009.09.28.18.59.53;	author jlee;	state Exp;
branches;
next	1.3;

1.3
date	2009.09.06.20.51.00;	author jlee;	state Exp;
branches;
next	1.2;

1.2
date	2009.07.07.21.36.04;	author jlee;	state Exp;
branches;
next	1.1;

1.1
date	2009.07.02.20.15.41;	author jlee;	state Exp;
branches;
next	;


desc
@@


1.37
log
@Defined return on error
Detail:
  Ensure the returned status is defined if USBDriver_InsertTransfer fails (because USBDriver has gone).
  See similar in DWCDriver-0_34.

Version 0.35. Tagged as 'MUSBDriver-0_35'
@
text
@/* (0.35)
 *
 * This file is automatically maintained by srccommit, do not edit manually.
 * Last processed by srccommit version: 1.1.
 *
 */
#define Module_MajorVersion_CMHG        0.35
#define Module_MinorVersion_CMHG        
#define Module_Date_CMHG                27 Jan 2018

#define Module_MajorVersion             "0.35"
#define Module_Version                  35
#define Module_MinorVersion             ""
#define Module_Date                     "27 Jan 2018"

#define Module_ApplicationDate          "27-Jan-18"

#define Module_ComponentName            "MUSBDriver"
#define Module_ComponentPath            "mixed/RiscOS/Sources/HWSupport/USB/Controllers/MUSBDriver"

#define Module_FullVersion              "0.35"
#define Module_HelpVersion              "0.35 (27 Jan 2018)"
#define Module_LibraryVersionInfo       "0:35"
@


1.36
log
@Root hub interval correction
Detail:
  HSHUBSTT use 12 (see DWCDriver-0_33).
Admin:
  Found by pattern matching.

Version 0.34. Tagged as 'MUSBDriver-0_34'
@
text
@d1 1
a1 1
/* (0.34)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.34
d9 1
a9 1
#define Module_Date_CMHG                25 Nov 2017
d11 2
a12 2
#define Module_MajorVersion             "0.34"
#define Module_Version                  34
d14 1
a14 1
#define Module_Date                     "25 Nov 2017"
d16 1
a16 1
#define Module_ApplicationDate          "25-Nov-17"
d21 3
a23 3
#define Module_FullVersion              "0.34"
#define Module_HelpVersion              "0.34 (25 Nov 2017)"
#define Module_LibraryVersionInfo       "0:34"
@


1.35
log
@Debug build fix
Detail:
  Add missing logprintf().
Admin:
  Submission for USB bounty.

Version 0.33. Tagged as 'MUSBDriver-0_33'
@
text
@d1 1
a1 1
/* (0.33)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.33
d9 1
a9 1
#define Module_Date_CMHG                18 Nov 2017
d11 2
a12 2
#define Module_MajorVersion             "0.33"
#define Module_Version                  33
d14 1
a14 1
#define Module_Date                     "18 Nov 2017"
d16 1
a16 1
#define Module_ApplicationDate          "18-Nov-17"
d21 3
a23 3
#define Module_FullVersion              "0.33"
#define Module_HelpVersion              "0.33 (18 Nov 2017)"
#define Module_LibraryVersionInfo       "0:33"
@


1.34
log
@Remove HAL library variant
Detail:
  Simplify the makefile by not building a HAL variant.
  cmodule.c: 2 fewer warnings
  musb.c/musb_debug.c/musb_peri.c/musb_root.c/musb_util.c/tps.c: remove usbhal.h include
  cmodule.h/musb_usb.c: USBHAL is no longer defined
  CMHG file changed to make Makefile
Admin:
  Submission for USB bounty.

Version 0.32. Tagged as 'MUSBDriver-0_32'
@
text
@d1 1
a1 1
/* (0.32)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.32
d9 1
a9 1
#define Module_Date_CMHG                23 Sep 2017
d11 2
a12 2
#define Module_MajorVersion             "0.32"
#define Module_Version                  32
d14 1
a14 1
#define Module_Date                     "23 Sep 2017"
d16 1
a16 1
#define Module_ApplicationDate          "23-Sep-17"
d21 3
a23 3
#define Module_FullVersion              "0.32"
#define Module_HelpVersion              "0.32 (23 Sep 2017)"
#define Module_LibraryVersionInfo       "0:32"
@


1.33
log
@Changes to header imports
Detail:
  Use those in C:USB rather than reaching inside the adjacent USBDriver.
Admin:
  Requires USBDriver-1_21.

Version 0.31. Tagged as 'MUSBDriver-0_31'
@
text
@d1 1
a1 1
/* (0.31)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.31
d9 1
a9 1
#define Module_Date_CMHG                19 Aug 2017
d11 2
a12 2
#define Module_MajorVersion             "0.31"
#define Module_Version                  31
d14 1
a14 1
#define Module_Date                     "19 Aug 2017"
d16 1
a16 1
#define Module_ApplicationDate          "19-Aug-17"
d21 3
a23 3
#define Module_FullVersion              "0.31"
#define Module_HelpVersion              "0.31 (19 Aug 2017)"
#define Module_LibraryVersionInfo       "0:31"
@


1.32
log
@Repoint include path
Admin:
  Reach into USBDriver rather than NetBSD.

Version 0.30. Tagged as 'MUSBDriver-0_30'
@
text
@d1 1
a1 1
/* (0.30)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.30
d9 1
a9 1
#define Module_Date_CMHG                15 Jul 2017
d11 2
a12 2
#define Module_MajorVersion             "0.30"
#define Module_Version                  30
d14 1
a14 1
#define Module_Date                     "15 Jul 2017"
d16 1
a16 1
#define Module_ApplicationDate          "15-Jul-17"
d21 3
a23 3
#define Module_FullVersion              "0.30"
#define Module_HelpVersion              "0.30 (15 Jul 2017)"
#define Module_LibraryVersionInfo       "0:30"
@


1.31
log
@HAL build fix
Detail:
  c/musb_hal - Add a dummy messages_file_lookup implementation for use with HAL builds of the code (as required by musb_peri.c / musb_root.c)
Admin:
  Tested on BB-xM


Version 0.29. Tagged as 'MUSBDriver-0_29'
@
text
@d1 1
a1 1
/* (0.29)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.29
d9 1
a9 1
#define Module_Date_CMHG                18 Dec 2016
d11 2
a12 2
#define Module_MajorVersion             "0.29"
#define Module_Version                  29
d14 1
a14 1
#define Module_Date                     "18 Dec 2016"
d16 1
a16 1
#define Module_ApplicationDate          "18-Dec-16"
d21 3
a23 3
#define Module_FullVersion              "0.29"
#define Module_HelpVersion              "0.29 (18 Dec 2016)"
#define Module_LibraryVersionInfo       "0:29"
@


1.30
log
@Internationalised
Detail:
  Add support for standalone messages registration, and actually use the messages rather than just exporting them in ROM builds.
  Changed to use allocated error bases rather than 0.
  Sync with other HC for ease of comparison where possible.
Admin:
  Submission for USB bounty.
  Tested on a BBxM.

Version 0.28. Tagged as 'MUSBDriver-0_28'
@
text
@d1 1
a1 1
/* (0.28)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.28
d9 1
a9 1
#define Module_Date_CMHG                17 Dec 2016
d11 2
a12 2
#define Module_MajorVersion             "0.28"
#define Module_Version                  28
d14 1
a14 1
#define Module_Date                     "17 Dec 2016"
d16 1
a16 1
#define Module_ApplicationDate          "17-Dec-16"
d21 3
a23 3
#define Module_FullVersion              "0.28"
#define Module_HelpVersion              "0.28 (17 Dec 2016)"
#define Module_LibraryVersionInfo       "0:28"
@


1.29
log
@Fix for too short a memset
Found by pattern matching, this is the same change as DWCDriver-0_27.

Version 0.27. Tagged as 'MUSBDriver-0_27'
@
text
@d1 1
a1 1
/* (0.27)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.27
d9 1
a9 1
#define Module_Date_CMHG                02 May 2016
d11 2
a12 2
#define Module_MajorVersion             "0.27"
#define Module_Version                  27
d14 1
a14 1
#define Module_Date                     "02 May 2016"
d16 1
a16 1
#define Module_ApplicationDate          "02-May-16"
d21 3
a23 3
#define Module_FullVersion              "0.27"
#define Module_HelpVersion              "0.27 (02 May 2016)"
#define Module_LibraryVersionInfo       "0:27"
@


1.28
log
@Delete unused code
Detail:
  c/port - Less code, less bugs
Admin:
  Builds, untested


Version 0.26. Tagged as 'MUSBDriver-0_26'
@
text
@d1 1
a1 1
/* (0.26)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.26
d9 1
a9 1
#define Module_Date_CMHG                26 Mar 2016
d11 2
a12 2
#define Module_MajorVersion             "0.26"
#define Module_Version                  26
d14 1
a14 1
#define Module_Date                     "26 Mar 2016"
d16 1
a16 1
#define Module_ApplicationDate          "26-Mar-16"
d21 3
a23 3
#define Module_FullVersion              "0.26"
#define Module_HelpVersion              "0.26 (26 Mar 2016)"
#define Module_LibraryVersionInfo       "0:26"
@


1.27
log
@Don't build a veneer that points to nothing
Copy of the change in NetBSD-1_09.

Version 0.25. Tagged as 'MUSBDriver-0_25'
@
text
@d1 1
a1 1
/* (0.25)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.25
d9 1
a9 1
#define Module_Date_CMHG                18 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "0.25"
#define Module_Version                  25
d14 1
a14 1
#define Module_Date                     "18 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "18-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "0.25"
#define Module_HelpVersion              "0.25 (18 Nov 2015)"
#define Module_LibraryVersionInfo       "0:25"
@


1.26
log
@Init structures for MUSBDriver unused members
Detail:
  Play safe, put NULLs in for the unused HC overrides


Version 0.24. Tagged as 'MUSBDriver-0_24'
@
text
@d1 1
a1 1
/* (0.24)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.24
d9 1
a9 1
#define Module_Date_CMHG                15 Nov 2015
d11 2
a12 2
#define Module_MajorVersion             "0.24"
#define Module_Version                  24
d14 1
a14 1
#define Module_Date                     "15 Nov 2015"
d16 1
a16 1
#define Module_ApplicationDate          "15-Nov-15"
d21 3
a23 3
#define Module_FullVersion              "0.24"
#define Module_HelpVersion              "0.24 (15 Nov 2015)"
#define Module_LibraryVersionInfo       "0:24"
@


1.25
log
@Don't reach into USBDriver's back pocket
cmodule.c:
  Use USBDriver.h from interface exports
Makefile:
  Remove duplicated libs from debug build
  Remove relative reference to NetBSD component from VPATH
!MkDebug:
  Select debug target so the right compiler switches are used
musb.c/musb_debug.c/musb_peri.c/musb_root.c/musb_usb.c/musb_util.c/tps.c:
  Unused reference to USBDriver.h removed
Built, but not tested.

Version 0.23. Tagged as 'MUSBDriver-0_23'
@
text
@d1 1
a1 1
/* (0.23)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.23
d9 1
a9 1
#define Module_Date_CMHG                21 Aug 2015
d11 2
a12 2
#define Module_MajorVersion             "0.23"
#define Module_Version                  23
d14 1
a14 1
#define Module_Date                     "21 Aug 2015"
d16 1
a16 1
#define Module_ApplicationDate          "21-Aug-15"
d21 3
a23 3
#define Module_FullVersion              "0.23"
#define Module_HelpVersion              "0.23 (21 Aug 2015)"
#define Module_LibraryVersionInfo       "0:23"
@


1.24
log
@Fix to allow building against NetBSD-0_85
Detail:
  c/cmodule - Don't use NetBSD/build/service.h, it no longer exists. Use the exported USB/USBDevFS.h instead. Fix service call reason codes to use USBDevFS names.
  c/musb, c/musb_debug, c/musb_hal, c/musb_peri, c/musb_root, c/musb_usb, c/musb_util, c/tps - Strip redundant #includes
Admin:
  Tested in OMAP3 ROM build
  Build output is binary-identical to previous version
  Requires NetBSD-0_85


Version 0.22. Tagged as 'MUSBDriver-0_22'
@
text
@d1 1
a1 1
/* (0.22)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.22
d9 1
a9 1
#define Module_Date_CMHG                01 Jun 2014
d11 2
a12 2
#define Module_MajorVersion             "0.22"
#define Module_Version                  22
d14 1
a14 1
#define Module_Date                     "01 Jun 2014"
d16 1
a16 1
#define Module_ApplicationDate          "01-Jun-14"
d21 3
a23 3
#define Module_FullVersion              "0.22"
#define Module_HelpVersion              "0.22 (01 Jun 2014)"
#define Module_LibraryVersionInfo       "0:22"
@


1.23
log
@Fix handling of short control transfers
Detail:
  c/musb - Updated musb_ep0_host() to treat a short control packet as the end of the transfer, as mandated by the USB spec. Also updated a few other pieces of code to ensure the transfer length is reported correctly if an error occurs.
  c/cmodule - Fix potential null pointer dereference when debugging enabled
  Makefile - Fix lack of DPRINTF() debug output in debug builds due to USB_DEBUG not being defined
Admin:
  Tested on BB-xM with high processor vectors
  Fixes 99% of connected devices failing to initialise following the change to the device initialisation logic made to USBDriver in NetBSD-0_82 (initial device descriptor requests now request more data than is likely to be available, triggering a short packet/xfer response)


Version 0.21. Tagged as 'MUSBDriver-0_21'
@
text
@d1 1
a1 1
/* (0.21)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.21
d9 1
a9 1
#define Module_Date_CMHG                27 May 2014
d11 2
a12 2
#define Module_MajorVersion             "0.21"
#define Module_Version                  21
d14 1
a14 1
#define Module_Date                     "27 May 2014"
d16 1
a16 1
#define Module_ApplicationDate          "27-May-14"
d21 3
a23 3
#define Module_FullVersion              "0.21"
#define Module_HelpVersion              "0.21 (27 May 2014)"
#define Module_LibraryVersionInfo       "0:21"
@


1.22
log
@Missing va_end() added

Version 0.20. Tagged as 'MUSBDriver-0_20'
@
text
@d1 1
a1 1
/* (0.20)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.20
d9 1
a9 1
#define Module_Date_CMHG                06 May 2014
d11 2
a12 2
#define Module_MajorVersion             "0.20"
#define Module_Version                  20
d14 1
a14 1
#define Module_Date                     "06 May 2014"
d16 1
a16 1
#define Module_ApplicationDate          "06-May-14"
d21 3
a23 3
#define Module_FullVersion              "0.20"
#define Module_HelpVersion              "0.20 (06 May 2014)"
#define Module_LibraryVersionInfo       "0:20"
@


1.21
log
@Add re-entrancy check to USBDriver registration
Detail:
  c/cmodule - Added a re-entrancy check to USBDriver registration, to avoid any shenanigans if we receive "USBDriver has started" service calls while in the middle of registering
Admin:
  Tested on BB-xM
  Doesn't fix any known MUSBDriver-related issue, but is the same fix as was made to DWCDriver after the above-mentioned problem was found to be the cause of a hang on boot in recent Pi ROMs


Version 0.19. Tagged as 'MUSBDriver-0_19'
@
text
@d1 1
a1 1
/* (0.19)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.19
d9 1
a9 1
#define Module_Date_CMHG                30 Mar 2013
d11 2
a12 2
#define Module_MajorVersion             "0.19"
#define Module_Version                  19
d14 1
a14 1
#define Module_Date                     "30 Mar 2013"
d16 1
a16 1
#define Module_ApplicationDate          "30-Mar-13"
d21 3
a23 3
#define Module_FullVersion              "0.19"
#define Module_HelpVersion              "0.19 (30 Mar 2013)"
#define Module_LibraryVersionInfo       "0:19"
@


1.20
log
@Perform some missing PHY initialisation
Detail:
  c/tps - Added some extra PHY initialisation steps that are needed to get things working on Pandora
Admin:
  Tested on Pandora


Version 0.18. Tagged as 'MUSBDriver-0_18'
@
text
@d1 1
a1 1
/* (0.18)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.18
d9 1
a9 1
#define Module_Date_CMHG                24 Sep 2012
d11 2
a12 2
#define Module_MajorVersion             "0.18"
#define Module_Version                  18
d14 1
a14 1
#define Module_Date                     "24 Sep 2012"
d16 1
a16 1
#define Module_ApplicationDate          "24-Sep-12"
d21 3
a23 3
#define Module_FullVersion              "0.18"
#define Module_HelpVersion              "0.18 (24 Sep 2012)"
#define Module_LibraryVersionInfo       "0:18"
@


1.19
log
@Misc housekeeping
Detail:
  Makefile, !MkDebug,fd7 - Debug version of module can now be built just by passing "DEBUG=TRUE" to amu
  c/cmodule, c/musb_hal - Only accept USB controllers if HAL_USBControllerInfo says the struct size is an exact match with what we expect
  s/bufman - Delete unused file
  s/call_veneer, s/triggercbs - Use Entry/EXIT macros to avoid single-reg LDM/STM performance warnings. Convert tabs to spaces.
Admin:
  Tested on rev A2 BB-xM


Version 0.17. Tagged as 'MUSBDriver-0_17'
@
text
@d1 1
a1 1
/* (0.17)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.17
d9 1
a9 1
#define Module_Date_CMHG                07 Jun 2012
d11 2
a12 2
#define Module_MajorVersion             "0.17"
#define Module_Version                  17
d14 1
a14 1
#define Module_Date                     "07 Jun 2012"
d16 1
a16 1
#define Module_ApplicationDate          "07-Jun-12"
d21 3
a23 3
#define Module_FullVersion              "0.17"
#define Module_HelpVersion              "0.17 (07 Jun 2012)"
#define Module_LibraryVersionInfo       "0:17"
@


1.18
log
@Fix memory overwrites in root hub emulation
Detail:
  c/musb_root - Fixed device descriptor and config descriptor reads writing outside the destination buffer if the buffer was small enough.
Admin:
  Tested in OMAP3 ROM


Version 0.16. Tagged as 'MUSBDriver-0_16'
@
text
@d1 1
a1 1
/* (0.16)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.16
d9 1
a9 1
#define Module_Date_CMHG                04 Dec 2011
d11 2
a12 2
#define Module_MajorVersion             "0.16"
#define Module_Version                  16
d14 1
a14 1
#define Module_Date                     "04 Dec 2011"
d16 1
a16 1
#define Module_ApplicationDate          "04-Dec-11"
d21 3
a23 3
#define Module_FullVersion              "0.16"
#define Module_HelpVersion              "0.16 (04 Dec 2011)"
#define Module_LibraryVersionInfo       "0:16"
@


1.17
log
@Fix data aborts in HAL build
Detail:
  c/musb_peri, c/musb_root - Fixed some code in the root hub emulation that was writing to a global struct before copying it into the destination buffer. Although this works fine in ROM modules, it was causing data aborts in the HAL build due to lack of automatic RW data relocation by the compiler.
  c/musb - Removed reference to an old extern variable
Admin:
  Tested on rev C2 BB


Version 0.15. Tagged as 'MUSBDriver-0_15'
@
text
@d1 1
a1 1
/* (0.15)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.15
d9 1
a9 1
#define Module_Date_CMHG                22 Aug 2011
d11 2
a12 2
#define Module_MajorVersion             "0.15"
#define Module_Version                  15
d14 1
a14 1
#define Module_Date                     "22 Aug 2011"
d16 1
a16 1
#define Module_ApplicationDate          "22-Aug-11"
d21 3
a23 3
#define Module_FullVersion              "0.15"
#define Module_HelpVersion              "0.15 (22 Aug 2011)"
#define Module_LibraryVersionInfo       "0:15"
@


1.16
log
@Update to work with zero page relocation. Remove ability to cancel transfers by pressing escape
Detail:
  c/cmodule - Rework driver init/shutdown code to avoid null pointer dereference during Service_PreReset/USBDriver_Dying
  c/port - Removed ability to cancel transfers by pressing escape. Too dangerous for things like mass storage devices, and the code won't work anyway for the common case of being in the wimp
  s/triggercbs - Try using OS_ReadSysInfo 6 to get IRQsema ptr before falling back on legacy address
Admin:
  Tested on rev A2 BB-xM


Version 0.14. Tagged as 'MUSBDriver-0_14'
@
text
@d1 1
a1 1
/* (0.14)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.14
d9 1
a9 1
#define Module_Date_CMHG                05 Aug 2011
d11 2
a12 2
#define Module_MajorVersion             "0.14"
#define Module_Version                  14
d14 1
a14 1
#define Module_Date                     "05 Aug 2011"
d16 1
a16 1
#define Module_ApplicationDate          "05-Aug-11"
d21 3
a23 3
#define Module_FullVersion              "0.14"
#define Module_HelpVersion              "0.14 (05 Aug 2011)"
#define Module_LibraryVersionInfo       "0:14"
@


1.15
log
@Fix NAK timeout handling
Detail:
  c/musb, c/musb_debug, h/musb - Fixed NAK timeouts to not be treated as errors. Attempted to make use of NAK timeouts for yielding to other pending transfers, but ran into difficulties getting the timeout condition to clear properly. Disabling NAK intervals/timeouts entirely seems to be the safest option for now.
Admin:
  Tested on rev C2 BB, rev A2 BB-xM


Version 0.13. Tagged as 'MUSBDriver-0_13'
@
text
@d1 1
a1 1
/* (0.13)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.13
d9 1
a9 1
#define Module_Date_CMHG                11 Jul 2011
d11 2
a12 2
#define Module_MajorVersion             "0.13"
#define Module_Version                  13
d14 1
a14 1
#define Module_Date                     "11 Jul 2011"
d16 1
a16 1
#define Module_ApplicationDate          "11-Jul-11"
d21 3
a23 3
#define Module_FullVersion              "0.13"
#define Module_HelpVersion              "0.13 (11 Jul 2011)"
#define Module_LibraryVersionInfo       "0:13"
@


1.14
log
@Add support for HAL builds of MUSBDriver
Detail:
  Makefile - Now builds a HAL-compatible static library during the export libs phase
  !MkHAL,fd7 - Handy script for building the HAL lib
  c/musb_hal - HAL version of cmodule.c
  c/musb, c/musb_debug, c/musb_peri, c/musb_root, c/musb_usb, c/musb_util, c/tps, h/cmodule, h/musb, h/musb_util, h/tps - Changed to support the HAL build. Biggest change was getting rid of all global vars; everything is now done via the bus ptr instead.
  c/port - Removed microtime and moved riscos_irq_clear here, to match change made in main USB drivers
Admin:
  HAL & non-HAL versions tested on rev C2 BB, rev A2 BB-xM, rev C1 TouchBook
  Needs latest Kernel & NetBSD USB drivers


Version 0.12. Tagged as 'MUSBDriver-0_12'
@
text
@d1 1
a1 1
/* (0.12)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.12
d9 1
a9 1
#define Module_Date_CMHG                22 May 2011
d11 2
a12 2
#define Module_MajorVersion             "0.12"
#define Module_Version                  12
d14 1
a14 1
#define Module_Date                     "22 May 2011"
d16 1
a16 1
#define Module_ApplicationDate          "22-May-11"
d21 3
a23 3
#define Module_FullVersion              "0.12"
#define Module_HelpVersion              "0.12 (22 May 2011)"
#define Module_LibraryVersionInfo       "0:12"
@


1.13
log
@Restructure MUSBDriver source code, rework host mode endpoint handling, plus other misc changes
Detail:
  c/musb_debug - New file containing debug code.
  c/musb_peri - Contains the code for handling peripheral mode, taken from c/musb
  c/musb_root - Contains the code for handling the USBDriver-required 'soft' hub, taken from c/musb
  c/musb_usb - Contains initialisation code and other misc USBDriver-related code, mostly taken from c/musb
  c/musb_util - Misc utility functions from c/musb
  h/musb_util, h/musb_usb - A couple of new header files to help with breaking things up. Might make sense to break h/musb_usb down further (or just consolidate everything back into h/musb)
  c/musb - Stripped out pretty much everything except code related to host-mode endpoint and interrupt handling. Instances of the new musb_multiplexer struct are used to handle endpoint allocation, and allocation is now performed on a per-usbd_xfer basis instead of on a per-pipe basis. This should allow the code to cope better with situations where the number of pipes is greater than the number of physical endpoints, although much work is still required.
  c/cmodule, c/port, c/tps, h/cmodule, h/musb - Misc tweaks and changes
Admin:
  Tested on rev A2 BB-xM.


Version 0.11. Tagged as 'MUSBDriver-0_11'
@
text
@d1 1
a1 1
/* (0.11)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.11
d9 1
a9 1
#define Module_Date_CMHG                12 Apr 2011
d11 2
a12 2
#define Module_MajorVersion             "0.11"
#define Module_Version                  11
d14 1
a14 1
#define Module_Date                     "12 Apr 2011"
d16 1
a16 1
#define Module_ApplicationDate          "12-Apr-11"
d21 3
a23 3
#define Module_FullVersion              "0.11"
#define Module_HelpVersion              "0.11 (12 Apr 2011)"
#define Module_LibraryVersionInfo       "0:11"
@


1.12
log
@Makefile tweak to fix export_hdrs phase.

This component doesn't have any exported headers so this change will stop
build errors during the header export phase.

Version 0.10. Tagged as 'MUSBDriver-0_10'
@
text
@d1 1
a1 1
/* (0.10)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.10
d9 1
a9 1
#define Module_Date_CMHG                08 Feb 2011
d11 2
a12 2
#define Module_MajorVersion             "0.10"
#define Module_Version                  10
d14 1
a14 1
#define Module_Date                     "08 Feb 2011"
d16 1
a16 1
#define Module_ApplicationDate          "08-Feb-11"
d21 3
a23 3
#define Module_FullVersion              "0.10"
#define Module_HelpVersion              "0.10 (08 Feb 2011)"
#define Module_LibraryVersionInfo       "0:10"
@


1.11
log
@Add DEBUGLIBS to makefile so debug versions will build again

Version 0.09. Tagged as 'MUSBDriver-0_09'
@
text
@d1 1
a1 1
/* (0.09)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.09
d9 1
a9 1
#define Module_Date_CMHG                14 Sep 2010
d11 2
a12 2
#define Module_MajorVersion             "0.09"
#define Module_Version                  9
d14 1
a14 1
#define Module_Date                     "14 Sep 2010"
d16 1
a16 1
#define Module_ApplicationDate          "14-Sep-10"
d21 3
a23 3
#define Module_FullVersion              "0.09"
#define Module_HelpVersion              "0.09 (14 Sep 2010)"
#define Module_LibraryVersionInfo       "0:9"
@


1.10
log
@Add timeout handling to MUSBDriver, tidy code a bit
Detail:
  Makefile - rewritten to use CModule fragment instead of deprecated RAMCModule & ROMCModule fragments. Link stage also outputs symbol table to aid in debugging.
  c/cmodule, c/musb, h/musb - Add code to handle transfer timeouts
  c/musb - Fix a couple of compiler warnings, including a bug in root hub handling
Admin:
  Tested on rev C2 beagleboard.
  Machine no longer hangs on boot with hub + keyboard connected to OTG port, but keyboard often fails to initialise and needs to be *USBReset or re-plugged.


Version 0.08. Tagged as 'MUSBDriver-0_08'
@
text
@d1 1
a1 1
/* (0.08)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.08
d9 1
a9 1
#define Module_Date_CMHG                14 Aug 2010
d11 2
a12 2
#define Module_MajorVersion             "0.08"
#define Module_Version                  8
d14 1
a14 1
#define Module_Date                     "14 Aug 2010"
d16 1
a16 1
#define Module_ApplicationDate          "14-Aug-10"
d21 3
a23 3
#define Module_FullVersion              "0.08"
#define Module_HelpVersion              "0.08 (14 Aug 2010)"
#define Module_LibraryVersionInfo       "0:8"
@


1.9
log
@Update to use new bus registration API introduced in USBDriver 0.49
Detail:
  c/cmodule - Now uses USBDriver_Version to check USBDriver version number, and passes API version to USBDriver when calling USBDriver_RegisterBus to allow USBDriver to perform its side of the checks
Admin:
  Tested on rev C2 beagleboard


Version 0.07. Tagged as 'MUSBDriver-0_07'
@
text
@d1 1
a1 1
/* (0.07)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.07
d9 1
a9 1
#define Module_Date_CMHG                22 Jul 2010
d11 2
a12 2
#define Module_MajorVersion             "0.07"
#define Module_Version                  7
d14 1
a14 1
#define Module_Date                     "22 Jul 2010"
d16 1
a16 1
#define Module_ApplicationDate          "22-Jul-10"
d21 3
a23 3
#define Module_FullVersion              "0.07"
#define Module_HelpVersion              "0.07 (22 Jul 2010)"
#define Module_LibraryVersionInfo       "0:7"
@


1.8
log
@Improve reliability of OTG cable detection, add support for USBD_FORCE_SHORT_XFER, tidy code a bit
Detail:
  c/musb, h/musb - Added support for USBD_FORCE_SHORT_XFER flag. Also tidied the source a bit to use bools instead of ints for storing flags.
  c/tps, cmhg/modhead - Made OTG cable detection 100% reliable by getting rid of the USB_PRES interrupt code and instead using a ticker event to poll the STS_HW_CONDITIONS.STS_USB bit at regular intervals
Admin:
  Tested on rev C2 beagleboard


Version 0.06. Tagged as 'MUSBDriver-0_06'
@
text
@d1 1
a1 1
/* (0.06)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.06
d9 1
a9 1
#define Module_Date_CMHG                28 Jun 2010
d11 2
a12 2
#define Module_MajorVersion             "0.06"
#define Module_Version                  6
d14 1
a14 1
#define Module_Date                     "28 Jun 2010"
d16 1
a16 1
#define Module_ApplicationDate          "28-Jun-10"
d21 3
a23 3
#define Module_FullVersion              "0.06"
#define Module_HelpVersion              "0.06 (28 Jun 2010)"
#define Module_LibraryVersionInfo       "0:6"
@


1.7
log
@Fix a couple of nasty bugs in MUSBDriver
Detail:
  Allocation of bulk/interrupt endpoints has now been fixed so that two pipes won't end up claiming the same endpoint if the endpoint is idle at the time the second pipe searches for a free endpoint. Connecting multiple devices which rely on bulk endpoints (e.g. a mass storage device and a USB-LAN adaptor) now works properly.
  musb_receive_host() has also been fixed to deal with short packets properly, so devices which rely on them (e.g. USB-LAN adaptors) should now work properly.
Admin:
  Tested on rev C2 beagleboard.


Version 0.05. Tagged as 'MUSBDriver-0_05'
@
text
@d1 1
a1 1
/* (0.05)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.05
d9 1
a9 1
#define Module_Date_CMHG                20 Oct 2009
d11 2
a12 2
#define Module_MajorVersion             "0.05"
#define Module_Version                  5
d14 1
a14 1
#define Module_Date                     "20 Oct 2009"
d16 1
a16 1
#define Module_ApplicationDate          "20-Oct-09"
d21 3
a23 3
#define Module_FullVersion              "0.05"
#define Module_HelpVersion              "0.05 (20 Oct 2009)"
#define Module_LibraryVersionInfo       "0:5"
@


1.6
log
@Fix queueing of control transfers in MUSBDriver
Detail:
  The host_ep0_queue structure wasn't being initialised properly, leading to the driver failing to properly queue USB control transactions when acting in host mode. This fix should fix a number of serious soft-lock issues that can occur when using the driver (seen so far with USB mass storage devices)
Admin:
  Tested on rev C2 beagleboard


Version 0.04. Tagged as 'MUSBDriver-0_04'
@
text
@d1 1
a1 1
/* (0.04)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.04
d11 2
a12 2
#define Module_MajorVersion             "0.04"
#define Module_Version                  4
d21 3
a23 3
#define Module_FullVersion              "0.04"
#define Module_HelpVersion              "0.04 (20 Oct 2009)"
#define Module_LibraryVersionInfo       "0:4"
@


1.5
log
@Fix MUSBDriver so compiled module has correct date + version, fix assembler veneer setup code to sync the caches properly
Detail:
  cmhg/modhead - Now corrected so that the module is built with the correct version number & date, taken from the VersionNum file
  c/cmodule, s/call_veneer - init_veneer and build_veneer fixed to call OS_SyncrhoniseCodeAreas after creating the veneers
Admin:
  Tested on rev C2 beagleboard


Version 0.03. Tagged as 'MUSBDriver-0_03'
@
text
@d1 1
a1 1
/* (0.03)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.03
d9 1
a9 1
#define Module_Date_CMHG                02 Oct 2009
d11 2
a12 2
#define Module_MajorVersion             "0.03"
#define Module_Version                  3
d14 1
a14 1
#define Module_Date                     "02 Oct 2009"
d16 1
a16 1
#define Module_ApplicationDate          "02-Oct-09"
d21 3
a23 3
#define Module_FullVersion              "0.03"
#define Module_HelpVersion              "0.03 (02 Oct 2009)"
#define Module_LibraryVersionInfo       "0:3"
@


1.4
log
@MUSBDriver makefile fix for building from clean

Version 0.02. Not tagged
@
text
@d1 1
a1 1
/* (0.02)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.02
d9 1
a9 1
#define Module_Date_CMHG                28 Sep 2009
d11 2
a12 2
#define Module_MajorVersion             "0.02"
#define Module_Version                  2
d14 1
a14 1
#define Module_Date                     "28 Sep 2009"
d16 1
a16 1
#define Module_ApplicationDate          "28-Sep-09"
d21 3
a23 3
#define Module_FullVersion              "0.02"
#define Module_HelpVersion              "0.02 (28 Sep 2009)"
#define Module_LibraryVersionInfo       "0:2"
@


1.3
log
@Initial version of USB host support for MUSBDriver
Detail:
  c/tps, h/tps, Makefile - Some rather rough code to wake up the MUSB controller and cause it to enter host mode when the OTG cable is detected. Needs some tidying up and improvement to deal with any other drivers that need to interact with the TWL/TPS.
  c/musb, h/musb - Initial host-mode support for MUSBDriver. Control, bulk & interrupt endpoints are implemented. Isochronous is not. Lots of bits need improving, but it's stable enough for owners of rev B beagleboards to make use of.
  cmhg/modhead, c/cmodule - Improved debugging code
Admin:
  Tested on rev C2 beagleboard


Version 0.02. Tagged as 'MUSBDriver-0_02'
@
text
@d9 1
a9 1
#define Module_Date_CMHG                06 Sep 2009
d14 1
a14 1
#define Module_Date                     "06 Sep 2009"
d16 1
a16 1
#define Module_ApplicationDate          "06-Sep-09"
d22 1
a22 1
#define Module_HelpVersion              "0.02 (06 Sep 2009)"
@


1.2
log
@Makefile dependency fix so MUSBDriver builds properly from clean
Detail:
  Makefile - updated so o.musb depends upon h.modhead
Admin:
  Tested on rev C2 beagleboard following clean OMAP3 ROM build


Version 0.01. Not tagged
@
text
@d1 1
a1 1
/* (0.01)
d7 1
a7 1
#define Module_MajorVersion_CMHG        0.01
d9 1
a9 1
#define Module_Date_CMHG                07 Jul 2009
d11 2
a12 2
#define Module_MajorVersion             "0.01"
#define Module_Version                  1
d14 1
a14 1
#define Module_Date                     "07 Jul 2009"
d16 1
a16 1
#define Module_ApplicationDate          "07-Jul-09"
d21 3
a23 3
#define Module_FullVersion              "0.01"
#define Module_HelpVersion              "0.01 (07 Jul 2009)"
#define Module_LibraryVersionInfo       "0:1"
@


1.1
log
@Add initial version of MUSBDriver module

- Interfaces with main USBDriver module and implements software part of root hub
- Interfaces with Mentor MUSBMHDRC USB OTG controller, providing basic peripheral-mode support
@
text
@d8 2
a9 2
#define Module_MinorVersion_CMHG        $Revision:$
#define Module_Date_CMHG                02 Jul 2009
d13 2
a14 2
#define Module_MinorVersion             "$Revision:$"
#define Module_Date                     "02 Jul 2009"
d16 1
a16 1
#define Module_ApplicationDate          "02-Jul-09"
d21 2
a22 2
#define Module_FullVersion              "0.01 ($Revision:$)"
#define Module_HelpVersion              "0.01 (02 Jul 2009) $Revision:$"
@

