head	1.89;
access;
symbols
	NetBSD-1_19:1.89
	NetBSD-1_18:1.88
	NetBSD-1_17:1.87
	NetBSD-1_16:1.86
	NetBSD-1_15:1.85
	NetBSD-1_14:1.84
	NetBSD-1_13:1.84
	NetBSD-1_12:1.83
	NetBSD-1_09-1:1.82
	NetBSD-1_11:1.81
	NetBSD-1_10:1.80
	NetBSD-1_09:1.80
	NetBSD-1_08:1.79
	NetBSD-1_07:1.77
	NetBSD-1_06:1.76
	NetBSD-1_05:1.76
	NetBSD-1_04:1.75
	NetBSD-1_03:1.74
	NetBSD-1_02:1.73
	NetBSD-1_01:1.73
	NetBSD-1_00:1.73
	NetBSD-0_99:1.72
	NetBSD-0_98:1.71
	NetBSD-0_97:1.71
	NetBSD-0_96:1.70
	NetBSD-0_95:1.70
	NetBSD-0_94:1.69
	NetBSD-0_93:1.68
	NetBSD-0_92:1.67
	NetBSD-0_91:1.67
	NetBSD-0_90:1.67
	NetBSD-0_89:1.67
	NetBSD-0_88:1.66
	NetBSD-0_87:1.65
	NetBSD-0_86:1.64
	NetBSD-0_85:1.63
	NetBSD-0_84:1.63
	NetBSD-0_83:1.63
	NetBSD-0_82:1.63
	NetBSD-0_81:1.62
	NetBSD-0_80:1.61
	NetBSD-0_79:1.60
	NetBSD-0_78:1.59
	NetBSD-0_77:1.58
	NetBSD-0_76:1.57
	NetBSD-0_75:1.56
	NetBSD-0_74:1.55
	NetBSD-0_73:1.54
	NetBSD-0_72:1.53
	NetBSD-0_71:1.52
	NetBSD-0_70:1.51
	NetBSD-0_69:1.51
	NetBSD-0_68:1.50
	NetBSD-0_67:1.49
	NetBSD-0_66:1.49
	NetBSD-0_65:1.49
	NetBSD-0_64:1.48
	NetBSD-0_63:1.47
	NetBSD-0_62:1.46
	NetBSD-0_61:1.45
	NetBSD-0_60:1.44
	NetBSD-0_59:1.43
	NetBSD-0_58:1.42
	NetBSD-0_57:1.42
	NetBSD-0_56:1.41
	NetBSD-0_55:1.40
	NetBSD-0_54:1.40
	NetBSD-0_53:1.40
	NetBSD-0_52:1.40
	NetBSD-0_51:1.39
	NetBSD-0_50:1.39
	NetBSD-0_49:1.38
	NetBSD-0_48:1.38
	NetBSD-0_47:1.38
	NetBSD-0_46:1.38
	NetBSD-0_45:1.37
	NetBSD-0_44:1.36
	NetBSD-0_43:1.35
	NetBSD-0_42:1.35
	NetBSD-0_41:1.34
	NetBSD-0_40:1.33
	NetBSD-0_39:1.32
	NetBSD-0_38:1.31
	NetBSD-0_37:1.30
	NetBSD-0_36:1.29
	NetBSD-0_35:1.28
	NetBSD-0_34:1.27
	NetBSD-0_33:1.26
	NetBSD-0_32:1.25
	NetBSD-0_31:1.24
	NetBSD-0_30:1.23
	NetBSD-0_29:1.22
	RO_5_07:1.21
	NetBSD-0_28:1.21
	NetBSD-0_27:1.20
	NetBSD-0_26:1.20
	NetBSD-0_25:1.19
	NetBSD-0_24:1.18
	NetBSD-0_23:1.18
	NetBSD-0_21-1_22_2_1:1.17
	NetBSD-0_22:1.18
	USB1:1.17.0.2
	NetBSD-0_21:1.17
	NetBSD-0_20:1.17
	NetBSD-0_19:1.15
	NetBSD-0_18:1.14
	NetBSD-0_17:1.13
	NetBSD-0_16:1.12
	NetBSD-0_15:1.12
	NetBSD-0_14:1.11
	NetBSD-0_13:1.10
	NetBSD-0_12:1.10
	NetBSD-0_11:1.9
	NetBSD-0_10:1.8
	NetBSD-0_09:1.7
	NetBSD-0_08:1.7
	NetBSD-0_07:1.6
	NetBSD-0_06:1.5
	NetBSD-0_05:1.4
	NetBSD-0_04:1.3
	NetBSD-0_03:1.2
	NetBSD-0_02:1.1;
locks; strict;
comment	@# @;


1.89
date	2017.03.18.09.16.13;	author rool;	state Exp;
branches;
next	1.88;
commitid	2l0r7Njg1TXdP0Kz;

1.88
date	2016.12.17.10.12.52;	author rool;	state Exp;
branches;
next	1.87;
commitid	yws6HYEy6os04kyz;

1.87
date	2016.12.10.12.54.19;	author rool;	state Exp;
branches;
next	1.86;
commitid	zPShgPr6RkVlbrxz;

1.86
date	2016.06.21.22.04.03;	author jlee;	state Exp;
branches;
next	1.85;
commitid	kareoT4McyRIKnbz;

1.85
date	2016.06.02.21.01.13;	author rsprowson;	state Exp;
branches;
next	1.84;
commitid	Lesq5d7XLhs21W8z;

1.84
date	2016.05.02.19.14.49;	author rsprowson;	state Exp;
branches;
next	1.83;
commitid	Yalf9VtEPIFjqW4z;

1.83
date	2016.03.26.23.15.24;	author jlee;	state Exp;
branches;
next	1.82;
commitid	ec4yF5CmJMfyWc0z;

1.82
date	2016.03.04.20.54.36;	author rool;	state Exp;
branches;
next	1.81;
commitid	MvG9A9da0K4NQmXy;

1.81
date	2016.03.04.20.43.49;	author jballance;	state Exp;
branches;
next	1.80;
commitid	kgvzfwcVa0GpOmXy;

1.80
date	2015.11.17.08.54.35;	author rsprowson;	state Exp;
branches;
next	1.79;
commitid	aGTTwPGVohbkmqJy;

1.79
date	2015.11.15.09.50.41;	author rool;	state Exp;
branches;
next	1.78;
commitid	TgSd07Pyi9PAJaJy;

1.78
date	2015.11.15.09.42.38;	author rool;	state Exp;
branches;
next	1.77;
commitid	QBgP4ciWEprNGaJy;

1.77
date	2015.11.12.22.28.35;	author rsprowson;	state Exp;
branches;
next	1.76;
commitid	xXLLfyXXvY7x1RIy;

1.76
date	2015.11.04.22.20.00;	author rool;	state Exp;
branches;
next	1.75;
commitid	HzbqOzFGVg8xePHy;

1.75
date	2015.09.28.19.53.39;	author rsprowson;	state Exp;
branches;
next	1.74;
commitid	uzkkBixTPwO3C3Dy;

1.74
date	2015.09.17.16.03.43;	author rool;	state Exp;
branches;
next	1.73;
commitid	bTEnXVoCvWq6HCBy;

1.73
date	2015.08.22.08.58.44;	author rsprowson;	state Exp;
branches;
next	1.72;
commitid	Gxk8mCJ5kQ38bfyy;

1.72
date	2015.08.22.08.45.46;	author rool;	state Exp;
branches;
next	1.71;
commitid	dUK1sdsZhCgG6fyy;

1.71
date	2015.08.14.22.22.21;	author jlee;	state Exp;
branches;
next	1.70;
commitid	NGdbu548pV9NShxy;

1.70
date	2015.07.04.08.38.58;	author rsprowson;	state Exp;
branches;
next	1.69;
commitid	83feWxHUYZB0EWry;

1.69
date	2015.06.29.19.34.49;	author jlee;	state Exp;
branches;
next	1.68;
commitid	xm6CArfSWPrXqmry;

1.68
date	2015.01.06.00.04.43;	author jlee;	state Exp;
branches;
next	1.67;
commitid	tl9yMvzfmT5kyT4y;

1.67
date	2014.10.25.18.43.31;	author rsprowson;	state Exp;
branches;
next	1.66;
commitid	SYXBVhhWAW5D5CVx;

1.66
date	2014.08.29.19.26.14;	author jlee;	state Exp;
branches;
next	1.65;
commitid	f6ArfsGGibMS9iOx;

1.65
date	2014.08.12.19.02.09;	author jlee;	state Exp;
branches;
next	1.64;
commitid	FNxPAvpghRgvz6Mx;

1.64
date	2014.06.01.14.32.05;	author jlee;	state Exp;
branches;
next	1.63;
commitid	oHh05566cwiloPCx;

1.63
date	2014.04.26.11.34.10;	author jlee;	state Exp;
branches;
next	1.62;
commitid	nal1f0Yk6B22zbyx;

1.62
date	2013.07.13.17.33.24;	author rsprowson;	state Exp;
branches;
next	1.61;
commitid	vMk6UMBwDXCfMkXw;

1.61
date	2013.05.27.11.01.17;	author rsprowson;	state Exp;
branches;
next	1.60;
commitid	oiMiL7Z7wETo7gRw;

1.60
date	2013.05.25.22.16.39;	author rsprowson;	state Exp;
branches;
next	1.59;
commitid	CIRNQ3209zG4V3Rw;

1.59
date	2013.05.10.06.59.39;	author rsprowson;	state Exp;
branches;
next	1.58;
commitid	vl8blyfCfPxnk3Pw;

1.58
date	2013.03.30.23.46.23;	author jlee;	state Exp;
branches;
next	1.57;
commitid	QOU0ipH7csEsdSJw;

1.57
date	2012.12.05.01.59.17;	author jlee;	state Exp;
branches;
next	1.56;
commitid	QiGLK99lNineGYuw;

1.56
date	2012.09.19.16.03.57;	author jlee;	state Exp;
branches;
next	1.55;
commitid	dVW4qyWuIG6sP9lw;

1.55
date	2012.07.13.00.50.08;	author jlee;	state Exp;
branches;
next	1.54;
commitid	BcPnmDDFsvatXkcw;

1.54
date	2012.07.09.22.22.40;	author jlee;	state Exp;
branches;
next	1.53;
commitid	Y0MPgi404HAReWbw;

1.53
date	2012.06.24.21.55.26;	author jlee;	state Exp;
branches;
next	1.52;
commitid	4v309enDleTpz0aw;

1.52
date	2012.06.07.00.11.01;	author jlee;	state Exp;
branches;
next	1.51;
commitid	LkYeKFZjKWlNTH7w;

1.51
date	2012.02.20.20.57.05;	author rsprowson;	state Exp;
branches;
next	1.50;
commitid	SAJJ0xbfbjtvgWTv;

1.50
date	2012.02.18.15.36.15;	author rsprowson;	state Exp;
branches;
next	1.49;
commitid	tTFWWR62eUupyETv;

1.49
date	2011.12.18.18.13.56;	author jlee;	state Exp;
branches;
next	1.48;
commitid	FTilKIPWIS83qHLv;

1.48
date	2011.12.10.21.42.19;	author jlee;	state Exp;
branches;
next	1.47;
commitid	KVm6UAsJ6mTvPGKv;

1.47
date	2011.12.04.19.22.42;	author jlee;	state Exp;
branches;
next	1.46;
commitid	zwyAy3p02v2AfUJv;

1.46
date	2011.08.22.22.38.12;	author jlee;	state Exp;
branches;
next	1.45;
commitid	DX6w1a2oIxQTFywv;

1.45
date	2011.08.08.21.17.14;	author jlee;	state Exp;
branches;
next	1.44;
commitid	Hr33MiiPstM1GKuv;

1.44
date	2011.08.05.00.10.39;	author jlee;	state Exp;
branches;
next	1.43;
commitid	jZdApF1uaRruLfuv;

1.43
date	2011.05.22.20.22.27;	author jlee;	state Exp;
branches;
next	1.42;
commitid	Ye1jVWDlKivFSIkv;

1.42
date	2011.02.01.22.26.51;	author jlee;	state Exp;
branches;
next	1.41;

1.41
date	2010.11.23.22.59.26;	author jlee;	state Exp;
branches;
next	1.40;

1.40
date	2010.07.21.23.57.06;	author jlee;	state Exp;
branches;
next	1.39;

1.39
date	2010.02.28.15.57.30;	author jlee;	state Exp;
branches;
next	1.38;

1.38
date	2006.02.22.09.24.35;	author jballance;	state Exp;
branches;
next	1.37;

1.37
date	2006.01.05.12.43.04;	author jballance;	state Exp;
branches;
next	1.36;

1.36
date	2005.12.31.00.32.33;	author jballance;	state Exp;
branches;
next	1.35;

1.35
date	2005.12.05.16.02.38;	author jballance;	state Exp;
branches;
next	1.34;

1.34
date	2005.06.05.22.08.59;	author jballance;	state Exp;
branches;
next	1.33;

1.33
date	2005.05.18.11.54.02;	author jballance;	state Exp;
branches;
next	1.32;

1.32
date	2005.04.24.23.13.53;	author jballance;	state Exp;
branches;
next	1.31;

1.31
date	2005.03.05.00.24.12;	author jballance;	state Exp;
branches;
next	1.30;

1.30
date	2005.02.24.14.02.55;	author jballance;	state Exp;
branches;
next	1.29;

1.29
date	2005.02.23.00.01.58;	author jballance;	state Exp;
branches;
next	1.28;

1.28
date	2005.02.18.00.35.56;	author jballance;	state Exp;
branches;
next	1.27;

1.27
date	2005.01.31.13.45.35;	author jballance;	state Exp;
branches;
next	1.26;

1.26
date	2005.01.21.22.30.19;	author jballance;	state Exp;
branches;
next	1.25;

1.25
date	2005.01.03.01.50.01;	author jballance;	state Exp;
branches;
next	1.24;

1.24
date	2004.12.30.02.34.15;	author jballance;	state Exp;
branches;
next	1.23;

1.23
date	2004.11.25.00.54.52;	author jballance;	state Exp;
branches;
next	1.22;

1.22
date	2004.11.12.13.04.15;	author kbracey;	state Exp;
branches;
next	1.21;

1.21
date	2004.08.12.14.47.38;	author jballance;	state Exp;
branches;
next	1.20;

1.20
date	2004.06.30.14.50.34;	author kbracey;	state Exp;
branches;
next	1.19;

1.19
date	2004.05.06.15.50.21;	author bavison;	state Exp;
branches;
next	1.18;

1.18
date	2004.01.21.20.49.14;	author bavison;	state Exp;
branches;
next	1.17;

1.17
date	2004.01.07.14.07.49;	author bavison;	state Exp;
branches;
next	1.16;

1.16
date	2004.01.07.13.43.17;	author bavison;	state Exp;
branches;
next	1.15;

1.15
date	2003.06.16.14.03.48;	author bavison;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.03.10.38.13;	author bavison;	state Exp;
branches;
next	1.13;

1.13
date	2003.05.23.19.09.04;	author bavison;	state Exp;
branches;
next	1.12;

1.12
date	2003.04.23.14.10.12;	author rsprowson;	state Exp;
branches;
next	1.11;

1.11
date	2003.04.15.12.22.15;	author rsprowson;	state Exp;
branches;
next	1.10;

1.10
date	2003.04.11.09.17.42;	author rsprowson;	state Exp;
branches;
next	1.9;

1.9
date	2003.04.10.14.07.17;	author kbracey;	state Exp;
branches;
next	1.8;

1.8
date	2003.04.08.21.31.13;	author rsprowson;	state Exp;
branches;
next	1.7;

1.7
date	2003.03.02.17.05.50;	author rsprowson;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.22.11.38.35;	author kbracey;	state Exp;
branches;
next	1.5;

1.5
date	2003.02.10.19.03.03;	author dellis;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.07.22.29.44;	author dellis;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.31.12.38.56;	author dellis;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.29.10.55.54;	author dellis;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.28.10.25.50;	author dellis;	state Exp;
branches;
next	;


desc
@@


1.89
log
@Missing newline from device info printout
Detail:
  During internationalisation, the last line lost its newline.
Admin:
  Submission from Colin Granville.

Version 1.19. Tagged as 'NetBSD-1_19'
@
text
@/* Both drivers are brewed from the same sources,so can't share the same
   VersionNum file really,as a work around define them here so the CMHG
   file remains unaltered */

#define OHCIDriverModule_Module_Date_CMHG  17 Dec 2016
#define OHCIDriverModule_MajorVersion_CMHG 0.48

#define EHCIDriverModule_Module_Date_CMHG  17 Dec 2016
#define EHCIDriverModule_MajorVersion_CMHG 0.34
        
#define USBDriverModule_Module_Date_CMHG   18 Mar 2017
#define USBDriverModule_MajorVersion_CMHG  0.86
@


1.88
log
@Messages fixes, internationalisation, minor clean ups
Detail:
  USBDriver was performing unnecessary messages file reopening on Service_ResourceFSStarted (MessageTrans does this itself), remove this.
  Internationalised USBDriver, in particular its *Commands.
  Fixed standalone builds to output the messages file objects in the right place (Makefile mistake).
  Changed OHCIDriver and EHCIDriver to use allocated error bases rather than 0.
  Sync'd, where possible, the OHCIDriver and EHCIDriver sources which share a common heritage. Tentative shared interrupt support fixes for non-PCI attached controllers. Comment blocks & indentation improved.
  Export min() macro in usb_port.h.
  CMHG updated to not listen for unwanted services.
Admin:
  Submission for USB bounty.
  Tested on Pandaboard and Pi 2. OHCIDriver untested but low risk.

Version 1.18. Tagged as 'NetBSD-1_18'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   17 Dec 2016
#define USBDriverModule_MajorVersion_CMHG  0.85
@


1.87
log
@Case change to match documentation
Detail:
  DeRegisterBus->DeregisterBus. Since clients calling this SWI are compiled C or assembler, this doesn't affect existing modules which remain binary compatible.
Admin:
  Submission for USB bounty.

Version 1.17. Tagged as 'NetBSD-1_17'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  02 May 2016
#define OHCIDriverModule_MajorVersion_CMHG 0.47
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  02 May 2016
#define EHCIDriverModule_MajorVersion_CMHG 0.33
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   10 Dec 2016
#define USBDriverModule_MajorVersion_CMHG  0.84
@


1.86
log
@Revise TouchBook touchpad fix
Detail:
  build/c/usbmouse - Because the touchpad sends data that's consistent with a Boot protocol mouse, the data it sends is shorter than the expected size. This can result in bogus scroll wheel data being read from off the end of the buffer. Fix this by completely ignoring the report descriptor that the device returns and instead using a descriptor that's consistent with a Boot protocol mouse.
  build/Version - Increase USBDriver version number
Admin:
  Tested on TouchBook
  Fixes issue seen where garbage data at the end of the buffer would result in windows scrolling for every mouse interrupt


Version 1.16. Tagged as 'NetBSD-1_16'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   21 Jun 2016
#define USBDriverModule_MajorVersion_CMHG  0.83
@


1.85
log
@Fix for uninitialised wMaxPacketSize causing enumeration FS failure
The order of the new device enumeration means we have the initial device descriptor (hence bMaxPacketSize) but don't compute wMaxPacketSize until after addressing.
The XHCI HC needs this value by the addressing stage in order to setup the control endpoint context (other HC don't need it until later) so the specific case of a full speed device whose endpoint 0 has a non default max packet size would be set up using the default (of 64), then when the full device descriptor is requested the packet looks like a short transfer and the transaction ends having only collected (eg) 8 bytes. This would then appear as vendor &0000 product &0000 and not get any further.
Tested on Titanium.

Version 1.15. Tagged as 'NetBSD-1_15'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   02 Jun 2016
#define USBDriverModule_MajorVersion_CMHG  0.82
@


1.84
log
@Fix for too short a memset
Found by pattern matching, this is the same change as DWCDriver-0_27.

Version 1.13. Tagged as 'NetBSD-1_13'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   02 May 2016
#define USBDriverModule_MajorVersion_CMHG  0.81
@


1.83
log
@Don't pretend to mess with cacheability of pages
Detail:
  build/c/port - Fix vtophys requesting that pages are made uncacheable. They're already uncacheable (all allocated via PCI_RAMAlloc), and once we're done with the pages we never do a 'make cacheable' call to balance it out
  build/Version - Bump version numbers of modules which use vtophys
Admin:
  Untested


Version 1.10. Tagged as 'NetBSD-1_10'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  26 Mar 2016
#define OHCIDriverModule_MajorVersion_CMHG 0.46
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  26 Mar 2016
#define EHCIDriverModule_MajorVersion_CMHG 0.32
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   15 Nov 2015
#define USBDriverModule_MajorVersion_CMHG  0.80
@


1.82
log
@Revert accidental commits
Admin:
  These changes are currently subject to rework via the normal submissions channel.
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  17 Nov 2015
#define OHCIDriverModule_MajorVersion_CMHG 0.45
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  17 Nov 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.31
@


1.81
log
@  Updated module versions to better identify recent changes
Admin:


Version 1.11. Tagged as 'NetBSD-1_11'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  04 Mar 2016
#define OHCIDriverModule_MajorVersion_CMHG 0.46
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  04 Mar 2016
#define EHCIDriverModule_MajorVersion_CMHG 0.32
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   04 Mar 2016
#define USBDriverModule_MajorVersion_CMHG  0.81
@


1.80
log
@Don't build a veneer that points to nothing
The safety struct fillers added in OHCIDriver 0.44 and EHCIDriver 0.30 respectively were being carefully replaced by veneers to nothing. Skip veneer generation is the method isn't implemented.

Version 1.09. Tagged as 'NetBSD-1_09'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  17 Nov 2015
#define OHCIDriverModule_MajorVersion_CMHG 0.45
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  17 Nov 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.31
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   15 Nov 2015
#define USBDriverModule_MajorVersion_CMHG  0.80
@


1.79
log
@Init structures for OHCI & EHCI unused members
Detail:
  Play safe, put NULLs in for the unused HC overrides.

Version 1.08. Not tagged
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  15 Nov 2015
#define OHCIDriverModule_MajorVersion_CMHG 0.44
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  15 Nov 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.30
@


1.78
log
@Add support for HC with hardware enumerate phase
Detail:
  Support controllers such as the XHCI which perform some steps of enumeration themselves in hardware, thereby needing some steps of the software enumeration to be bypassed.
  usb.c:
    Internally permit addr of 0, to represent the root hub, since the controller is responsible for allocating 1+. Merged from NetBSD 1.144.
  usb_subr.c:
    Test pointers against NULL not 0. Merged from NetBSD 1.191.
    Add 4 new bus methods, for prior to enumeration, address assignment phase, post enumeration fixup, and device removal.
  usbdivar.h:
    Prototypes of 4 new bus methods.
Admin:
  HC API version number bumped.
  Submission from Elesar.

Version 1.08. Tagged as 'NetBSD-1_08'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  22 Aug 2015
#define OHCIDriverModule_MajorVersion_CMHG 0.43
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  04 Nov 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.29
@


1.77
log
@Resolve porting mistake on initial bus registration
On first registering a new bus in the the NetBSD build of the code usb_kthread_create(usb_create_event_thread, sc) is called which in turn creates the main event thread ("usb_event_thread").
The first thing usb_event_thread() does is set
  sc->sc_bus->needs_explore = 1;
  usb_discover(sc);
however in the RISC OS version of the code (usb.c around line 254) only the first action is performed, no discover happens.
This change schedules a callback via usb_needs_explore_callback() which in turn calls discover_callback() when the OS is next free, which calls usb_discover() for each bus in an equivalent way to NetBSD's event thread. There's then no longer any need for the special one-shot 11s rediscover callback, only the repeating 30s rediscover is needed.

For reference, the places that set needs_explore in this version are all in usb.c
  Line 254: set, but doesn't schedule a callback, as noted above
  Line 339: code not compiled for __riscos
  Line 548: set, does schedule a callback
  Line 727: cleared, in usb_discover()
  Line 743: set, does schedule a callback
  Line 756: code not called in RISC OS

NetBSD uses 500ms initial delay before discover, then 60s between discovers (or until requested by a hub, whichever is sooner).
RISC OS has a periodic callback of 30s (in usbmodule.c) and an initial discover of however long it is from the bus being registered until callbacks next fire usb_event_thread(), assumed ~500ms.

Version 1.07. Tagged as 'NetBSD-1_07'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   12 Nov 2015
#define USBDriverModule_MajorVersion_CMHG  0.79
@


1.76
log
@Add support for HAL_USBPortPower to EHCI host controller
Detail:
  When signalled as a feature of the HAL device, call HAL_USBPortPower to turn on the port.
Admin:
  Submission from Willi Theiss.

Version 1.05. Tagged as 'NetBSD-1_05'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   28 Sep 2015
#define USBDriverModule_MajorVersion_CMHG  0.78
@


1.75
log
@Internationalisation, help, and syntax improvments
Assign a proper error number and translate "Incompatible USBDriver version".
Don't bother internationalising the *commands which are for debug builds only.
Rephrase the help for USBQuirk so it makes sense, and trim the unmatched '<' from the syntax example.
Bracket the USBDiscover help with the same switch that governs the code, which has been disabled for over a decade.

Version 1.04. Tagged as 'NetBSD-1_04'
@
text
@d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  22 Aug 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.28
@


1.74
log
@Update table of device quirks
Detail:
  From NetBSD usb_quirks.c revision 1.81.
  usbmodule: NULL is for pointer types, not ints.
  usb_quirks: Group the RISC OS specific ones together, disable the non applicable UQ_APPLE_ISO ones, UQ_LOST_CS_DESC doesn't apply either but is only used for USB modem drivers not ported here. Untangle ifdefs around usbd_find_quirk().
Admin:
  Removed unused source file ums.c

Version 1.03. Tagged as 'NetBSD-1_03'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   17 Sep 2015
#define USBDriverModule_MajorVersion_CMHG  0.77
@


1.73
log
@Add some missing struct members
From NetBSD dev/usb/usbdivar.h 1.109.
As these extra members change the struct layout, bump the API version number too. Having carefully analysed which headers are actually required by host controllers (in NetBSD-0_98) also be explicit about them in Hdr/USBDriver rather than the former vague comment in h/usbdivar.

Hdr/USBDriver:
  Relocate API define here.
usbmodule.c:
  Include USBDriver.h to get the API define.
usbdivar.h:
  Add struct members from recent NetBSD.

Version 1.00. Tagged as 'NetBSD-1_00'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   22 Aug 2015
#define USBDriverModule_MajorVersion_CMHG  0.76
@


1.72
log
@Fix to interface matching function
Use -1 as the invalid mark, so that an accidental match on interface=0 alternate=0 is no longer possible.
Submission from Colin Granville.

Version 0.99. Tagged as 'NetBSD-0_99'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  05 Jan 2015
#define OHCIDriverModule_MajorVersion_CMHG 0.42
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  14 Aug 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.27
d12 1
a12 1
#define USBDriverModule_MajorVersion_CMHG  0.75
@


1.71
log
@Add memory barriers
Detail:
  dev/usb/h/usb_port - Implement usb_syncmem to call the appropriate memory barrier function. Required for when PCI_RAMAlloc starts returning Normal, non-cacheable memory rather than Device (although technically these barriers have always been needed for ARMv6+)
  build/c/port - Memory barrier implementation; uses the appropriate OS routine if available, otherwise uses a null op.
  build/Version - Bump EHCIDriver version number (the only module that uses these barriers so far)
Admin:
  Tested on BB-xM, PandaBoard


Version 0.97. Tagged as 'NetBSD-0_97'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   04 Jul 2015
#define USBDriverModule_MajorVersion_CMHG  0.74
@


1.70
log
@Fix to system variable launch & debug build
ohcimodule.c:
 Variable renamed so it builds with debug enabled.
usbmodule.c:
 Tighten up the logic deciding when to launch a USB$<thing> variable, previously it would be launched both for the initial device attach and then again for each interface.
 Remove local <stdlib.h> function prototypes.
 Reindent to 4 spaces to match the rest of the file.
 Fix confusion of ->dv_unit being an int not a pointer.
Submission from Colin Granville. Built, but not tested.

Version 0.95. Tagged as 'NetBSD-0_95'
@
text
@d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  05 Jan 2015
#define EHCIDriverModule_MajorVersion_CMHG 0.26
@


1.69
log
@Handle absolute pointing devices in a more sensible manner
Detail:
  build/c/usbmouse - For absolute pointing devices, use the PointerV_Report "Abso" call to report absolute positions instead of relative
  build/Version - Bump USBDriver version number
Admin:
  Based on code supplied by Chris Mahoney; allows USB touchscreens such as the Adafruit AR1100 to work under RISC OS
  Tested locally in an Iyonix ROM build (with regular mouse)


Version 0.94. Tagged as 'NetBSD-0_94'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   29 Jun 2015
#define USBDriverModule_MajorVersion_CMHG  0.73
@


1.68
log
@Deregister IRQ handlers in Service_PreReset
Detail:
  build/c/ehcimodule, build/c/ohcimodule - Deregister IRQ handlers in Service_PreReset. Fixes a hang during reset on OMAP4.
  build/Version - Bump module version numbers for recent changes.
Admin:
  Tested on Pandaboard, Iyonix


Version 0.93. Tagged as 'NetBSD-0_93'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   02 Jan 2015
#define USBDriverModule_MajorVersion_CMHG  0.72
@


1.67
log
@Update to use rationalised power and overcurrent API
OHCIDriver (only) had sketchy support for a HAL based scheme for controlling the port power and monitor overcurrent. However the implementation was limited to supporting the single port required for an embedded product (aka Rhenium in the CVS history). The change makes it follow a model much more akin to the HAL_TimerDevice/HAL_TimerIRQStatus/HAL_TimerIRQClear set of functions.
Version:
  Bumped OHCIDriver and USBDriver version numbers.
ohcimodule.c:
  Use some defines from OsBytes.h.
  Group the debug variables within the OHCI_DEBUG define so they go away in the release case.
  Allow for up to 15 ports to be controlled via the revised HAL API, and pass something other than a hardwired controller of 0 when controlling/monitoring power.
  Enumerate the device numbers for overcurrent monitoring on startup.
  Deal with the possibility of one (or more) of the device numbers being shared interrupts.
  Squash a few trivial compiler warnings.
ohcimodhead.cmhg:
  rename the handler/entry to reflect their use for overcurrent
ohci.c:
  Allow for up to 15 ports to be controlled by passing in the port index where needed.
usb_subr.c/usbdivar.h:
  Remove a RISC OS-ism in datatoggle, to converge with NetBSD a bit.
ehcivar.h/usb_port.h:
  Relocate the overrides for mutex_ functions here since this is the only controller using them. Previously when in "usb_port.h" they would indirectly get dragged in ia the nested include in "usb.h". The could in fact now be implemented using SyncLib, an exercise left to the reader.
usb.h
  Merge some of the device classes and other allocations from NetBSD.

While it's not been possible to test the revised API, due to not having sight of the original platform on which it was implemented, none of the actively maintained HALs currently use the HAL based power and overcurrent scheme anyway, so the new code never gets called. In that respect, it's no more broken then the previous single port-single controller version.

Version 0.89. Tagged as 'NetBSD-0_89'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  25 Oct 2014
#define OHCIDriverModule_MajorVersion_CMHG 0.41
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  29 Aug 2014
#define EHCIDriverModule_MajorVersion_CMHG 0.25
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   25 Oct 2014
#define USBDriverModule_MajorVersion_CMHG  0.71
@


1.66
log
@Merge in some EHCI fixes from NetBSD. Other minor changes.
Detail:
  build/Version - Bump EHCIDriver version number
  build/c/ehcihal, build/c/ehcimodule, build/c/ohcimodule - Use the HAL USB controller type & flag definitions from Hdr:HALEntries instead of using magic numbers
  build/c/ehcimodule - Avoid double-read of hardware register in debug version of bus_space_read_4(); ensures that we report the value that's actually returned to the driver
  dev/usb/c/ehci - Merge in the following revisions from NetBSD:
  - 1.172, 1.173, 1.178, 1.193 - Support for controllers with embedded transaction translators
  - 1.174 - alloc_sqtd_chain() fix for short packets that end on page boundaries
  - 1.179 - ehci_set_qh_qtd() fixed to terminate alternate next qTD pointer with EHCI_NULL, not 0
  dev/usb/h/ehcireg - Updated to latest NetBSD version (1.34)
  dev/usb/h/ehcivar - Merge in revision 1.38 (ETTF support)
Admin:
  Tested on BB-xM


Version 0.88. Tagged as 'NetBSD-0_88'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  30 Mar 2013
#define OHCIDriverModule_MajorVersion_CMHG 0.40
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   12 Aug 2014
#define USBDriverModule_MajorVersion_CMHG  0.70
@


1.65
log
@Include device speed in *USBDevInfo output. Corrections to header export.
Detail:
  build/c/usbmodule - Improve *USBDevInfo to display the devices connection speed
  build/h/USBDevFS - Correct device speed listing to match reality
  build/Version - Bump USBDriver version number
Admin:
  Tested on Raspberry Pi


Version 0.87. Tagged as 'NetBSD-0_87'
@
text
@d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  30 Mar 2013
#define EHCIDriverModule_MajorVersion_CMHG 0.24
@


1.64
log
@Updated to latest usbdevs file from NetBSD
Detail:
  dev/usb/usbdevs - Updated to the latest version from the NetBSD CVS, mainly for several new DisplayLink product IDs. Merged in our TouchBook definitions from rev 1.5, and commented out a couple of duplicate products.
  dev/usb/c/usb_quirks - Updated to cope with MetaGeek vendor being renamed to Misc
  build/Version - Bump USBDriver version number
Admin:
  Tested in OMAP3 ROM build


Version 0.86. Tagged as 'NetBSD-0_86'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   01 Jun 2014
#define USBDriverModule_MajorVersion_CMHG  0.69
@


1.63
log
@Merge in latest usbd_new_device() changes from NetBSD
Detail:
  dev/usb/c/usb_subr - Merge in latest usbd_new_device() changes from NetBSD (rev 1.196). This primarily changes around the order of the SET_ADDRESS and descriptor get calls, as well as changing the descriptor get to request 64 bytes of data instead of 8.
  build/Version - Bump USBDriver version number
Admin:
  Tested on BB-xM, Raspberry Pi, Iyonix ROM softload
  Fixes issue reported on forums with Raspberry Pi Model A not initialising correctly when connected as a device. Previously it was getting stuck fetching the descriptors after setting the address.
  http://www.riscosopen.org/forum/forums/5/topics/2534


Version 0.82. Tagged as 'NetBSD-0_82'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   26 Apr 2014
#define USBDriverModule_MajorVersion_CMHG  0.68
@


1.62
log
@Ensure state consistent for restarting a transfer within a callback
Merge of code change from revision 1.152 of usbdi.c from NetBSD, function usb_transfer_complete - this just swaps the ordering around to ensure the callback & done are in the right order.
Built, but not tested.

Version 0.81. Tagged as 'NetBSD-0_81'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   13 Jul 2013
#define USBDriverModule_MajorVersion_CMHG  0.67
@


1.61
log
@Improvements to interface/alternate matching from partially specified special strings
Previously, if an endpoint was specified the endpoint type would be matched as type BULK even if that wasn't the case for the given endpoint number.
Also, the find_interface_and_endpoint could exit without assigning the alternate.

Line 2001: only search for BULK when neither the type nor endpoint were given
Line 2028: take the first match on any fields that were given, assign all 3 return values
Line 2094: remove some dead code, 'ep' is not read by find_interface_and_endpoint, so no need to initialise it

Test case
  OPENIN "devicefs#endpoint1;size8:USB1"
now gets the actual endpoint_type of the device, rather than BULK all the time.

Changes from Colin, ref http://www.riscosopen.org/forum/forums/3/topics/1895


Version 0.80. Tagged as 'NetBSD-0_80'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   27 May 2013
#define USBDriverModule_MajorVersion_CMHG  0.66
@


1.60
log
@Fix for out-by-1 error on incoming transfer
No transfer occurred if maxpacketsize exactly equalled the free space in the buffer.
Changes from Colin, ref http://www.riscosopen.org/forum/forums/3/topics/1895
Module version number bumped.

Version 0.79. Tagged as 'NetBSD-0_79'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   25 May 2013
#define USBDriverModule_MajorVersion_CMHG  0.65
@


1.59
log
@Fix for potential NULL pointer dereference
Spotted by Colin http://www.riscosopen.org/forum/forums/4/topics/1874
Built, but not tested.

Version 0.78. Tagged as 'NetBSD-0_78'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   10 May 2013
#define USBDriverModule_MajorVersion_CMHG  0.64
@


1.58
log
@Add re-entrancy check to USBDriver registration
Detail:
  build/c/ehcimodule, build/c/ohcimodule - Added a re-entrancy check to USBDriver registration, to avoid shenanigans if we receive "USBDriver has started" service calls while in the middle of registering
  build/Version - Bump EHCIDriver & OHCIDriver versions & dates
Admin:
  Tested on BB-xM
  Doesn't fix any known EHCIDriver/OHCIDriver-related issues, but is the same fix as was made to DWCDriver after the above-mentioned problem was found to be the cause of a hang on boot in recent Pi ROMs


Version 0.77. Tagged as 'NetBSD-0_77'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   04 Dec 2012
#define USBDriverModule_MajorVersion_CMHG  0.63
@


1.57
log
@Let other keyboard drivers know when the last USB keyboard is disconnected
Detail:
  build/c/usbkboard - detach_keyboard() now issues KeyV_KeyboardRemoved when the last keyboard is removed, to provide a hint to other keyboard drivers (e.g. PandoraKey) that they can reclaim KeyV.
  build/Version - Increased USBDriver version number
Admin:
  Tested on Pandora


Version 0.76. Tagged as 'NetBSD-0_76'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  24 Jun 2012
#define OHCIDriverModule_MajorVersion_CMHG 0.39
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  24 Jun 2012
#define EHCIDriverModule_MajorVersion_CMHG 0.23
@


1.56
log
@Fix one read at the filesystem level turning into two transfers at the USB level
Detail:
  build/c/usbmodule - The introduction of the delayed_read flag brought with it a bug, whereby performing one read at the filing system level would result in two transfers at the USB level: One transfer triggered by the RxWakeUp device call, and a second read triggered by the Resume device call once the devices buffer becomes empty.
  To counter this a new read_status variable is used to track the state of the filesystem-level transfer; idle, busy, or complete. Only start_read calls triggered by RxWakeUp are able to start new filesystem-level transfers, while Resume is only able to continue transfers which had been paused due to lack of buffer space.
  Additionally if a RxWakeUp call is received before the previous transfer had finished, the read amount is now buffered correctly, and the read count/padding count will only be reset once the new read actually starts.
  Also made DeviceFS-level debug output more verbose and useful; most read/write debug output now lists the associated usbd_xfer_handle, making it easier to track transfers once they enter the NetBSD layer.
  build/Version - Increase USBDriver version number
Admin:
  Tested on BB-xM
  FTDIDriver now apears to work correctly again


Version 0.75. Tagged as 'NetBSD-0_75'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   19 Sep 2012
#define USBDriverModule_MajorVersion_CMHG  0.62
@


1.55
log
@Make delayed_read handling more robust
Detail:
  build/c/usbmodule - read_cb() now explicitly clears the delayed_read flag, and only issues a delayed read if the pipe isn't a repeating type
  build/Version - Increased USBDriver version number
Admin:
  Tested on BB-xM


Version 0.74. Tagged as 'NetBSD-0_74'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   13 Jul 2012
#define USBDriverModule_MajorVersion_CMHG  0.61
@


1.54
log
@Make get_transfer_info() take into account any delayed xfer
Detail:
  build/c/usbmodule - If there's a read xfer which has been delayed due to RxWakeup being called before the previous xfer had finished (e.g. while inside a buffer filling upcall), report the transfer as having not finished yet. Should match the old behaviour before the delayed reads were introduced.
  build/Version - Increment USBDriver version number
Admin:
  Tested briefly on BB-xM


Version 0.73. Tagged as 'NetBSD-0_73'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   09 Jul 2012
#define USBDriverModule_MajorVersion_CMHG  0.60
@


1.53
log
@Fix null pointer dereferences. Add protection against DeviceFS xfers being multiply inserted into their pipes xfer queue.
Detail:
  build/Version - Increased version numbers
  build/c/ehcimodule, build/c/ohcimodule - Fixed null pointer dereferences in debug code
  build/c/port, build/s/triggercbs - Fix debug code in tsleep() using hardcoded IRQsema ptr. Now requests the right pointer from build/s/triggercbs.
  build/c/usbmodule - Fix null pointer deferences in debug code and MonitorTX/MonitorRX handlers. Add xfer_busy and delayed_read flags to devstream struct in order to track whether the xfer associated with the stream is busy or not. Previously if the TxWakeUp/RxWakeUp device calls were made on a stream which already had an active xfer, the xfer would end up being inserted in the USB pipes xfer queue twice, creating a circular reference, resulting in (at the least) infinite loops in usbd_dump_queue() when debugging is enabled. Now, in the case of reads, a second read will automatically be issued once the first completes, while in the case of writes, the write request will simply be ignored. This isn't a proper fix for all the shortcomings of the DeviceFS interface, but at least the code is now a little bit safer.
Admin:
  Tested on Raspberry Pi with high processor vectors


Version 0.72. Tagged as 'NetBSD-0_72'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   24 Jun 2012
#define USBDriverModule_MajorVersion_CMHG  0.59
@


1.52
log
@Make RHENIUM build switch go away. Misc housekeeping
Detail:
  build/Makefile, build/!MkDebug,fd7 - Debug versions of the modules can now be built just by passing "DEBUG=TRUE" to amu
  build/!MkRhenium,fd7 - Deleted obsolete file
  build/Version - Increased version numbers
  build/c/ehcihal, build/c/ehcimodule, build/c/ohcimodule - Only accept USB controllers if HAL_USBControllerInfo says the struct size is an exact match with what we expect. Rework USB controller enumeration to allow modules to properly support both PCI and HAL controllers being available on the same machine, and without RHENIUM switch (module sources only).
  build/c/ehcimodule - Get rid of remaining RHENIUM bits; RHENIUM flag no longer needed for 32bit wide register reads/writes to be supported
  build/c/ohcimodule, build/cmhg/ohcimodhead, dev/usb/c/ohci - Get rid of remaining RHENIUM bits; RHENIUM flag no longer needed for HAL port power controls to be supported.
  build/c/usbhal, build/c/usbmodule, dev/usb/c/uhub, dev/usb/h/usb_port - Get rid of empty riscos_failed_device function
  build/s/call_veneer, build/s/triggercbs - Use Entry/EXIT macros to avoid single-reg LDM/STM performance warnings. Convert tabs to spaces.
  dev/usb/h/usb - Get rid of RHENIUM switch on USB_PORT_RESET_DELAY. Now always uses non-RHENIUM value of 100ms.
Admin:
  Tested on rev A2 BB-xM, Iyonix, Raspberry Pi


Version 0.71. Tagged as 'NetBSD-0_71'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  06 Jun 2012
#define OHCIDriverModule_MajorVersion_CMHG 0.38
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  06 Jun 2012
#define EHCIDriverModule_MajorVersion_CMHG 0.22
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   06 Jun 2012
#define USBDriverModule_MajorVersion_CMHG  0.58
@


1.51
log
@Use the passed buffer limit rather than 255.
Avoids potential buffer overrun, since the actual buffers are 128 at the moment.

Version 0.69. Tagged as 'NetBSD-0_69'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  04 Dec 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.37
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  18 Dec 2011
#define EHCIDriverModule_MajorVersion_CMHG 0.21
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   20 Feb 2012
#define USBDriverModule_MajorVersion_CMHG  0.57
@


1.50
log
@Add some more usbdevs from the NetBSD sources.
In particular, the SMSC ethernet controller and hub on the Beagleboard
xm.
Changed pointer assignments & comparisons with 0 to be NULL for clarity.
Implement a left trim function for any printed out strings obtained from
the device (to mirror usbd_trim_spaces) so that when dopey manufacturers
use a space instead of their company name everything lines up still.

Version 0.68. Tagged as 'NetBSD-0_68'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   18 Feb 2012
#define USBDriverModule_MajorVersion_CMHG  0.56
@


1.49
log
@Add workaround for what looks like a bug in the DM37x EHCI controller
Detail:
  dev/usb/c/ehci - Force all EHCI data buffers to be 512 byte aligned.
  This is a workaround for what I believe is a bug in the DM37x EHCI controller - It looks like if the last packet of a bulk in transfer is a short packet, and that packet crosses a page boundary, then the second half of the packet doesn't seem to be written out to the correct address in memory.
  Version - increased EHCI module version number
Admin:
  Tested on rev A2 BB-xM
  Fixes issue reported on forums with unreliable USB ethernet:
  http://www.riscosopen.org/forum/fourms/5/topics/828#posts-9691


Version 0.65. Tagged as 'NetBSD-0_65'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   10 Dec 2011
#define USBDriverModule_MajorVersion_CMHG  0.55
@


1.48
log
@Improve scrollwheel handling
Detail:
  build/c/usbmouse - Scrollwheel code now only sends scroll requests in a given direction if the window has an appropriate scroll bar.
  build/Version - Incremented USBDriver version number
Admin:
  Tested in OMAP3 ROM
  Fixes issue reported on forums where it was possible to scroll filer windows horizontally if you used a mouse with a 'w' axis


Version 0.64. Tagged as 'NetBSD-0_64'
@
text
@d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  04 Dec 2011
#define EHCIDriverModule_MajorVersion_CMHG 0.20
@


1.47
log
@Fix memory overwrites in root hub emulation
Detail:
  dev/usb/c/ehci, dev/usb/c/ohci - Fixed device descriptor and config descriptor reads writing outside the destination buffer if the buffer was small enough.
  build/Version - Incremented EHCI & OHCI version numbers & dates
Admin:
  Tested in OMAP3 ROM & Iyonix ROM softload


Version 0.63. Tagged as 'NetBSD-0_63'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   22 Aug 2011
#define USBDriverModule_MajorVersion_CMHG  0.54
@


1.46
log
@Update HAL USB code for new HAL_KbdScanInterrupt behaviour. Fix data aborts during keyboard scanning.
Detail:
  build/c/usbhal, build/h/usbhal - Updated USBHAL_KbdScanInterrupt to behave the same way HAL_KbdScanInterrupt is now expected to behave.
  build/c/ehci, build/c/ohci - Fixed some root hub emulation code which was writing to a global structure before copying it into the destination buffer. Although this works fine in ROM modules it was causing data aborts in the USB HAL libraries due to lack of automatic RW data relocation by the compiler.
  build/Version - Updated version numbers
Admin:
  Tested on rev C2 BB.


Version 0.62. Tagged as 'NetBSD-0_62'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  22 Aug 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.36
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  22 Aug 2011
#define EHCIDriverModule_MajorVersion_CMHG 0.19
@


1.45
log
@Fix null pointer access in OHCIDriver
Detail:
  build/c/ohcimodule - Not all PCI_ReadInfo calls were checking for null pointers afterwards, leading to strncpy being called with a null source
  build/Version - Updated OCHIDriver version number
Admin:
  Tested in Iyonix ROM softload


Version 0.61. Tagged as 'NetBSD-0_61'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  08 Aug 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.35
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  05 Aug 2011
#define EHCIDriverModule_MajorVersion_CMHG 0.18
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   05 Aug 2011
#define USBDriverModule_MajorVersion_CMHG  0.53
@


1.44
log
@Update to work with zero page relocation. Remove ability to cancel transfers by pressing escape
Detail:
  build/c/port - Removed ability to cancel transfers by pressing escape. Too dangerous for things like mass storage devices, and the code won't work anyway for the common case of being in the wimp
  build/s/triggercbs - Try using OS_ReadSysInfo 6 to get IRQsema ptr before falling back on legacy address
  build/Version - Updated version numbers
Admin:
  Tested on rev A2 BB-xM


Version 0.60. Tagged as 'NetBSD-0_60'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  05 Aug 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.34
@


1.43
log
@Add the ability to build the USB drivers as HAL-compatible static libraries
Detail:
  build/Makefile, build/OBJEHCIDriver, build/OBJOHCIDriver, build/OBJUSBDriver - Modified makefiles to build the HAL libs during the export libs phase
  build/!MkHAL,fd7 - Handy script for building the HAL libs
  build/Hdr/usbhal - Header containing definitions for the assembler code. Also gets exported so that HALs know how much workspace to reserve.
  build/c/usbhal - HAL version of usbmodule.c & port.c. Also contains the keyboard scan code, adapted from the code in the Tungsten HAL.
  build/s/porthal - Assembler versions of some port.c routines that were easier to do in assembler than C
  build/s/halheap - OS_Heap code that's been adapted for use in the HAL. Could easily be changed into a standalone library instead of being part of the HAL USB libs. Supports memory-efficient allocation of aligned blocks.
  build/c/ehcihal - HAL version of ehcimodule.c. Currently only supports EHCI controllers exposed via HAL_USBControllerInfo (i.e. no PCI support)
  build/c/ehcimodule, build/c/ohcimodule, build/c/port - Moved riscos_irq_clear into port.c. Removed unused microtime() function.
  build/c/usbmouse - Strip out some debug-related code in non-debug builds
  build/Version - Updated version numbers
  dev/usb/c/ehci, dev/usb/h/ehcivar - Adapted to add support for the HAL build. Apart from the base changes, the code has also been tweaked to significantly reduce the amount of memory used at runtime by the HAL version of the driver.
  dev/usb/c/hid, dev/usb/c/uhub, dev/usb/c/usb, dev/usb/c/usb_quirks, dev/usb/c/usb_subr, dev/usb/c/usbdi, dev/usb/c/usbdi_util, dev/usb/c/usbroothub_subr - Changes to support HAL builds. Mainly disabling bits that won't work in the HAL or disabling bits for RISC OS in general if they weren't being used in the first place.
  dev/usb/c/ohci, dev/usb/h/ohcivar - Basic changes to support HAL builds. However HAL OHCI support is still incomplete.
  dev/usb/h/usb_port - Added support for the HAL build. Also tweaked logprintf definition to get rid of logprintf calls entirely in non-debug builds.
  dev/usb/h/usbdivar - Added support for the HAL build.
  dev/usb/h/usbhal - New header used by the HAL build. Gets included by every C file to ensure the compiler doesn't use sb, and contains structs/macros to allow access to the shared workspace.
Admin:
  HAL & non-HAL builds tested on rev C2 BB, rev A2 BB-xM, rev C1 TouchBook.
  Non-HAL builds tested with Iyonix ROM softload.
  Needs latest Kernel source for OSEntries.h export.


Version 0.59. Tagged as 'NetBSD-0_59'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  22 May 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.33
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  22 May 2010
#define EHCIDriverModule_MajorVersion_CMHG 0.17
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   22 May 2011
#define USBDriverModule_MajorVersion_CMHG  0.52
@


1.42
log
@Fix modules so resources don't get included twice in ROM builds
Detail:
  A couple of the USB modules were including their resources both in the Messages module and within themselves, leading to wasted ROM space
  build/OBJOHCIDriver, build/OBJUSBDriver - Tweaked makefiles so that ohcimsgs.o and usbmsgs.o only get built/linked for RAM builds
  build/c/usbmodule - Fix erroneous attempt to free non-registered resource files in ROM builds
  Version - Increased OHCIDriver & USBDriver version numbers
Admin:
  Tested with Iyonix ROM softload. Saves approx 48k of ROM space.
  Fixes bug #265


Version 0.57. Tagged as 'NetBSD-0_57'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  01 Feb 2011
#define OHCIDriverModule_MajorVersion_CMHG 0.32
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  18 Jul 2010
#define EHCIDriverModule_MajorVersion_CMHG 0.16
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   01 Feb 2011
#define USBDriverModule_MajorVersion_CMHG  0.51
@


1.41
log
@Fix a few USBDriver bugs
Detail:
  build/c/usbdi - Fix compiler warning in usbd_clear_endpoint_stall()
  build/c/usbmodule - Fix detach_device() to deregister any pending attach callback for the detaching device. Fixes crash seen when inserting 16GB USB stick into EHCI port of rev C2 beagleboard (a current surge or something causes the stick to immediately disconnect then reconnect, but the disconnect occurs before the initial attach callback)
  build/c/usbmodule - Fix device_initialise() to use a timeout of 0 if no timeout was specified in the DeviceFS special field
  build/c/usbmodule - Fix the new read_cb() buffer padding logic to only pad up to totalcount instead of filling the entire buffer
Admin:
  Tested on rev C2 beagleboard.
  This seems to fix the problems that were preventing Steffen Huber's USB CD code from working properly.


Version 0.56. Tagged as 'NetBSD-0_56'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  18 Jul 2010
#define OHCIDriverModule_MajorVersion_CMHG 0.31
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   23 Nov 2010
#define USBDriverModule_MajorVersion_CMHG  0.50
@


1.40
log
@Update EHCI driver to NetBSD latest (as of 10/07/2010), improve DeviceFS interface
Detail:
  EHCI driver update:
    dev/usb/c/ehci - Updated to latest NetBSD version, except for revisions 1.134 and 1.135 which are too invasive to merge in without updating the rest of the USB stack. This new version brings lots of bug fixes, and adds (untested on RISC OS) support for EHCI isochronous transfers.
    dev/usb/h/ehcivar - Updated to latest NetBSD version, except for the sc_bus splitting that was held back from the ehci.c update
    dev/usb/h/usb, dev/usb/h/usbdi, dev/usb/usbdivar - partial update to latest as required/possible
    dev/usb/c/usb_quirks, dev/usb/h/ehcireg, dev/usb/h/usb_mem, dev/usb/h/usb_quirks, dev/usb/h/usbhid, dev/usb/usbdevs, dev/usb/devlist2h.awk, dev/wscons/h/wsconsio, dev/wscons/h/wsmousevar - Updated to latest NetBSD versions
    dev/usb/c/usbroothub_subr, dev/usb/h/usbroothub_subr - New files brought in from NetBSD sources for use with new EHCI driver
    build/objehcidriver - Added usbroorhub_subr to EHCI driver
    dev/usb/h/usb_port - Added extra dummy functions as required by new EHCI driver
    dev/build/c/port - Added extra parameter to callout_init as required by new EHCI driver
  DeviceFS improvements:
    build/c/usbmodule - Added DeviceFSCallDevice_GetHandles2 as a replacement for Thomas Milius's backwards-incompatible GetHandles changes. Added DeviceFSCallDevice_GetSetOptions call to control RX padding and TX force-short-xfer features. These features can also be controlled at endpoint creation time by new fields in the filename. Also fixed packet padding to not fill the buffer with garbage or potentially crash when the padded area is more than one packet in length.
  New bus registration API:
    Changes made to the data structures that are shared between the modules means that new checks are needed to ensure USB modules with incompatible APIs are not used with one another.
    build/h/usbdivar - Since this seems to be the file containing the main structures that are shared, it now has a #define at the top indicating the first version of the USBDriver module that implemented the data structures within. This version number is used to check that the driver modules are compatible.
    build/cmhg/usbmodhead, build/h/usbdriver, build/c/usbmodule - Add a new SWI, USBDriver_Version, to return the version number of the USBDriver module. Used for both intra-stack API version checks and can be useful for external code that wants to query DeviceFS feature availability.
    build/c/usbmodule, build/c/ehcimodule, build/c/ohcimodule - Updated USBDriver_RegisterBus SWI and the code that calls it to pass the API version number (as defined in usbdivar.h) to USBDriver when attempting to reigster the bus. USBDriver then ensures the version matches that of itself, and if not refuses to allow the bus to register. EHCI & OHCI modules also check that USBDriver is new enough to implement this behaviour via the USBDriver_Version SWI.
  And finally:
    build/version - Incremented module version numbers.
    build/doc/usb - Updated with details of new features
Admin:
  Tested in ROM softload on Iyonix & beagleboard. Beagleboard hub issues seem to be resolved, and there are no new bugs that I can see.


Version 0.52. Tagged as 'NetBSD-0_52'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   18 Jul 2010
#define USBDriverModule_MajorVersion_CMHG  0.49
@


1.39
log
@Fix USBDriver's handling of PointerV. Increase module version numbers/dates.
Detail:
  build/c/usbmouse - USBDriver's PointerReason_Request handler now correctly restores the IRQ state to that of the caller, instead of unconditionally enabling IRQs. It also correctly intercepts the vector instead of passing it on to other claimants.
  build/Version - This fake VersionNum file hasn't been touched in a long time, leading to some newer versions of the USB modules being released with version numbers identical to their predecessors. This has now been fixed, so that each module has had its version increased by 0.01 and date increased to that of the last (functional) change.
Admin:
  Tested on rev C2 beagleboard


Version 0.50. Tagged as 'NetBSD-0_50'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  02 Oct 2009
#define OHCIDriverModule_MajorVersion_CMHG 0.30
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  02 Oct 2009
#define EHCIDriverModule_MajorVersion_CMHG 0.15
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   28 Feb 2010
#define USBDriverModule_MajorVersion_CMHG  0.48
@


1.38
log
@	Replaced ep resync mechanism in usb_subr
Detail:
	in recent work endpoint resync mechanism in usb_subr
	was removed to re-align better with current NetBSD
	sources.. however without the mechanism Epson
	scanners fail to do repeat scans/
Admin:	Castle added IP


Version 0.46. Tagged as 'NetBSD-0_46'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  31 Dec 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.29
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  15 May 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.14
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   22 Feb 2006
#define USBDriverModule_MajorVersion_CMHG  0.47
@


1.37
log
@	re-merged some items missed by Dan, and corrected usbmodule for
	1 item missed earlier.. interrupt out endpoints noe demonstrated
	working
Detail:
Admin:  jb  Castle added IP


Version 0.45. Tagged as 'NetBSD-0_45'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   05 Jan 2006
#define USBDriverModule_MajorVersion_CMHG  0.46
@


1.36
log
@	updated release version numbers for OHCIDriver and USBDriver
	modules to reflect work done on USB Interrupt Out
Detail:
Admin:


Version 0.44. Tagged as 'NetBSD-0_44'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   31 Dec 2005
#define USBDriverModule_MajorVersion_CMHG  0.45
@


1.35
log
@	Added USB$Ignore_VVVV_PPPP variable.. if it exists
	then the internal hub/kbd/mouse checks are not done.
	it is left ONLY to external programs
Detail:
Admin:


Version 0.42. Tagged as 'NetBSD-0_42'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  15 May 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.28
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   05 Dec 2005
#define USBDriverModule_MajorVersion_CMHG  0.44
@


1.34
log
@	Fixed abort seen with some KVMs and ps2 adaptors in relation
	to !HID
Detail:
	Devices with HID kbd and mouse in separate interfaces were
	not being correctly 'forgotten' when the device was claimed
	by a 3rd party App (!HID). This was because a re-entrancy issue
	led to the second claimed i/f being removed before the first
	was fully removed.
	This led to a muddle in the dev->subdevs array. Solution was to
	unlink it from the subdevs array before 'detaching' it,
	instead of after.
Admin:
	Castle added IP. Tested at Castle. Will be initially released via
	the beta test site.


Version 0.41. Tagged as 'NetBSD-0_41'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   05 Jun 2005
#define USBDriverModule_MajorVersion_CMHG  0.43
@


1.33
log
@	several changes and nullpointer bug fixes
Detail:
	Includes several bug fixes and null pointer traps.
	Rhenium version reviewed and reset should be improved.
Admin:
	Tested in rhenium desktop build and iyonix build at castle
   	Castle added IP


Version 0.40. Tagged as 'NetBSD-0_40'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   15 May 2005
#define USBDriverModule_MajorVersion_CMHG  0.42
@


1.32
log
@	Update of NetBSD elements (except c.ohci) to track NetBSD current
	from mid April 2005.
	Inclusion of Mods to c.ehci (from Dan) to correctly handle low
	speed interrupt devices beyond USB2 hubs (i.e. keyboards and mice).
	Mod to EHCI resetting in service call handler to better cope with
	USBDriver being restarted 'underneath' it.
Detail:
Admin:
	Castle, Dan Ellis, NetBSD added IP. Tested at Castle. Will be
	beta tested at this revision level before full release.


Version 0.39. Tagged as 'NetBSD-0_39'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  25 Apr 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.27
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  25 Apr 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.12
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   25 Apr 2005
#define USBDriverModule_MajorVersion_CMHG  0.41
@


1.31
log
@         small change at start of pipe open process to accomodate
         error return provided by some mass storage devices.
Detail:
Admin:   tested at castle.. castle added ip


Version 0.38. Tagged as 'NetBSD-0_38'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  22 Feb 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.26
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  22 Feb 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.11
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   05 Mar 2005
#define USBDriverModule_MajorVersion_CMHG  0.40
@


1.30
log
@        2 specific changes to USBDriver module
        Added (and fixed code underlying) to give periodic
        explore of USB busses (cf NetBSD).
        Added USBDisover command to let user provoke this too.
        Reworked USB device number allocation to roll
        around at 999 to avoid field overflow in
        a number of places.
Detail:
Admin:  castle added IP. to be beta tested on beta test site


Version 0.37. Tagged as 'NetBSD-0_37'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   24 Feb 2005
#define USBDriverModule_MajorVersion_CMHG  0.39
@


1.29
log
@        An increased delay caused havoc with chicony keyboards in the field
Detail:
        USB_PORT_RESET_DELAY had been increased from 100 to 200ms in previous
        version. This was OK for most devices, and beneficial for some, BUT
        killed the Chicony keyboards shipped with many iyonix.. Delay has
        been reverted to 100ms, and is now run time alterable via the
        USB$PortResetDelay sysvar. This problem did not show up in beta testing!

Admin:  tested by JB with chicony.. delays up to around 160ms work with
        the chicony.
        Castle added IP

Version 0.36. Tagged as 'NetBSD-0_36'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   22 Feb 2005
#define USBDriverModule_MajorVersion_CMHG  0.38
@


1.28
log
@         changes and bug fixes that came to light following USB2 launch.
Detail:
         - VarVal launching.. string length was incorrectly calculated.
         - USB VarVals now correctly cleared if device failed during
           enumeration, after first SetVarVal call.
         - Triggercbs() modified to check interrupt context and be
           refuse (quietly) to trigger callbacks if interrupts threaded
           (result of possible issue .. but perhaps wise)
         - Added third QueryDelay variable, and an Info file to describe
           what does what.
Admin:
         checked at Castle.. due for extended check via beta test site
         before formal release.

         Castle + D Ellis added IP


Version 0.35. Tagged as 'NetBSD-0_35'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  17 Feb 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.25
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  17 Feb 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.10
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   17 Feb 2005
#define USBDriverModule_MajorVersion_CMHG  0.37
@


1.27
log
@Summary:  Minor tweaks to USBDriver and EHCI prior to USB2 release
          resulting from beta testing
Detail:
Admin:    castle and d ellis added IP beyond that in NetBSD sources


Version 0.34. Tagged as 'NetBSD-0_34'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  21 Jan 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.24
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  31 Jan 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.09
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   31 Jan 2005
#define USBDriverModule_MajorVersion_CMHG  0.36
@


1.26
log
@        Stack brought up to date with NetBSD sources as at 20050121.
        USB2 further debugged.
Detail:
        Check in prior to second beta release. Improvements also to
        softloading of replacement modules.
Admin:
        Checked with JB .. further crosschecking is still needed for rhenium.
        Castle/D Ellis added ip from NetBSD sources


Version 0.33. Tagged as 'NetBSD-0_33'
@
text
@d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  21 Jan 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.08
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   21 Jan 2005
#define USBDriverModule_MajorVersion_CMHG  0.35
@


1.25
log
@       improved module startup sequence independance, and added
       service-prereset to
       the ehcimodule. modules in beta test in field
Detail:
Admin:
       castle added ip.  still to be tested on rhenium


Version 0.32. Tagged as 'NetBSD-0_32'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  02 Jan 2005
#define OHCIDriverModule_MajorVersion_CMHG 0.23
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  02 Jan 2005
#define EHCIDriverModule_MajorVersion_CMHG 0.07
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   30 Dec 2004
#define USBDriverModule_MajorVersion_CMHG  0.34
@


1.24
log
@        Update of EHCIDriver to current NetBSD, together with needed changes
        in both OHCIDriver and USBDriver.


Detail:
        Code may change before formal release .. will be beta released
        ... Entered to CVS to get new version numbers, and for
        the record.
Admin:
        Castle/netbsd added IP .. will be tested more fully before
        formal release. Still to be verified on Rhenium.


Version 0.31. Tagged as 'NetBSD-0_31'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  30 Dec 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.22
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  30 Dec 2004
#define EHCIDriverModule_MajorVersion_CMHG 0.06
@


1.23
log
@       change to OHCIModule to pay heed to number of OHCI i/f reported
       by HAL (in Rhenium).. various other small adjustments to improve
       softloadability, both in OHCI and EHCI drivers.
Detail:
Admin:
    tested on iyonix and on rhenium
    castle added IP


Version 0.30. Tagged as 'NetBSD-0_30'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  24 Nov 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.20
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  24 Nov 2004
#define EHCIDriverModule_MajorVersion_CMHG 0.04
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   12 Nov 2004
#define USBDriverModule_MajorVersion_CMHG  0.32
@


1.22
log
@Added 5 extra keycodes for Japanese keyboards to usbkboard.c

Version 0.29. Tagged as 'NetBSD-0_29'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  12 Aug 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.19
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  12 Aug 2004
#define EHCIDriverModule_MajorVersion_CMHG 0.03
@


1.21
log
@  Extensive changes and bug fixes to usb and ohci ..
  'blocked' several holes that could cause freezes with awkward
  usb devices.  Added latest changes from Dan Ellis too , especially for USB2
Detail:
 many
Admin:
 Tested in ROM at Castle, and beta tested with users


Version 0.28. Tagged as 'NetBSD-0_28'
@
text
@d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   12 Aug 2004
#define USBDriverModule_MajorVersion_CMHG  0.31
@


1.20
log
@Latest stuff from John - mainly Rhenium improvements.

Version 0.26. Tagged as 'NetBSD-0_26'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  12 Jun 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.18
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  26 Apr 2004
#define EHCIDriverModule_MajorVersion_CMHG 0.02
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   06 Jun 2004
#define USBDriverModule_MajorVersion_CMHG  0.30
@


1.19
log
@  New versions from John.
Detail:
  * All modules will now rmkill/rmload more reliably
  * Keyboard driver disables kernel debounce on new enough kernels, needed
    for many PS2-USB adaptors, bar code scanners etc
  * Mouse driver will scroll wheel scroll any windows that do respond to
    scroll events, otherwise it issues PointerReason_WheelChange (9) to an
    external WimpScroll module
  * Several bugs and an interrupt hole resolved
Admin:
  Tested at Framlingham.

Version 0.25. Tagged as 'NetBSD-0_25'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  26 Apr 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.17
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   26 Apr 2004
#define USBDriverModule_MajorVersion_CMHG  0.29
@


1.18
log
@Merge of Dan Ellis's USB2 sources.

Version 0.22. Tagged as 'NetBSD-0_22'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  21 Jan 2004
#define OHCIDriverModule_MajorVersion_CMHG 0.16
d8 2
a9 2
#define EHCIDriverModule_Module_Date_CMHG  21 Jan 2004
#define EHCIDriverModule_MajorVersion_CMHG 0.01
d11 2
a12 2
#define USBDriverModule_Module_Date_CMHG   21 Jan 2004
#define USBDriverModule_MajorVersion_CMHG  0.26
@


1.17
log
@Increased version number of USBDriver since it currently matches the version
released with SCSISoftUSB. Retagged.
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  16 Jun 2003
#define OHCIDriverModule_MajorVersion_CMHG 0.14
d8 4
a11 1
#define USBDriverModule_Module_Date_CMHG   07 Jan 2004
@


1.16
log
@Update from John:
> Reduce root port reset delay to 50ms from 250ms to work with Chicony
> keyboards (again).  Comment out duplicate free(udev) at end of
> usbmodule:config_detach.

Version 0.20. Tagged as 'NetBSD-0_20'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   05 Jan 2004
#define USBDriverModule_MajorVersion_CMHG  0.25
@


1.15
log
@Updated the vendor/device headers and table

Version 0.19. Tagged as 'NetBSD-0_19'
@
text
@d8 1
a8 1
#define USBDriverModule_Module_Date_CMHG   03 Jun 2003
@


1.14
log
@USB transfer failed reason strings in the messages files were incorrectly
being tokenised. Also added a couple of bits of debug.

Version 0.18. Tagged as 'NetBSD-0_18'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  14 Apr 2003
#define OHCIDriverModule_MajorVersion_CMHG 0.13
@


1.13
log
@Hand-cranked the version number. Sigh.

Retagged as 'NetBSD-0_17'
@
text
@d8 1
a8 1
#define USBDriverModule_Module_Date_CMHG   23 May 2003
@


1.12
log
@Put the port reset delay back to 50ms.Not sure why NetBSD decided to change
that but it broke the Chicony keyboard supplied in Castle's Iyonix.

Version 0.15. Tagged as 'NetBSD-0_15'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   23 Apr 2003
#define USBDriverModule_MajorVersion_CMHG  0.24
@


1.11
log
@Removed a debugging delay from dev.c.ohci which was breaking everything.
Null vendor names no longer say oflaofla.

Version 0.14. Tagged as 'NetBSD-0_14'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   14 Apr 2003
#define USBDriverModule_MajorVersion_CMHG  0.23
@


1.10
log
@Nicked a few hub related fixes from later NetBSD versions.
Added stuff to delete the DeviceFS$USB*$Options variables when the module is
RMkilled.

Version 0.12. Tagged as 'NetBSD-0_12'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  10 Apr 2003
#define OHCIDriverModule_MajorVersion_CMHG 0.12
d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   10 Apr 2003
#define USBDriverModule_MajorVersion_CMHG  0.22
@


1.9
log
@Fix for erratic behaviour after having unplugged hubs: TAILQ was
being given an entry which wasn't on its list, and the behaviour was to
break the list and poke a zero into the reset vector!
Also, some extra IFDEF's so that debug builds will work again.
A few typos/spelling errors changed.

Version 0.11. Tagged as 'NetBSD-0_11'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  21 Feb 2003
#define OHCIDriverModule_MajorVersion_CMHG 0.11
@


1.8
log
@Before I forget,unset the DeviceFS$USBnnn$Options variable due to not
reusing numbers and DeviceFS not deleting them - is there such thing as
variable leaks?

Version 0.10. Tagged as 'NetBSD-0_10'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   08 Apr 2003
#define USBDriverModule_MajorVersion_CMHG  0.21
@


1.7
log
@Found a "busses" lingering in the messages file,also removed a \n which
must have been copied from a printf somewhere.
Old service call detail removed from c.port as it's defined in another
file differently!
USBDiscover is now only available for debugging purposes.
Internationalised the mouse name (default is still "USB mouse").

Version 0.08. Tagged as 'NetBSD-0_08'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   03 Mar 2003
#define USBDriverModule_MajorVersion_CMHG  0.20
@


1.6
log
@Fix to extern char * thingy which was causing hardware vector 0 to be
scrambled.
Makefile now zaps the linked directory too.

Version 0.07. Tagged as 'NetBSD-0_07'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   10 Feb 2003
#define USBDriverModule_MajorVersion_CMHG  0.19
@


1.5
log
@Resources file was a bit out of sync.No code changes.

Version 0.06. Tagged as 'NetBSD-0_06'
@
text
@d5 2
a6 2
#define OHCIDriverModule_Module_Date_CMHG  27 Jan 2003
#define OHCIDriverModule_MajorVersion_CMHG 0.10
@


1.4
log
@Another fix to the previous buffer overrun fix,such that this time the
command aliases actually get executed now.
Timing code changed to work round HAL call not returning the right value
so temporarily wired to 2000000.
Change to Makefile so ROM builds don't have annoying throwback windows
popping up,this is now in the !Mk file.Also "-ff" function names away.

Version 0.05. Tagged as 'NetBSD-0_05'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   07 Feb 2003
#define USBDriverModule_MajorVersion_CMHG  0.18
@


1.3
log
@Fix for nasty bug where system variable assignment would trample over
random bits of the RMA

Version 0.04. Tagged as 'NetBSD-0_04'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   31 Jan 2003
#define USBDriverModule_MajorVersion_CMHG  0.17
@


1.2
log
@Minor bug fix,the system variable was getting run before the device
was fully established in DeviceFS - which could cause printing problems.

Version 0.03. Tagged as 'NetBSD-0_03'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   29 Jan 2003
#define USBDriverModule_MajorVersion_CMHG  0.16
@


1.1
log
@Fix to interrupt hole in mouse driver.
Version number now got from Version file,not hand tweaked CMHG file.
Timer was a factor 10 out in previous version due to typo.

Version 0.02. Tagged as 'NetBSD-0_02'
@
text
@d8 2
a9 2
#define USBDriverModule_Module_Date_CMHG   28 Jan 2003
#define USBDriverModule_MajorVersion_CMHG  0.15
@

